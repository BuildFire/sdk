"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},postMaster={controlPluginAPI:null,widgetPluginAPI:null,launcherPluginAPI:null,servicePluginAPIs:{},postMessageHandler:function(e){if(e.data){if("object"==_typeof(e.data))e.packet=e.data;else try{e.packet=JSON.parse(e.data)}catch(t){return void console.log("!! Post Master:: Ignore Invalid packet",t,e.data)}postMaster._acceptRequest(e)}},_acceptRequest:function(t){if(t&&t.packet&&t.packet.cmd){var e=!1;if(!(e=n(postMaster.widgetPluginAPI,t))&&(postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI&&(e=n(postMaster.launcherPluginAPI,t)),!e&&!(e=n(postMaster.controlPluginAPI,t)))){for(var s in postMaster.servicePluginAPIs)if(e=n(postMaster.servicePluginAPIs[s],t))return;e||console.warn("no home for this packet (sad face) ")}}function n(t,e){if(!t||!t.postMessageHandler||!e)return!1;try{return t.postMessageHandler(e)}catch(t){return console.error("postMessageHandler error:",t),!1}}},broadcast:function(e,s){function t(t){t&&(s&&t.context.instanceId!=s||t.sendMessage(null,e))}for(var n in t(postMaster.controlPluginAPI),postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI&&t(postMaster.widgetPluginAPI),postMaster.launcherPluginAPI&&postMaster.widgetPluginAPI==postMaster.launcherPluginAPI&&(e.fid=postMaster.launcherPluginAPI.iFrameId),postMaster.launcherPluginAPI&&t(postMaster.launcherPluginAPI),postMaster.servicePluginAPIs)t(postMaster.servicePluginAPIs[n])},attachService:function(t,e){this.servicePluginAPIs[t]=e},dettachService:function(t){delete this.servicePluginAPIs[t]},isLauncherPluginActive:function(){return null==postMaster.widgetPluginAPI||postMaster.widgetPluginAPI==postMaster.launcherPluginAPI}};window.addEventListener("message",postMaster.postMessageHandler,!1);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,a,e,E){function h(t,e,i){return setTimeout(u(t,i),e)}function i(t,e,i){return!!Array.isArray(t)&&(r(t,i[e],i),!0)}function r(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==E)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function s(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===E)&&(t[n[r]]=e[n[r]]),r++;return t}function n(t,e){return s(t,e,!0)}function o(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&s(n,i)}function u(t,e){return function(){return t.apply(e,arguments)}}function c(t,e){return(void 0===t?"undefined":_typeof(t))==K?t.apply(e&&e[0]||E,e):t}function l(t,e){return t===E?e:t}function p(e,t,i){r(v(t),function(t){e.addEventListener(t,i,!1)})}function f(e,t,i){r(v(t),function(t){e.removeEventListener(t,i,!1)})}function I(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function d(t,e){return-1<t.indexOf(e)}function v(t){return t.trim().split(/\s+/g)}function m(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function g(t){return Array.prototype.slice.call(t,0)}function y(t,i,e){for(var n=[],r=[],s=0;s<t.length;){var o=i?t[s][i]:t[s];m(r,o)<0&&n.push(t[s]),r[s]=o,s++}return e&&(n=i?n.sort(function(t,e){return t[i]>e[i]}):n.sort()),n}function T(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),s=0;s<B.length;){if((n=(i=B[s])?i+r:e)in t)return n;s++}return E}function _(t){var e=t.ownerDocument;return e.defaultView||e.parentWindow}function A(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){c(e.options.enable,[e])&&i.handler(t)},this.init()}function S(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,s=e&ht&&n-r==0,o=e&(ut|ct)&&n-r==0;i.isFirst=!!s,i.isFinal=!!o,s&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=b(e)),1<r&&!i.firstMultiple?i.firstMultiple=b(e):1===r&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,a=o?o.center:s.center,h=e.center=D(n);e.timeStamp=tt(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=R(a,h),e.distance=C(a,h),f=i,d=e,v=d.center,m=f.offsetDelta||{},g=f.prevDelta||{},y=f.prevInput||{},(d.eventType===ht||y.eventType===ut)&&(g=f.prevDelta={x:y.deltaX||0,y:y.deltaY||0},m=f.offsetDelta={x:v.x,y:v.y}),d.deltaX=g.x+(v.x-m.x),d.deltaY=g.y+(v.y-m.y),e.offsetDirection=w(e.deltaX,e.deltaY),e.scale=o?(l=o.pointers,p=n,C(p[0],p[1],Et)/C(l[0],l[1],Et)):1,e.rotation=o?(u=o.pointers,c=n,R(c[1],c[0],Et)-R(u[1],u[0],Et)):0,function(t,e){var i,n,r,s,o=t.lastInterval||e,a=e.timeStamp-o.timeStamp;if(e.eventType!=ct&&(at<a||o.velocity===E)){var h=o.deltaX-e.deltaX,u=o.deltaY-e.deltaY,c={x:h/(l=a)||0,y:u/l||0};n=c.x,r=c.y,i=$(c.x)>$(c.y)?c.x:c.y,s=w(h,u),t.lastInterval=e}else i=o.velocity,n=o.velocityX,r=o.velocityY,s=o.direction;var l;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=s}(i,e);var u,c;var l,p;var f,d,v,m,g,y;var T=t.element;I(e.srcEvent.target,T)&&(T=e.srcEvent.target),e.target=T}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function b(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:Q(t.pointers[i].clientX),clientY:Q(t.pointers[i].clientY)},i++;return{timeStamp:tt(),pointers:e,center:D(e),deltaX:t.deltaX,deltaY:t.deltaY}}function D(t){var e=t.length;if(1===e)return{x:Q(t[0].clientX),y:Q(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:Q(i/e),y:Q(n/e)}}function w(t,e){return t===e?lt:$(t)>=$(e)?0<t?pt:ft:0<e?dt:vt}function C(t,e,i){i||(i=Tt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function R(t,e,i){i||(i=Tt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function z(){this.evEl=_t,this.evWin=At,this.allow=!0,this.pressed=!1,A.apply(this,arguments)}function N(){this.evEl=Dt,this.evWin=wt,A.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function P(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,A.apply(this,arguments)}function M(){this.evTarget=zt,this.targetIds={},A.apply(this,arguments)}function O(){A.apply(this,arguments);var t=u(this.handler,this);this.touch=new M(this.manager,t),this.mouse=new z(this.manager,t)}function x(t,e){this.manager=t,this.set(e)}function X(t){this.id=et++,this.manager=null,this.options=n(t||{},this.defaults),this.options.enable=l(this.options.enable,!0),this.state=Ft,this.simultaneous={},this.requireFail=[]}function Y(t){return t==vt?"down":t==dt?"up":t==pt?"left":t==ft?"right":""}function F(t,e){var i=e.manager;return i?i.get(t):t}function W(){X.apply(this,arguments)}function q(){W.apply(this,arguments),this.pX=null,this.pY=null}function L(){W.apply(this,arguments)}function H(){X.apply(this,arguments),this._timer=null,this._input=null}function k(){W.apply(this,arguments)}function U(){W.apply(this,arguments)}function G(){X.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function V(t,e){return(e=e||{}).recognizers=l(e.recognizers,V.defaults.preset),new j(t,e)}function j(t,e){var i;e=e||{},this.options=n(e,V.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=new((i=this).options.inputClass||(nt?N:rt?M:it?O:z))(i,S),this.touchAction=new x(this,this.options.touchAction),Z(this,!0),r(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function Z(t,i){var n=t.element;r(t.options.cssProps,function(t,e){n.style[T(n.style,e)]=i?t:""})}var B=["","webkit","moz","MS","ms","o"],J=a.createElement("div"),K="function",Q=Math.round,$=Math.abs,tt=Date.now,et=1,it="ontouchstart"in t,nt=T(t,"PointerEvent")!==E,rt=it&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),st="touch",ot="mouse",at=25,ht=1,ut=4,ct=8,lt=1,pt=2,ft=4,dt=8,vt=16,mt=pt|ft,gt=dt|vt,yt=mt|gt,Tt=["x","y"],Et=["clientX","clientY"];A.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(_(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(_(this.element),this.evWin,this.domHandler)}};var It={mousedown:ht,mousemove:2,mouseup:ut},_t="mousedown",At="mousemove mouseup";o(z,A,{handler:function(t){var e=It[t.type];e&ht&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=ut),this.pressed&&this.allow&&(e&ut&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:ot,srcEvent:t}))}});var St={pointerdown:ht,pointermove:2,pointerup:ut,pointercancel:ct,pointerout:ct},bt={2:st,3:"pen",4:ot,5:"kinect"},Dt="pointerdown",wt="pointermove pointerup pointercancel";t.MSPointerEvent&&(Dt="MSPointerDown",wt="MSPointerMove MSPointerUp MSPointerCancel"),o(N,A,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=St[n],s=bt[t.pointerType]||t.pointerType,o=s==st,a=m(e,t.pointerId,"pointerId");r&ht&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):r&(ut|ct)&&(i=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(a,1))}});var Ct={touchstart:ht,touchmove:2,touchend:ut,touchcancel:ct};o(P,A,{handler:function(t){var e=Ct[t.type];if(e===ht&&(this.started=!0),this.started){var i=function(t,e){var i=g(t.touches),n=g(t.changedTouches);return e&(ut|ct)&&(i=y(i.concat(n),"identifier",!0)),[i,n]}.call(this,t,e);e&(ut|ct)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:st,srcEvent:t})}}});var Rt={touchstart:ht,touchmove:2,touchend:ut,touchcancel:ct},zt="touchstart touchmove touchend touchcancel";o(M,A,{handler:function(t){var e=Rt[t.type],i=function(t,e){var i=g(t.touches),n=this.targetIds;if(e&(2|ht)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s,o=g(t.changedTouches),a=[],h=this.target;if(s=i.filter(function(t){return I(t.target,h)}),e===ht)for(r=0;r<s.length;)n[s[r].identifier]=!0,r++;for(r=0;r<o.length;)n[o[r].identifier]&&a.push(o[r]),e&(ut|ct)&&delete n[o[r].identifier],r++;return a.length?[y(s.concat(a),"identifier",!0),a]:void 0}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:st,srcEvent:t})}}),o(O,A,{handler:function(t,e,i){var n=i.pointerType==st,r=i.pointerType==ot;if(n)this.mouse.allow=!1;else if(r&&!this.mouse.allow)return;e&(ut|ct)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Nt=T(J.style,"touchAction"),Pt=Nt!==E,Mt="compute",Ot="manipulation",xt="none",Xt="pan-x",Yt="pan-y";x.prototype={set:function(t){t==Mt&&(t=this.compute()),Pt&&(this.manager.element.style[Nt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return r(this.manager.recognizers,function(t){c(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(t){if(d(t,xt))return xt;var e=d(t,Xt),i=d(t,Yt);return e&&i?Xt+" "+Yt:e||i?e?Xt:Yt:d(t,Ot)?Ot:"auto"}(e.join(" "))},preventDefaults:function(t){if(!Pt){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,r=d(n,xt),s=d(n,Yt),o=d(n,Xt);return r||s&&i&mt||o&&i&gt?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ft=1,Wt=2,qt=4,Lt=8,Ht=Lt,kt=16;X.prototype={defaults:{},set:function(t){return s(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(i(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=F(t,this)).id]||(e[t.id]=t).recognizeWith(this),this},dropRecognizeWith:function(t){return i(t,"dropRecognizeWith",this)||(t=F(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(i(t,"requireFailure",this))return this;var e=this.requireFail;return-1===m(e,t=F(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(i(t,"dropRequireFailure",this))return this;t=F(t,this);var e=m(this.requireFail,t);return-1<e&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(i){function t(t){var e;n.manager.emit(n.options.event+(t?(e=r)&kt?"cancel":e&Lt?"end":e&qt?"move":e&Wt?"start":"":""),i)}var n=this,r=this.state;r<Lt&&t(!0),t(),Lt<=r&&t(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=32)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Ft)))return!1;t++}return!0},recognize:function(t){var e=s({},t);return c(this.options.enable,[this,e])?(this.state&(Ht|kt|32)&&(this.state=Ft),this.state=this.process(e),void(this.state&(Wt|qt|Lt|kt)&&this.tryEmit(e))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}},o(W,X,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Wt|qt),r=this.attrTest(t);return n&&(i&ct||!r)?e|kt:n||r?i&ut?e|Lt:e&Wt?e|qt:Wt:32}}),o(q,W,{defaults:{event:"pan",threshold:10,pointers:1,direction:yt},getTouchAction:function(){var t=this.options.direction,e=[];return t&mt&&e.push(Yt),t&gt&&e.push(Xt),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(n=e.direction&mt?(r=0===s?lt:s<0?pt:ft,i=s!=this.pX,Math.abs(t.deltaX)):(r=0===o?lt:o<0?dt:vt,i=o!=this.pY,Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return W.prototype.attrTest.call(this,t)&&(this.state&Wt||!(this.state&Wt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Y(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),o(L,W,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Wt)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),o(H,X,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(ut|ct)&&!r)this.reset();else if(t.eventType&ht)this.reset(),this._timer=h(function(){this.state=Ht,this.tryEmit()},e.time,this);else if(t.eventType&ut)return Ht;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Ht&&(t&&t.eventType&ut?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=tt(),this.manager.emit(this.options.event,this._input)))}}),o(k,W,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Wt)}}),o(U,W,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:mt|gt,pointers:1},getTouchAction:function(){return q.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(mt|gt)?e=t.velocity:i&mt?e=t.velocityX:i&gt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&$(e)>this.options.velocity&&t.eventType&ut},emit:function(t){var e=Y(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),o(G,X,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Ot]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&ht&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=ut)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||C(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=h(function(){this.state=Ht,this.tryEmit()},e.interval,this),Wt):Ht}return 32},failTimeout:function(){return this._timer=h(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ht&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),V.VERSION="2.0.4",V.defaults={domEvents:!1,touchAction:Mt,enable:!0,inputTarget:null,inputClass:null,preset:[[k,{enable:!1}],[L,{enable:!1},["rotate"]],[U,{direction:mt}],[q,{direction:mt},["swipe"]],[G],[G,{event:"doubletap",taps:2},["tap"]],[H]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};j.prototype={set:function(t){return s(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Ht)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(Wt|qt|Lt)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof X)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(i(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),(t.manager=this).touchAction.update(),t},remove:function(t){if(i(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(m(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return r(v(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return r(v(t),function(t){e?i[t].splice(m(i[t],e),1):delete i[t]}),this},emit:function(t,e){var i,n,r;this.options.domEvents&&(i=t,n=e,(r=a.createEvent("Event")).initEvent(i,!0,!0),(r.gesture=n).target.dispatchEvent(r));var s=this.handlers[t]&&this.handlers[t].slice();if(s&&s.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var o=0;o<s.length;)s[o](e),o++}},destroy:function(){this.element&&Z(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},s(V,{INPUT_START:ht,INPUT_MOVE:2,INPUT_END:ut,INPUT_CANCEL:ct,STATE_POSSIBLE:Ft,STATE_BEGAN:Wt,STATE_CHANGED:qt,STATE_ENDED:Lt,STATE_RECOGNIZED:Ht,STATE_CANCELLED:kt,STATE_FAILED:32,DIRECTION_NONE:lt,DIRECTION_LEFT:pt,DIRECTION_RIGHT:ft,DIRECTION_UP:dt,DIRECTION_DOWN:vt,DIRECTION_HORIZONTAL:mt,DIRECTION_VERTICAL:gt,DIRECTION_ALL:yt,Manager:j,Input:A,TouchAction:x,TouchInput:M,MouseInput:z,PointerEventInput:N,TouchMouseInput:O,SingleTouchInput:P,Recognizer:X,AttrRecognizer:W,Tap:G,Pan:q,Swipe:U,Pinch:L,Rotate:k,Press:H,on:p,off:f,each:r,merge:n,extend:s,inherit:o,bindFn:u,prefixed:T}),("undefined"==typeof define?"undefined":_typeof(define))==K&&define.amd?define(function(){return V}):"undefined"!=typeof module&&module.exports?module.exports=V:t.Hammer=V}(window,document);
"use strict";var WebPullToRefresh=function(){var e="content",r="ptr",o=70,a=!1,s=2.5,i={},n={enabled:!1,distance:0,startingPositionY:0},c=document.body.classList,d=function(t){n.startingPositionY=document.body.scrollTop,0===n.startingPositionY&&(n.enabled=!0)},l=function(t){n.enabled&&(t.preventDefault(),n.distance=t.distance/i.resistance,u(),m())},f=function(t){n.enabled&&0!==n.distance&&(t.preventDefault(),n.distance<t.distance/i.resistance?n.distance=0:n.distance=t.distance/i.resistance,u(),m())},u=function(){i.contentEl.style.transform=i.contentEl.style.webkitTransform="translate3d( 0, "+n.distance+"px, 0 )",i.ptrEl.style.transform=i.ptrEl.style.webkitTransform="translate3d( 0, "+(n.distance-i.ptrEl.offsetHeight)+"px, 0 )"},m=function(){n.distance>i.distanceToRefresh?c.add("ptr-refresh"):c.remove("ptr-refresh")},p=function(t){n.enabled&&(t.preventDefault(),i.contentEl.style.transform=i.contentEl.style.webkitTransform="",i.ptrEl.style.transform=i.ptrEl.style.webkitTransform="",document.body.classList.contains("ptr-refresh")?E():b(),n.distance=0,n.enabled=!1)},E=function(){if(c.add("ptr-loading"),!i.loadingFunction)return b();var t=i.loadingFunction();setTimeout(function(){t.then(b)},1e3)},b=function(){c.remove("ptr-loading"),c.remove("ptr-refresh"),c.add("ptr-reset");document.body.addEventListener("transitionend",function t(){c.remove("ptr-reset"),document.body.removeEventListener("transitionend",t,!1)},!1)};return{init:function(t){if(!(i={contentEl:(t=t||{}).contentEl||document.getElementById(e),ptrEl:t.ptrEl||document.getElementById(r),distanceToRefresh:t.distanceToRefresh||o,loadingFunction:t.loadingFunction||a,resistance:t.resistance||s}).contentEl||!i.ptrEl)return!1;var n=new Hammer(i.contentEl);n.get("pan").set({direction:Hammer.DIRECTION_VERTICAL}),n.on("panstart",d),n.on("pandown",l),n.on("panup",f),n.on("panend",p)},disable:function(){if(i&&i.contentEl){var t=new Hammer(i.contentEl);t&&t.get("pan").set({enable:!1})}},enable:function(){if(i&&i.contentEl){var t=new Hammer(i.contentEl);t&&t.get("pan").set({enable:!0})}}}}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(b){function d(t,e){if(e=e||{},(t=t||"")instanceof d)return t;if(!(this instanceof d))return new d(t,e);var r,n,a,i,o,s,f,h,l,u,c,g=(n={r:0,g:0,b:0},s=o=i=null,h=f=!(a=1),"string"==typeof(r=t)&&(r=function(t){t=t.replace(F,"").replace(C,"").toLowerCase();var e,r=!1;if(j[t])t=j[t],r=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(e=P.rgb.exec(t))?{r:e[1],g:e[2],b:e[3]}:(e=P.rgba.exec(t))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=P.hsl.exec(t))?{h:e[1],s:e[2],l:e[3]}:(e=P.hsla.exec(t))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=P.hsv.exec(t))?{h:e[1],s:e[2],v:e[3]}:(e=P.hsva.exec(t))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=P.hex8.exec(t))?{r:x(e[1]),g:x(e[2]),b:x(e[3]),a:H(e[4]),format:r?"name":"hex8"}:(e=P.hex6.exec(t))?{r:x(e[1]),g:x(e[2]),b:x(e[3]),format:r?"name":"hex"}:(e=P.hex4.exec(t))?{r:x(e[1]+""+e[1]),g:x(e[2]+""+e[2]),b:x(e[3]+""+e[3]),a:H(e[4]+""+e[4]),format:r?"name":"hex8"}:!!(e=P.hex3.exec(t))&&{r:x(e[1]+""+e[1]),g:x(e[2]+""+e[2]),b:x(e[3]+""+e[3]),format:r?"name":"hex"}}(r)),"object"==(void 0===r?"undefined":_typeof(r))&&(R(r.r)&&R(r.g)&&R(r.b)?(l=r.r,u=r.g,c=r.b,n={r:255*y(l,255),g:255*y(u,255),b:255*y(c,255)},f=!0,h="%"===String(r.r).substr(-1)?"prgb":"rgb"):R(r.h)&&R(r.s)&&R(r.v)?(i=w(r.s),o=w(r.v),n=function(t,e,r){t=6*y(t,360),e=y(e,100),r=y(r,100);var n=b.floor(t),a=t-n,i=r*(1-e),o=r*(1-a*e),s=r*(1-(1-a)*e),f=n%6;return{r:255*[r,o,i,i,s,r][f],g:255*[s,r,r,o,i,i][f],b:255*[i,i,s,r,r,o][f]}}(r.h,i,o),f=!0,h="hsv"):R(r.h)&&R(r.s)&&R(r.l)&&(i=w(r.s),s=w(r.l),n=function(t,e,r){function n(t,e,r){return r<0&&(r+=1),1<r&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}var a,i,o;if(t=y(t,360),e=y(e,100),r=y(r,100),0===e)a=i=o=r;else{var s=r<.5?r*(1+e):r+e-r*e,f=2*r-s;a=n(f,s,t+1/3),i=n(f,s,t),o=n(f,s,t-1/3)}return{r:255*a,g:255*i,b:255*o}}(r.h,i,s),f=!0,h="hsl"),r.hasOwnProperty("a")&&(a=r.a)),a=v(a),{ok:f,format:r.format||h,r:I(255,L(n.r,0)),g:I(255,L(n.g,0)),b:I(255,L(n.b,0)),a:a});this._originalInput=t,this._r=g.r,this._g=g.g,this._b=g.b,this._a=g.a,this._roundA=M(100*this._a)/100,this._format=e.format||g.format,this._gradientType=e.gradientType,this._r<1&&(this._r=M(this._r)),this._g<1&&(this._g=M(this._g)),this._b<1&&(this._b=M(this._b)),this._ok=g.ok,this._tc_id=q++}function a(t,e,r){t=y(t,255),e=y(e,255),r=y(r,255);var n,a,i=L(t,e,r),o=I(t,e,r),s=(i+o)/2;if(i==o)n=a=0;else{var f=i-o;switch(a=.5<s?f/(2-i-o):f/(i+o),i){case t:n=(e-r)/f+(e<r?6:0);break;case e:n=(r-t)/f+2;break;case r:n=(t-e)/f+4}n/=6}return{h:n,s:a,l:s}}function i(t,e,r){t=y(t,255),e=y(e,255),r=y(r,255);var n,a,i=L(t,e,r),o=I(t,e,r),s=i,f=i-o;if(a=0===i?0:f/i,i==o)n=0;else{switch(i){case t:n=(e-r)/f+(e<r?6:0);break;case e:n=(r-t)/f+2;break;case r:n=(t-e)/f+4}n/=6}return{h:n,s:a,v:s}}function e(t,e,r,n){var a=[k(M(t).toString(16)),k(M(e).toString(16)),k(M(r).toString(16))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function o(t,e,r,n){return[k(S(n)),k(M(t).toString(16)),k(M(e).toString(16)),k(M(r).toString(16))].join("")}function t(t,e){e=0===e?0:e||10;var r=d(t).toHsl();return r.s-=e/100,r.s=A(r.s),d(r)}function r(t,e){e=0===e?0:e||10;var r=d(t).toHsl();return r.s+=e/100,r.s=A(r.s),d(r)}function n(t){return d(t).desaturate(100)}function s(t,e){e=0===e?0:e||10;var r=d(t).toHsl();return r.l+=e/100,r.l=A(r.l),d(r)}function f(t,e){e=0===e?0:e||10;var r=d(t).toRgb();return r.r=L(0,I(255,r.r-M(-e/100*255))),r.g=L(0,I(255,r.g-M(-e/100*255))),r.b=L(0,I(255,r.b-M(-e/100*255))),d(r)}function h(t,e){e=0===e?0:e||10;var r=d(t).toHsl();return r.l-=e/100,r.l=A(r.l),d(r)}function l(t,e){var r=d(t).toHsl(),n=(r.h+e)%360;return r.h=n<0?360+n:n,d(r)}function u(t){var e=d(t).toHsl();return e.h=(e.h+180)%360,d(e)}function c(t){var e=d(t).toHsl(),r=e.h;return[d(t),d({h:(r+120)%360,s:e.s,l:e.l}),d({h:(r+240)%360,s:e.s,l:e.l})]}function g(t){var e=d(t).toHsl(),r=e.h;return[d(t),d({h:(r+90)%360,s:e.s,l:e.l}),d({h:(r+180)%360,s:e.s,l:e.l}),d({h:(r+270)%360,s:e.s,l:e.l})]}function p(t){var e=d(t).toHsl(),r=e.h;return[d(t),d({h:(r+72)%360,s:e.s,l:e.l}),d({h:(r+216)%360,s:e.s,l:e.l})]}function _(t,e,r){e=e||6,r=r||30;var n=d(t).toHsl(),a=360/r,i=[d(t)];for(n.h=(n.h-(a*e>>1)+720)%360;--e;)n.h=(n.h+a)%360,i.push(d(n));return i}function m(t,e){e=e||6;for(var r=d(t).toHsv(),n=r.h,a=r.s,i=r.v,o=[],s=1/e;e--;)o.push(d({h:n,s:a,v:i})),i=(i+s)%1;return o}function v(t){return t=parseFloat(t),(isNaN(t)||t<0||1<t)&&(t=1),t}function y(t,e){var r;"string"==typeof(r=t)&&-1!=r.indexOf(".")&&1===parseFloat(r)&&(t="100%");var n,a="string"==typeof(n=t)&&-1!=n.indexOf("%");return t=I(e,L(0,parseFloat(t))),a&&(t=parseInt(t*e,10)/100),b.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function A(t){return I(1,L(0,t))}function x(t){return parseInt(t,16)}function k(t){return 1==t.length?"0"+t:""+t}function w(t){return t<=1&&(t=100*t+"%"),t}function S(t){return b.round(255*parseFloat(t)).toString(16)}function H(t){return x(t)/255}function R(t){return!!P.CSS_UNIT.exec(t)}var F=/^\s+/,C=/\s+$/,q=0,M=b.round,I=b.min,L=b.max,N=b.random;d.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,r,n=this.toRgb();return t=n.r/255,e=n.g/255,r=n.b/255,.2126*(t<=.03928?t/12.92:b.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:b.pow((e+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:b.pow((r+.055)/1.055,2.4))},setAlpha:function(t){return this._a=v(t),this._roundA=M(100*this._a)/100,this},toHsv:function(){var t=i(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=i(this._r,this._g,this._b),e=M(360*t.h),r=M(100*t.s),n=M(100*t.v);return 1==this._a?"hsv("+e+", "+r+"%, "+n+"%)":"hsva("+e+", "+r+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=a(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=a(this._r,this._g,this._b),e=M(360*t.h),r=M(100*t.s),n=M(100*t.l);return 1==this._a?"hsl("+e+", "+r+"%, "+n+"%)":"hsla("+e+", "+r+"%, "+n+"%, "+this._roundA+")"},toHex:function(t){return e(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return e=this._r,r=this._g,n=this._b,a=this._a,i=t,o=[k(M(e).toString(16)),k(M(r).toString(16)),k(M(n).toString(16)),k(S(a))],i&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("");var e,r,n,a,i,o},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:M(this._r),g:M(this._g),b:M(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+M(this._r)+", "+M(this._g)+", "+M(this._b)+")":"rgba("+M(this._r)+", "+M(this._g)+", "+M(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:M(100*y(this._r,255))+"%",g:M(100*y(this._g,255))+"%",b:M(100*y(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+M(100*y(this._r,255))+"%, "+M(100*y(this._g,255))+"%, "+M(100*y(this._b,255))+"%)":"rgba("+M(100*y(this._r,255))+"%, "+M(100*y(this._g,255))+"%, "+M(100*y(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(O[e(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+o(this._r,this._g,this._b,this._a),r=e,n=this._gradientType?"GradientType = 1, ":"";if(t){var a=d(t);r="#"+o(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+r+")"},toString:function(t){var e=!!t;t=t||this._format;var r=!1,n=this._a<1&&0<=this._a;return!e&&n&&("hex"===t||"hex6"===t||"hex3"===t||"hex4"===t||"hex8"===t||"name"===t)?"name"===t&&0===this._a?this.toName():this.toRgbString():("rgb"===t&&(r=this.toRgbString()),"prgb"===t&&(r=this.toPercentageRgbString()),("hex"===t||"hex6"===t)&&(r=this.toHexString()),"hex3"===t&&(r=this.toHexString(!0)),"hex4"===t&&(r=this.toHex8String(!0)),"hex8"===t&&(r=this.toHex8String()),"name"===t&&(r=this.toName()),"hsl"===t&&(r=this.toHslString()),"hsv"===t&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return d(this.toString())},_applyModification:function(t,e){var r=t.apply(null,[this].concat([].slice.call(e)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(s,arguments)},brighten:function(){return this._applyModification(f,arguments)},darken:function(){return this._applyModification(h,arguments)},desaturate:function(){return this._applyModification(t,arguments)},saturate:function(){return this._applyModification(r,arguments)},greyscale:function(){return this._applyModification(n,arguments)},spin:function(){return this._applyModification(l,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(_,arguments)},complement:function(){return this._applyCombination(u,arguments)},monochromatic:function(){return this._applyCombination(m,arguments)},splitcomplement:function(){return this._applyCombination(p,arguments)},triad:function(){return this._applyCombination(c,arguments)},tetrad:function(){return this._applyCombination(g,arguments)}},d.fromRatio=function(t,e){if("object"==(void 0===t?"undefined":_typeof(t))){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]="a"===n?t[n]:w(t[n]));t=r}return d(t,e)},d.equals=function(t,e){return!(!t||!e)&&d(t).toRgbString()==d(e).toRgbString()},d.random=function(){return d.fromRatio({r:N(),g:N(),b:N()})},d.mix=function(t,e,r){r=0===r?0:r||50;var n=d(t).toRgb(),a=d(e).toRgb(),i=r/100;return d({r:(a.r-n.r)*i+n.r,g:(a.g-n.g)*i+n.g,b:(a.b-n.b)*i+n.b,a:(a.a-n.a)*i+n.a})},d.readability=function(t,e){var r=d(t),n=d(e);return(b.max(r.getLuminance(),n.getLuminance())+.05)/(b.min(r.getLuminance(),n.getLuminance())+.05)},d.isReadable=function(t,e,r){var n,a,i,o,s,f=d.readability(t,e);switch(a=!1,"AA"!==(o=((i=(i=r)||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==o&&(o="AA"),"small"!==(s=(i.size||"small").toLowerCase())&&"large"!==s&&(s="small"),(n={level:o,size:s}).level+n.size){case"AAsmall":case"AAAlarge":a=4.5<=f;break;case"AAlarge":a=3<=f;break;case"AAAsmall":a=7<=f}return a},d.mostReadable=function(t,e,r){var n,a,i,o,s=null,f=0;a=(r=r||{}).includeFallbackColors,i=r.level,o=r.size;for(var h=0;h<e.length;h++)f<(n=d.readability(t,e[h]))&&(f=n,s=d(e[h]));return d.isReadable(t,s,{level:i,size:o})||!a?s:(r.includeFallbackColors=!1,d.mostReadable(t,["#fff","#000"],r))};var z,E,T,j=d.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},O=d.hexNames=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[t[r]]=r);return e}(j),P=(E="[\\s|\\(]+("+(z="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+z+")[,|\\s]+("+z+")\\s*\\)?",T="[\\s|\\(]+("+z+")[,|\\s]+("+z+")[,|\\s]+("+z+")[,|\\s]+("+z+")\\s*\\)?",{CSS_UNIT:new RegExp(z),rgb:new RegExp("rgb"+E),rgba:new RegExp("rgba"+T),hsl:new RegExp("hsl"+E),hsla:new RegExp("hsla"+T),hsv:new RegExp("hsv"+E),hsva:new RegExp("hsva"+T),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});"undefined"!=typeof module&&module.exports?module.exports=d:"function"==typeof define&&define.amd?define(function(){return d}):window.tinycolor=d}(Math);
"use strict";!function(){function e(t){return this.promise=new Promise(t),this.promise.success=function(t){return this.then(t),this},this.promise.error=function(t){return this.then(null,t),this},this.promise}function o(){}console.log("httpClient is loading"),o.get=function(t,e){return o.request("GET",t,void 0,e)},o.post=function(t,e,n){return o.request("POST",t,e)},o.put=function(t,e,n){return o.request("PUT",t,e)},o.jsonp=function(t,e,n){throw new Error("jsonp not ready")},o.request=function(o,r,s,t){return console.log("httpClient create request for url: ",r," using method: ",o),new e(function(e,t){var n=new XMLHttpRequest;n.onload=function(){console.log("httpClient read response for url: ",r," using method: ",o);n.status,n.statusText;var t="response"in n?n.response:n.responseText;e(t?JSON.parse(t):null)},n.onerror=function(){console.log("httpClient failed for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},n.ontimeout=function(){console.log("httpClient timed out for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},console.log("httpClient requesting for url: ",r," using method: ",o),n.open(o,r,!0),n.send(s)})},window.httpClient=o}();
"use strict";var bfUtils={get deviceOnline(){return!("undefined"==typeof window||!window.ignoreNavigatorOnline)||("undefined"==typeof navigator||(navigator.connection&&navigator.connection.type?"none"!=navigator.connection.type:void 0===navigator.onLine||navigator.onLine))},get isMobileDevice(){return window.location.protocol.indexOf("http")<0},get isAndroid(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"Android"==device.platform},get isIOS(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"iOS"==device.platform},get isPwaAndroid(){return!!navigator.userAgent.match(/Android/i)},get isPwaiOS(){return"standalone"in window.navigator&&!window.navigator.standalone},get isAppHtml5Version(){return window.self==window.top},get isEmulatorCP(){return window.top&&window.top!=window&&0==window.location.protocol.indexOf("http")},get isApp(){return!!window.siteConfig&&"app"===window.siteConfig.scope},tryParseJSON:function(i){try{return JSON.parse(i)}catch(n){return void console.error("Cannot parse data :: "+i,n.message,n.stack)}},get http(){return window.$http?window.$http:window.httpClient},getIPAddress:function(i){bfUtils.http.get(siteConfig.endPoints.crmHost+"/ipinfo").success(function(n){i(null,n)}).error(function(n){i(n)})},sanitize:function(n,i){bfUtils.sanitizeCallbacks=bfUtils.sanitizeCallbacks||[];var t,o,e=n.data,s={onIgnoreTagAttr:function(n,i,t,o){if("class"===i||"style"===i||"src"===i||"id"===i)return i+'="'+t+'"'}};"undefined"==typeof filterXSS?bfUtils.isLoadingXSSLibrary?bfUtils.sanitizeCallbacks.push(function(){i(null,filterXSS(e,s))}):(bfUtils.isLoadingXSSLibrary=!0,bfUtils.sanitizeCallbacks.push(function(){i(null,filterXSS(e,s))}),t=function(){bfUtils.sanitizeCallbacks.forEach(function(n){n()})},o=document.createElement("script"),"sdk"==window.siteConfig.scope?o.src="scripts/lib/xss.min.js":window._appRoot?o.src=window._appRoot+"scripts/lib/xss/xss.min.js":o.src="/app/scripts/lib/xss/xss.min.js",o.type="text/javascript",o.onload=function(){t&&t()},document.getElementsByTagName("head")[0].appendChild(o)):i(null,filterXSS(e,s))}};
"use strict";var customRegistration={googleMapServices:{},get wl_name(){var e="Full ";return appContext&&appContext.currentApp&&appContext.currentApp.config&&(e=appContext.currentApp.config.whitlabelName+" "),e},getSettings:function(e,t){var s="appearance",i={appId:window.appContext.currentApp.appId,pluginId:s,instanceId:s};new window.DatastoreAPI(i).get({tag:s,withDynamicData:!0},function(e,s){if(e)return console.error(e),void t(e);s&&s.data&&s.data.customRegistration&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?t(null,s.data.customRegistration):t(null,null)})},getFields:function(n,e){var s=n.customRegistrationSettings;if(s&&s.singlePage&&s.singlePage.formControls){var r=[],i={},o=[],l=[];s.singlePage.formControls.forEach(function(a,e){switch(a.id){case"fullName":a.active&&(a.settings.displayNameEnabled&&r.push({type:"text",viewType:"none",name:"displayName",order:e,label:a.options.fieldsLabels.displayName,iconClass:a.icon,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults?n.defaults.displayName:void 0}),a.settings.firstNameEnabled&&r.push({type:"text",viewType:"text",name:"firstName",order:e,label:a.options.fieldsLabels.firstName,iconClass:a.icon,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults?n.defaults.firstName:void 0}),a.settings.lastNameEnabled&&r.push({type:"text",viewType:"text",name:"lastName",order:e,label:a.options.fieldsLabels.lastName,iconClass:a.icon,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults?n.defaults.lastName:void 0}));break;case"email":r.push({type:"email",viewType:"email",name:"email",autocorrect:"off",autocapitalize:"none",order:e,label:a.options.fieldsLabels.email,iconClass:a.icon,validate:function(e){this.error=null,e&&e.trim().length?window.validator.validateEmail(e)?e&&e.trim().length||(this.error=a.options.errorMessages.emailAlreadyInUse):this.error=a.options.errorMessages.emailInvalidFormat:this.error=a.options.errorMessages.emailRequired},touch:function(e,s){!e&&s&&s.target&&(e=s.target.value),this.validate(e)},messages:a.options.errorMessages,value:n.defaults?n.defaults.email:void 0});break;case"address":if(a.active){var s=a.options.addressGoogleApiKey;a.options.addressGoogleApiKey&&l.push(function(){setTimeout(function(){var e=document.getElementById("customRegistrationScript");e&&document.getElementsByTagName("head")[0].removeChild(e),customRegistration.googleMapServices.mapsApiKeyError=null,(e=document.createElement("script")).id="customRegistrationScript",e.src="https://maps.googleapis.com/maps/api/js?key="+s+"&libraries=places&callback=googleMapsInitCallback",e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e),window.googleMapsInitCallback=function(){customRegistration.googleMapServices.autoAddressCompleteService=new google.maps.places.AutocompleteService,customRegistration.googleMapServices.addressGeocoder=new google.maps.Geocoder},n.refreshUI&&n.refreshUI()},0)}),a.settings.showFullAddress&&(r.push({type:"text",viewType:"text",name:"address",order:e,label:a.options.fieldsLabels.address,iconClass:a.icon,change:function(e){var t=this;t.extra=null,customRegistration.googleMapServices.mapsApiKeyError&&(t.error=customRegistration.googleMapServices.mapsApiKeyError),customRegistration.googleMapServices.autoAddressCompleteService?(customRegistration.googleMapServices.checkMapsApiKeyErrors=!0,setTimeout(function(){customRegistration.googleMapServices.checkMapsApiKeyErrors=!1},3e3),customRegistration.googleMapServices.autoAddressCompleteService.getPlacePredictions({input:e},function(e,s){s!==google.maps.places.PlacesServiceStatus.OK&&(t.error=a.options.errorMessages.invalidGoogleAddress),t.suggestions=e,n.refreshUI&&n.refreshUI()})):t.error=a.options.errorMessages.invalidGoogleAddress},selectSuggestion:function(r){var o=this;o.error=null,o.suggestions=null,o.value=r.description,customRegistration.googleMapServices.addressGeocoder.geocode({placeId:r.place_id},function(e,s){if(e&&e[0]&&e[0]){var t=e[0].geometry.location.lat(),i=e[0].geometry.location.lng();if(a.settings.required)e[0].address_components.find(function(e){return e.types&&e.types.find(function(e){return"street_number"===e})})||(o.error=a.options.errorMessages.invalidGoogleAddress);o.extra={lat:t,lng:i,place:r,addressComponents:e[0].address_components}}else o.error=a.options.errorMessages.invalidGoogleAddress;n.refreshUI&&n.refreshUI()})},validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required?this.extra||(this.error=a.options.errorMessages.invalidGoogleAddress):this.error=a.options.errorMessages.addressRequired},touch:function(e){this.suggestions||this.suggestions.length||this.validate(e)},messages:a.options.errorMessages,value:n.defaults&&n.defaults.userProfile&&n.defaults.userProfile.address?n.defaults.userProfile.address.fullAddress:void 0,extra:n.defaults&&n.defaults.userProfile&&n.defaults.userProfile.address?n.defaults.userProfile.address.geoLocation:void 0}),a.settings.showAptNo&&r.push({type:"text",viewType:"text",name:"aptNo",order:e,label:a.options.fieldsLabels.aptNo,iconClass:a.icon,containerClass:"small-login-field",validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.addressRequired)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults&&n.defaults.userProfile&&n.defaults.userProfile.address&&n.defaults.userProfile.address.customFields?n.defaults.userProfile.address.customFields.aptNo:void 0})),a.settings.showZipCode&&r.push({type:"text",viewType:"text",name:"zipCode",order:e,label:a.options.fieldsLabels.zipCode,iconClass:a.icon,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.addressRequired)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults&&n.defaults.userProfile&&n.defaults.userProfile.address&&n.defaults.userProfile.address.customFields?n.defaults.userProfile.address.customFields.zipCode:void 0})}break;case"password":n.isProfileMode||(r.push({type:"password",name:"password",order:e,label:a.options.fieldsLabels.password,iconClass:a.icon,togglePasswordVisibility:"showHidePassword"===a.settings.validation,info:"simple"===a.settings.passwordStrength?a.options.infoMessages.passwordSimpleRules:a.options.infoMessages.passwordRules,validate:function(e){(this.error=null,"retypePassword"===a.settings.validation)&&(r.find(function(e){return"retypePassword"===e.name}).error=null);e&&e.trim().length?window.validator.validatePassword(e,{simplePasswordValidation:"simple"===a.settings.passwordStrength})||(this.error="simple"===a.settings.passwordStrength?a.options.errorMessages.invalidPasswordSimpleRules:a.options.errorMessages.invalidPasswordRules):this.error=a.options.errorMessages.passwordRequired},touch:function(e){this.validate(e)},messages:a.options.errorMessages}),"retypePassword"===a.settings.validation&&r.push({type:"password",name:"retypePassword",order:e,label:a.options.fieldsLabels.retypePassword,iconClass:a.icon,togglePasswordVisibility:"showHidePassword"===a.settings.validation,validate:function(e){var s=r.find(function(e){return"password"===e.name});this.error=null,e&&e.trim().length?s.value!==e&&(this.error=a.options.errorMessages.passwordsDontMatch):this.error=a.options.errorMessages.passwordRequired},touch:function(e){this.validate(e)},messages:a.options.errorMessages})),i.passwordStrength=a.settings.passwordStrength;break;case"bio":a.active&&r.push({type:"textarea",viewType:"multiline",name:"bio",order:e,label:a.options.fieldsLabels.bio,iconClass:a.icon,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.bioRequired)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults&&n.defaults.userProfile?n.defaults.userProfile.bio:void 0});break;case"telephone":a.active&&r.push({type:"text",viewType:"text",name:"tel",order:e,label:a.options.fieldsLabels.tel,iconClass:a.icon,validate:function(e){(this.error=null,e&&e.trim().length||!a.settings.required)?e&&(/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i.test(e)||(this.error=a.options.errorMessages.invalidEntry)):this.error=a.options.errorMessages.invalidEntry},info:a.settings.showReasonForTelephone?a.options.infoMessages.reasonForTelephone:null,touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults&&n.defaults.userProfile?n.defaults.userProfile.tel:void 0});break;case"birthDate":if(a.active){var t=function(e){return e?moment(e).format("L"):null};r.push({type:"date",viewType:"text",name:"birthDate",order:e,label:a.options.fieldsLabels.dateBirth,minDate:a.settings.maxAgeIsRequired&&a.settings.maxAgeRequired?moment().subtract(a.settings.maxAgeRequired,"years").toDate():void 0,maxDate:a.settings.minAgeIsRequired&&a.settings.minAgeRequired?moment().subtract(a.settings.minAgeRequired,"years").toDate():void 0,iconClass:a.icon,displayValue:t(n.defaults&&n.defaults.userProfile?n.defaults.userProfile.birthDate:void 0),validate:function(e){if(this.error=null,e){var s=moment(e),t=moment().diff(s,"years");a.settings.maxAgeIsRequired&&a.settings.maxAgeRequired&&t>a.settings.maxAgeRequired?this.error=a.options.errorMessages.maxAge+" "+a.settings.maxAgeRequired:a.settings.minAgeIsRequired&&a.settings.minAgeRequired&&t<a.settings.minAgeRequired&&(this.error=a.options.errorMessages.minAge+" "+a.settings.minAgeRequired)}else a.settings.required&&(this.error=a.options.errorMessages.birthRequired)},change:function(e){this.validate(e),this.displayValue=t(e)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:n.defaults&&n.defaults.userProfile?n.defaults.userProfile.birthDate?new Date(n.defaults.userProfile.birthDate):null:void 0})}break;case"termsConditionsAndPrivacyPolicy":n.isProfileMode||a.active&&(o.push({type:"check",name:"termsAndConditions",order:1,preLinkText:a.options.fieldsLabels.iAccept,linkText:a.options.fieldsLabels.termsAndConditions,key:a.settings.termsAndConditionsDocumentKey||"bf_terms_and_conditions",iconClass:a.icon,validate:function(e){this.error=null,e||(this.error=a.options.errorMessages.termsAndConditionsAcceptRequired)},touch:function(e){this.validate(e)},open:function(){n.openGDPRContent({key:a.settings.termsAndConditionsDocumentKey||"bf_terms_and_conditions"})}}),o.push({type:"check",name:"privacyPolicy",order:2,preLinkText:a.options.fieldsLabels.iAccept,linkText:a.options.fieldsLabels.privacyPolicy,key:a.settings.privacyPolicyDocumentKey||"bf_privacy_policy",iconClass:a.icon,validate:function(e){this.error=null,e||(this.error=a.options.errorMessages.termsAndConditionsAcceptRequired)},touch:function(e){this.validate(e)},open:function(){n.openGDPRContent({key:a.settings.privacyPolicyDocumentKey||"bf_privacy_policy"})}}))}});e(null,{fields:r,rules:i,gdprLinks:o,initializers:l,fetch:function(s,e){var t=!1,i={};s&&s.validateFields&&r.forEach(function(e){"edit"===s.mode&&"email"===e.name?e.error=null:e.validate(e.value),e.error&&(t=!0),i[e.name]={value:e.value,extra:e.extra,messages:e.messages}}),s&&s.validateLinks&&o&&o.forEach(function(e){e.validate(e.value),e.error&&(t=!0)}),t?e(!0,null):e(null,{user:{email:i.email.value,password:i.password?i.password.value:void 0,firstName:i.firstName?i.firstName.value:void 0,lastName:i.lastName?i.lastName.value:void 0,displayName:i.displayName?i.displayName.value:void 0,userProfile:{address:{fullAddress:i.address?i.address.value:void 0,customFields:{aptNo:i.aptNo?i.aptNo.value:void 0,zipCode:i.zipCode?i.zipCode.value:void 0},geoLocation:i.address&&i.address.extra?i.address.extra:void 0},bio:i.bio?i.bio.value:void 0,birthDate:i.birthDate?i.birthDate.value?new Date(i.birthDate.value):null:void 0,tel:i.tel?i.tel.value:void 0}},messages:{emailAlreadyInUse:i.email.messages.emailAlreadyInUse}})}})}else e(null,null)}};function gm_authFailure(){customRegistration.googleMapServices.checkMapsApiKeyErrors&&(customRegistration.googleMapServices.mapsApiKeyError="There seems to be an issue with google maps key")}
"use strict";var userTags={get isUserTaggingEnabled(){return window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.userTagging&&"hidden"!=window.appContext.currentApp.config.userTagging&&"disabled"!=window.appContext.currentApp.config.userTagging},init:function(){},checkPluginAccessSettings:function(e,a){var o=e.accessSettings;!bfUtils.isEmulatorCP&&e.requiresLogin?authAPI.getCurrentUser(function(e,s){if(e)return console.error(e),void a(e,null);if(s){if(!userTags.isUserTaggingEnabled||"enabled"!=window.appContext.currentApp.config.advancedPluginAccessSettings)return void a(null,!0);if(!o)return void a(null,!0);if(!o.requiresTags)return void a(null,!0);if(!o.requiredTags||0==o.requiredTags.length)return void a(null,!0);if(o.giveAccessWhen)if(s.tags&&s.tags[window.appContext.currentApp.appId]&&0<s.tags[window.appContext.currentApp.appId].length){var n=s.tags[window.appContext.currentApp.appId];if("matchAllTags"==o.giveAccessWhen){for(var r=0;r<o.requiredTags.length;r++){for(var t=!1,i=0;i<n.length;i++)if(n[i].tagName==o.requiredTags[r].name&&o.requiredTags[r].appliedCount<=n[i].appliedCount){t=!0;break}if(!t)return void a(null,!1)}a(null,!0)}else{for(r=0;r<o.requiredTags.length;r++)for(i=0;i<n.length;i++)if(n[i].tagName==o.requiredTags[r].name&&o.requiredTags[r].appliedCount<=n[i].appliedCount)return void a(null,!0);a(null,!1)}}else a(null,!1);else a(null,!1)}else a(null,!1)}):a(null,!0)},setBehavioralTags:function(n){!bfUtils.isEmulatorCP&&bfUtils.deviceOnline&&userTags.isUserTaggingEnabled&&authAPI.getCurrentUser(null,function(e,s){e?console.log(e):s&&bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/assignBehavioralTag",{instanceId:n,accessToken:s.accessToken}).success(function(e){authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated"})}).error(function(e){console.log(e)})})},removeProfileTags:function(n){userTags.unassignUserTags(["$$profile_birth_year:","$$profile_birth_month:","$$profile_zip:","$$profile_city:","$$profile_state:","$$profile_town:","$$profile_country:"],{isPrefix:!0,removeTag:!0},function(e,s){e?n(e,null):n(null,!0)})},setRegistrationTags:function(e,s,n){var r=function(e,s){for(var n=0;n<e.length;n++){if(e[n].types[0]==s)return e[n].short_name}};if(userTags.isUserTaggingEnabled){var t=[];if(s){var i=new Date;t.push("$$registered"),t.push("$$registered_year:"+i.getFullYear()),t.push("$$registered_month:"+(i.getMonth()+1))}if(e&&(e.birthDate&&(t.push("$$profile_birth_year:"+e.birthDate.getFullYear()),t.push("$$profile_birth_month:"+(e.birthDate.getMonth()+1))),e.address&&e.address.customFields&&e.address.customFields.zipCode&&t.push("$$profile_zip:"+e.address.customFields.zipCode),e.address&&e.address.geoLocation&&e.address.geoLocation.addressComponents)){var a=r(e.address.geoLocation.addressComponents,"country");a&&t.push("$$profile_country:"+a.replace(/ /g,"_"));var o=r(e.address.geoLocation.addressComponents,"administrative_area_level_1");o&&t.push("$$profile_state:"+o.replace(/ /g,"_"));var p=r(e.address.geoLocation.addressComponents,"administrative_area_level_2");p&&t.push("$$profile_city:"+p.replace(/ /g,"_"));var u=r(e.address.geoLocation.addressComponents,"locality");u&&t.push("$$profile_town:"+u.replace(/ /g,"_"))}s?userTags.assignUserTags(t,n):userTags.removeProfileTags(function(e,s){e?n(e):userTags.assignUserTags(t,n)})}},assignUserTags:function(n,r){"string"==typeof n&&(n=n.split(",")),authAPI.getCurrentUser(function(e,s){e?(console.log(e),r(e,null)):s&&bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/assign",{tags:n,accessToken:s.accessToken}).success(function(e){authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated"}),r(null,!0)}).error(function(e){console.log(e),r(e)})})},unassignUserTags:function(n,r,t){"string"==typeof n&&(n=n.split(",")),authAPI.getCurrentUser(function(e,s){e?(console.log(e),t(e,null)):s&&bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/unassign",{tags:n,isPrefix:r.isPrefix||!1,accessToken:s.accessToken,removeTag:r.removeTag||!1}).success(function(e){authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated"}),t(null,!0)}).error(function(e){console.log(e),t(e,null)})})}};userTags.init();
"use strict";function RemoteDatastore(t,e,r,n,i){this.appId=t,this.pluginId=e,this.instanceId=r,this.liveMode=n,this.dataStoreUrl=i}RemoteDatastore.prototype={createReadUrl:function(t,e,r){var n=this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+this.liveMode+"/"+e;return r&&(n+="?withDynamicData=true"),n},createSearchUrl:function(t){return this.dataStoreUrl+"/plugin/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+this.liveMode+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createCloneUrl:function(t){return this.dataStoreUrl+"/app/"+this.appId+"/plugin/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/clone/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/plugin/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/plugin/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/plugin/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/plugin/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createPublishUrl:function(){return this.dataStoreUrl+"/publish/"+this.appId},createServicesUrl:function(){return this.dataStoreUrl+"/app/"+this.appId+"/services/"+this.liveMode},createDeletePluginInstanceUrl:function(t){return this.dataStoreUrl+"/plugin/deletePluginInstance/"+this.appId+"/"+t},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},_httpGet:function(t,e,s){"function"!=typeof e||s||(s=e,e=this),bfUtils.http?bfUtils.http.get(t).success(function(t){s.apply(e,[null,t])}).error(function(t,e,r,n){var i="datastore GET Error with URL: "+n.url;s(i),console.error("datastore GET Error: "+n.url,e)}):s("datastore GET Error:bfUtils.http is undefined. Try again later.")},_httpPost:function(t,e,s){bfUtils.http.post(t,e).success(function(t){s(null,t)}).error(function(t,e,r,n){var i="datastore POST Error with URL: "+n.url;s(i),console.error("datastore POST Result: ",e,n.url)})},_httpPut:function(t,e,s){bfUtils.http.put(t,e).success(function(t){s(null,t)}).error(function(t,e,r,n){var i="datastore PUT Error with URL: "+n.url;s(i),console.error("datastore PUT Result: ",e,n.url)})},get:function(t,e,r,n,i){return this._httpGet(this.createReadUrl(e,t,n),r,i),this},save:function(t,e,r){return this._httpPost(this.createSaveUrl(t),e,r),this},insert:function(t,e,r){return this._httpPost(this.createWriteUrl(t),e,r),this},clone:function(t,e,r){return this._httpPost(this.createCloneUrl(t),e,r),this},bulkInsert:function(t,e,r){return this._httpPost(this.createBulkInsertUrl(t),e,r),this},update:function(t,e,r){return this._httpPut(this.createWriteUrl(t),e,r),this},searchAndUpdate:function(t,e,r){return this._httpPost(this.createSearchAndUpdateUrl(t),e,r),this},delete:function(t,e,r,n){return this._httpPost(this.createDeleteUrl(t,e),r,n),this},search:function(t,e,r,n){return this._httpPost(this.createSearchUrl(t),r,n),this},publish:function(t,e){return this._httpPost(this.createPublishUrl(),t,e),this},getServices:function(t,e){return this._httpGet(this.createServicesUrl(),t,e),this},deletePluginInstance:function(t,e,r){return this._httpPost(this.createDeletePluginInstanceUrl(t),e,r),this}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function DatastoreAPI(t,e,n,i,r){if(window.appContext&&window.appContext.currentApp||console.warn("invalid appContext in datastore"),this.enableCache=window.location.protocol.indexOf("http")<0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,this._featureSecurityAccess=void 0,window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.featureSecurityAccess?"enterprise"==window.appContext.currentApp.config.type&&(this._featureSecurityAccess="enabled"):this._featureSecurityAccess=window.appContext.currentApp.config.featureSecurityAccess),"object"==(void 0===t?"undefined":_typeof(t))){var o=t;this.appId=o.appId,this.pluginId=o.pluginId,this.instanceId=o.instanceId,this.liveMode=o.liveMode,this.writeKey=o.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)}else this.appId=t,this.pluginId=e,this.instanceId=n,this.liveMode=i,r?this.writeKey=r:window.appContext.currentApp&&window.appContext.currentApp.keys&&window.appContext.currentApp.keys.datastoreKey?this.writeKey=window.appContext.currentApp.keys.datastoreKey:window.appContext.currentApp&&window.appContext.currentApp.datastoreWriteKey?this.writeKey=window.appContext.currentApp.datastoreWriteKey:this.writeKey=null;if("undefined"==typeof CustomEvent&&console.warn("Browser doesn't support CustomEvent"),"undefined"==typeof RemoteDatastore&&document.querySelector('script[src="scripts/overrides.js"]'))throw console.error("SDK is outdated. Please update to the most recent version."),"SDK is outdated. Please update to the most recent version.";var s=new RemoteDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,this.dataStoreUrl);this.enableCache&&"undefined"!=typeof OfflineDatastore?this._provider=new OfflineDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,s):this._provider=s}DatastoreAPI.prototype={deviceOnline:function(){return"undefined"==typeof navigator||!navigator.connection||!navigator.connection.type||"none"!=navigator.connection.type},onUpdate:function(t){},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t)},onRefresh:function(t){document.addEventListener("datastoreOnRefresh",t,!1)},triggerOnRefresh:function(t){var e=new CustomEvent("datastoreOnRefresh",{detail:t});document.dispatchEvent(e)},onDisableRefresh:function(t){document.addEventListener("datastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("datastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},get:function(t,r){if("function"==typeof r){var e,o=this,n="",s=!1;"object"==(void 0===t?"undefined":_typeof(t))?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:"",s=t.withDynamicData):"string"==typeof t?e=t:null!=e&&null!=e||(e=""),"string"!=typeof e&&(e="");Date.now();return this._provider.get(n,e,{ds:this,obj:t},s,function(t,n){if(404==t)r(null,null);else if(t)r(t);else if(null==n)r(null,null);else{var i=n.tag;n.tag=e,s&&n&&n.data&&n.data._buildfire?o._dynamicDataSecurityFilter(n.data._buildfire,function(t,e){n.data._buildfire=e,r(null,n),n.tag=i}):(r(null,n),n.tag=i)}}),this}},save:function(n,i){if(window.toast&&window.toast("saving..."),this.writeKey){var r=n.tag,t=n.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t=this._cleanUp(t),t="undefined"!=typeof angular?angular.toJson({data:t,writeKey:this.writeKey,id:n.id}):JSON.stringify({data:t,writeKey:this.writeKey,id:n.id}));var o=this;return this._provider.save(r,t,function(t){if(404==t)window.toast&&window.toast("404","danger"),i(null,null);else if(t)window.toast&&window.toast("error saving","danger"),i(t);else{var e={id:n.id,data:n.obj,tag:r};i(null,e),o.triggerOnUpdate(e)}}),this}console.error("no write key has been provided")},insert:function(i,r){var o=i.tag,t=i.obj,e=i.checkDuplicate;"object"==(void 0===t?"undefined":_typeof(t))&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var s=this;return this._provider.insert(o,t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{i.id=e.id;var n={id:e.id,data:i.obj,tag:o};r(null,n),s.triggerOnUpdate(n)}}),this},clone:function(i,r){var o=i.tag,t=i.obj,e=i.checkDuplicate;"object"==(void 0===t?"undefined":_typeof(t))&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var s=this;return this._provider.clone(o,t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{i.id=e.id;var n={id:e.id,data:i.obj,tag:o};r(null,n),s.triggerOnUpdate(n)}}),this},bulkInsert:function(i,r){var o=i.tag,t=i.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t=this._cleanUp(t),t=JSON.stringify({data:t,writeKey:this.writeKey,checkDuplicate:!1}));var s=this;return this._provider.bulkInsert(o,t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{var n={data:i.obj,tag:o};r(null,n),s.triggerOnUpdate(n)}}),this},update:function(n,i){window.toast&&window.toast("saving...");var t=n.tag,e=n.obj;"object"==(void 0===e?"undefined":_typeof(e))&&(e=this._cleanUp(e),e=JSON.stringify({id:n.id,data:e,writeKey:this.writeKey}));var r=this;return this._provider.update(t,e,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=n.tag,i(null,e.record),r.triggerOnUpdate(e.record))}),this},searchAndUpdate:function(t,n){window.toast&&window.toast("saving...");var e=t.tag,i=t.obj;"object"==(void 0===i?"undefined":_typeof(i))&&(i=this._cleanUp(i),i=JSON.stringify({search:t.search,data:i,writeKey:this.writeKey}));var r=this;return this._provider.searchAndUpdate(e,i,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),r.triggerOnUpdate(e))}),this},delete:function(n,i){var t=n.tag,e=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.delete(t,n.id,e,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),r.triggerOnUpdate(n))}),this},deletePluginInstance:function(n,i){var t=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.deletePluginInstance(n.id,t,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),r.triggerOnUpdate(n))}),this},search:function(t,n){var i=this,e=t.tag,r=t.obj;if("function"==typeof n)return"string"!=typeof e&&(e=""),"object"==(void 0===r?"undefined":_typeof(r))&&(r=JSON.stringify(r)),this._provider.search(e,t.obj,r,function(t,e){404==t?n(null,null):t?n(t):null==e?n(null,null):"string"==typeof e?n(null,bfUtils.tryParseJSON(e)):("pluginInstances"===i.pluginId&&"undefined"!=typeof userTags&&userTags.checkPluginAccessSettings&&e.result&&i._pluginInstancesSecurityFilter(e.result),n(null,e))}),this},publish:function(n){var t=JSON.stringify({publishKey:this.publishKey}),i=this;return this._provider.publish(t,function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this},getServices:function(t,n){return this._provider.getServices(t,function(t,e){404==t?n(null,null):t?n(t):n(null,e)}),this},_cleanUp:function(t){if(t){var e=JSON.parse(JSON.stringify(t));return this._cleanUpTree(e),e}return t},_cleanUpTree:function(t){for(var e in t){var n=t[e];"_buildfire"==e&&n?(delete n.result,delete n.err):null!==n&&"object"==(void 0===n?"undefined":_typeof(n))&&this._cleanUpTree(t[e])}},_dynamicDataSecurityFilter:function(t,e){if("undefined"!=typeof userTags&&userTags.checkPluginAccessSettings)for(var n in t)if(n){var i=t[n];i&&i.result&&this._pluginInstancesSecurityFilter(i.result)}e(null,t)},_pluginInstancesSecurityFilter:function(t){var e=this;t&&t.forEach(function(n){n&&n.data&&(n.hasAccess=!0,"enabled"===e._featureSecurityAccess&&userTags.checkPluginAccessSettings(n.data,function(t,e){n.hasAccess=e}))})}};
"use strict";var appApiKeys={_callbacksQueue:[],_getInProgress:!1,get:function(a){if(window.appContext){if(window.appContext.currentApp.apiKeys)return a&&a(null,window.appContext.currentApp.apiKeys),window.appContext.currentApp.apiKeys;if(a&&appApiKeys._callbacksQueue.splice(0,0,a),!appApiKeys._getInProgress)appApiKeys._getInProgress=!0,new window.DatastoreAPI({appId:window.appContext.currentApp.appId,pluginId:"apiKeys",instanceId:"apiKeys"}).get({tag:"apiKeys"},function(p,e){if(p){for(;a=appApiKeys._callbacksQueue.pop();)a(p);appApiKeys._getInProgress=!1}else{for(e&&e.data?window.appContext.currentApp.apiKeys=e.data:window.appContext.currentApp.apiKeys={};a=appApiKeys._callbacksQueue.pop();)a(null,window.appContext.currentApp.apiKeys);appApiKeys._getInProgress=!1}})}else a&&a("no appContext")}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function UserDatastoreAPI(e,t,r,n,i){if(window.appContext&&window.appContext.currentApp){if(this.enableCache=!1,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==(void 0===e?"undefined":_typeof(e))){var s=e;this.appId=s.appId,this.pluginId=s.pluginId,this.instanceId=s.instanceId,this.isAppUser="control"!=s.type,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=s.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)}else this.appId=e,this.pluginId=t,this.instanceId=r,this.isAppUser=n,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=i||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null);"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}else console.error("invalid appCOntext in userstore")}UserDatastoreAPI.prototype={onUpdate:function(e){},triggerOnUpdate:function(e){this.onUpdate&&this.onUpdate(e)},onRefresh:function(e){document.addEventListener("userDataOnRefresh",e,!1)},triggerOnRefresh:function(e){var t=new CustomEvent("userDataOnRefresh",{detail:e});document.dispatchEvent(t)},onDisableRefresh:function(e){document.addEventListener("userDatastoreOnDisableRefresh",e,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("userDatastoreOnDisableRefresh"))},resolveTag:function(e){return null==e||null==e||""==e?"primary":e},createReadUrl:function(e,t,r){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(e))+"/"+encodeURIComponent(t)+"/"+r},createSearchUrl:function(e){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(e))+"/"},createWriteUrl:function(e,t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(e))+"/"+encodeURIComponent(t)+"/"},createSearchAndUpdateUrl:function(e,t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(e))+"/"+encodeURIComponent(t)+"/"},createDeleteUrl:function(e,t,r){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(e))+"/"+encodeURIComponent(r)+"/"+t},createSaveUrl:function(e,t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(e))+"/"+encodeURIComponent(t)+"/"},createBulkInsertUrl:function(e,t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(e))+"/"+encodeURIComponent(t)+"/"},_httpGet:function(r,n,i){"function"!=typeof n||i||(i=n,n=this),bfUtils.http.get(r).success(function(e){i.apply(n,[null,e])}).error(function(e,t){e=e||"http error with status: "+t,i.apply(n,[e]),console.error("user datastore GET Error: ",r,e)})},_httpPost:function(r,e,n){bfUtils.http.post(r,e).success(function(e){n(null,e)}).error(function(e,t){n(e=e||"http error with status: "+t),console.error("user datastore POST Result: ",r,e)})},_httpPut:function(r,e,n){bfUtils.http.put(r,e).success(function(e){n(null,e)}).error(function(e,t){n(e=e||"http error with status: "+t),console.error("user datastore PUT Result: ",r,e)})},get:function(e,i){if(console.log("user datastore: get "+JSON.stringify(e)),"function"==typeof i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void i("no logged in user found",null);var t,r="";"object"==(void 0===e?"undefined":_typeof(e))?(t="string"==typeof e.tag?e.tag:"",r="string"==typeof e.id?e.id:""):"string"==typeof e?t=e:null!=t&&null!=t||(t=""),"string"!=typeof t&&(t="");var s=!1,o=null;try{if(this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),o=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(t),e.id))){console.log("data cache: found cache");var n=o;n.tag=e.tag,n.obj=e.obj,i(null,n),s=!0}}catch(e){console.error("dataDump error: "+e)}var a=Date.now();return this._httpGet(this.createReadUrl(t,this.writeKey,r,!1),{ds:this,isCallBackDone:s,obj:e,userDataDumpAPI:window.userDataDumpAPI},function(e,t){var r=this,n=Date.now()-a;if(console.log("user datastore: response time "+n),e)r.isCallBackDone||i(e);else if(404==e)r.isCallBackDone||i(null,null);else try{null==t?r.isCallBackDone||i(null,null):(r.ds.enableCache&&void 0!==r.userDataDumpAPI&&r.userDataDumpAPI.setData(r.ds.appId,r.ds.pluginId,r.ds.instanceId,r.ds.resolveTag(r.obj.tag),r.obj.id,t),t.tag=r.obj.tag,r.isCallBackDone?o&&o.lastUpdated!=t.lastUpdated&&(console.log("data cache: send updated object onUpdate"),r.ds.triggerOnUpdate(t)):i(null,t))}catch(e){s||i(e)}}),this}},save:function(n,i){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var s=n.tag,e=n.obj,t=n.userToken?n.userToken:this.writeKey;"object"==(void 0===e?"undefined":_typeof(e))&&(e="undefined"!=typeof angular?this.isAppUser?angular.toJson({data:e,userToken:this.writeKey,id:n.id}):angular.toJson({data:e,writeKey:this.writeKey,id:n.id}):this.isAppUser?JSON.stringify({data:e,userToken:this.writeKey,id:n.id}):JSON.stringify({data:e,writeKey:this.writeKey,id:n.id}));var o=this;return this._httpPost(this.createSaveUrl(s,t),e,function(e,t){if(404==e)window.toast&&window.toast("404","danger"),i(null,null);else if(e)window.toast&&window.toast("error saving","danger"),i(e);else{var r={id:n.id,data:n.obj,tag:s};i(null,r),o.triggerOnUpdate(r)}}),this},insert:function(n,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var s=n.tag,e=n.obj,t=n.checkDuplicate,r=n.userToken?n.userToken:this.writeKey;"object"==(void 0===e?"undefined":_typeof(e))&&(e=this.isAppUser?{data:e,userToken:this.writeKey}:{data:e,writeKey:this.writeKey},t&&(e.checkDuplicate=t),e=JSON.stringify(e));var o=this;return this._httpPost(this.createWriteUrl(s,r),e,function(e,t){if(404==e)i(null,null);else if(e)i(e);else{n.id=t.id;var r={id:t.id,data:n.obj,tag:s};i(null,r),o.triggerOnUpdate(r)}}),this},bulkInsert:function(n,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var s=n.tag,e=n.obj,t=n.userToken?n.userToken:this.writeKey;"object"==(void 0===e?"undefined":_typeof(e))&&(e=this.isAppUser?JSON.stringify({data:e,userToken:this.writeKey,checkDuplicate:!1}):JSON.stringify({data:e,writeKey:this.writeKey,checkDuplicate:!1}));var o=this;return this._httpPost(this.createBulkInsertUrl(s,t),e,function(e,t){if(404==e)i(null,null);else if(e)i(e);else{var r={data:n.obj,tag:s};i(null,r),o.triggerOnUpdate(r)}}),this},update:function(r,n){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(n&&n("no logged in user found",null));var e=r.tag,t=r.obj,i=r.userToken?r.userToken:this.writeKey;"object"==(void 0===t?"undefined":_typeof(t))&&(t=this.isAppUser?JSON.stringify({id:r.id,data:t,userToken:this.writeKey}):JSON.stringify({id:r.id,data:t,writeKey:this.writeKey}));var s=this;return this._httpPut(this.createWriteUrl(e,i),t,function(e,t){404==e?(window.toast&&window.toast("404"),n(null,null)):e?(window.toast&&window.toast("error updating"),n(e)):(t.record.tag=r.tag,n(null,t.record),s.triggerOnUpdate(t.record))}),this},searchAndUpdate:function(e,r){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var t=e.tag,n=e.obj,i=e.userToken?e.userToken:this.writeKey;"object"==(void 0===n?"undefined":_typeof(n))&&(n=this.isAppUser?JSON.stringify({search:e.search,data:n,userToken:this.writeKey}):JSON.stringify({search:e.search,data:n,writeKey:this.writeKey}));var s=this;return this._httpPost(this.createSearchAndUpdateUrl(t,i),n,function(e,t){404==e?(window.toast&&window.toast("404"),r(null,null)):e?(window.toast&&window.toast("error updating"),r(e)):(r(null,t),s.triggerOnUpdate(t))}),this},delete:function(r,n){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(n&&n("no logged in user found",null));var e={},t=r.tag,i=r.userToken?r.userToken:this.writeKey;e=this.isAppUser?JSON.stringify({userToken:this.writeKey}):JSON.stringify({writeKey:this.writeKey});var s=this;return this._httpPost(this.createDeleteUrl(t,r.id,i),e,function(e,t){404==e?n(null,null):e?n(e):(n(null,t),s.triggerOnUpdate(r))}),this},search:function(e,r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var t=e.tag,n=e.obj;return"function"==typeof r?("string"!=typeof t&&(t=""),"string"==typeof n&&(n=JSON.parse(n)),this.isAppUser?n.userToken=this.writeKey:n.writeKey=this.writeKey,"object"==(void 0===n?"undefined":_typeof(n))&&(n=JSON.stringify(n)),this._httpPost(this.createSearchUrl(t),n,function(e,t){404==e?r(null,null):e?r(e):r(null,null==t?null:"string"==typeof t?bfUtils.tryParseJSON(t):t)}),this):void 0},dataDump:function(r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var n=this;return this._httpget(this.createDataDumpUrl(),function(e,t){404==e?r(null,null):e?r(e):(r(null,bfUtils.tryParseJSON(t)),n.triggerOnUpdate(obj))}),this}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function AnalyticsAPI(e,t,n,i,s){if(this.analyticsHostUrl=siteConfig.endPoints.analyticsHost,"object"==(void 0===e?"undefined":_typeof(e))){var a=e;this.appId=a.appId,this.pluginId=a.pluginId,this.instanceId=a.instanceId,this.liveMode=a.liveMode,this.developerId=a.developerId}else this.appId=e,this.pluginId=t,this.instanceId=n,this.liveMode=i,this.developerId=s;this.source=window.siteConfig&&"app"===window.siteConfig.scope?"app":"web",this.secondLevelEmailVerificationEnabled=!1,window.whitelabelContext&&window.whitelabelContext.whitelabelId&&(this.whitelabelId=window.whitelabelContext.whitelabelId,window.whitelabelContext.selfProvSettings&&(this.secondLevelEmailVerificationEnabled=window.whitelabelContext.selfProvSettings.secondLevelEmailVerificationEnabled)),this._user=this._getUser(),window.appContext&&window.appContext.liveMode&&this.appId&&this._trackInstall()}AnalyticsAPI.prototype={_getIpInfo:function(e){function t(){var e=new XMLHttpRequest;e.open("GET",window.siteConfig.endPoints.crmHost+"/ipinfo",!0),e.onreadystatechange=function(){if(4==e.readyState){if(200<=e.status&&e.status<400){if(e.responseText){var t={};try{t=JSON.parse(e.responseText)}catch(e){t={}}}!function(e,t){if(t){var n={data:e,lastSyncDate:new Date};localStorage.setItem("analyticsUserIpInfo",JSON.stringify(n))}}(t,!0)}AnalyticsAPI.IPInfoCalled=!1}},e.send(null)}var n,i,s,a,o=localStorage.getItem("analyticsUserIpInfo");if(o){try{o=JSON.parse(o)}catch(e){o=null}var r=new Date,l=o&&o.lastSyncDate?new Date(o.lastSyncDate):new Date;n=r,i=l.getTime(),s=n.getTime(),a=Math.abs(s-i),Math.round(a/864e5)<=30&&o&&o.data?e&&e(o.data):(e&&e(o?o.data:null),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t()))}else e&&e(),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t())},_updateMetadata:function(e){var t=null,n=localStorage.user;if(!n&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(n=localStorage[window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"]),n)try{n=JSON.parse(n),t=localStorage.user?{userId:n.userToken,username:n.username,email:n.email||n.username,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName}:{userId:n._id,username:n.username,email:n.email||n.username,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName}}catch(e){console.warn("could not load analytics user"),t=null}e.user=t,"undefined"!=typeof push&&null!=push.deviceId&&(e.deviceId=push.deviceId)},_getUser:function(){if(localStorage.user)try{if(e=JSON.parse(localStorage.user))return{userId:e.username,isValidEmail:this.secondLevelEmailVerificationEnabled?e.isValidEmail:1}}catch(e){return console.warn("could not load analytics user"),this._getAnonymousUser()}else{if(!(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&localStorage[window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"]))return"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser();try{var e;return(e=JSON.parse(localStorage[window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"]))?{userId:e.username}:"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser()}catch(e){return console.warn("could not load analytics user"),"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser()}}},_getAnonymousUser:function(){var e,t,n,i=localStorage.getItem("analyticsUser");if(i)try{e=JSON.parse(i)}catch(e){console.log(e)}if(!e){var s=this._getCookie("ajs_anonymous_id");if(s)e={anonymousId:s.replace("%22","").replace("%22","")};else{var a=1;e={anonymousId:(t=new Date,n=t.getMilliseconds()+"",++t+n+(1e4==++a?a=1:a))};try{localStorage.setItem("analyticsUser",JSON.stringify(e))}catch(e){console.log(e)}}}return e},_getBrowserInfo:function(){return{path:document.location.pathname,referrer:document.referrer,url:document.location.href,title:document.title,platform:window.device&&window.device.platform?window.device.platform.toLowerCase():""}},_getCookie:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var s=n[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""},_trackInstall:function(){localStorage.getItem("INSTALL_TRACKED")||(this.trackAction("app/installed",{appId:this.appId}),localStorage.setItem("INSTALL_TRACKED","true"))},trackAction:function(t,n,i){var s=this;if(n){var e=this._getBrowserInfo();for(var a in e)n[a]=e[a]}if((n=n||this._getBrowserInfo()).source=this.source,this._updateMetadata(n),this.analyticsHostUrl&&t){var o=!!n&&n.forceSync;n&&delete n.forceSync,this._getIpInfo(function(e){e&&e.country&&(n.ipInfo=e),s._httpPost(s.analyticsHostUrl+"/event",{type:"action",value:t,metadata:n,context:{whitelabelId:s.whitelabelId,appId:s.appId,pluginId:s.pluginId,instanceId:s.instanceId,liveMode:s.liveMode,developerId:s.developerId?s.developerId:void 0},user:s._user},!o,function(e,t){i&&i()})})}return this},trackView:function(t,n,i){var s=this;if(n){var e=this._getBrowserInfo();for(var a in e)n[a]=e[a]}if((n=n||this._getBrowserInfo()).source=this.source,this._updateMetadata(n),this.analyticsHostUrl&&t){var o,r=this._getCookie("_ga");if(r)(o={}).clientId=r.substr(6);this._getIpInfo(function(e){e&&(n.ipInfo=e),s._httpPost(s.analyticsHostUrl+"/event",{type:"view",value:t,metadata:n,context:{whitelabelId:s.whitelabelId,appId:s.appId,pluginId:s.pluginId,instanceId:s.instanceId,liveMode:s.liveMode,developerId:s.developerId?s.developerId:void 0},segmentContext:{"Google Analytics":o},user:s._user},!0,function(e,t){i&&i()})})}return this},registerPluginEvent:function(i,s){if("cp"==window.siteConfig.scope||"sdk"==window.siteConfig.scope)if(i){i.data||(i.data={}),i.options||(i.options={});var n=i.data;if(n.key)if(n.title){n._titleLowerCase=n.title.toLowerCase();var e=this.instanceId+"_pluginEvents",a=new DatastoreAPI(this.appId,this.pluginId,e,this.liveMode);a.searchAndUpdate({tag:"events",obj:{$set:n},search:{key:n.key}},function(e,t){null==e&&t&&0==t.nModified?a.insert({tag:"events",obj:n,checkDuplicate:!1},function(e,t){var n=new CustomEvent("pluginAnalyticsRegisterEvent",{detail:{data:i.data,options:i.options}});document.dispatchEvent(n),s&&s(e,t)}):s&&s(e,t)})}else s&&s("Missing event title",null);else s&&s("Missing event key",null)}else s&&s("invalid params",null);else s&&s("This method works only on Control Side",null)},unregisterPluginEvent:function(e,i){if(e&&e.key){var t=this.instanceId+"_pluginEvents",s=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode);s.search({tag:"events",obj:{filter:{"$json.key":e.key}}},function(e,t){if(!e&&t&&0<t.length)for(var n=0;n<t.length;n++)s.delete({tag:"events",id:t[n].id},function(e,t){i&&i(e,t)});else i&&i(e,t)})}else i&&i("Missing event key",null)},getPluginEvents:function(e,n){var t=this.instanceId+"_pluginEvents",i=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode);e||(e={}),e.skip=e.skip||0,e.limit=e.limit||50,i.search({tag:"events",obj:e},function(e,t){n&&n(e,t)})},setUsername:function(e){this._user.userId=e,this._user.anonymousId&&(this._user.updateIdentity=!0)},setUserProperties:function(e){this._user.properties=e,this._user.updateIdentity=!0},_httpPost:function(e,t,n,i){if(!window.__$haultEvents){var s=new XMLHttpRequest;s.open("POST",e,n),s.setRequestHeader("Content-type","application/JSON");var a=this;t.user&&t.user.userId&&t.user.userId.userId&&(t.user=r(t.user),localStorage.setItem("analyticsUser",JSON.stringify(t.user))),s.onreadystatechange=function(){4==s.readyState&&(200<=s.status&&s.status<400?(a._user&&a._user.userId&&a._user.userId.userId&&(a._user=r(a._user)),a._user.updateIdentity&&(delete a._user.updateIdentity,delete a._user.properties,delete a._user.anonymousId),localStorage.setItem("analyticsUser",JSON.stringify(a._user)),i(null,s.responseText)):0==s.status?window.__$haultEvents=!0:i(s.status))};var o=null;try{o=JSON.stringify(t)}catch(e){console.error("error stringifying analytics data",t.context,t.type+":"+t.value,t.metadata,t,e)}if(o)try{s.send(o)}catch(e){e.code&&console.error("error sending analytics",e,t,t.context,t.type+":"+t.value,t.metadata,o,e)}}function r(e){return e&&"object"==_typeof(e.userId)?r(e.userId):e}}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function PublicDatastoreAPI(t,e,n){if(window.appContext&&window.appContext.currentApp){if(this.enableCache=!0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==(void 0===t?"undefined":_typeof(t))){var i=t;this.appId=i.appId,this.pluginId=i.pluginId,this.instanceId=i.instanceId,this.writeKey="public"}else this.appId=t,this.pluginId=e,this.instanceId=n,this.writeKey="public";"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}else console.error("invalid appCOntext in publicdata")}PublicDatastoreAPI.prototype={onUpdate:function(t){document.addEventListener("publicDataOnUpdate",t,!1)},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t);var e=new CustomEvent("publicDataOnUpdate",{detail:t});document.dispatchEvent(e)},onRefresh:function(t){document.addEventListener("publicDataOnRefresh",t,!1)},triggerOnRefresh:function(t){var e=new CustomEvent("publicDataOnRefresh",{detail:t});document.dispatchEvent(e)},onDisableRefresh:function(t){document.addEventListener("publicDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("publicDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},createReadUrl:function(t,e){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},_httpGet:function(e,n,i){"function"!=typeof n||i||(i=n,n=this),bfUtils.http.get(e).success(function(t){i.apply(n,[null,t])}).error(function(t){i.apply(n,[t]),console.error("public datastore GET Error: ",e,t)})},_httpPost:function(e,t,n){bfUtils.http.post(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("public datastore POST Result: ",e,t)})},_httpPut:function(e,t,n){bfUtils.http.put(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("public datastore PUT Result: ",e,t)})},get:function(t,o){if(console.log("public datastore: get "+JSON.stringify(t)),"function"==typeof o){if(this.writeKey){var e,n="";"object"==(void 0===t?"undefined":_typeof(t))?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:""):"string"==typeof t?e=t:null!=e&&null!=e||(e=""),"string"!=typeof e&&(e="");var r=!1,s=null;try{if(this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),s=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))){console.log("data cache: found cache");var i=s;i.tag=t.tag,i.obj=t.obj,o(null,i),r=!0}}catch(t){console.error("dataDump error: "+t)}var a=Date.now();return this._httpGet(this.createReadUrl(e,n,!1),{ds:this,isCallBackDone:r,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var n=this,i=Date.now()-a;if(console.log("public datastore: response time "+i),t)n.isCallBackDone||o(t);else if(404==t)n.isCallBackDone||o(null,null);else try{null==e?n.isCallBackDone||o(null,null):(n.ds.enableCache&&void 0!==n.userDataDumpAPI&&n.userDataDumpAPI.setData(n.ds.appId,n.ds.pluginId,n.ds.instanceId,n.ds.resolveTag(n.obj.tag),n.obj.id,e),e.tag=n.obj.tag,n.isCallBackDone?s&&s.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),n.ds.triggerOnUpdate(e)):o(null,e))}catch(t){r||o(t)}}),this}console.error("no write key has been provided")}},save:function(i,o){if(window.toast&&window.toast("saving..."),this.writeKey){var r=i.tag,t=i.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t="undefined"!=typeof angular?angular.toJson({data:t,userToken:this.writeKey,id:i.id}):JSON.stringify({data:t,userToken:this.writeKey,id:i.id}));var s=this;return this._httpPost(this.createSaveUrl(r),t,function(t,e){if(404==t)window.toast&&window.toast("404","danger"),o(null,null);else if(t)window.toast&&window.toast("error saving","danger"),o(t);else{var n={id:i.id,data:i.obj,tag:r};o(null,n),s.triggerOnUpdate(n)}}),this}console.error("no write key has been provided")},insert:function(i,o){if(this.writeKey){var r=i.tag,t=i.obj,e=i.checkDuplicate;"object"==(void 0===t?"undefined":_typeof(t))&&(t={data:t,userToken:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var s=this;return this._httpPost(this.createWriteUrl(r),t,function(t,e){if(404==t)o(null,null);else if(t)o(t);else{i.id=e.id;var n={id:e.id,data:i.obj,tag:r};o(null,n),s.triggerOnUpdate(n)}}),this}console.error("no write key has been provided")},bulkInsert:function(i,o){if(this.writeKey){var r=i.tag,t=i.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify({data:t,userToken:this.writeKey,checkDuplicate:!1}));var s=this;return this._httpPost(this.createBulkInsertUrl(r),t,function(t,e){if(404==t)o(null,null);else if(t)o(t);else{var n={data:i.obj,tag:r};o(null,n),s.triggerOnUpdate(n)}}),this}console.error("no write key has been provided")},update:function(n,i){if(window.toast&&window.toast("saving..."),this.writeKey){var t=n.tag,e=n.obj;"object"==(void 0===e?"undefined":_typeof(e))&&(e=JSON.stringify({id:n.id,data:e,userToken:this.writeKey}));var o=this;return this._httpPut(this.createWriteUrl(t),e,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=n.tag,i(null,e.record),o.triggerOnUpdate(e.record))}),this}console.error("no write key has been provided")},searchAndUpdate:function(t,n){if(window.toast&&window.toast("saving..."),this.writeKey){var e=t.tag,i=t.obj;"object"==(void 0===i?"undefined":_typeof(i))&&(i=JSON.stringify({search:t.search,data:i,userToken:this.writeKey}));var o=this;return this._httpPost(this.createSearchAndUpdateUrl(e),i,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),o.triggerOnUpdate(e))}),this}console.error("no write key has been provided")},delete:function(n,i){if(this.writeKey){var t=n.tag,e=JSON.stringify({userToken:this.writeKey}),o=this;return this._httpPost(this.createDeleteUrl(t,n.id),e,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),o.triggerOnUpdate(n))}),this}console.error("no write key has been provided")},search:function(t,n){if(this.writeKey){var e=t.tag,i=t.obj;if("function"==typeof n)return"string"!=typeof e&&(e=""),"string"==typeof i&&(i=JSON.parse(i)),i.userToken=this.writeKey,"object"==(void 0===i?"undefined":_typeof(i))&&(i=JSON.stringify(i)),this._httpPost(this.createSearchUrl(e),i,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this}else console.error("no write key has been provided")},dataDump:function(n){if(this.writeKey){var i=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this}console.error("no write key has been provided")}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function AppDatastoreAPI(t){if(window.appContext&&window.appContext.currentApp){if(this.enableCache=!0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==(void 0===t?"undefined":_typeof(t))){var e=t;this.appId=e.appId,this.pluginId="public",this.instanceId="public",this.writeKey="public"}else this.appId=t,this.pluginId="public",this.instanceId="public",this.writeKey="public";"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}else console.error("invalid appCOntext in publicdata")}AppDatastoreAPI.prototype={onUpdate:function(t){document.addEventListener("appDataOnUpdate",t,!1)},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t);var e=new CustomEvent("appDataOnUpdate",{detail:t});document.dispatchEvent(e)},onRefresh:function(t){document.addEventListener("appDataOnRefresh",t,!1)},triggerOnRefresh:function(t){var e=new CustomEvent("appDataOnRefresh",{detail:t});document.dispatchEvent(e)},onDisableRefresh:function(t){document.addEventListener("appDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("appDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},createReadUrl:function(t,e){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},_httpGet:function(e,n,r){"function"!=typeof n||r||(r=n,n=this),bfUtils.http.get(e).success(function(t){r.apply(n,[null,t])}).error(function(t){r.apply(n,[t]),console.error("appDatastore GET Error: ",e,t)})},_httpPost:function(e,t,n){bfUtils.http.post(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("appDatastore POST Result: ",e,t)})},_httpPut:function(e,t,n){bfUtils.http.put(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("appDatastore PUT Result: ",e,t)})},get:function(t,i){if(console.log("appDatastore: get "+JSON.stringify(t)),"function"==typeof i){if(this.writeKey){var e,n="";if("object"==(void 0===t?"undefined":_typeof(t))?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:""):"string"==typeof t&&(e=t),"string"!=typeof e||!e)return i(new Error("tag is required for appData"),null);var o=!1,a=null;try{if(this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),a=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))){console.log("data cache: found cache");var r=a;r.tag=t.tag,r.obj=t.obj,i(null,r),o=!0}}catch(t){console.error("dataDump error: "+t)}var s=Date.now();return this._httpGet(this.createReadUrl(e,n,!1),{ds:this,isCallBackDone:o,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var n=this,r=Date.now()-s;if(console.log("appDatastore: response time "+r),t)n.isCallBackDone||i(t);else if(404==t)n.isCallBackDone||i(null,null);else try{null==e?n.isCallBackDone||i(null,null):(n.ds.enableCache&&void 0!==n.userDataDumpAPI&&n.userDataDumpAPI.setData(n.ds.appId,n.ds.pluginId,n.ds.instanceId,n.ds.resolveTag(n.obj.tag),n.obj.id,e),e.tag=n.obj.tag,n.isCallBackDone?a&&a.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),n.ds.triggerOnUpdate(e)):i(null,e))}catch(t){o||i(t)}}),this}console.error("no write key has been provided")}},save:function(r,i){if(window.toast&&window.toast("saving..."),this.writeKey){var o=r.tag,t=r.obj;if("string"!=typeof o||!o)return i(new Error("tag is required for appData"),null);"object"==(void 0===t?"undefined":_typeof(t))&&(t="undefined"!=typeof angular?angular.toJson({data:t,userToken:this.writeKey,id:r.id}):JSON.stringify({data:t,userToken:this.writeKey,id:r.id}));var a=this;return this._httpPost(this.createSaveUrl(o),t,function(t,e){if(404==t)window.toast&&window.toast("404","danger"),i(null,null);else if(t)window.toast&&window.toast("error saving","danger"),i(t);else{var n={id:r.id,data:r.obj,tag:o};i(null,n),a.triggerOnUpdate(n)}}),this}console.error("no write key has been provided")},insert:function(r,i){if(this.writeKey){var o=r.tag,t=r.obj,e=r.checkDuplicate;if("string"!=typeof o||!o)return i(new Error("tag is required for appData"),null);"object"==(void 0===t?"undefined":_typeof(t))&&(t={data:t,userToken:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var a=this;return this._httpPost(this.createWriteUrl(o),t,function(t,e){if(404==t)i(null,null);else if(t)i(t);else{r.id=e.id;var n={id:e.id,data:r.obj,tag:o};i(null,n),a.triggerOnUpdate(n)}}),this}console.error("no write key has been provided")},bulkInsert:function(r,i){if(this.writeKey){var o=r.tag,t=r.obj;if("string"!=typeof o||!o)return i(new Error("tag is required for appData"),null);"object"==(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify({data:t,userToken:this.writeKey,checkDuplicate:!1}));var a=this;return this._httpPost(this.createBulkInsertUrl(o),t,function(t,e){if(404==t)i(null,null);else if(t)i(t);else{var n={data:r.obj,tag:o};i(null,n),a.triggerOnUpdate(n)}}),this}console.error("no write key has been provided")},update:function(n,r){if(window.toast&&window.toast("saving..."),this.writeKey){var t=n.tag,e=n.obj;if("string"!=typeof t||!t)return r(new Error("tag is required for appData"),null);"object"==(void 0===e?"undefined":_typeof(e))&&(e=JSON.stringify({id:n.id,data:e,userToken:this.writeKey}));var i=this;return this._httpPut(this.createWriteUrl(t),e,function(t,e){404==t?(window.toast&&window.toast("404"),r(null,null)):t?(window.toast&&window.toast("error updating"),r(t)):(e.record.tag=n.tag,r(null,e.record),i.triggerOnUpdate(e.record))}),this}console.error("no write key has been provided")},searchAndUpdate:function(t,n){if(window.toast&&window.toast("saving..."),this.writeKey){var e=t.tag,r=t.obj;if("string"!=typeof e||!e)return n(new Error("tag is required for appData"),null);"object"==(void 0===r?"undefined":_typeof(r))&&(r=JSON.stringify({search:t.search,data:r,userToken:this.writeKey}));var i=this;return this._httpPost(this.createSearchAndUpdateUrl(e),r,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),i.triggerOnUpdate(e))}),this}console.error("no write key has been provided")},delete:function(n,r){if(this.writeKey){var t=n.tag,e=JSON.stringify({userToken:this.writeKey});if("string"!=typeof t||!t)return r(new Error("tag is required for appData"),null);var i=this;return this._httpPost(this.createDeleteUrl(t,n.id),e,function(t,e){404==t?r(null,null):t?r(t):(r(null,e),i.triggerOnUpdate(n))}),this}console.error("no write key has been provided")},search:function(t,n){if(this.writeKey){var e=t.tag,r=t.obj;if("function"==typeof n)return"string"==typeof e&&e?("string"==typeof r&&(r=JSON.parse(r)),r.userToken=this.writeKey,"object"==(void 0===r?"undefined":_typeof(r))&&(r=JSON.stringify(r)),this._httpPost(this.createSearchUrl(e),r,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):n(new Error("tag is required for appData"),null)}else console.error("no write key has been provided")},dataDump:function(n){if(this.writeKey){var r=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),r.triggerOnUpdate(obj))}),this}console.error("no write key has been provided")}};
"use strict";var deepLinkAPI={navigateToContent:function(n,t){var i=n.pluginInstanceId,a=n.payload,e="&dld="+JSON.stringify(a);if(i){var o=window.postMaster.launcherPluginAPI.navigation,r={instanceId:i,queryString:e};"function"!=typeof t&&(t=Function.prototype),o.navigateToPluginInstance(r,t)}}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function ShortLinksAPI(t){this.context=t,this.url=window.siteConfig.endPoints.appHost+"/api/app/"+this.context.appId+"/shortlink/"}ShortLinksAPI.prototype={generate:function(e,n){var a=this;if(e.pluginToken=this.context.pluginId,e.instanceId=this.context.instanceId,e.data&&"object"!=_typeof(e.data))n("data is not an object");else{if(e.extraMetaTags){if("object"!=_typeof(e.extraMetaTags))return void n("extraMetaTags is not array of objects");for(var t=0;t<e.extraMetaTags.length;t++)if("object"!=_typeof(e.extraMetaTags[t]))return void n("extraMetaTags is not array of objects")}bfUtils.http.post(this.url,e).success(function(t){var o=new AnalyticsAPI(a.context.appId,a.context.pluginId,a.context.instanceId,a.context.liveMode);e.shortLinkUrl=t.url,o.trackAction("shortlink/generate",e),n(null,t)}).error(function(t){n(t)})}}};
"use strict";function AppearanceAPI(e){this.pluginAPI=e}function resetToDefaults(){!(0==postMaster.isLauncherPluginActive()||-1==["","#/","#"].indexOf(window.location.hash))&&AppearanceAPI.prototype.titlebar.hide(),AppearanceAPI.prototype.sideMenu.show(),AppearanceAPI.prototype.fullScreenMode.disable(),AppearanceAPI.prototype.navbar.show();var e=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(e,"disableAutomaticNavigationBar",!1)}AppearanceAPI.prototype={getCSSFiles:function(e,n){return n(null,["https://bootswatch.com/cerulean/bootstrap.css"]),this},autosizeContainer:function(e,n){this.autosizeContainerHandler(e.height),n(null,null)},autosizeContainerHandler:function(){},setHeaderVisibility:function(e){var n=document.getElementById("pluginControlHeader"),t=document.getElementById("pluginControlHeaderTabs");n&&(e?n.classList.remove("hidden"):n.classList.add("hidden")),t&&(e?t.classList.remove("hidden"):t.classList.add("hidden"))},beforeUpdate:function(e){document.addEventListener("appearanceBeforeUpdate",e,!1)},triggerBeforeUpdate:function(e){var n=new CustomEvent("appearanceBeforeUpdate");document.dispatchEvent(n)},onUpdate:function(e){document.addEventListener("appearanceOnUpdate",e,!1)},triggerOnUpdate:function(e){var n=new CustomEvent("appearanceOnUpdate");document.dispatchEvent(n)},applyToScope:function(e,n,t,o){if(!e)return o&&o();var a=void 0;(a=angular.element(e).scope())[n]=t,a.$$phase||(a.$apply(),o&&o())},getScope:function(e){return angular.element(e).scope()},applyScopeFunction:function(e,n,t){var o=void 0;"function"==typeof(o=angular.element(e).scope())[n]&&o[n](),t&&t()},applyToRootScope:function(e,n,t){var o=void 0;(o=angular.element(document.body).scope().$root)[e]=n,o.$$phase||(o.$apply(),t&&t())},getRootScope:function(){return angular.element(document.body).scope().$root},getFooterMenu:function(e,n){"function"==typeof e&&(n=e);var t=localStorage.getItem("footerMenu"),o={};t&&(o=JSON.parse(t)),n(null,o)},titlebar:{show:function(e,n){AppearanceAPI.prototype.titlebar.toggleVisibility(!0,"showNavigationBar",n)},hide:function(e,n){AppearanceAPI.prototype.titlebar.toggleVisibility(!1,"showNavigationBar",n)},toggleVisibility:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"showNavigationBar",t=arguments[2],o=document.getElementsByClassName("pluginFrame"),a=!(0==postMaster.isLauncherPluginActive()||-1==["","#/","#"].indexOf(window.location.hash)),i=0,p=function(e){i+=e},r=function(){0==--i&&t&&t()};if(a){var l=document.getElementById("launcherPlugin");p(2),AppearanceAPI.prototype.applyToScope(l,"disableAutomaticNavigationBar",!0,r),AppearanceAPI.prototype.applyToScope(l,n,e,r)}else{p(2*o.length);for(var c=0;c<o.length;c++)AppearanceAPI.prototype.applyToScope(o[c],"disableAutomaticNavigationBar",!0,r),AppearanceAPI.prototype.applyToScope(o[c],n,e,r)}},isVisible:function(){var e=0==postMaster.isLauncherPluginActive()||-1==["","#/","#"].indexOf(window.location.hash),n=document.getElementById("launcherPlugin"),t=angular.element(n).scope(),o=t.showNavigationBar;return!0===t.disableAutomaticNavigationBar?o:e}},navbar:{show:function(e,n){AppearanceAPI.prototype.navbar.toggleVisibility(!0,"isFooterMenuHidden",e,n)},hide:function(e,n){AppearanceAPI.prototype.navbar.toggleVisibility(!1,"isFooterMenuHidden",e,n)},toggleVisibility:function(e,n,t,o){var a=document.getElementsByClassName("pluginFrame"),i=!(0==postMaster.isLauncherPluginActive()||-1==["","#/","#"].indexOf(window.location.hash)),p=document.getElementById("footerMenuParent"),r=0,l=function(e){r+=e},c=function(){0==--r&&o&&o()};if(i){var u=document.getElementById("launcherPlugin");l(2),AppearanceAPI.prototype.applyToScope(p,n,!e,c),AppearanceAPI.prototype.applyToScope(u,n,!e,c)}else{l(2*a.length);for(var s=0;s<a.length;s++)AppearanceAPI.prototype.applyToScope(p,n,!e,c),AppearanceAPI.prototype.applyToScope(a[s],n,!e,c)}},isVisible:function(){return AppearanceAPI.prototype.getRootScope().turnOnFooterMenu}},fullScreenMode:{enable:function(e,n){AppearanceAPI.prototype.fullScreenMode.toggle(!1,e,n)},disable:function(e,n){AppearanceAPI.prototype.fullScreenMode.toggle(!0,e,n)},toggle:function(e,n,t){var o=3,a=function(){0==--o&&t&&t()};if(!(0==postMaster.isLauncherPluginActive()||-1==["","#/","#"].indexOf(window.location.hash))){var i=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(i,"isInFullScreenMode",e)}AppearanceAPI.prototype.titlebar.toggleVisibility(e,"isInFullScreenMode",a),AppearanceAPI.prototype.sideMenu.toggleIconVisibility(e,"isInFullScreenMode",null,a),AppearanceAPI.prototype.navbar.toggleVisibility(e,"isInFullScreenMode",null,a)}},sideMenu:{show:function(e,n){AppearanceAPI.prototype.sideMenu.toggleIconVisibility(!0,"isMenuIconHidden",e,n)},hide:function(e,n){AppearanceAPI.prototype.sideMenu.toggleIconVisibility(!1,"isMenuIconHidden",e,n)},toggleIconVisibility:function(e,n,t,o){var a=document.getElementById("menu-location");if(!(0==postMaster.isLauncherPluginActive()||-1==["","#/","#"].indexOf(window.location.hash))){var i=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(i,n,!e)}AppearanceAPI.prototype.applyToScope(a,n,!e,o)},open:function(e,n){cpSync.menu.showSideMenu(),n&&n()},close:function(e,n){var t=document.getElementById("sideMenuCloseButton");AppearanceAPI.prototype.applyScopeFunction(t,"closeMenu",n)},getStyles:function(e,p){var n={appId:e.appId,pluginId:"sideMenu",instanceId:1,liveMode:e.liveMode,writeKey:e.writeKey};null==this.dataStore&&(this.dataStore=new DatastoreAPI(n)),this.dataStore.get({tag:"",withDynamicData:!0},function(e,n){if(e)p(e);else{var t,o=n.data&&n.data._buildfire?n.data._buildfire:{},a=o.sideMenu,i=(void 0===(t=a)&&(t={style:void 0}),void 0===t.style&&(t.style={alignLeft:!1,showIcon:!0,icon:"icon-menu",transparent:!1,floating:!1}),t);i.id=n.id,i.styleUpdate=o.styleUpdate,p(null,i)}})},reset:function(e,n){AppearanceAPI.prototype.sideMenu.getStyles(e,function(e,n){var t=n.style,o=void 0;o=postMaster&&postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.history&&postMaster.launcherPluginAPI.history.historyItems?postMaster.launcherPluginAPI.history.historyItems:null;var a=["","#/","#"].indexOf(window.location.hash)<0&&window.location.href.indexOf("#/pluginContainer")<0,i=!o||!o.length||1==o.length&&"home"==o[0].source,p=document.getElementById("faux-http-section"),r=AppearanceAPI.prototype.getScope(p);r.showIcon=t.showIcon,r.menuIcon=t.icon,r.isMenuLeftAligned=t.alignLeft,r.menuDisabled=!(!n||!n.content)&&n.content.turnOffSideMenu,r.menuDisabled||(r.menuDisabled=r.authShown&&!r.allowCancel&&!0!==r.showMenuOnAuth),t&&t.headerImage&&(r.headerImage=t.headerImage.replace("/width/21/","/width/78/"));var l=r.menuDisabled?" ng-hide ":"";l+=!a&&i?t.alignLeft?" menu menu-left-align ":" menu menu-right-align ":t&&t.alignLeft?" menu menuLeft ":" menu ",t.transparent&&(l+=" translucent "),t.floating&&(t.alignLeft?l+=" floating-left ":l+=" floating-right "),r.menuClass=l,r.$$phase||r.$apply()})}},ready:function(){var e=document.getElementsByClassName("pluginFrame");if(!(0==postMaster.isLauncherPluginActive()||-1==["","#/","#"].indexOf(window.location.hash))){var n=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(n,"readyToShow",!0)}else for(var t=0;t<e.length;t++)AppearanceAPI.prototype.applyToScope(e[t],"readyToShow",!0);window.spinner&&window.spinner.hide()}},document.addEventListener("launcherOnReactivated",function(){var e=document.getElementById("launcherPlugin"),n=AppearanceAPI.prototype.getScope(e),t={};Object.assign(t,n);var o=t.isInFullScreenMode,a=t.isFooterMenuHidden;t.isMenuIconHidden?AppearanceAPI.prototype.sideMenu.hide():AppearanceAPI.prototype.sideMenu.show(),o?AppearanceAPI.prototype.fullScreenMode.enable():AppearanceAPI.prototype.fullScreenMode.disable(),a?AppearanceAPI.prototype.navbar.hide():AppearanceAPI.prototype.navbar.show(),AppearanceAPI.prototype.applyToScope(e,"disableAutomaticNavigationBar",!1)}),document.addEventListener("AUTH_CURRENT_USER_ON_LOGOUT",function(){resetToDefaults()},!1),document.addEventListener("pluginOnActivated",function(){AppearanceAPI.prototype.fullScreenMode.disable(),AppearanceAPI.prototype.navbar.show(),AppearanceAPI.prototype.sideMenu.show()});
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function Track(a,e,t,i,r){this.title=a,this.url=e,this.image=t,this.album=i,this.artist=r,this.startAt=0,this.lastPosition=0}var audioPlayer={_audio:null,_allowPlay:!0,_interval:{time:5e3,id:null},get audio(){return null==this._audio&&("undefined"!=typeof Audio?this._audio=new Audio:this._audio={}),this._audio},_currentTrack:null,settings:{autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1},getSettings:function(a,e){e(null,this.settings)},setSettings:function(a){console.log("setSettings called"),a&&(this.audio&&this.settings&&(this.audio.volume=this.settings.volume),angular.extend(this.settings,a),this.save())},resetSettingsToDefault:function(){audioPlayer.settings={autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1}},isStream:function(){return!isFinite(audioPlayer.audio.duration)},isAndroid:function(){var a=!1;return window.device&&window.device.platform&&"android"===window.device.platform.toLowerCase()&&(a=!0),a},retryAllowed:function(){var a=!0;return audioPlayer.isStream()||(a=!1),a},retryAudio:function(){console.warn("retryAudio"),null==audioPlayer._interval.id&&(audioPlayer._interval.id=setInterval(function(){audioPlayer.resumePlay()},audioPlayer._interval.time))},cancelRetry:function(){null!=audioPlayer._interval.id&&(clearInterval(audioPlayer._interval.id),audioPlayer._interval.id=null)},resumePlay:function(){audioPlayer.audio.paused||(console.warn("restart audio",new Date),audioPlayer._allowPlay=!0,audioPlayer.play(audioPlayer._currentTrack))},init:function(){var e=this;try{this.audio&&this.audio.addEventListener&&this.audio.addEventListener("ended",function(){e.triggerOnEvent("audioEnded",e._currentTrack),e.settings.autoPlayNext&&e.next()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("stalled",function(){console.warn("audio stalled",new Date),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(){console.warn("audio error",new Date),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("playing",function(){console.warn("playing",new Date),audioPlayer.cancelRetry()})}catch(a){console.warn("error",a)}var a=0;this.audio&&this.audio.addEventListener&&this.audio.addEventListener("timeupdate",function(){e._currentTrack&&(e._currentTrack.lastPosition=e.audio.currentTime),5<Math.abs(a-e.audio.currentTime)&&(e.save(),a=e.audio.currentTime),e.triggerOnEvent("timeUpdate",{currentTime:e.audio.currentTime,duration:e.audio.duration,buffer:{start:e.audio.buffered.length?e.audio.buffered.start(0):0,end:e.audio.buffered.length?e.audio.buffered.end(0):0}})}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(a){e.triggerOnEvent("error",a)});var t=window.appContext;if(null!=t&&void 0!==t&&void 0!==t.currentApp&&void 0!==t.currentApp.appId){var i=window.localStorage.getItem("audioPlayer");if("{}"!=i)try{var r=JSON.parse(i);e.settings=r.settings,e.playlist=r.playlist,e._currentTrack=r._currentTrack,e.audio.volume=e.settings.volume}catch(a){console.warn("audioPlayer localStorage error",a)}}else console.warn("no app found for audioPlayer")},getCurrentTrack:function(a,e){return e&&e(this._currentTrack),this._currentTrack},onEvent:function(e){var a=function(a){e&&e(a.detail)};return document.addEventListener("audioPlayer.onEvent",a,!1),{clear:function(){document.removeEventListener("audioPlayer.onEvent",a,!1)}}},triggerOnEvent:function(a,e){a=new CustomEvent("audioPlayer.onEvent",{detail:{event:a,data:e}});document.dispatchEvent(a)},_tmrSave:null,save:function(){this._tmrSave&&clearTimeout(this._tmrSave),this._tmrSave=setTimeout(function(){try{var a={settings:audioPlayer.settings,playlist:audioPlayer.playlist,_currentTrack:audioPlayer._currentTrack};window.localStorage.setItem("audioPlayer",JSON.stringify(a))}catch(a){var e=a.message?a.message:"";console.error("Error with JSON.stringify. ",e)}},500)},play:function(a){if((!audioPlayer._currentTrack||a&&audioPlayer._currentTrack.url!=a.url)&&(audioPlayer._allowPlay=!0),audioPlayer._allowPlay){var e=void 0===a?"undefined":_typeof(a);if("string"==e)a={url:a};else if("number"==e){var t=this.playlist.tracks[a];if(!t)return;this.playlist.lastIndex=a,a=t,this.save()}else if(!a)return void(this.audio.paused&&(this.audio.play(),this.triggerOnEvent("resume",{track:this._currentTrack})));this.audio.src=a.url,this.audio.preload="auto",this._currentTrack=a,console.warn("this.audio.play()",new Date),this.audio.play(),this.triggerOnEvent("play",{track:a}),this.settings&&this.settings.autoJumpToLastPosition&&a.lastPosition&&this.skip(a.lastPosition),a.startAt&&this.skip(a.startAt),audioPlayer._allowPlay=!1,!audioPlayer.isBackgroundModeEnabled&&"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&(audioPlayer.isBackgroundModeEnabled=!0,cordova.plugins.backgroundMode.enable&&cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.on("activate",function(){cordova.plugins.backgroundMode.disableWebViewOptimizations()}))}},skip:function(a){this.audio&&(this.audio.currentTime+a<0?this.audio.currentTime=0:this.audio.currentTime+a>this.audio.duration?this.audio.currentTime=this.audio.duration:this.audio.currentTime+=a,this.triggerOnEvent("skip",a))},pause:function(){audioPlayer.audio.pause(),audioPlayer._allowPlay=!0,audioPlayer.triggerOnEvent("pause")},isPaused:function(a,e){e&&e(null,audioPlayer.audio.paused)},loopTrack:function(a){audioPlayer.audio&&(audioPlayer.audio.loop=a)},next:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex++,audioPlayer.playlist.lastIndex>=audioPlayer.playlist.tracks.length){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1,null;audioPlayer.playlist.lastIndex=0}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("next",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},previous:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex--,audioPlayer.playlist.lastIndex<0){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=0,null;audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("previous",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},removeFromPlaylist:function(a){if(!(a<0||a>=audioPlayer.playlist.tracks.length)){var e=audioPlayer.playlist.tracks.splice(a,1);a==audioPlayer.playlist.lastIndex?audioPlayer.playlist.lastIndex=-1:a<audioPlayer.playlist.lastIndex&&audioPlayer.playlist.lastIndex--,audioPlayer.triggerOnEvent("removeFromPlaylist",{index:a,track:e,newPlaylist:audioPlayer.playlist})}},addToPlaylist:function(a){audioPlayer.playlist.tracks.push(a),audioPlayer.save(),audioPlayer.triggerOnEvent("addToPlaylist",{track:a,newPlaylist:audioPlayer.playlist})},setTime:function(a){audioPlayer.audio.currentTime=a,audioPlayer._currentTrack.lastPosition=audioPlayer.audio.currentTime,audioPlayer.save(),audioPlayer.triggerOnEvent("timeUpdate",{currentTime:audioPlayer.audio.currentTime,duration:audioPlayer.audio.duration,buffer:{start:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.start(0):0,end:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.end(0):0}})},setVolume:function(a){a<0?a=0:1<a&&a<=100&&(a/=100),audioPlayer.settings&&(audioPlayer.settings.volume=a),audioPlayer.audio&&(audioPlayer.audio.volume=a),audioPlayer.triggerOnEvent("volumeChange",{volume:a}),audioPlayer.save()},playlist:{tracks:[],lastIndex:-1},getPlaylist:function(a,e){e(null,audioPlayer.playlist)}};"undefined"==typeof PluginAPI||PluginAPI.prototype.mediaAPI||(PluginAPI.prototype.mediaAPI={audioPlayer:window.audioPlayer}),audioPlayer.init();
"use strict";function NotificationsAPI(t){this.context=t,this.dialogApi=null}NotificationsAPI.prototype={initDialog:function(){this.dialogApi||(this.dialogApi=new DialogAPI(this.context))},alert:function(t,n){if(this.initDialog(),t||(t={}),t.message)return t.okButton||(t.okButton={text:"OK"}),t.okButton.text||(t.okButton.text="OK"),this.dialogApi.alert({title:t.title,message:t.message,okButtonText:t.okButton.text},function(t,i){if(n)return window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.confirm?t?n(t):n(1,void 0):n(i)});n("invalid parameter, messing message")},confirm:function(t,n){if(this.initDialog(),t||(t={}),t.message)return t.confirmButton||(t.confirmButton={text:"Confirm"}),t.confirmButton.text||(t.confirmButton.text="Confirm"),t.cancelButton||(t.cancelButton={text:"Cancel"}),t.cancelButton.text||(t.cancelButton.text="Cancel"),t.buttonLabels=[t.confirmButton.text,t.cancelButton.text],this.dialogApi.confirm({title:t.title,message:t.message,confirmButtonText:t.confirmButton.text,cancelButtonText:t.cancelButton.text},function(t,i){if(n)return window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.confirm?n(i?1:2,void 0):n(i)});n("invalid parameter, missing message",null)},prompt:function(n){function t(t,i){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(t,i){if(window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.prompt)navigator.notification.prompt(t.message,i,t.title,t.buttonLabels,t.defaultText);else{var n=prompt(t.message);i&&i(n)}}),beep:function(t,i){console.log("calling NotificationsAPI.beep ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.beep&&navigator.notification.beep(t.times),i&&i()},vibrate:function(t,i){console.log("calling NotificationsAPI.vibrate ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&("function"==typeof navigator.vibrate?navigator.vibrate(t.milliseconds):navigator.notification&&"function"==typeof navigator.notification.vibrate&&navigator.notification.vibrate(t.milliseconds)),i&&i()}};
"use strict";function appAPI(t){this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=t.endPoints.appHost,"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}appAPI.prototype={getPluginInstances:function(t,n){var e=new DatastoreAPI(this.appId,"pluginInstances",1,this.liveMode,null);t||(t={}),t.pageSize||(t.pageSize=50),t.pageIndex||(t.pageIndex=1);var a={obj:{filter:{"$json.title":{$regex:null!=t.title?t.title:""}},page:t.pageIndex-1,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};e.search(a,function(t,e){t||n(null,{data:e.result,totals:e.totalRecord})})},getPluginInstancesByIds:function(e,a){var i=0,s=[],o=new DatastoreAPI(this.appId,"pluginInstances",1,this.liveMode,null);!function n(){var t={obj:{filter:{"$json.instanceId":{$in:e||[]}},page:i,pageSize:50,withDynamicData:!0,recordCount:!0},tag:""};o.search(t,function(t,e){t||(s=s.concat(e.result)),50<=e.result.length?(i++,n()):a(null,{data:s,totals:s.length})})}()}};
"use strict";"undefined"==typeof ActionItemsAPI&&(window.ActionItemsAPI=function(e){this.templateUrl="pages/share/actionBuilder.html",this.listTemplateUrl=window._appRoot+"pages/templates/actionItemsListDialog.html",this.controller="actionItemsCtrl",this.context=e,this.init()}),ActionItemsAPI.prototype.init=function(){},ActionItemsAPI.prototype.list=function(e,t){var o={templateUrl:this.listTemplateUrl,controller:"actionItemsListDialogCtrl",size:"lg",data:e};window.openDialog(o,function(e){t&&t(null,e)})},ActionItemsAPI.prototype.openWebLink=function(e,t,o){if(e){var n="_blank"===t,i=window.open(e,t,"location=no"),a=void 0;n&&(a=setTimeout(function(){ActionItemsAPI.prototype.openWebLink(e,"_system",o),i&&i.close()},1e3)),i&&i.addEventListener("loadstart",function(){a&&clearTimeout(a)}),o&&o(i?null:"failed to open window"),i||ActionItemsAPI.prototype.popUpCtrlScope.show(e)}},ActionItemsAPI.prototype.sendEmail=function(e,t,o){var n="mailto:"+(null!=e&&""!=e?e:"")+"?"+(null!=t&&""!=t?"subject="+t:"")+"&"+(null!=o&&""!=o?"body="+o:"");window.open(n,"_system")},ActionItemsAPI.prototype.navigateToAddress=function(e,t){if(e&&t){var o="https://maps.google.com/?q=";window.device&&null!=window.device.platform&&("android"==window.device.platform.toLowerCase()?o="geo:?q=":"ios"==window.device.platform.toLowerCase()&&(o="maps://maps.apple.com?q=")),window.open(o+e+","+t,"_system","location=no,menubar=no,titlebar=no,toolbar=no")}},ActionItemsAPI.prototype.callNumber=function(e){e&&(e=e.replace(/ /,""),window.open("tel:"+e,"_system","location=no,menubar=no,titlebar=no,toolbar=no"))},ActionItemsAPI.prototype.sendSms=function(e){if(e)if(e=e.replace(/ /,""),-1!=navigator.platform.indexOf("Android")||-1!=navigator.platform.indexOf("Linux")||null==navigator.platform){var t="sms:"+e;window.open(t,"_system")}else if(-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")){t="sms:"+e;window.open(t,"_system")}else console.error("This action can't be used on browser , it should be used on actual device")},ActionItemsAPI.prototype.linkToAppContent=function(e,r){var t=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),o={};o.obj={filter:{"$json.instanceId":e},pageSize:1,withDynamicData:!0},t.search(o,function(e,t){if(t&&t.length){var o=t[0].data.instanceId,n=t[0].data._buildfire.pluginType.result[0].token,i=t[0].data._buildfire.pluginType.result[0].folderName,a=t[0].data.title,s=window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI;s?s.navigation.navigateTo({pluginId:n,instanceId:o,title:a,folderName:i,pushToHistory:!0,queryString:r?r.queryString:null},null):console.warn("Plugin API is empty")}})},ActionItemsAPI.prototype.navigateToPage=function(e,t){if(t||(t={}),e)if("login"!=e)if("appSearch"!=e||"enterprise"==window.appContext.currentApp.config.type){if(t.queryString){var o=encodeURIComponent;e=e+"?"+Object.keys(t.queryString).map(function(e){return o(e)+"="+o(t.queryString[e])}).join("&")}window.location.hash=e}else console.info("Action Items","Search page only available for Enterprise Plan");else window.authAPI&&window.authAPI.login&&window.authAPI.login();else console.error("Action Items","navigateToPage","Please specify Page Name!")},ActionItemsAPI.prototype.purchase=function(n,i,a,s,r,p){if(bfUtils.isMobileDevice)if("undefined"!=typeof inAppPurchaseAPI){var c=function(e,t){if(e){o={data:{title:" ",body:s,disableCancel:!0}};window.openDialog(o,function(){})}else if(t&&t.isApproved&&!bfUtils.isIOS){var o={data:{title:" ",body:a,disableCancel:!0}};window.openDialog(o,function(){}),r&&ActionItemsAPI.prototype.linkToAppContent(r)}p(e,t)};inAppPurchaseAPI.checkAccess(i,function(e,t){if(e&&console.error("error while checking product",e),t&&t.owned)r&&ActionItemsAPI.prototype.linkToAppContent(r),p(null,{product:t,isApproved:!0});else{var o=i.productId;"subscriptions"===i.purchaseType&&i.subscription&&(o=i.subscription.subscriptionId||i.subscription.id),inAppPurchaseAPI.purchase({productId:o,purchaseType:n},c)}})}else console.error("inAppPurchaseAPI is undefined")},ActionItemsAPI.prototype.execute=function(e,t){var o=!1;switch(e.action){case"linkToApp":this.linkToAppContent(e.instanceId,{queryString:e.queryString});break;case"linkToWeb":o=!0,this.openWebLink(e.url,e.openIn,t);break;case"sendEmail":this.sendEmail(e.email,e.subject,e.body);break;case"callNumber":this.callNumber(e.phoneNumber);break;case"sendSms":this.sendSms(e.phoneNumber);break;case"navigateToAddress":this.navigateToAddress(e.lat,e.lng);break;case"navigateToAppSettings":this.navigateToPage("appSettings");break;case"navigateToNotifications":this.navigateToPage("pushGroups");break;case"navigateToBookmarks":this.navigateToPage("bookmarks");break;case"navigateToSearch":var n={};e.searchAppValue&&(n.queryString={searchTerm:e.searchAppValue}),this.navigateToPage("appSearch",n);break;case"navigateToLogin":this.navigateToPage("login");break;case"navigateToNotes":window.notesAPI.openDialog();break;case"linkToSocialGoogle":case"linkToSocialFacebook":case"linkToSocialInstagram":case"linkToSocialTwitter":case"linkToSocialLinkedIn":this.openWebLink(e.url,"_system");break;case"purchase":o=!0;var i={productId:e.productId,subscriptions:e.subscriptions,subscription:e.subscription,purchaseType:e.purchaseType};this.purchase(e.purchaseType,i,e.successMessage,e.errorMessage,e.instanceId,t)}o||t(null,!0)},"undefined"!=typeof $app&&$app.controller("actionItemsListDialogCtrl",["$scope","$data","$dialog",function(e,t,n){e.actionItems=t.actionItems,e.executeItem=!0,e.close=function(){n.close(null)},t.options&&t.options.executeItem&&(e.executeItem=t.options.executeItem),e.openActionItem=function(o){e.executeItem?(window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI).actionItems.execute(o,function(e,t){n.close(o)}):n.close(o)}}]);
"use strict";function PluginInstanceAPI(t){this.templateUrl="pages/plugins/pluginInstanceDialog/pluginInstanceDialog.html",this.controller="pluginInstanceDialog",this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=window.siteConfig.endPoints.appHost;var n=JSON.parse(JSON.stringify(t));n.pluginId="pluginInstances",n.instanceId=1,this.ds=new DatastoreAPI(n)}PluginInstanceAPI.prototype={showDialog:function(t,n){if(window.openDialog){var i={templateUrl:this.templateUrl,controller:this.controller,size:"lg",data:t};window.openDialog(i,function(t){n&&n(null,t)})}else console.error("openDialog isnt defined")},get:function(t,i){var n={};n.obj={filter:{"$json.instanceId":t},pageSize:1,withDynamicData:!0},this.ds.search(n,function(t,n){t?i(t,null):n&&n.length?i(null,n[0].data):i(null)})},_createReadUrl:function(){return this.appHost+"/api/appPluginInstances/getByIds/"+this.appId},_httpGet:function(t,n,i){bfUtils.http.get(t,{params:n}).success(function(t){i(null,t)}).error(function(t){i(t)})},search:function(t,n){var i;(t.title||t.instanceIds)&&(i={}),t.title&&(i["$json.title"]={$regex:t.title,$options:"-i"}),t.instanceIds&&(i["$json.instanceId"]={$in:t.instanceIds});var e={obj:{filter:i,page:t.pageIndex,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};this.ds.search(e,n)}};
"use strict";var deviceAPI={calendar:{addEvent:function(o,a){permissionRequestsAPI.queueRequest("calendar",this,function(){var e;if(window.plugins&&window.plugins.calendar&&(e=window.plugins.calendar),!e)return console.warn("cannot complete action add event to calendar. so fake it"),void(0<=window.location.protocol.indexOf("http")?alert("Adding to calendar requires native app."):console.error("Calendar feature not installed"));o.startDate instanceof Date||(o.startDate=new Date(o.startDate)),o.endDate instanceof Date||(o.endDate=new Date(o.endDate));var n,t=function(e){a(null,e)},i=function(e){a(e)};o.options?((n=e.getCalendarOptions()).firstReminderMinutes=o.options.firstReminderMinutes||n.firstReminderMinutes,n.secondReminderMinutes=o.options.secondReminderMinutes||n.secondReminderMinutes,n.recurrence=o.options.recurrence||n.recurrence,o.options.recurrenceEndDate&&(n.recurrenceEndDate=new Date(o.options.recurrenceEndDate)),e.createEventWithOptions(o.title,o.location,o.notes,o.startDate,o.endDate,n,t,i)):e.createEvent(o.title,o.location,o.notes,o.startDate,o.endDate,t,i)})}},share:function(e,n){window.plugins&&window.plugins.socialsharing?window.plugins.socialsharing.share(e.text,e.subject,e.image,e.link):(console.warn("device sharing plugin not found. defaulting to email sending"),window.location="mailto:?subject="+encodeURIComponent(e.subject)+"&body="+encodeURIComponent(e.text+" "+e.link)),n(null,!0)},onAppBackgrounded:function(e){document.addEventListener("deviceAppBackgrounded",e,!1)},onAppResumed:function(e){document.addEventListener("deviceAppResumed",e,!1)}};document.addEventListener("deviceready",function(){window.open=function(e,n,t){var i,o="_blank"===n,a=cordova.InAppBrowser.open(e,n,t),s=a&&a.channels&&a.channels.close;return o&&s&&((i=document.getElementById("webviewBackdrop"))&&i.classList.remove("hide"),a&&a.addEventListener("close",function(){d()}),a&&a.addEventListener("exit",function(){d()})),a;function d(){var e=document.getElementById("webviewBackdrop");e&&!e.classList.contains("hide")&&(e.classList.add("closing"),setTimeout(function(){e.classList.replace("closing","hide")},250))}}});
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function HistoryAPI(t,s,e,i){if("object"==(void 0===t?"undefined":_typeof(t))){var n=t;this.appId=n.appId,this.pluginId=n.pluginId,this.instanceId=n.instanceId,this.liveMode=n.liveMode}else this.appId=t,this.pluginId=s,this.instanceId=e,this.liveMode=i}HistoryAPI.prototype={historyItems:[],push:function(t,s){if("undefined"==typeof emulatorSync){if("plugin"!=t.source){var e=-1;if(1<this.historyItems.length){for(var i=1;i<this.historyItems.length;i++)if("plugin"==this.historyItems[i].source&&"control"==this.historyItems[i-1].source){e=i;break}0<=e&&this.historyItems.splice(e)}}t.uid=(new Date).getTime(),t.options||(t.options={}),t.options.pluginData||(t.options.pluginData={instanceId:this.instanceId}),this.historyItems.push(t);var n=new CustomEvent("historyOnPush",{detail:{pushedItem:t}});document.dispatchEvent(n);var o=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});document.dispatchEvent(o)}else{var r=new Packet(null,"history.pushAppHistory",t);emulatorSync.sendMessage(r)}return s&&s(null,!0),this},get:function(t,s){var e,i=this;if(t&&t.pluginBreadcrumbsOnly){var n=[],o=0;if(postMaster.launcherPluginAPI&&this!=postMaster.launcherPluginAPI.history){var r=this.historyItems.findIndex(function(t){return"control"==t.source});o=-1==r?this.historyItems.length:r}for(var h=o;h<this.historyItems.length;h++){var u=this.historyItems[h];"plugin"==(e=u).source&&e.options&&e.options.pluginData&&e.options.pluginData.instanceId==i.instanceId&&n.push(this.historyItems[h])}s(null,n)}else s(null,this.historyItems);return this},getNext:function(t){var s=null;if(this.historyItems)for(var e=0;e<this.historyItems.length;e++)if(this.historyItems[e]==t||this.historyItems[e].uid==t.uid){e<this.historyItems.length&&(s=this.historyItems[e+1]);break}return s},pop:function(t,s){if("undefined"==typeof emulatorSync){if(!t&&this.historyItems)if(1<this.historyItems.length){var e=this.historyItems[this.historyItems.length-1];e&&"plugin"==e.source&&(t=this.historyItems[this.historyItems.length-2])}else this.historyItems[0]&&"plugin"==this.historyItems[0].source&&(t=this.historyItems[0]);if(t){for(var i=-1,n=!1,o=0;o<this.historyItems.length;o++)if(this.historyItems[o]==t||this.historyItems[o].uid==t.uid){(i=o)+1<this.historyItems.length&&"plugin"==this.historyItems[o+1].source&&(n=!0);break}0<=i&&i<=this.historyItems.length&&this.historyItems.splice(i+1);var r=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});document.dispatchEvent(r);var h=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});if(document.dispatchEvent(h),(n||"plugin"==t.source)&&postMaster){var u=new Packet(null,"history.triggerOnPop",t);postMaster.widgetPluginAPI?postMaster.widgetPluginAPI.sendMessage(null,u):postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.sendMessage(null,u)}}else if(s)return s("breadcrumb not found"),this}else{u=new Packet(null,"history.popAppHistory",t);emulatorSync.sendMessage(u)}return s&&s(null,!0),this},popToHome:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=1;t<this.historyItems.length;t++)"control"==this.historyItems[t].source&&this.pop(this.historyItems[t-1])},popToPlugin:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=this.historyItems.length-1;1<t&&"plugin"==this.historyItems[t].source;t--)this.pop(this.historyItems[t-1])},clear:function(t,s){var e=this.historyItems[0];this.historyItems.splice(0),s&&s(null);var i=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});if(document.dispatchEvent(i),e){var n=new CustomEvent("historyOnPop",{detail:{poppedItem:e}});document.dispatchEvent(n)}return this},triggerOnPop:function(t){var s=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});return document.dispatchEvent(s),this},triggerOnUpdate:function(t){this.historyItems=t;var s=new CustomEvent("historyOnUpdate",{detail:{historyItems:t}});return document.dispatchEvent(s),this},onUpdate:function(s){var t=function(t){s&&s({historyItems:t.detail.historyItems})};return document.addEventListener("historyOnUpdate",t,!1),{clear:function(){document.removeEventListener("historyOnUpdate",t,!1)}}},onPop:function(s){var t=function(t){s&&s(t.detail)};return document.addEventListener("historyOnPop",t,!1),{clear:function(){document.removeEventListener("historyOnPop",t,!1)}}},onPush:function(s){var t=function(t){s&&s({historyItems:t.detail.historyItems,pushedItem:t.detail.pushedItem})};return document.addEventListener("historyOnPush",t,!1),{clear:function(){document.removeEventListener("historyOnPush",t,!1)}}},clearLauncherBreadcrumbs:function(){for(var t=[],s=0,e=!1;s<this.historyItems.length;s++){var i=this.historyItems[s];if(e){if("control"==i.source){e=!1;break}}else t.push(i);"home"==i.source&&(e=!0)}this.historyItems=t;var n=new CustomEvent("historyOnUpdate",{detail:{historyItems:t}});return document.dispatchEvent(n),this}};
"use strict";function Packet(e,n,t,i){this.id=e,this.cmd=n,this.data=t,this.error=i,this.instanceId}var pluginCount=0;if(void 0===logger)var logger={log:function(){}};function PluginAPI(e,n,t,i,o,a,s,r){pluginCount++,this.datastore=this.analytics=this.appearance=null,this.iFrameId=e,this.iFrame=document.getElementById(e),this.init(n,t,i,o,a,s,r)}PluginAPI.prototype={getContentWindow:function(){return this.iFrame=document.getElementById(this.iFrameId),this.iFrame?this.iFrame.contentWindow:null},debugTag:null,init:function(e,n,t,i,o,a,s){if(window.appContext&&window.appContext.currentApp){var r=window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.cpDomain?window.appContext.currentApp.config.cpDomain:window.siteConfig.endPoints.appHost;this.context={appId:e,pluginId:n,instanceId:t,liveMode:i||0,endPoints:window.siteConfig.endPoints,cpDomain:r,device:window.device,deviceId:"undefined"!=typeof push?push.deviceId:null,debugTag:this.debugTag,datastoreWriteKey:o||void 0,type:a,appTheme:PluginAPI.appTheme,configType:PluginAPI.configType,title:s};var p=localStorage.getItem("currentAppManifest");if(p){var l=null;try{l=JSON.parse(p)}catch(e){console.error("bad currentAppManifest",e)}this.context.offlineModeEnabled=l.offlineModeEnabled}if(this.context.device||(this.context.device={platform:"web"}),"undefined"!=typeof AppearanceAPI&&(this.appearance=new AppearanceAPI(this.context)),"undefined"!=typeof DatastoreAPI&&(this.datastore=new DatastoreAPI(this.context)),"undefined"!=typeof UserDatastoreAPI&&(this.userData=new UserDatastoreAPI(this.context)),"undefined"!=typeof AnalyticsAPI&&(this.analytics=new AnalyticsAPI(this.context)),"undefined"!=typeof ImageLibAPI&&(this.imageLib=new ImageLibAPI(this.context)),"undefined"!=typeof ColorLibAPI&&(this.colorLib=new ColorLibAPI(this.context),this.colorLib.onChange(function(e){c.sendMessage(null,new Packet(null,"colorLib._triggerOnChange",e))})),"undefined"!=typeof appAPI&&(this.appAPI=new appAPI(this.context)),"undefined"!=typeof ActionItemsAPI&&(this.actionItems=new ActionItemsAPI(this.context)),"undefined"!=typeof NotificationsAPI&&(this.notificationsAPI=new NotificationsAPI(this.context)),"undefined"!=typeof PopupLibAPI&&(this.notificationsAPI=PopupLibAPI),"undefined"!=typeof DialogAPI&&(this.dialogAPI=new DialogAPI(this.context)),"undefined"!=typeof HistoryAPI&&(this.history=new HistoryAPI(this.context)),"undefined"!=typeof PluginInstanceAPI&&(this.pluginInstances=new PluginInstanceAPI(this.context)),"undefined"!=typeof inAppPurchaseAPI&&(this.inAppPurchase=inAppPurchaseAPI),"undefined"!=typeof barcodeScannerAPI&&(this.barcodeScanner=barcodeScannerAPI),"undefined"!=typeof UsersLibAPI&&(this.usersLib=new UsersLibAPI(this.context)),"undefined"!=typeof PublicDatastoreAPI&&(this.publicData=new PublicDatastoreAPI(this.context)),"undefined"!=typeof AppDatastoreAPI&&(this.appData=new AppDatastoreAPI(this.context)),"undefined"!=typeof LocalStorageAPI&&(this.localStorage=new LocalStorageAPI(this.context)),"undefined"!=typeof LocalNotificationsAPI&&(this.localNotifications=new LocalNotificationsAPI(this.context)),"undefined"!=typeof deviceAPI&&(this.device=deviceAPI,this.device.onAppBackgrounded(function(e){c.sendMessage(null,new Packet(null,"device.triggerOnAppBackgrounded",e.detail))}),this.device.onAppResumed(function(e){c.sendMessage(null,new Packet(null,"device.triggerOnAppResumed",e.detail))})),"undefined"!=typeof geoAPI&&(this.geo=geoAPI),"undefined"!=typeof inputAPI&&(this.input=inputAPI),"undefined"!=typeof notesAPI&&(this.notes=notesAPI),"undefined"!=typeof bookmarkAPI&&(this.bookmarkAPI=bookmarkAPI),"undefined"!=typeof deepLinkAPI&&(this.deepLink=deepLinkAPI),"undefined"!=typeof imagePreviewerAPI&&(this.imagePreviewer=imagePreviewerAPI),"undefined"!=typeof bluetoothAPI&&(this.bluetooth=bluetoothAPI),"undefined"!=typeof BleCentralAPI&&(this.bleCentral=new BleCentralAPI),"undefined"!=typeof iBeaconAPI&&(this.iBeacon=iBeaconAPI),"undefined"!=typeof CameraAPI&&(this.camera=new CameraAPI(this.context)),"undefined"!=typeof fileManagerAPI&&(this.fileManager=fileManagerAPI),"undefined"!=typeof imageCacheAPI&&(this.imageCache=imageCacheAPI),"undefined"!=typeof PushNotificationsAPI&&(this.pushNotifications=new PushNotificationsAPI(this.context)),"undefined"!=typeof FirebaseAPI&&(this.firebase=new FirebaseAPI(this.context)),"undefined"!=typeof ComponentUIAPI&&(this.componentUI=new ComponentUIAPI(this.context)),"undefined"!=typeof authAPI){this.auth=authAPI,this.auth.init(this.context);var c=this;this.auth.onLogin(function(e){c.sendMessage(null,new Packet(null,"auth.triggerOnLogin",e.detail))}),this.auth.onLogout(function(){c.sendMessage(null,new Packet(null,"auth.triggerOnLogout"))}),this.auth.onUpdate(function(e){c.sendMessage(null,new Packet(null,"auth.triggerOnUpdate",e.detail))})}"undefined"!=typeof richModal&&(this.popup=richModal);c=this;this.mediaAPI=new Object,"undefined"!=typeof audioPlayer&&(this.mediaAPI.audioPlayer=audioPlayer,this.mediaAPI.audioPlayer.onEvent(function(e){c.sendMessage(null,new Packet(null,"services.media.audioPlayer.triggerOnEvent",e))})),this.analytics.trackActionCommand=function(e,n){return!!e&&c.analytics.trackAction(e.value,e.metadata,n)},this.analytics.trackViewCommand=function(e,n){return!!e&&c.analytics.trackView(e.value,e.metadata,n)},this.navigation.pluginAPI=this,"undefined"!=typeof PublicFilesAPI&&(this.publicFiles=new PublicFilesAPI(this.context),this.publicFiles.onProgress(function(e){c.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnProgress",{file:e}))}),this.publicFiles.onComplete(function(e){c.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnComplete",{file:e}))})),"undefined"!=typeof searchEngineAPI&&(this.searchEngine=new searchEngineAPI(this.context)),"undefined"!=typeof CreditsAPI&&(this.credits=new CreditsAPI(this.context)),"undefined"!=typeof StripeAPI&&(this.stripe=new StripeAPI(this.context)),"undefined"!=typeof ShortLinksAPI&&(this.shortLinks=new ShortLinksAPI(this.context)),"undefined"!=typeof userTagsAPI&&(this.userTags=userTagsAPI)}else console.error("invalid appContext cant create pluginAPI")},postMessageHandler:function(i){if(!this.iFrameId)return!1;var o=void 0;try{o=i.packet||JSON.parse(i.data)}catch(e){return void console.warn("error parsing post message data.")}if(o&&o.cmd&&o.cmd.split&&(i.source==this.getContentWindow()||o.fid==this.iFrameId||this.context.instanceId==o.instanceId)){for(var a=this,e=o.cmd.split("."),n=this,t=this,s=0;s<e.length;s++){if(0<s&&(t=n),!n[e[s]])return!0;n=n[e[s]]}return n.apply(t,[o.data,function(e,n){e&&console.warn(i.data,e);var t=new Packet(o.id,o.cmd,n,e);a.sendMessage(null,t)}]),!0}},sendMessage:function(e,n){(e=this.getContentWindow())&&e.postMessage&&(n=JSON.parse(JSON.stringify(n)),e.postMessage(n,"*"))},getContext:function(e,t){var i=Object.assign({},this.context);return this.localStorage.getCollection(null,function(e,n){i.localStorage=n||{},"undefined"!=typeof appApiKeys?appApiKeys.get(function(e,n){i.apiKeys=n||{},t&&t(null,i)}):(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.apiKeys&&(i.apiKeys=window.appContext.currentApp.apiKeys||{}),t&&t(null,i))}),this},navigation:{displayPopUpInstructions:function(){window.location.hash="/popUp"},_navigateTo:function(n,e){!1!==n.pushToHistory&&(n.pushToHistory=!0);var t=!1,i="/pluginContainer/"+n.pluginId+"/"+n.instanceId+"/"+encodeURIComponent(n.title)+"/"+n.folderName+"/"+n.pushToHistory;!0===n.isNavigateBack&&postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.context&&postMaster.widgetPluginAPI.context.instanceId&&postMaster.widgetPluginAPI.context.instanceId!==n.instanceId&&(i+="/"+postMaster.widgetPluginAPI.context.instanceId);var o=new HistoryAPI;if(n.pushToHistory||o.popToHome(),0==o.historyItems.length&&o.push({label:"Home",options:{pluginData:void 0},source:"home"}),postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.context&&n.instanceId==postMaster.launcherPluginAPI.context.instanceId&&n.pluginId==postMaster.launcherPluginAPI.context.pluginId)return o.popToHome(),window.location.hash="/",void(n&&n.queryString&&(window.pluginControllerHelper.pluginPassThroughqueryString=n.queryString,window.resetLauncherView()));var a=o.historyItems[o.historyItems.length-1];if("control"==a.source)n.instanceId!=a.options.pluginData.instanceId||n.pluginId!=a.options.pluginData.pluginId?o.push({label:decodeURIComponent(n.title),options:{pluginData:n,context:window.location.href},source:"control"}):t=!0;else{var s;try{s=decodeURIComponent(n.title)}catch(e){console.error("BAD Title",n.title,e),s="TITLE"}o.push({label:s,options:{pluginData:n,context:window.location.href},source:"control"})}n&&n.queryString&&(window.pluginControllerHelper.pluginPassThroughqueryString=n.queryString),n&&(n.dontTriggerHashChangeEvent||t)?cpSync.navigation.silentNavigation(i):window.location.hash=i,e&&e(null,{status:"completed"})},navigateTo:function(s,r){if(s&&s.pluginId&&s.instanceId&&s.title&&s.folderName)this._navigateTo(s,r);else if(s&&(s.pluginId||s.instanceId||s.folderName)){var p=this,e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),n={obj:{filter:{},pageSize:1,withDynamicData:!0}};s.instanceId&&(n.obj.filter["$json.instanceId"]=s.instanceId),s.pluginId&&(n.obj.filter["$json.token"]=s.pluginId),e.search(n,function(e,n){if(e)r("error fetching pluginInstance",!1);else if(n&&n.length){var t=n[0].data.instanceId,i=n[0].data._buildfire.pluginType.result[0].token,o=n[0].data._buildfire.pluginType.result[0].folderName,a=n[0].data.title;p._navigateTo({pluginId:i,instanceId:t,title:s.title||a,folderName:o,pushToHistory:s.pushToHistory,queryString:s.queryString},r)}else r&&r("pluginInstance not found",!1)})}else r("either pluginId, instanceId or folderName must be specified",!1)},navigateToPluginInstance:function(a,s){var r=this;if(a&&a.instanceId){var e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),n={};n.obj={filter:{"$json.instanceId":a.instanceId},pageSize:1,withDynamicData:!0},e.search(n,function(e,n){if(e)s("error fetching pluginInstance",!1);else if(n&&n.length){var t=n[0].data._buildfire.pluginType.result[0].token,i=n[0].data._buildfire.pluginType.result[0].folderName,o=n[0].data.title;r._navigateTo({pluginId:t,instanceId:a.instanceId,title:o,folderName:i,pushToHistory:!1,queryString:a.queryString},s)}else s&&s("pluginInstance not found",!1)})}else s("Invalid parameters. Need to pass instanceId.")},navigateToAppearance:function(e){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/appearanceSample"):window.location.hash="/appearanceSample"},navigateHome:function(e,n){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/"):window.location.hash="/";var t=new HistoryAPI;t.clear(),t.push({label:"Home",options:{pluginData:void 0},source:"home"}),n&&n()},navigateBack:function(){var e=new HistoryAPI;if(e.historyItems&&1<e.historyItems.length){var n=e.historyItems[e.historyItems.length-1],t=e.historyItems[e.historyItems.length-2];if(t&&t.options)switch(t.source){case"control":var i=null;"plugin"==n.source?(e.pop(t),t.options.pluginData&&((i=JSON.parse(JSON.stringify(t.options.pluginData))).isNavigateBack=!0,this._navigateTo(i))):(t.options.pluginData&&((i=JSON.parse(JSON.stringify(t.options.pluginData))).isNavigateBack=!0,this._navigateTo(i)),e.pop(t));break;case"plugin":"control"==n.source?(e.pop(t),window.location.hash="/"):e.pop(t);break;case"home":if("plugin"==n.source){e.pop(t);break}default:e.clear(),e.push({label:"Home",options:{pluginData:void 0},source:"home"}),window.location.hash="/"}}else e.clear(),e.push({label:"Home",options:{pluginData:void 0},source:"home"}),window.location.hash="/"},scrollTop:function(e,n){document.body.scrollTop=e||0,n&&n()},navigateEmulator:function(){cordova&&cordova.file&&cordova.file.applicationDirectory?window.appContext&&window.appContext.environment?window.location.href.indexOf("http://")<0&&(window.location.href=cordova.file.applicationDirectory+"www/emulator/login.html?env="+window.appContext.environment+"&lastUrl="+encodeURIComponent(window.location.href)):console.log("Cant load emulator bc window.appContext.environment is undefined"):console.log("Cant load emulator bc cordova.file.applicationDirectory is undefined")},navigateToApp:function(e){window.location.search="?env="+window.appContext.environment+"&appId="+e.appId+"&mode="+window.appContext.currentApp.liveMode+"&lastUrl="+encodeURIComponent(window.location.href)}},messaging:{triggerOnNewControlMessage:function(e){console.warn("unhandled message [onNewControlMessage]")},triggerOnNewWidgetMessage:function(e){var n=new Packet(null,"messaging.onReceivedMessage",e);postMaster.widgetPluginAPI?postMaster.widgetPluginAPI.sendMessage(null,n):postMaster.launcherPluginAPI.sendMessage(null,n)},sendMessageToService:function(e,n){var t=postMaster.widgetPluginAPI;if(t||(t=postMaster.launcherPluginAPI),t&&t.context&&postMaster.servicePluginAPIs){var i=postMaster.servicePluginAPIs[t.context.instanceId];if(i&&i.sendMessage){var o=new Packet(null,"messaging.onReceivedMessage",e);i.sendMessage(null,o),n&&n(null,!0)}}n&&n("no service available for current widget",null)}},spinner:{show:function(e,n){window.spinner&&window.spinner.show(),n&&n()},hide:function(e,n){window.spinner&&window.spinner.hide(),n&&n()}}};
"use strict";var geoAPI={getPermissionType:function(){return"undefined"==typeof BackgroundGeolocation&&"undefined"==typeof backgroundGeolocation?"location":"background_location"},currentPosition:null,convertPosition:function(o){return{coords:{latitude:o.coords.latitude,longitude:o.coords.longitude,altitude:o.coords.altitude,accuracy:o.coords.accuracy,altitudeAccuracy:o.coords.altitudeAccuracy,heading:o.coords.heading,speed:o.coords.speed},timestamp:o.timestamp,isBackground:!!o.isBackground&&o.isBackground}},convertBackGroundPosition:function(o){return{coords:{latitude:o.latitude,longitude:o.longitude,altitude:o.altitude,accuracy:o.accuracy,speed:o.speed},timestamp:o.time,isBackground:!0}},getCurrentPosition:function(o,n){var t=this;permissionRequestsAPI.queueRequest(geoAPI.getPermissionType(),geoAPI,function(){t._getCurrentPosition(o,n)})},_getCurrentPosition:function(n,t){return navigator.geolocation?(bfUtils.isMobileDevice||(n=n||{}).timeout||(n.timeout=5e3),navigator.geolocation.getCurrentPosition(function(o){t(null,geoAPI.convertPosition(o))},function(o){!function(){{if(!geoAPI.currentPosition)return!1;if(!n.maximumAge)return!0;if(Date.now()-geoAPI.currentPosition.timestamp<n.maximumAge)return!0}}()?t(o,null):t(null,geoAPI.currentPosition)},n)):console.error("navigator.geolocation is undefined"),this},isAndroid:!1,watchPosition:function(o,n){var t=this;permissionRequestsAPI.queueRequest(geoAPI.getPermissionType(),geoAPI,function(){t._watchPosition(o,n)})},_watchPosition:function(o,n){function t(o){(o=geoAPI.convertPosition(o)).watchId=i,geoAPI.currentPosition=o;var n=new Packet(null,"geo.onPositionChange",o);postMaster.broadcast(n)}function e(o){console.log("Geo watchPosition: ",o.message),o.watchId=i,n(o)}var i;if(navigator.geolocation&&navigator.geolocation.watchPosition){i=navigator.geolocation.watchPosition(t,e,o);var a=function(o){t(geoAPI.convertBackGroundPosition(o))},c=function(o){console.error("Background geo error",o)};bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){"undefined"==typeof BackgroundGeolocation&&"undefined"==typeof backgroundGeolocation||("undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&(cordova.plugins.backgroundMode.enable&&cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.on("activate",function(){cordova.plugins.backgroundMode.disableWebViewOptimizations()})),"undefined"==typeof backgroundGeolocation?(BackgroundGeolocation.configure({locationProvider:BackgroundGeolocation.ACTIVITY_PROVIDER,desiredAccuracy:BackgroundGeolocation.HIGH_ACCURACY,stationaryRadius:1,distanceFilter:1,debug:!1,interval:1e4,fastestInterval:5e3,activitiesInterval:1e4,activityType:o?o.activityType:void 0}),BackgroundGeolocation.on("location",a),BackgroundGeolocation.on("error",c),BackgroundGeolocation.on("authorization",function(o){console.log("[INFO] BackgroundGeolocation authorization status: "+o),!0===bfUtils.isIOS&&o!==BackgroundGeolocation.AUTHORIZED&&setTimeout(function(){if(console.log("always permission needed"),confirm("To use background location, you must enable 'Always' in the in the Location Services settings"))return BackgroundGeolocation.showAppSettings()},1e3)}),BackgroundGeolocation.checkStatus(function(o){console.log("[INFO] BackgroundGeolocation service is running",o.isRunning),console.log("[INFO] BackgroundGeolocation services enabled",o.locationServicesEnabled),console.log("[INFO] BackgroundGeolocation auth status: "+o.authorization),o.isRunning||BackgroundGeolocation.start()})):(backgroundGeolocation.configure(a,c,{desiredAccuracy:0,stationaryRadius:1,distanceFilter:1,interval:1e3,locationProvider:backgroundGeolocation.provider.ANDROID_ACTIVITY_PROVIDER}),backgroundGeolocation.start()))})}else console.log("HTML5 position"),i=setInterval(function(){geoAPI.getCurrentPosition(o,function(o,n){o?e(o):t(n)})},o&&o.timeout?o.timeout:5e3);n()},clearWatch:function(o,n){navigator.geolocation&&navigator.geolocation.watchPosition?navigator.geolocation.clearWatch(o):clearInterval(o),n&&n()},isEnabled:function(o,n){BackgroundGeolocation.checkStatus(function(o){return n(null,o.locationServicesEnabled)})}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},inputAPI={initialized:!1,timer:null,currentStepData:null,currentStepOptions:null,init:function(){var e=this;this.inputDialog?this.inputDialog.innerHTML="":(this.inputDialog=document.createElement("div"),this.inputDialog.style.display="none"),this.listDialog?this.listDialog.innerHTML="":(this.listDialog=document.createElement("div"),this.listDialog.style.display="none"),this.backdrop?this.backdrop.className="":(this.backdrop=document.createElement("div"),this.backdrop.id="input-backdrop"),0<=window.location.pathname.indexOf("pluginTester")?(this.inputDialog.style.height=document.getElementById("app").offsetHeight+"px",this.inputDialog.style.position="absolute",this.listDialog.style.height=document.getElementById("app").offsetHeight+"px",this.listDialog.style.position="absolute"):(this.inputDialog.style.height="100vh",this.inputDialog.style.maxHeight="100vh",this.listDialog.style.height="100vh",this.listDialog.style.maxHeight="100vh");var t=localStorage.getItem("footerMenu");this.inputDialog.id="inputDialog",this.inputDialog.className=t?"has-footer-menu":"";var i=document.createElement("div");i.className="input-dialog-container backgroundColorTheme",this.inputDialog.appendChild(i),this.dialogNav=document.createElement("div"),this.dialogNav.className="inputapi-nav titleBarBackgroundTheme",i.appendChild(this.dialogNav),this.dialogNavFlex=document.createElement("div"),this.dialogNavFlex.className="inputapi-nav-flex",this.dialogNav.appendChild(this.dialogNavFlex),this.dialogNavSecondary=document.createElement("div"),this.dialogNavSecondary.className="inputapi-nav secondary titleBarBackgroundTheme",i.appendChild(this.dialogNavSecondary),this.dialogNavFlexSecondary=document.createElement("div"),this.dialogNavFlexSecondary.className="inputapi-nav-flex secondary",this.dialogNavSecondary.appendChild(this.dialogNavFlexSecondary),this.currentUserContainer=document.createElement("div"),this.currentUserContainer.className="inputapi-user-container",i.appendChild(this.currentUserContainer),this.textarea=document.createElement("textarea"),this.textarea.className="inputapi-textarea needsfocus bodyTextTheme",this.textarea.id="inputapi-textarea",this.textarea.addEventListener("touchend",function(t){t.target.click()}),this.textarea.addEventListener("focus",function(t){var e=t.target;e.style.webkitTransform="translate3d(0px,-10000px,0)",requestAnimationFrame(function(){return e.style.webkitTransform=""})}),this.textarea.addEventListener("input",function(t){e.currentStepData.textValue=t.target.value,e.currentStepData.textValue.length>e.currentStepOptions.maxLength&&(e.currentStepData.textValue=e.currentStepData.textValue.substring(0,e.currentStepOptions.maxLength),t.target.value=e.currentStepData.textValue),e.doneButton.disabled=!e.validate()}),i.appendChild(this.textarea),this.imageGallery=document.createElement("div"),this.imageGallery.id="imageGallery",this.geoContainer=document.createElement("div"),this.geoContainer.id="geo-container",this.geoContainer.classList="img-gallery-container",this.geoContainer.style.display="none",this.geoImage=document.createElement("img"),this.geoImage.id="geo-img",this.geoContainer.appendChild(this.geoImage),this.geoDeleteBtn=document.createElement("span"),this.geoDeleteBtn.className="galery-delete glyphicon glyphicon-minus-sign",this.geoDeleteBtn.onclick=function(){return e.setLocation()},this.geoContainer.appendChild(this.geoDeleteBtn),this.imageGallery.appendChild(this.geoContainer),i.appendChild(this.imageGallery),this.cancelButton=document.createElement("button"),this.cancelButton.className="inputapi-cancel titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.cancelButton),this.title=document.createElement("h1"),this.title.className="inputapi-nav-title primary titleBarTextAndIcons ellipsis",this.title.style.whiteSpace="nowrap",this.dialogNavFlex.appendChild(this.title),this.titleSecondary=document.createElement("h1"),this.titleSecondary.className="inputapi-nav-title secondary titleBarTextAndIcons ellipsis",this.titleSecondary.style.whiteSpace="nowrap",this.dialogNavFlexSecondary.appendChild(this.titleSecondary),this.doneButton=document.createElement("button"),this.doneButton.className="inputapi-done titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.doneButton),this.actionFooter=document.createElement("div"),this.actionFooter.className="inputapi-footer",i.appendChild(this.actionFooter),this.cameraBtn=document.createElement("span"),this.cameraBtn.className="icon icon-camera2 needsclick",this.cameraBtn.onclick=function(t){return e.showFileDialog()},this.actionFooter.appendChild(this.cameraBtn),this.geoPin=document.createElement("span"),this.geoPin.id="goc-pin",this.geoPin.className="icon icon-map-marker",this.geoPin.onclick=function(t){return e.showLocationModal()},this.actionFooter.appendChild(this.geoPin),this.gifBtn=document.createElement("span"),this.gifBtn.className="icon icon-gif",this.gifBtn.id="gif-btn",this.gifBtn.onclick=function(t){return e.showGifDialog()},this.actionFooter.appendChild(this.gifBtn),this.listDialog.id="listDialog";var n=document.createElement("div");n.className="body backgroundColorTheme",this.listDialog.appendChild(n),this.listDialogHeader=document.createElement("h1"),this.listDialogHeader.className="list-header",n.appendChild(this.listDialogHeader),this.listDialogItems=document.createElement("form"),this.listDialogItems.className="input-list",n.appendChild(this.listDialogItems);var a=document.createElement("div");a.className="button-container",n.appendChild(a),this.listDialogCancelBtn=document.createElement("button"),this.listDialogCancelBtn.className="cancel primaryTheme",a.appendChild(this.listDialogCancelBtn),this.listDialogConfirmBtn=document.createElement("button"),this.listDialogConfirmBtn.className="confirm primaryTheme",a.appendChild(this.listDialogConfirmBtn),0<=window.location.pathname.indexOf("pluginTester")?(document.getElementById("app").appendChild(this.inputDialog),document.getElementById("app").appendChild(this.listDialog),document.getElementById("app").appendChild(this.backdrop)):(document.body.appendChild(this.inputDialog),document.body.appendChild(this.listDialog),document.body.appendChild(this.backdrop)),this.initialized=!0},showLocationModal:function(){var h=this;window.spinner&&window.spinner.show(),this.getLocation(function(t,e){try{if(t)throw t;var i=e.coords,n=i.latitude,a=i.longitude,o=h.getMapUrl(e),l=o.mapUrl,r=o.thumbnail;if(h.currentStepOptions.attachments.location.required)return window.spinner&&window.spinner.hide(),h.geoDeleteBtn.style.display="none",h.setLocation({latitude:n,longitude:a},r);var s={title:"Send My Current Location",richContent:'\n          <img style="height: 90vw !important; width: 90vw !important" src="'+l+'" />\n        ',action:{title:"Confirm",handler:function(){return h.setLocation({latitude:n,longitude:a},r)}}};window.spinner&&window.spinner.hide(),richModal.display(s)}catch(t){console.error("inputAPI location error",t);var c="Failed to determine location. Please try again later.";if(t.code)switch(t.code){case 1:c="App does not have location access.";break;case 2:c="Location information is not availible to this device.";break;case 3:c="Location request timed out. Try again.";break;case 4:c="Failed to determine location. Please try again later (code 4)";break;case 5:c="This app does not have access to this feature."}var d={title:"Could not determine location",richContent:c};richModal.display(d),window.spinner&&window.spinner.hide()}})},getLocation:function(i){var n=null,a=null;appApiKeys.get(function(t,e){if((a=e.googleMapKey)||((n=new Error("no google API key")).code=5),n||"object"==("undefined"==typeof geoAPI?"undefined":_typeof(geoAPI))||((n=new Error("geoAPI not defined")).code=4),n)i(n,null);else{geoAPI.getCurrentPosition({timeout:1e4},function(t,e){e&&(e.googleMapKey=a),i(t,e)})}})},setLocation:function(t,e){t&&e?"undefined"!=typeof tinymce&&tinymce.activeEditor?(tinymce.activeEditor.insertContent('<img src="'+e+'" width="100" height="100" class="tinymce-geoImage">'),this.currentStepData.location=t):(this.currentStepData.location=t,this.geoContainer.style.display="block",this.geoImage.src=e):(this.currentStepData.location={},this.geoContainer.style.display="none",this.geoImage.removeAttribute("src")),this.doneButton.disabled=!this.validate()},getMapUrl:function(t){var e=t.coords,i=e.latitude,n=e.longitude,a=t.googleMapKey,o="https://maps.googleapis.com/maps/api/staticmap?"+("center="+i+","+n)+"&"+("markers=color:blue|size:large|"+i+","+n)+"&"+("zoom=15&"+("size="+window.innerWidth+"x"+window.innerWidth)+"&maptype=roadmap&key="+a),l=o.replace(/size:large/g,"size:mid").replace(/size=\d{1,4}x\d{1,4}/g,"size=100x100").replace(/zoom=15/g,"zoom=12");return{mapUrl:o,thumbnail:l}},showGifDialog:function(){var l=this,i=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if("object"==("undefined"==typeof gifAPI?"undefined":_typeof(gifAPI))){var t=this.currentStepOptions.attachments.gifs,r=t.multiple,e=t.rating,s=function(t){if(!(6<=l.currentStepData.images.length+l.currentStepData.gifs.length)){l.currentStepData.gifs.push(t);var e="";e=bfUtils.isIOS?t.images.preview.mp4||t.images.gif.downsized_small.mp4:t.images.downsized_medium.url||t.images.original.url,i?inputAPI._showTinyMceDialog(e,"gif"):l.addToGallery(e,"gifs")}};gifAPI.showGifDialog({multiple:r,rating:e},function(t,e){if(!t&&e){var i=e.cancelled,n=e.results;if(!i&&n&&n.length)if(r)e.results.forEach(function(t){return s(t)});else{l.currentStepData.gifs=[];var a=document.getElementById("gifs_0");a&&l.imageGallery.removeChild(a);var o=e.results[0];s(o)}}})}},showFileDialog:function(){var o=this,l=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=new PublicFilesAPI(window.appContext.currentApp);t._onComplete=function(t){if("success"===t.status){var e=o.currentStepData,i=e.images,n=e.gifs,a=i?i.length:0;if(6<=(n?n.length:0)+a)return;o.currentStepData.images.push(t.url),l?inputAPI._showTinyMceDialog(t.url,"image"):o.addToGallery(t.url,"images")}else console.error("Image upload failed - inputAPI",t)},t._onProgress=function(){window.spinner&&window.spinner.show(),o.doneButton.disabled=!0};var e=this.currentStepOptions.attachments.images.multiple||!1;t.showDialog({allowMultipleFilesUpload:e},function(){window.spinner&&setTimeout(window.spinner.hide.bind(null,!0),300),o.doneButton.disabled=!(!o.currentStepOptions.required||!o.currentStepData.textValue||o.currentStepData.textValue.length)})},addToGallery:function(t,e){var i=this,n=this.currentStepData[e].length-1,a=document.createElement("div");a.className="img-gallery-container animated fadeInUp "+e,a.id=e+"_"+n;var o=document.createElement("span");if(o.className="galery-delete glyphicon glyphicon-minus-sign",o.onclick=function(){i.removeFromGallery(n,e)},a.appendChild(o),"images"===e&&"undefined"!=typeof imageTools){t=imageTools.cropImage(t,{size:"s",aspect:"1:1",compression:50})}var l=document.createElement("img");l.setAttribute("src",t),l.className="img-gallery-item "+e,a.appendChild(l),this.imageGallery.appendChild(a);var r=this.currentStepData,s=r.images,c=r.gifs,d=s?s.length:0;5<(c?c.length:0)+d&&(this.cameraBtn.classList.add("disabled"),this.gifBtn.classList.add("disabled"))},removeFromGallery:function(t,e){this.currentStepData[e].splice(t,1);var i=document.getElementById(e+"_"+t);i&&this.imageGallery.removeChild(i);var n=this.currentStepData,a=n.images,o=n.gifs,l=a?a.length:0;(o?o.length:0)+l<6&&(this.cameraBtn.classList.remove("disabled"),this.gifBtn.classList.remove("disabled"))},getTinyMceStyles:function(){var t=document.createElement("style");if(t.id="tinymce-styles",!PluginAPI.appTheme)return t;var e=PluginAPI.appTheme.colors,i=e.icons,n=e.backgroundColor,a=e.bodyText,o=e.primaryTheme;return t.innerHTML="\n      .tox .tox-tbtn svg,\n      .tox-icon svg {\n        fill: "+i+" !important;\n      }\n\n      .tox .tox-toolbar,\n      .tox .tox-toolbar__overflow,\n      #tinymce-textarea_ifr,\n      .tox .tox-edit-area__iframe,\n      .tox-dialog__header,\n      .tox-dialog,\n      .tox-dialog__footer,\n      .tox .tox-statusbar {\n        background-color: "+n+" !important;\n      }\n\n      .tox-editor-header,\n      .tox .tox-toolbar__primary,\n      .tox .tox-toolbar-overlord {\n        background-color: "+n+"33 !important;\n      }\n      .tox .tox-tbtn--enabled {\n        background-color: rgba(155, 155, 155, .3) !important;\n        background: rgba(155, 155, 155, .3) !important;\n      }\n\n      .tox .tox-tbtn--enabled:hover,\n      .tox .tox-tbtn:hover {\n        background-color: rgba(155, 155, 155, .1) !important;\n        background: rgba(155, 155, 155, .1) !important;\n      }\n      \n      .tox-label,\n      .tox-dialog__body-content,\n      .tox-dialog__title,\n      .tox-statusbar__path-item,\n      .tox-statusbar__path {\n        color: "+a+" !important;\n      }\n\n      button.tox-button.tox-button--secondary {\n        background: none !important;\n        border: none !important;\n        color: "+a+" !important;\n      }\n\n      .tox.tox-tinymce.tox-tinymce--toolbar-bottom {\n        border-left: none;\n        border-right: none;\n        border-top: none;\n        border-bottom: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      @media (min-width: 1200px) {\n        .tox.tox-tinymce.tox-tinymce--toolbar-bottom {\n          min-height: 200px;\n        }\n      }\n\n      .tox-toolbar.tox-toolbar--scrolling {\n        background: transparent !important;\n        border-top: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox:not([dir=rtl]) .tox-toolbar__group:not(:last-of-type) {\n        border-right: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox-statusbar {\n        border-top: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox-dialog__footer {\n        border-top: none !important;\n      }\n\n      .wysiwyg_radio {\n        display: flex;\n      }\n\n      .wysiwyg_radio__label {\n        margin-left: 1rem;\n      }\n\n      .wysiwyg_radio__label:after {\n        background-color: "+o+" !important;\n      }\n\n      .wysiwyg_radio__input:checked + .wysiwyg_radio__label:before {\n        border-color: "+o+" !important;\n      }\n\n      .wysiwyg_radio__label:before {\n        border: 2px solid "+a+" !important;\n      }\n\n      .tox .tox-form__group {\n        margin-bottom: 2rem !important;\n      }\n\n      .tox-dialog {\n        width: calc(100vw - 4rem) !important;\n        border: none !important;\n        border-radius: 5px !important;\n        margin-top: 50% !important; \n      }\n\n      #full_width path#Shape {\n        fill: "+i+";\n      }\n\n      #half_width path#Shape {\n        fill: "+i+";\n      }\n\n      #third_width path#Shape {\n        fill: "+i+";\n      }\n\n      #quarter_width path#Shape {\n        fill: "+i+';\n      }\n\n      .wysiwyg_radio svg {\n        margin-left: auto !important;\n      }\n\n      .tox .tox-dialog-wrap__backdrop--opaque {\n        background-color: rgba(0,0,0,.5) !important;\n      }\n\n      [aria-label="Close"] {\n        visibility: hidden;\n      }\n\n    ',t},getTinyMceOptions:function(t,e){var i="";if(PluginAPI.appTheme){var n=PluginAPI.appTheme.colors,a=n.bodyText;i="\n          body { \n            color: "+a+"; \n          } \n          .mce-content-body[data-mce-placeholder]:not(.mce-visualblocks)::before { \n            color: "+a+"99;\n          }\n          .tox .tox-tbtn svg {\n            fill: "+n.icons+" !important;\n          }\n      "}return{selector:"#inputapi-textarea",plugins:"image lists imagetools",toolbar:["bold italic | bullist numlist | alignleft aligncenter alignright"],placeholder:t.placeholder||"Type something...",toolbar_location:"bottom",height:"100%",menubar:!1,toolbar_mode:"scrolling",content_style:i,setup:function(i){i.on("init",function(t){var e=document.querySelector('[aria-label="Powered by Tiny"]');e.addEventListener("click",function(t){t.preventDefault(),window.open(e.href,"_system")}),setTimeout(function(){i.focus()},500)})}}},fullWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>full_width</title> <desc>Created with Sketch.</desc> <g id="full_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M16,12 C17.1045695,12 18,12.8954305 18,14 L18,16 C18,17.1045695 17.1045695,18 16,18 L2,18 C0.8954305,18 0,17.1045695 0,16 L0,14 C0,12.8954305 0.8954305,12 2,12 L16,12 Z M16,14 L2,14 L2,16 L16,16 L16,14 Z M16,0 C17.1045695,0 18,0.8954305 18,2 L18,8 C18,9.1045695 17.1045695,10 16,10 L2,10 C0.8954305,10 0,9.1045695 0,8 L0,2 C0,0.8954305 0.8954305,0 2,0 L16,0 Z" id="Shape" fill="#000000"></path> </g> </svg>',halfWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>half_width</title> <desc>Created with Sketch.</desc> <g id="half_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M6,3.55271368e-15 C7.1045695,3.55271368e-15 8,0.8954305 8,2 L8,16 C8,17.1045695 7.1045695,18 6,18 L2,18 C0.8954305,18 -3.2162453e-16,17.1045695 -3.2162453e-16,16 L-3.2162453e-16,2 C-3.2162453e-16,0.8954305 0.8954305,3.55271368e-15 2,3.55271368e-15 L6,3.55271368e-15 Z M16,7.10542736e-15 C17.1045695,7.10542736e-15 18,0.8954305 18,2 L18,16 C18,17.1045695 17.1045695,18 16,18 L12,18 C10.8954305,18 10,17.1045695 10,16 L10,2 C10,0.8954305 10.8954305,7.10542736e-15 12,7.10542736e-15 L16,7.10542736e-15 Z M16,2 L12,2 L12,16 L16,16 L16,2 Z" id="Shape" fill="#000000"></path> </g> </svg>',thirdWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>third_width</title> <desc>Created with Sketch.</desc> <g id="third_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M4,4 C4.55228475,4 5,4.44771525 5,5 L5,13 C5,13.5522847 4.55228475,14 4,14 L2,14 C1.44771525,14 1,13.5522847 1,13 L1,5 C1,4.44771525 1.44771525,4 2,4 L4,4 Z M10,4 C10.5522847,4 11,4.44771525 11,5 L11,13 C11,13.5522847 10.5522847,14 10,14 L8,14 C7.44771525,14 7,13.5522847 7,13 L7,5 C7,4.44771525 7.44771525,4 8,4 L10,4 Z M16,4 C16.5522847,4 17,4.44771525 17,5 L17,13 C17,13.5522847 16.5522847,14 16,14 L14,14 C13.4477153,14 13,13.5522847 13,13 L13,5 C13,4.44771525 13.4477153,4 14,4 L16,4 Z M10,5 L8,5 L8,13 L10,13 L10,5 Z M16,5 L14,5 L14,13 L16,13 L16,5 Z" id="Shape" fill="#000000"></path> </g> </svg>',quarterWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>quarter_width</title> <desc>Created with Sketch.</desc> <g id="quarter_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M2,4 C2.55228475,4 3,4.44771525 3,5 L3,13 C3,13.5522847 2.55228475,14 2,14 L1,14 C0.44771525,14 0,13.5522847 0,13 L0,5 C0,4.44771525 0.44771525,4 1,4 L2,4 Z M7,4 C7.55228475,4 8,4.44771525 8,5 L8,13 C8,13.5522847 7.55228475,14 7,14 L6,14 C5.44771525,14 5,13.5522847 5,13 L5,5 C5,4.44771525 5.44771525,4 6,4 L7,4 Z M17,4 C17.5522847,4 18,4.44771525 18,5 L18,13 C18,13.5522847 17.5522847,14 17,14 L16,14 C15.4477153,14 15,13.5522847 15,13 L15,5 C15,4.44771525 15.4477153,4 16,4 L17,4 Z M12,4 C12.5522847,4 13,4.44771525 13,5 L13,13 C13,13.5522847 12.5522847,14 12,14 L11,14 C10.4477153,14 10,13.5522847 10,13 L10,5 C10,4.44771525 10.4477153,4 11,4 L12,4 Z M7,5 L6,5 L6,13 L7,13 L7,5 Z M17,5 L16,5 L16,13 L17,13 L17,5 Z M12,5 L11,5 L11,13 L12,13 L12,5 Z" id="Shape" fill="#000000"></path> </g> </svg>',_showTinyMceDialog:function(a,t){var e="image"===t?"Image":"Gif",i={title:"Save",handler:function(){var e=void 0;["fullWidth","halfWidth","thirdWidth","quarterWidth"].some(function(t){if(document.querySelector('input[value="'+t+'"]').checked)return e=t,!0});var t=tinyMCE.activeEditor.getContainer().clientWidth,i=void 0;switch(e){case"fullWidth":t="calc("+t+"px - 2rem)",i="full_width";break;case"halfWidth":t="calc("+t/2+"px - 1rem)",i="half_width";break;case"thirdWidth":t="calc(("+t+"px - 2rem) / 3)",i="third_width";break;case"quarterWidth":t="calc("+t/4+"px - .5rem)",i="quarter_width"}var n=imageTools.resizeImage(a,{size:i,aspect:"1:1"});tinymce.activeEditor.insertContent('<img src="'+n+'" style="width: '+t+';">'),richModal.close()}},n={title:"Insert "+e,richContent:'\n      <div>\n        <p style="margin-bottom: 2rem !important">'+e+' size</p>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="fullWidth" class="wysiwyg_radio__input" value="fullWidth" checked>\n          <label for="fullWidth" class="wysiwyg_radio__label">Full Width</label>\n          '+this.fullWidthIcon+'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="halfWidth" class="wysiwyg_radio__input" value="halfWidth">\n          <label for="halfWidth" class="wysiwyg_radio__label">Half Width</label>\n          '+this.halfWidthIcon+'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="thirdWidth" class="wysiwyg_radio__input" value="thirdWidth">\n          <label for="thirdWidth" class="wysiwyg_radio__label">Third Width</label>\n          '+this.thirdWidthIcon+'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="quarterWidth" class="wysiwyg_radio__input" value="quarterWidth">\n          <label for="quarterWidth" class="wysiwyg_radio__label">Quarter Width</label>\n          '+this.quarterWidthIcon+"\n        </div>\n      </div>\n    ",action:i};richModal.display(n)},renderStep:function(e,i,n){var a=this;this.currentStepData={wysiwygValue:e.defaultValue||"",textValue:e.defaultValue||"",images:[],location:{},gifs:[]},e.maxLength=e.maxLength||2e3,this.currentStepOptions=e,this.title.innerHTML=e.title||"",this.titleSecondary.innerHTML=e.title||"";var t=this.currentStepOptions.attachments,o=t.location,l=t.images,r=t.gifs,s=!1;["images","gifs","location"].forEach(function(t){e.attachments[t]&&e.attachments[t].enable&&(e.attachments[t].required||(s=!0))}),this.actionFooter.style.display=s?"flex":"none",this.cameraBtn.style.display=l.enable&&this.currentStepData.images.length<6?"block":"none",this.geoPin.style.display=o.enable&&!o.required?"block":"none",this.gifBtn.style.display=r.enable?"block":"none",this.imageGallery.style.display=e.wysiwyg?"none":"block",this.currentUserContainer.innerHTML="";var c=authAPI.getCurrentUser();if(this.userImage=document.createElement("img"),c&&c.imageUrl)if("undefined"!=typeof imageTools){this.userImage.src=imageTools.cropImage(c.imageUrl,{size:"xs",aspect:"1:1",compression:70})}else this.userImage.src=c.imageUrl;else this.userImage.src="https://pluginserver.buildfire.com/styles/media/avatar-placeholder.png";(this.userImage.className="inputapi-user-image",this.currentUserContainer.appendChild(this.userImage),this.userTitle=document.createElement("h1"),this.userTitle.className="inputapi-user-title ellipsis",c&&(this.userTitle.innerHTML=c.displayName||(c.firstName?c.firstName+" ":"")+(c.lastName||"")||""),this.currentUserContainer.appendChild(this.userTitle),e.wysiwyg)?(document.getElementById("tinymce-styles")||document.head.appendChild(inputAPI.getTinyMceStyles()),"undefined"!=typeof Keyboard&&(Keyboard.shrinkView?Keyboard.shrinkView(!0):Keyboard.setResizeMode&&Keyboard.setResizeMode("native")),this.textarea.innerHTML=e.defaultValue||"",tinymce.init(this.getTinyMceOptions(e,this)),this.cameraBtn.onclick=function(t){return a.showFileDialog(!0)},this.gifBtn.onclick=function(t){return a.showGifDialog(!0)}):(this.textarea.placeholder=e.placeholder||"Type something...",this.textarea.maxLength=e.maxLength||2e3,this.textarea.value=e.defaultValue?e.defaultValue.substring(0,this.textarea.maxLength):"");var d=document.createElement("div");d.className="btn-txt primary",d.innerHTML=e.saveText?e.saveText:e._buffer.length?"Next":"Done";var h=document.createElement("div");h.className="btn-txt secondary iconsTheme",h.innerHTML=e.saveText?e.saveText:e._buffer.length?"Next":"Done";var u=document.createElement("div");u.className="btn-txt primary",u.innerHTML=e.cancelText||"Cancel";var m=document.createElement("div");for(m.className="btn-txt secondary iconsTheme",m.innerHTML=e.cancelText||"Cancel",this.doneButton.innerHTML="",this.cancelButton.innerHTML="",this.doneButton.appendChild(d),this.doneButton.appendChild(h),this.cancelButton.appendChild(u),this.cancelButton.appendChild(m),this.doneButton.onclick=function(t){return n(a.currentStepData)},this.cancelButton.onclick=function(t){return i()},this.backdrop.onclick=function(t){return i()},e.prefill&&(this.textarea.value=e.prefill),this.doneButton.disabled=!this.validate();this.imageGallery.childNodes[1];)this.imageGallery.removeChild(this.imageGallery.childNodes[1]);if("object"==_typeof(e.defaultAttachments)){var p=e.defaultAttachments,g=p.images,f=p.gifs,y=p.location;g&&g.length&&(this.currentStepData.images=g).forEach(function(t){a.addToGallery(t,"images")}),f&&f.length&&(this.currentStepData.gifs=f).forEach(function(t){return a.addToGallery(t,"gifs")}),this.currentStepData.gifs=f,this.currentStepData.location=y}o.required?this.showLocationModal():this.setLocation()},showTextDialog:function(t,e){var i=this;if(t&&e)if("undefined"==typeof tinymce&&("function"==typeof t.some?t.some(function(t){return t.wysiwyg}):t.wysiwyg)){var n=document.createElement("script");n.src=window._appRoot+"scripts/lib/tinymce/js/tinymce/tinymce.min.js",n.type="text/javascript",n.onload=function(){i._showTextDialog(t,e)},document.getElementsByTagName("head")[0].appendChild(n)}else this._showTextDialog(t,e)},_showTextDialog:function(t,e){var n=this;if(t&&e){if(this.currentStepOptions&&this.currentStepOptions._buffer)return e({message:"inputDialog is already active"});this.initialized||this.init();var a=new PublicFilesAPI(window.appContext.currentApp),o=Array.isArray(t)?t:[t],l=[],i=!1,r=!1;if(o.forEach(function(t){t.cancelText&&9<t.cancelText.length&&(r=!0),t.saveText&&9<t.saveText.length&&(i=!0),t.attachments||(t.attachments={}),t.attachments.images||(t.attachments.images={}),t.attachments.location||(t.attachments.location={}),t.attachments.location.required&&(t.attachments.location.enable=!0),t.attachments.gifs||(t.attachments.gifs={})}),i)return e(new Error("saveText too long, max 9 chars"));if(r)return e(new Error("cancelText too long, max 9 chars"));!t.hideUserData&&authAPI.getCurrentUser()||(this.currentUserContainer.style.display="none"),t.prefill&&(this.textarea.value=t.prefill);var s=function(t){return"undefined"==typeof Keyboard?t():Keyboard.shrinkView?(Keyboard.shrinkView(!1),t()):Keyboard.hide&&Keyboard.setResizeMode?Keyboard.isVisible?(window.addEventListener("keyboardDidHide",function(){return Keyboard.setResizeMode&&Keyboard.setResizeMode("body"),t()},{once:!0}),void Keyboard.hide()):(Keyboard.setResizeMode("body"),t()):t()},c=function(t){e(null,{cancelled:t,results:l}),n.currentStepOptions=null,n.currentStepData=null,n.timer=setTimeout(function(){n.inputDialog.classList.remove("active"),n.backdrop.classList.remove("active"),setTimeout(function(){n.inputDialog.classList.contains("active")||(n.inputDialog.style.display="none",n.init(),"undefined"!=typeof tinymce&&tinymce.activeEditor&&tinymce.activeEditor.remove())},500)},150)},d=function(){s(function(){return c(!0)})},h=o.shift();h._buffer=o,this.renderStep(h,d,function e(i){"undefined"!=typeof tinymce&&tinymce.activeEditor&&(i.wysiwygValue=tinymce.activeEditor.getContent(),i.textValue=tinymce.activeEditor.getContent({format:"text"}),i.images&&i.images.length&&(i.images=i.images.filter(function(t){return!!i.wysiwygValue.includes(t)||(a.deleteFile({fileId:t.split("/").pop()},function(t,e){t&&console.error("Error while deleting image")}),!1)})),tinymce.activeEditor.remove(),n.textarea.value=""),l.push(i);s(function(){var t=o.shift();if(!t)return c(!1);t._buffer=o,n.renderStep(t,d,e)})}),this.timer&&(clearTimeout(this.timer),this.timer=null),this.inputDialog.style.display="flex",setTimeout(function(){n.inputDialog.classList.add("active"),n.backdrop.classList.add("active")},100),setTimeout(function(){"undefined"==typeof tinymce||tinymce.activeEditor||n.textarea.focus()},500)}},showListDialog:function(l,t){var r=this;if(l&&t){if(!l.listItems||!l.listItems.length)return t(new Error("No listItems provided to showListDialog"),null);if(l.listItems.some(function(t){return!t.text||!t.value}))return t(new Error("All listItems must contain text and value"),null);l.cancelButton||(l.cancelButton={text:"Cancel",value:"cancel"}),l.confirmButton||(l.confirmButton={text:"Ok",value:"ok"}),this.initialized||this.init(),this.listDialogItems.innerHTML="",this.listDialogHeader.innerText=l.title||"",l.listItems.forEach(function(t){var e=document.createElement("div");e.className="input-list-item";var i=document.createElement("input");i.value=t.value,i.setAttribute("type",l.multiSelect?"checkbox":"radio"),i.setAttribute("name","listDialogItem"),i.setAttribute("id",t.value),e.appendChild(i);var n=document.createElement("label");n.setAttribute("for",t.value);var a=document.createElement("span");a.className="selector primaryBackgroundTheme";var o=document.createElement("div");o.innerText=t.text,n.appendChild(a),n.appendChild(o),e.appendChild(n),r.listDialogItems.appendChild(e)});for(var a=[],e=function(t){var e=t.target.children[0],i=e.value,n=e.type;switch(t.target.children[0].checked?t.target.children[0].checked=!1:t.target.children[0].checked=!0,n){case"checkbox":t.target.checked?a.push({value:i}):a=a.filter(function(t){return t.value!==i});break;case"radio":a=[{value:i}],r.listDialogConfirmBtn.disabled=!1}},i=0;i<this.listDialogItems.childElementCount;i++)this.listDialogItems.children[i].onclick=e;this.listDialogCancelBtn.innerHTML=l.cancelButton.text,this.listDialogCancelBtn.value=l.cancelButton.value,this.listDialogConfirmBtn.innerHTML=l.confirmButton.text,this.listDialogConfirmBtn.value=l.confirmButton.value,l.multiSelect||(this.listDialogConfirmBtn.disabled=!0);var n=function(){r.listDialog.classList.remove("active"),r.backdrop.classList.remove("active"),r.backdrop.classList.remove("isDialog");for(var t=0;t<r.listDialogItems.childElementCount;t++)r.listDialogItems.children[t].onclick=null;r.listDialogItems.innerHTML="",r.listDialogHeader.innerHTML=""};this.backdrop.onclick=function(){return n(),t(null,{cancelled:!0,selected:a})},this.listDialogCancelBtn.onclick=function(){return n(),t(null,{cancelled:!0,selected:a})},this.listDialogConfirmBtn.onclick=function(){return n(),t(null,{cancelled:!1,selected:a})},this.listDialog.classList.add("active"),this.backdrop.classList.add("active"),this.backdrop.classList.add("isDialog")}},validate:function(){var t=!1,e=!1,i=this.currentStepOptions,n=i.required,a=i.attachments;return(!n||this.textarea.value&&0<this.textarea.value.length)&&(t=!0),a.location.required&&!this.currentStepData.location.latitude||(e=!0),t&&e}};setTimeout(function(){inputAPI.initialized||inputAPI.init()},5e3);
"use strict";var gifAPI={initialized:!1,apiKey:"5yISc07frWLGwJJgXt7PKnsDMQP1or1H",results:[],pages:[],options:{},handleClose:null,init:function(){var n=this;this.gifDialog?this.gifDialog.innerHTML="":(this.gifDialog=document.createElement("div"),this.gifDialog.style.display="none"),this.backdrop?this.backdrop.className="":(this.backdrop=document.createElement("div"),this.backdrop.id="gif-backdrop"),this.gifDialog.id="gifDialog",this.gifDialog.className="backgroundColorTheme";var e=document.createElement("div");e.className="gifDialog-container backgroundColorTheme",this.gifDialog.appendChild(e);var i=document.createElement("div");i.className="gifapi-nav backgroundColorTheme",e.appendChild(i);var t=document.createElement("div");t.className="gifapi-nav-flex gifapi-search-bar",i.appendChild(t),this.cancelButton=document.createElement("span"),this.cancelButton.className="icon icon-cross2 gifapi-cancel bodyTextTheme",this.cancelButton.style.width="unset",t.appendChild(this.cancelButton);var a=document.createElement("form");a.action=".",t.appendChild(a),this.gifSearchInput=document.createElement("input"),this.gifSearchInput.className="gif-search-input form-control",this.gifSearchInput.placeholder="search GIPHY",this.gifSearchInput.type="search",this.gifSearchInput.onkeydown=function(e){var i=e.key,t=e.target;"Enter"===i&&(n.search(),t.blur())},this.gifSearchInput.oninput=function(e){var i=e.target;n.clearSearch.style.display=i.value?"block":"none"},this.setSearchBarStyle(),a.appendChild(this.gifSearchInput);var s=document.createElement("i");s.className="glyphicon glyphicon-search search-icon",a.appendChild(s),this.clearSearch=document.createElement("button"),this.clearSearch.className="search-clear",this.clearSearch.style.display="none",this.clearSearch.onclick=function(e){var i=e.target;n.gifSearchInput.value="",i.style.display="none"},a.appendChild(this.clearSearch);var l=document.createElement("i");l.className="glyphicon glyphicon-minus-sign",this.clearSearch.appendChild(l),this.gifResults=document.createElement("div"),this.gifResults.className="gif-results",this.gifResults.addEventListener("scroll",function(){n.lazyLoad.processLazyImages(),n.loadPage()},!1),e.appendChild(this.gifResults);var r=document.createElement("div");r.className="powered-by",e.appendChild(r);var o=document.createElement("img");o.src=window._appRoot+"media/PoweredByGiphy.png",r.appendChild(o),0<=window.location.pathname.indexOf("pluginTester")?(this.gifDialog.style.height=document.getElementById("app").offsetHeight+"px",this.gifDialog.style.position="absolute",document.getElementById("app").appendChild(this.gifDialog),document.getElementById("app").appendChild(this.backdrop)):(this.gifDialog.style.height="100vh",this.gifDialog.style.maxHeight="100vh",document.body.appendChild(this.gifDialog),document.body.appendChild(this.backdrop)),this.initialized=!0},setSearchBarStyle:function(){var c=this,e=function(e,i){if(!e&&i&&i.data&&i.data.colors){var t=i.data.colors,n=t.backgroundColor,a=t.bodyText,s=tinycolor(n).isDark()?"lighten":"darken",l=tinycolor(n)[s](10).toString(),r=tinycolor(a)[s](10).toString(),o=document.createElement("style");o.innerHTML="\n\t\t\t\t.gif-search-input::placeholder,\n\t\t\t\t.search-icon {\n\t\t\t\t\tcolor: "+r+" !important;\n\t\t\t\t}\n\t\t\t\t.gif-search-input {\n\t\t\t\t\tcolor: "+r+";\n\t\t\t\t\tbackground: "+l+"\n\t\t\t\t}\n\t\t\t",c.gifDialog.appendChild(o)}};if(PluginAPI.appTheme)return e(null,{data:PluginAPI.appTheme});new DatastoreAPI(window.appContext.currentApp.appId,"appearance","appearance",window.appContext.liveMode).get({tag:"appearance",withDynamicData:!1},e)},showGifDialog:function(e,i){var t=this;e||(e={multiple:!1,rating:"g"}),this.options=e,this.initialized||this.init(),this.gifResults.innerHTML="",this.gifSearchInput.value="";this.results=[],this.handleClose=function(e){i(null,{cancelled:e,results:t.results}),t.handleClose=null,t.pages=[],t.results=[],t.options={},t.timer=setTimeout(function(){t.gifDialog.classList.remove("active"),t.backdrop.classList.remove("active"),setTimeout(function(){t.gifDialog.classList.contains("active")||(t.gifResults.innerHTML="",t.gifSearchInput.value="",t.gifDialog.style.display="none",t.init())},500)},150)},this.cancelButton.onclick=function(){return t.handleClose(!0)},this.backdrop.onclick=function(){return t.handleClose(!0)},this.timer&&(clearTimeout(this.timer),this.timer=null),this.gifDialog.style.display="flex",setTimeout(function(){t.gifDialog.classList.add("active"),t.backdrop.classList.add("active")},100),this.gifDialog.addEventListener("transitionend",function(){return t.getTrending()},{once:!0})},createRequestUrl:function(e){if(e){var i=e.key,t=e.endpoint,n=e.query,a=e.limit,s=e.offset,l=e.rating;return""+("https://api.giphy.com/v1/gifs/"+t+"?api_key="+i)+(a="&limit="+(a||120))+(s="&offset="+(s||0))+(l="&rating="+(l||"g"))+(n=n&&"search"===t?"&q="+n:"")}},createProxyUrl:function(e){return"https://proxy.buildfire.com/hop?url="+encodeURIComponent(e)},get:function(e,i,t){var n=this;if(!e||!["trending","search","random"].includes(e))return t(new Error("invalid endpoint"),null);"function"==typeof i&&(t||(t=i),i={});var a=i||{},s=a.limit,l=a.offset,r=a.rating,o=a.query,c={key:this.apiKey,endpoint:e,limit:s,offset:l,rating:r,query:o},d=this.createRequestUrl(c);d=this.createProxyUrl(d),fetch(d).then(function(e){return e.json()}).then(function(e){return n.digest(e,t)}).catch(function(e){t?t(e,null):console.error(e)})},digest:function(e,i){var t=this.convertGifs(e.data);if(i)return i(null,t);this.gifResults.innerHTML="",this.pages=[];for(var n=[];t.length;){var a=[];a=24<t.length?t.splice(0,24):t.splice(0,t.length),n.push(a)}this.pages=n,this.loadPage()},convertGifs:function(e){return e?(e.id&&(e=[e]),e.map(function(e){var i=e.id,t=e.title,n=e.rating,a=e.user,s=e.images;return{id:i,title:t,rating:n,user:a,images:{preview:s.preview,preview_gif:s.preview_gif,original:s.original,downsized_large:s.downsized_large,downsized_medium:s.downsized_medium,downsized_small:s.downsized_small,downsized_still:s.downsized_still,original_still:s.original_still,fixed_height:s.fixed_height}}})):[]},loadPage:function(){if(!(this.pages.length<1)){var e=this.gifResults;if(e.scrollHeight-e.scrollTop<=1.75*e.clientHeight){var i=this.pages.splice(0,1)[0];this.renderPage(i)}}},renderPage:function(e){var l=this;if(e&&e.length){var r=bfUtils.isIOS;e.forEach(function(i){var e,t=(e=i,r?e.images.preview&&e.images.preview.mp4?e.images.preview.mp4:e.images.downsized_small&&e.images.downsized_small.mp4?e.images.downsized_small.mp4:e.images.original&&e.images.original.mp4?e.images.original.mp4:null:e.images.downsized_medium&&e.images.downsized_medium.url?e.images.downsized_medium.url:e.images.original&&e.images.original.url?e.images.original.url:null);if(t){var n=document.createElement("div");n.className="gif-container lazy-img",n.id="gif_"+i.id,n.setAttribute("data-src",t),n.onclick=function(e){return l.selectGif(e,i)};var a=document.createElement("span");n.appendChild(a);var s=document.createElement("div");s.className="gif-thumbnail",n.appendChild(s),l.gifResults.appendChild(n)}}),this.lazyLoad.processLazyImages()}},selectGif:function(e,i){e.target.classList.add("selected"),this.results=[i],this.handleClose&&this.handleClose(!1)},getTrending:function(){this.get("trending",this.options)},search:function(){gifAPI.options.query=gifAPI.gifSearchInput.value||"",gifAPI.options.query?gifAPI.get("search",gifAPI.options):gifAPI.get("trending",gifAPI.options)},lazyLoad:{process:function(e){if(e.hasAttribute("data-src")){var i=e.querySelectorAll(".gif-thumbnail")[0];i&&(i.style.backgroundImage=this.isInViewport(e)?"url("+e.getAttribute("data-src")+")":"unset")}},isInViewport:function(e){var i=window.innerHeight,t=e.getBoundingClientRect().top;return t>i*-Math.abs(1.25)&&t<1.25*i},processLazyImages:function(){var i=this;document.querySelectorAll(".lazy-img").forEach(function(e){return i.process(e)})}}};setTimeout(function(){gifAPI.initialized||gifAPI.init()},5e3);
"use strict";var bookmarkAPI={add:function(r,t){var e=window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin.instanceId:window.postMaster.launcherPluginAPI.context.instanceId,n=authAPI.getCurrentUser(),a=(n?n._id:"guest")+".bookmarks",o=localStorage.getItem(a)?JSON.parse(localStorage.getItem(a)):[];r.id=r.id||r.title,r.pluginInstanceId=e;var l=o.findIndex(function(t){var e=t.id===r.id,n=t.pluginInstanceId===r.pluginInstanceId;return e&&n});0<=l?o[l]=r:o.push(r),localStorage.setItem(a,JSON.stringify(o)),t(null,r)},delete:function(e,t){var n=authAPI.getCurrentUser(),r=(n?n._id:"guest")+".bookmarks",a=localStorage.getItem(r)?JSON.parse(localStorage.getItem(r)):[],o=a.findIndex(function(t){return t.id===e});0<=o&&a.splice(o,1),localStorage.setItem(r,JSON.stringify(a)),t&&t(null,a)},deleteFromPlugin:function(e,t){var n=authAPI.getCurrentUser(),r=(n?n._id:"guest")+".bookmarks",a=localStorage.getItem(r)?JSON.parse(localStorage.getItem(r)):[],o=a.findIndex(function(t){return t.id===e});0<=o&&a.splice(o,1),localStorage.setItem(r,JSON.stringify(a)),t(null,null)},getAll:function(t){var e=authAPI.getCurrentUser(),n=(e?e._id:"guest")+".bookmarks";t(null,localStorage.getItem(n)?JSON.parse(localStorage.getItem(n)):[])},getAllFromPlugin:function(t,e){var n=authAPI.getCurrentUser(),r=n?n._id:"guest",a=window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin.instanceId:window.postMaster.launcherPluginAPI.context.instanceId,o=r+".bookmarks";e(null,(localStorage.getItem(o)?JSON.parse(localStorage.getItem(o)):[]).filter(function(t){return t.pluginInstanceId===a}))}};
"use strict";var notesAPI={notesCtrlScope:null,userData:null,_getUserDataContext:function(t,a){this._getUser(function(t){var e=t._id,n=window.currentAppId||window.appContext.currentApp.appId,i=new UserDatastoreAPI(n,"sideMenu",1,!0,e);a(null,{userDatastore:i,userToken:e})})},openDialog:function(t,e){t?(this.notesCtrlScope.tempNoteData=t,this.notesCtrlScope.instanceId=window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin.instanceId:window.postMaster.launcherPluginAPI.context.instanceId,this.notesCtrlScope.pluginOpen=!0,this.notesCtrlScope.callback=e):this.notesCtrlScope.pluginOpen=!1,this._showModal()},getByItemId:function(i,a){i||(i={}),i.itemId?this.getAllFromItem(i.itemId,function(t,e){if(t)a(t);else{var n={itemId:i.itemId,hasNotes:e&&0<e.length,noteCount:e?e.length:0};a(null,n)}}):a("invalid params, missing itemId")},_showModal:function(){this.notesCtrlScope.notesShown=!0,notesAPI.notesCtrlScope.$$phase||notesAPI.notesCtrlScope.$apply()},add:function(d,r){var s=this,t={title:d.title||"New Note",hideUserData:!0,placeholder:"Note Text",saveText:"Save"};window.inputAPI.showTextDialog(t,function(t,e){if(t)throw t;d.noteText=e.cancelled?"":e.results[0].textValue,""!==d.noteText&&(d.id=Date.now(),s.notesCtrlScope.notes.push({id:d.id,noteText:d.noteText,timeIndex:d.timeIndex}),s.notesCtrlScope.$$phase||s.notesCtrlScope.$apply(),s._getUser(function(o){s._getUserData(function(t,e){if(t)throw t;if(d.userToken=o._id,e.id){var n=s._getIndex(e,d.instanceId,d.itemId),i=n.pluginIndex,a=n.itemIndex;if(-1<i)-1<a?s._addNote(e,d,i,a,r):s._addItem(e,d,i,r);else s._initPluginData(e,d,r)}else s._initUserData(d,r)})}))})},_addNote:function(t,e,n,i,a){var o=e.id,d=e.noteText,r=e.timeIndex;t.data[n].content[i].notes.push({id:o,noteText:d,timeIndex:r}),this._updatePluginData(t,a)},_addItem:function(t,e,n,i){var a=e.title,o=e.itemId,d=e.imageUrl,r=e.payload,s=e.noteText,u=e.timeIndex,l=e.id;t.data[n].content.push({title:a,itemId:o,imageUrl:d,payload:r,notes:[{id:l,noteText:s,timeIndex:u}]}),this._updatePluginData(t,i)},edit:function(r,s,u,l){var c=this;this._getUserData(function(t,n){if(t)throw t;var e=c._getIndex(n,u,s,r),i=e.pluginIndex,a=e.itemIndex,o=e.noteIndex,d={title:n.data[i].content[a].title||"New Note",hideUserData:!0,placeholder:"",saveText:"Save",prefill:n.data[i].content[a].notes[o].noteText};window.inputAPI.showTextDialog(d,function(t,e){if(t)throw t;e.cancelled||""===e.results[0].textValue||(n.data[i].content[a].notes[o].noteText=e.results[0].textValue,c._updatePluginData(n,l))})})},delete:function(o,d,r,s){var u=this;this._getUserData(function(t,e){if(t)throw t;var n=u._getIndex(e,r,d),i=n.pluginIndex,a=n.itemIndex;(e.data[i].content[a].notes=e.data[i].content[a].notes.filter(function(t){return t.id!=o}),0===e.data[i].content[a].notes.length)&&(e.data[i].content.splice(a,1),0===e.data[i].content.length&&e.data.splice(i,1));u._updatePluginData(e,s)})},getAllFromItem:function(o,d){var r=this;this._getUserData(function(t,e){if(!t&&e.id&&e.data.length){var n=window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin.instanceId:window.postMaster.launcherPluginAPI.context.instanceId,i=r._getIndex(e,n).pluginIndex,a=e.data[i].content.find(function(t){return t.itemId===o});d(null,a?a.notes:[])}else d(null,[])})},getAll:function(n){this._getUserData(function(t,e){if(t)throw t;n(null,e.data)})},loadNote:function(w,m,_,v){var D=this;this._getUserData(function(t,e){if(t)throw t;var n=_.pluginId,i=_.instanceId,a=_.title,o=_.folderName,d=D._getIndex(e,i,m,w),r=d.pluginIndex,s=d.itemIndex,u=d.noteIndex,l=e.data[r].content[s],c=!!w&&e.data[r].content[s].notes[u],p=!1;window.appContext&&window.appContext.currentPlugin&&document.getElementById(window.appContext.currentPlugin.pluginAPI.iFrameId)&&window.appContext.currentPlugin.instanceId===i&&(p=!0);var I=window.postMaster.launcherPluginAPI.navigation,g="";if(l.payload){var x=l.payload;c&&(x.timeIndex=c.timeIndex);var f=JSON.stringify(x);g="&dld="+f}else{var h=void 0;h=c?JSON.stringify({link:m,timeIndex:c.timeIndex}):JSON.stringify({link:m}),g="&dld="+h}"function"!=typeof v&&(v=Function.prototype),p?I.navigateHome({},function(){I.navigateTo({pluginId:n,instanceId:i,title:a,folderName:o,queryString:g},v)}):I.navigateTo({pluginId:n,instanceId:i,title:a,folderName:o,queryString:g},v)})},_getUserData:function(n){this._getUserDataContext({},function(t,e){if(t)throw t;e.userDatastore.get("notesDB.18",function(t,e){n(t,e)})})},_initUserData:function(t,i){var a=t.id,o=t.title,d=t.noteText,r=t.timeIndex,s=t.instanceId,u=t.itemId,l=t.imageUrl,c=t.payload;this._getUserDataContext({},function(t,e){if(t)throw t;var n={tag:"notesDB.18",userToken:e.userToken,checkDuplicate:!0};n.obj=[{instanceId:s,content:[{title:o,itemId:u,imageUrl:l,payload:c,notes:[{id:a,noteText:d,timeIndex:r}]}]}],e.userDatastore.insert(n,function(t,e){if(t)throw t;i(e)})})},_initPluginData:function(t,e,n){var i=e.id,a=e.title,o=e.noteText,d=e.timeIndex,r=e.instanceId,s=e.itemId,u=e.imageUrl,l=e.payload;t.data.push({instanceId:r,content:[{title:a,itemId:s,imageUrl:u,payload:l,notes:[{id:i,noteText:o,timeIndex:d}]}]}),this._updatePluginData(t,n)},_updatePluginData:function(i,a){this._getUserDataContext({},function(t,e){if(t)throw t;var n={id:i.id,tag:"notesDB.18",userToken:e.userToken};n.obj=i.data,e.userDatastore.update(n,function(t,e){if(t)throw t;a(e)})})},_getUser:function(n){var t=window.authAPI.getCurrentUser();t?n(t):authAPI.login({showMenu:!1},function(t,e){!t&&e&&n(e)})},_getIndex:function(t,e,n,i){var a={},o=t.data.findIndex(function(t){return t.instanceId===e});if((a.pluginIndex=o)<0||!n)return a;var d=t.data[o].content.findIndex(function(t){return t.itemId===n});if((a.itemIndex=d)<0||!i)return a;var r=t.data[o].content[d].notes.findIndex(function(t){return t.id===i});return a.noteIndex=r,a},seekTo:function(r,s,u,l){var c=this;this._getUserData(function(t,e){if(t)throw t;var n=c._getIndex(e,u,s,r),i=n.pluginIndex,a=n.itemIndex,o=n.noteIndex,d=!!r&&e.data[i].content[a].notes[o];d&&((window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI).sendMessage(null,new Packet(null,"notes.triggerOnSeekTo",{time:d.timeIndex})),l())})}};
"use strict";$app.controller("authCtrl",["$rootScope","$scope","Upload","$sce","StringResource",function(a,c,r,s,o){c._appRoot=window._appRoot,c.registerClick=!1;document.addEventListener("appThemeOnUpdate",function(){var e,o,n=document.querySelector(".form.registration").querySelectorAll("input[type=date]");e=n,o=tinycolor(PluginAPI.appTheme.colors.backgroundColor).isDark(),e.forEach(function(e){o?e.classList.add("inverted-input"):e.classList.remove("inverted-input")})},!1);var l,d=void 0;window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.userLoginDomainSettings?"enterprise"==window.appContext.currentApp.config.type&&(d="enabled"):d=window.appContext.currentApp.config.userLoginDomainSettings);var n="Password must be at least 8 characters long, contains an upper case letter, a lower case letter, a number and a symbol.";c.loginTranslation="Log In",c.registerTranslation="Register",c.emailDoesNotExistTxt="Email does not exist in system.",c.updateLoginTranslations=function(e){e.passwordAtLeast8ComplexChars&&(n=e.passwordAtLeast8ComplexChars),e.loginTranslation&&(c.loginTranslation=e.loginTranslation),e.registerTranslation&&(c.registerTranslation=e.registerTranslation),e.emailDoesNotExist&&(c.emailDoesNotExistTxt=e.emailDoesNotExist)},o.getData().then(function(e){e&&(c.loginButtonTitle=e.logIn,c.changedPasswordSuccessfully=e.changedPasswordSuccessfully||"Password Changed Successfully",c.changePasswordAtLeast8ComplexChars=e.changePasswordAtLeast8ComplexChars||"Password must be at least 8 characters long, contains an upper case letter, a lower case letter, a number and a symbol.",c.changePasswordError=e.changePasswordError||"Sorry, we couldn't change your password, please try later.",c.secretCodeInformModal=e.secretCodeInformModal||"We are going to send you a secret code through your email in order to complete changing password process",c.secretCodeError=e.secretCodeError||"Sorry, we have faced a problem while sending you a secret code")});var t=function(){var e="appearance",o={appId:window.appContext.currentApp.appId,pluginId:e,instanceId:e};new window.DatastoreAPI(o).get({tag:e,withDynamicData:!0},function(e,o){if(e)return console.error(e),void callback(e);o&&o.data&&o.data.customRegistration&&i(o.data.customRegistration,null,o.data.colors),o&&o.data&&o.data&&c.setThemeType(o.data)})};t();var i=function(e,s,o){if(e&&e.active&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)){var r=o||(PluginAPI&&PluginAPI.appTheme&&PluginAPI.appTheme.colors?PluginAPI.appTheme.colors:null);customRegistration.getFields({customRegistrationSettings:e,refreshUI:function(){c.$$phase||c.$apply()},openGDPRContent:function(e){c.loadGDPR(e.key)}},function(e,o){if(o){c.showCustomRegistration=!0,c.showDefaultTermsAndConditions=!0,c.showDefaultPrivacyPolicy=!0;var n=null,t=null;o.gdprLinks&&o.gdprLinks.forEach(function(e){"termsAndConditions"===e.name?(c.showDefaultTermsAndConditions=!1,n=e.key):"privacyPolicy"===e.name&&(c.showDefaultPrivacyPolicy=!1,t=e.key)}),c.customRegistrationSubmit=function(){o.fetch({validateFields:!0,validateLinks:!0},function(e,o){e||(o.customTermsAndConditionsKey=n,o.customPrivacyPolicyKey=t,c.register(o))})},o.fields&&o.fields.forEach(function(e){e&&"tel"===e.name&&(e.type="tel"),e&&"date"===e.type&&r&&r.backgroundColor&&tinycolor(r.backgroundColor).isDark()&&(e.class="inverted-input")}),c.customRegistrationFields=o.fields,c.customRegistrationRules=o.rules,c.customRegistrationGdprLinks=o.gdprLinks,c.initCustomRegistration=function(){o.initializers.forEach(function(e){e()})},s&&s(null,null),c.$$phase||c.$apply()}})}else c.showCustomRegistration=!1,c.$$phase||c.$apply()};window.authAPI.authCtrlScope=c,a.allowCancel=void 0===a.allowCancel||a.allowCancel,a.authShown=!1,c.secretCodeProvider=null,c.refWindow=null,c.errors={},c.invalidCredentials=!1,c.invalidReset=!1,c.invalidRegister=!1,c.msgError=null,c.msgSuccess=null,c.enablePasswordBasedAuth=!0,c.password="",c.userObj={username:"",email:""},c.changePassword={oldPassword:"",newPassword:"",reTypedPassword:"",secretCode:""},c.loginCallback=null;var u="",p="",w="",g="",f="",m="",h="",C="",v="",P=window.appContext.currentApp.appId;function y(e){e&&(e=window.loginUI.convertToCss(e)||"*{}",localStorage.loginUI=e);var o=e||localStorage.getItem("loginUI_"+P),n=document.getElementById("custom-login-ui");if(!n){var t=document.getElementsByClassName("login-holder")[0];(n=document.createElement("style")).id="custom-login-ui",t.appendChild(n)}n.innerHTML=o}function S(e){return"boolean"!=typeof e||e}function b(e,t){e?console.error(e):(c.authLoginProviders=[],t&&t.data?("SSOLogin"==t.data.signOnStrategy&&(c.SSOLogin=!0,v=t.data.contentType,p="application/x-www-form-urlencoded"==v||"multipart/form-data"==v?(u=window.siteConfig.endPoints.hopHost+t.data.accessTokenAPI,window.siteConfig.endPoints.hopHost+t.data.loginAPI):(u=t.data.accessTokenAPI,t.data.loginAPI),c.signOnStrategy=m=t.data.signOnStrategy,c.resetPasswordAPI=w=t.data.resetPasswordAPI,g=t.data.resetPasswordMessage,c.registerUrl=f=t.data.registerUrl,h=t.data.clientId,C=t.data.clientSecret,setInterval(A,9e5)),o.getData().then(function(e){if(e&&(c.appleSignIn=e.appleSignIn||"Continue with Apple",c.facebookSignIn=e.facebookSignIn||"Continue with Facebook",c.twitterSignIn=e.twitterSignIn||"Continue with Twitter",c.appleRegistration=e.appleRegistration||"Continue with Apple",c.facebookRegistration=e.facebookRegistration||"Continue with Facebook",c.twitterRegistration=e.twitterRegistration||"Continue with Twitter"),t.data.authLoginProviders)c.authLoginProviders=t.data.authLoginProviders.filter(function(e){return e.isActive}),c.authLoginProviders.forEach(function(e){"oauth2"===e.authType?(e.buttonIcon?"image"===e.buttonIcon.type?e.darkButtonImageUrl=e.lightButtonImageUrl=imageTools.cropImage(e.buttonIcon.value,{size:"xxs",aspect:"1:1"}):(e.buttonIconValue=e.buttonIcon.value+(e.buttonTextColor?"":" bodyTextTheme"),e.buttonIconStyles=(e.buttonTextColor?"color: "+e.buttonTextColor+" !important; ":"")+"width: 1.75em; margin: 0 .75em; flex: none;"):e.buttonIconStyles=(e.buttonTextColor?"color: "+e.buttonTextColor+" !important; ":"")+"width: 1.75em; margin: 0 .75em; flex: none;",e.buttonColor&&(e.buttonBackground={},"gradient"===e.buttonColor.colorType&&(e.buttonBackground.background=e.buttonColor.gradient&&e.buttonColor.gradient.backgroundCSSValue),"solid"===e.buttonColor.colorType&&(e.buttonBackground.background=e.buttonColor.solid&&e.buttonColor.solid.color))):I(e)});else{var o=S(t.data.enableFacebook),n=S(t.data.enableTwitter);c.enablePasswordBasedAuth=S(t.data.enablePasswordBasedAuth),!(!o&&!n&&void 0===t.data.enableApple)&&S(t.data.enableApple)&&c.authLoginProviders.push(I({providerId:"apple",authType:"social"})),o&&c.authLoginProviders.push(I({providerId:"facebook",authType:"social"})),n&&c.authLoginProviders.push(I({providerId:"twitter",authType:"social"}))}}),m=t.data.signOnStrategy,"enabled"==d&&(l=t.data.domain),c.emailInputType=l?"text":"email"):o.getData().then(function(e){e&&(c.appleSignIn=e.appleSignIn||"Continue with Apple",c.facebookSignIn=e.facebookSignIn||"Continue with Facebook",c.twitterSignIn=e.twitterSignIn||"Continue with Twitter",c.appleRegistration=e.appleRegistration||"Continue with Apple",c.facebookRegistration=e.facebookRegistration||"Continue with Facebook",c.twitterRegistration=e.twitterRegistration||"Continue with Twitter"),c.enablePasswordBasedAuth=!0,c.authLoginProviders.push(I({providerId:"apple",authType:"social"})),c.authLoginProviders.push(I({providerId:"twitter",authType:"social"})),c.authLoginProviders.push(I({providerId:"facebook",authType:"social"}))}))}function I(e){switch(e.providerId){case"apple":return e.classes="btn-apple",e.loginButtonName=c.appleSignIn,e.registerButtonName=c.appleRegistration,e.darkButtonImageUrl=_appRoot+"media/logo_apple_b.png",e.lightButtonImageUrl=_appRoot+"media/logo_apple_w.png",e;case"facebook":return e.classes="btn-fb",e.loginButtonName=c.facebookSignIn,e.registerButtonName=c.facebookRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_facebook.png",e;case"twitter":return e.classes="btn-twitter",e.loginButtonName=c.twitterSignIn,e.registerButtonName=c.twitterRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_twitter.png",e}}function A(){var e=JSON.parse(window.localStorage.getItem("SSO_USER"));if(e){(new Date).getTime()/1e3>e.ssoExpiresAt&&(c.invalidCredentials=!0,a.allowCancel=!1,a.showMenu=!1,c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()}));var o=u;if("multipart/form-data"==v||"application/x-www-form-urlencoded"==v)var n={headers:{Authorization:"Bearer "+e.ssoUserToken,"Content-Type":"application/json"}};else{n={headers:{"Content-Type":"application/x-www-form-urlencoded"}};o=u+"?access_token="+e.ssoUserToken}window.bfUtils.http.get(o,n).success(function(e){console.log(e)}).error(function(e,o,n,t){c.invalidCredentials=!0,a.allowCancel=!1,a.showMenu=!1,c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()})})}}c.updateLoginCss=function(){y()},c.updateSSORegistrationFormStatus=function(e){/htt(p|ps):\/\//g.test(k.src)&&(window.spinner&&window.spinner.hide(),c.ssoRegistrationFormStatus=e,c.$$phase||c.$apply())},y(),c.SSOLogin=!1,authAPI.getAuthSettings(null,b),c.closeLogin=function(){c.loginCallback&&c.loginCallback(),a.allowCancel?c.hideLogin():T()},c.reset=function(){c.errors={},c.showProgressMessage=!1,c.invalidCredentials=!1,c.invalidReset=!1,c.invalidRegister=!1,c.allowToRegister=!1,c.uploadFile=null,c.changePassword.oldPassword=null,c.changePassword.newPassword=null,c.changePassword.reTypedPassword=null,c.changePassword.secretCode=null,c.userObj.email=null,c.userObj.username=null,c.password=null,c.secretCode=null,c.newPassword=null,c.confirmPassword=null,c.msgError=null,c.msgSuccess=null,c.uploadFile=null,c.firstName=null,c.lastName=null,c.secretCodeProvider=null,c.refWindow=null,c.acceptTOS=null,c.acceptPP=null,c.acceptedAppTerms=null,c.customRegistrationGdprLinks&&c.customRegistrationGdprLinks.forEach(function(e){e.value=void 0,e.error=void 0}),c.customRegistrationFields&&c.customRegistrationFields.forEach(function(e){e.value=void 0,e.error=void 0,"date"===e.type&&tinycolor(PluginAPI.appTheme.colors.backgroundColor).isDark()?e.class="inverted-input":e.class=e.class?e.class.replace("inverted-input",""):""})};var R=function(){c.successShown=!1,c.registrationShown=!1,c.loginShown=!1,c.forgetPasswordShown=!1,c.resetPasswordShown=!1,c.changePasswordShown=!1,(k=k||document.getElementById("frmExternalRegistrationForm")).src="",c.externalRegister=!1,c.ssoRegistrationFormStatus=null};R(),c.openTermsAndConditions=function(){return window.open("https://learn.appdocumentation.com/en/collections/1618556-terms-conditions-and-privacy-policy","_system"),!1},c.registerUser=function(){if(c.registerClick=!0,!c.frmAuthRegister.$invalid)if(window.validator.validatePassword(c.password))c.register(),c.registerClick=!1;else{var e={data:{title:" ",body:n,disableCancel:!0}};window.openDialog(e,function(){})}},c.hideLogin=function(){c.reset(),R(),a.authShown=!1,c.loginCallback=null};var k=document.getElementById("frmExternalRegistrationForm");function T(){c.reset(),R(),a.allowCancel=!c.loginOptions||!1!==c.loginOptions.allowCancel,a.showMenuOnAuth=!c.loginOptions||!1!==c.loginOptions.showMenu,c.loginShown=!0,c.showAuth(),c.$$phase||c.$apply()}function U(){var o={};if(c.customRegistrationFields&&c.customRegistrationFields.forEach(function(e){"password"===e.type&&(o=e.messages)}),c.customRegistrationRules&&"simple"===c.customRegistrationRules.passwordStrength){if(!window.validator.validatePassword(c.changePassword.newPassword,{simplePasswordValidation:!0}))return c.errors.newPassword=!0,c.newPasswordError=o.invalidPasswordSimpleRules,!1}else if(!window.validator.validatePassword(c.changePassword.newPassword))return c.errors.newPassword=!0,c.newPasswordError=o.invalidPasswordRules||c.changePasswordAtLeast8ComplexChars,!1;return!0}function L(e,s){var o=JSON.parse(window.localStorage.getItem("SSO_USER"));if(o||(o={}),"string"==typeof e)try{e=JSON.parse(e)}catch(e){console.warn("Unexpected parsing issue",e)}e&&e.access_token?o.ssoUserToken=e.access_token:o.ssoUserToken=e.replace(/["]+/g,""),e&&e.expires_in&&e.issued_at?o.ssoExpiresAt=e.issued_at+e.expires_in:o.ssoExpiresAt=1902608081e3,window.localStorage.setItem("SSO_USER",JSON.stringify(o));var n=null;n="undefined"==typeof push?{}:push;var t=u.replace(window.siteConfig.endPoints.hopHost,""),r={id:1,method:"users/loginSSO",params:{accessToken:o.ssoUserToken,accessTokenAPI:t,deviceId:n.deviceId,osType:n.platform?n.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId,loginProviderType:"SSO",email:c.userObj.username,contentType:v}},i=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(r));window.bfUtils.http.jsonp(i,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result)authAPI._setCurrentUser(e.result),a.$broadcast("loginSuccessfully",e.result),s(null,e.result),bfUtils.isEmulatorCP&&cpSync.SSO.log("Succeed...");else{c.invalidRegister=!0;var o=null;e&&e.error?(c.msgError=e.error.message,c.invalidCredentials=!0,console.error(e.error),o=e.error,bfUtils.isEmulatorCP&&cpSync.SSO.log(e.error)):(e=o=c.msgError="Could not retrieve profile data",c.invalidCredentials=!0,console.error(e),bfUtils.isEmulatorCP&&cpSync.SSO.log(e)),s&&s(o,null)}}).error(function(e,o,n,t){console.error(e),s&&s(e,null),bfUtils.isEmulatorCP&&cpSync.SSO.log("Error while testing SSO Login..")})}c.showRegistration=function(e,t){if(c.scrolling=bfUtils.isIOS?"no":"auto","SSOLogin"==m&&f){window.spinner.show(),c.externalRegister=!0,c.ssoRegistrationFormStatus="loading",(k=k||document.getElementById("frmExternalRegistrationForm")).src=f,window.addEventListener("message",function e(o){if(o&&-1<f.indexOf(o.origin)&&o.data){var n=null;try{n=JSON.parse(o.data)}catch(e){}n&&("success"===n.status&&(n.user&&n.user.username&&(c.userObj.username=n.user.username),window.spinner&&window.spinner.show&&window.spinner.show(!0),L(n.user,function(e,o){e?(console.error(e),window.openDialog({data:{title:" ",body:"Invalid Login",disableCancel:!0}},function(){}),t&&t(e,null)):(t||(t=c.loginCallback),t&&t(null,o)),window.spinner&&window.spinner.hide&&window.spinner.hide(!0)})),window.removeEventListener("message",e,!1),k.src="",c.externalRegister=!1,c.ssoRegistrationFormStatus=null,c.$$phase||c.$apply())}},!1)}else c.reset(),R(),c.registrationShown=!0,c.showAuth()},c.showAuth=function(){a.authShown||(a.authShown=!0,AppearanceAPI.prototype.sideMenu.reset({appId:window.appContext.currentApp.appId}))},c.showForgetPassword=function(){c.reset(),R(),c.forgetPasswordShown=!0,c.showAuth()},c.showSuccess=function(e){R(),c.msgSuccess=e,c.successShown=!0},c.showResetPassword=function(e){c.reset(),R(),c.resetPasswordShown=!0,c.showAuth(),c.loginCallback=e},c.updateLogin=function(e){bfUtils.isEmulatorCP&&a.accessCodeVisible&&(a.accessCodeVisible=!1),e&&"SSOForgetPassword"!=e&&y(e),c.loginCallback=function(e,o){o?(window.authAPI._setCurrentUser(o),window.authAPI.triggerOnLogin(o)):console.error("authCtrl loginCallback error",e),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()},T(),e&&"SSOForgetPassword"==e&&(c.showForgetPassword(),c.$apply()),t()},c.updateRegistration=function(e){c.reset(),R(),c.registrationShown=!0,c.showAuth(),e&&i(e,function(){c.initCustomRegistration()}),c.$$phase||c.$apply()},c.updateLoginAuth=function(e){c.enablePasswordBasedAuth=S(e.enablePasswordBasedAuth),e.domain&&"enabled"==d&&(l=e.domain),c.authLoginProviders=null,c.$$phase||c.$apply(),b(null,{data:e}),c.$$phase||c.$apply()},c.returnToLogin=function(){c.showLogin(c.loginCallback)},c.showLogin=function(e){c.loginCallback=e,T()},c.resetPassword=function(){if(c.invalidReset=!1,c.msgError=null,c.newPassword!=c.confirmPassword)return c.invalidReset=!1,void(c.msgError="Make sure new password and confirm password are equal");var e={id:1,method:"users/changePassword",params:{email:c.email,secretCode:c.secretCode,password:c.newPassword,passwordStrength:c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null,externalAppId:window.currentAppId}},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result){c.showSuccess("Password reset successfully");var o={data:{title:" ",body:"Password reset successfully",disableCancel:!0}};window.openDialog(o,function(){})}else if(e&&e.error){o={data:{title:" ",body:e.error.message,disableCancel:!0}};window.openDialog(o,function(){}),console.error(e.error)}}).error(function(e,o,n,t){c.invalidCredentials=!0,console.error(e),callback&&callback(e,null)})},c.forgotPassword=function(e){if("SSOLogin"!=m){c.invalidCredentials=!1;var o={email:c.email,sendSecretCode:!0,externalAppId:window.currentAppId};e&&(o.email=e.email);var n={id:1,method:"users/forgotPassword",params:o},t=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(n));window.bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result)c.showResetPassword(c.loginCallback);else{var o={data:{title:" ",body:c.emailDoesNotExistTxt,disableCancel:!0}};window.openDialog(o,function(){}),e&&console.warn(e)}}).error(function(e,o,n,t){c.invalidCredentials=!0,console.error(e)})}else{var s=-1===w.indexOf("?")?"?":"&",r=w+s+"email="+c.email;window.bfUtils.http.get(r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(){var e={data:{title:" ",body:g||"An email has been sent, please check your email.",disableCancel:!0}};window.openDialog(e,function(){c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()})}),cpSync.SSO.log("Succeed...")}).error(function(e,o,n,t){e&&console.error(e),bfUtils.isEmulatorCP&&(e||"0"!=o?(o&&cpSync.SSO.log("Error status:"+o),e&&cpSync.SSO.log("Error details:"+JSON.stringify(e))):cpSync.SSO.log("Error while testing SSO Login , CORS policy .."))})}},c.showChangePassword=function(){R(),c.changePasswordShown=!0,c.showAuth(),c.passwordChangeForm.showCurrentPasswordField=!0},c.changePasswordByCurrentPassword=function(){if(U()){var e=c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null;authAPI.changePassword({oldPassword:c.changePassword.oldPassword,newPassword:c.changePassword.newPassword,passwordStrength:e},function(e,o){if(e){if("invalidPassword"==e.code)return c.errors.oldPassword=!0;var n=c.changePasswordError;return 1310===e.code&&(n=e.message),void richModal.display({title:"Change Password",richContent:"<p style='font-size:1.8rem'>"+n+"</p>",showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}})}c.changePasswordShown=!1,a.authShown=!1,c.reset(),(new ComponentUIAPI).showToastMessage({text:c.changedPasswordSuccessfully,hideDismiss:!0})})}},c.showSecretCodeModal=function(){richModal.display({title:"Secret Code",richContent:"<p style='font-size:1.8rem'>"+c.secretCodeInformModal+"</p>",showDismissButton:!0,forceShow:!0,action:{title:"OK",handler:function(){var n,e,o;n=authAPI.getCurrentUser(),e={id:1,method:"users/forgotPassword",params:{email:n.email,sendSecretCode:!0,externalAppId:window.currentAppId}},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result){var o=new ComponentUIAPI;o.showToastMessage({text:"A secret code has been sent to "+n.email,hideDismiss:!0})}}).error(function(e,o,n,t){richModal.display({title:"Secret Code",richContent:"<p style='font-size:1.8rem'>"+secretCodeError+"</p>",showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}}),console.error(e)}),c.passwordChangeForm.showCurrentPasswordField=!1}}})},c.changePasswordBySecretCode=function(){if(U()){var e={id:1,method:"users/changePassword",params:{email:authAPI.getCurrentUser().email,secretCode:c.changePassword.secretCode,password:c.changePassword.newPassword,passwordStrength:c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null,externalAppId:window.currentAppId}},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result?(c.changePasswordShown=!1,a.authShown=!1,c.reset(),authAPI.logout(),(new ComponentUIAPI).showToastMessage({text:c.changedPasswordSuccessfully,hideDismiss:!0})):e&&e.error&&(c.errors.secretCode=!0,console.error(e.error))}).error(function(e,o,n,t){richModal.display({title:"Change Password",richContent:"<p style='font-size:1.8rem'>"+c.changePasswordError+"</p>",showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}}),console.error(e)})}},c.showBackLogin=function(){authAPI.login(null,function(){a.$broadcast("displayNav")})},c.login=function(e,s){window.spinner&&window.spinner.show&&window.spinner.show(!0),"SSOLogin"!=m?function(e,s){if(window.appContext&&window.appContext.currentApp){c.invalidCredentials=!1,s||(s=c.loginCallback);var o=null;o="undefined"==typeof push?{}:push;var n=c.userObj.email;n||(n=e.email),c.password||(c.password=e.password),"enabled"==d&&l&&!n.includes("@")&&(n+=l),console.warn("email",n);var t={email:n,password:c.password,deviceId:o.deviceId,osType:o.platform?o.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId};e&&(t.email=e.email,t.password=e.password);var r={id:1,method:"users/login",params:t},i=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(r));window.bfUtils.http.jsonp(i,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result&&e.result.userToken)authAPI._setCurrentUser(e.result),a.$broadcast("loginSuccessfully",e.result),s&&s(null,e.result);else{c.invalidCredentials=!0;var o=null;e&&e.error&&(console.warn("login error: ",e.error),o=e.error),o&&o.message?c.msgError=o.message:c.msgError="Invalid Email or Password",s&&s(o,null)}}).error(function(e,o,n,t){c.invalidCredentials=!0,console.error(e),s&&s(e,null)})}else console.error("invalid appContext")}(e,function(e,o){if(e||!o){var n=null;if(e)switch(e.code){case 1303:n=e.message;break;default:n="Invalid Login"}else n="To log in, please make sure you have a valid connection.";var t={data:{title:" ",body:n,disableCancel:!0}};window.openDialog(t,function(){}),console.error(e),s&&s(e,null)}else s||(s=c.loginCallback),s&&s(null,o);window.spinner&&window.spinner.hide&&window.spinner.hide(!0)}):function(e,s){var o={headers:{"Content-Type":"application/x-www-form-urlencoded"}},n=c.userObj.username;if("enabled"==d&&l&&!n.includes("@")&&(n+=l),"application/x-www-form-urlencoded"==v)var t=encodeURIComponent("grant_type")+"="+encodeURIComponent("password")+"&"+encodeURIComponent("username")+"="+encodeURIComponent(n)+"&"+encodeURIComponent("password")+"="+encodeURIComponent(c.password)+"&"+encodeURIComponent("client_id")+"="+encodeURIComponent(h)+"&"+encodeURIComponent("client_secret")+"="+encodeURIComponent(C);else"multipart/form-data"==v?(o={transformRequest:angular.identity,headers:{"Content-Type":void 0}},(t=new FormData).append("username",n),t.append("password",c.password)):t={grant_type:"password",username:n,password:c.password,client_id:h};window.bfUtils.http.post(p,t,o).success(function(e){L(e,s)}).error(function(e,o,n,t){c.invalidCredentials=!0,e&&e.error_description?(console.error(e),c.msgError=e.error_description):c.msgError="Login Failed",s&&s("Login Failed",null),bfUtils.isEmulatorCP&&(e||"0"!=o?(o&&cpSync.SSO.log("Error status:"+o),e&&cpSync.SSO.log("Error details:"+JSON.stringify(e))):cpSync.SSO.log("Error while testing SSO Login , CORS policy .."))})}(0,function(e,o){if(e){console.error(e);var n=null;if(e)switch(e.code){case 1303:case 1301:case 1312:n=e.message;break;default:n="Invalid Login"}else n="To log in, please make sure you have a valid connection.";var t={data:{title:" ",body:n,disableCancel:!0}};window.openDialog(t,function(){}),s&&s(e,null)}else s||(s=c.loginCallback),s(null,o);window.spinner&&window.spinner.hide&&window.spinner.hide(!0)})};c.getGDPR=function(n,t){var e=c.userObj.email,o=siteConfig.endPoints.crmHost+"/documents/"+n.key+"/check?userKey="+encodeURIComponent(e)+"&withDetails=true";bfUtils.http.get(o).success(function(e){var o={};o.title=s.trustAsHtml(e[n.key].title),o.subtitle=s.trustAsHtml(e[n.key].subtitle),o.details=s.trustAsHtml(e[n.key].details),t(null,o)}).error(function(e){console.error(e),t(e,null)})},c.loadGDPR=function(e){c.getGDPR({key:e},function(e,o){o&&(c.GDPR_content=o,c.showGDPR=!0,a.$broadcast("hideNav"),c.$$phase||c.$apply())})},c.hideGDPR=function(){a.$broadcast("displayNav"),c.showGDPR=!1,c.GDPR_content=null},c.showTermsOfService=function(){c.loadGDPR("bf_terms_and_conditions")},c.showPrivacyPolicy=function(){c.loadGDPR("bf_privacy_policy")},c.showAppTerms=function(){window.open(appContext.currentApp.config.TermsOfUse,"_system")},c.shouldShowAppTerms=!!(appContext.currentApp&&appContext.currentApp.config&&appContext.currentApp.config.TermsOfUse)&&appContext.currentApp.config.TermsOfUse.indexOf("appdocumentation.com")<0&&appContext.currentApp.config.TermsOfUse.indexOf("buildfire.com")<0,c.saveGDPR=function(s,r){var n;n=function(e,o){var t={};o&&(t=o),t.appId=appContext.currentApp.appId;var n=["bf_terms_and_conditions","bf_privacy_policy"];s.customTermsAndConditionsKey&&n.push(s.customTermsAndConditionsKey),s.customPrivacyPolicyKey&&n.push(s.customPrivacyPolicyKey),function(e,o){if(e){var n=siteConfig.endPoints.crmHost+"/documents/"+e+"/accept";bfUtils.http.post(n,{userKey:s?s.email.toLowerCase():c.userObj.email.toLowerCase(),info:t,source:"app"}).success(function(e){o(null,e)}).error(function(e){o(e),console.error(e)})}else o(null,null)}(n.join(","),function(){r&&r()})},window.$http.get("https://ipapi.co/json/").success(function(e){if(e){var o={ipInfo:{city:e.city,country:e.country_name,countryCode:e.country,lat:e.latitude,lon:e.longitude,regionName:e.region,timezone:e.timezone,zip:e.postal,ip:e.ip}};n(null,o)}else n(null,null)}).error(function(e){n(null,null)})},c.register=function(s,l){if(window.appContext&&window.appContext.currentApp){c.invalidRegister=!1,l||(l=c.loginCallback);var e=null;e="undefined"==typeof push?{}:push;var d=(s?s.user:void 0)||{firstName:c.firstName||c.userObj.email,lastName:c.lastName||"",email:c.userObj.email,password:c.password};d.deviceId=e.deviceId,d.osType=e.platform?e.platform.toLowerCase():"web",d.passwordStrength=c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null,d.externalAppId=window.appContext.currentApp.appId;var o={id:1,method:"users/register",params:d},n=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(angular.toJson(o));c.isRegistering=!0,window.bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result){var o={email:d.email};s&&(o.customTermsAndConditionsKey=s.customTermsAndConditionsKey,o.customPrivacyPolicyKey=s.customPrivacyPolicyKey),c.saveGDPR(o,function(){c.login({email:d.email,password:d.password},function(e,o){d.userProfile&&userTags.setRegistrationTags(d.userProfile,!0,function(e,o){e&&console.log(e)}),o&&o.userToken?(c.upload(c.uploadFile,function(e,o){if(e)c.isRegistering=!1,l&&l(e,null);else{var n=authAPI.getCurrentUser();if(o){var t={userToken:n.userToken,firstName:d.firstName,lastName:d.lastName,displayName:d.firstName+" "+d.lastName,imageUrl:o.result,externalAppId:window.currentAppId};r=function(e,o){c.isRegistering=!1,l&&l(e,o)},i={id:1,method:"users/update",params:s=t},a=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(i)),window.bfUtils.http.jsonp(a,{bypassInterceptorForStatus:404}).success(function(e){if(e.error){var o=null;e&&e.error&&(console.error(e.error),o=e.error),r&&r(o,null)}else{var n=authAPI.getCurrentUser();null!=n&&(n.firstName=s.firstName,n.lastName=s.lastName,n.displayName=s.displayName,n.imageUrl=s.imageUrl,authAPI._setCurrentUser(n)),r&&r(null,n)}}).error(function(e,o,n,t){console.error(e),r&&r(e,null)})}else c.isRegistering=!1,l&&l(null,n)}var s,r,i,a}),authAPI.trackRegister(o)):c.isRegistering=!1})})}else{c.isRegistering=!1,c.invalidRegister=!0;if(e&&e.error){var n=e.error.message;1301===e.error.code&&s&&s.messages&&s.messages.emailAlreadyInUse&&(n=s.messages.emailAlreadyInUse);var t={data:{title:" ",body:n,disableCancel:!0}};window.openDialog(t,function(){}),console.warn(e.error),e.error}}}).error(function(e,o,n,t){console.error(e),c.isRegistering=!1})}else console.error("invalid appContext")},c.upload=function(e,s){var o=authAPI.getCurrentUser();if(null!=o){var n=window.siteConfig.endPoints.authHost+"/src/server.js?method=users/uploadImage";if(e&&1==e.length){var t=e[0];r.upload({url:n,fields:{userToken:o.userToken,externalAppId:window.currentAppId},file:t}).progress(function(e){c.progressMessage=!0;var o=parseInt(100*e.loaded/e.total);console.log("progress: "+o+"% "+e.config.file.name)}).success(function(e,o,n,t){console.log("file "+t.file.name+"uploaded."),s&&s(null,e)}).error(function(e){c.msgError="",c.invalidRegister=!0,s&&s(e,null)})}else s&&s(null,null)}else s&&s({message:"Invalid user"},null)},c.requestLoginProvider=function(o,n){var e={id:1,method:"secretCode/request",params:{externalAppId:window.currentAppId}},t=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));c.refWindow&&!c.refWindow.closed||window.bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){if(null!=e&&null!=e.result&&e.result.code){c.secretCodeProvider=e.result.code,c.refWindow="social"===o&&"apple"===n?window.open(window.siteConfig.endPoints.authHost+"/api/sso/apple?code="+encodeURIComponent(c.secretCodeProvider)+"&externalAppId="+encodeURIComponent(window.currentAppId),"_blank","location=no,enableViewportScale=yes"):"oauth2"==o?window.open(window.siteConfig.endPoints.authHost+"/app/"+encodeURIComponent(window.currentAppId)+"/oauth2/login?code="+encodeURIComponent(c.secretCodeProvider)+"&providerId="+encodeURIComponent(n),"_blank","location=no,enableViewportScale=yes"):window.open(window.siteConfig.endPoints.authHost+"/website/index.html?v=2.0&code="+encodeURIComponent(c.secretCodeProvider)+"&loginProviderType="+n+"&externalAppId="+encodeURIComponent(window.currentAppId),"_blank","location=no,enableViewportScale=yes"),c.refWindow&&c.refWindow.addEventListener&&(c.refWindow.addEventListener("exit",function(){c.refWindow=null}),c.refWindow.addEventListener("close",function(){c.refWindow=null}));setTimeout(O,1e3,120)}},function(e){console.log(JSON.stringify(e))})};var O=function s(r){if(window.appContext&&window.appContext.currentApp)if(0<r){var e={id:1,method:"users/secretCodeLogin",params:{code:c.secretCodeProvider,deviceId:push.deviceId,osType:push.platform?push.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId}},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){if(e.error){var o=!1;1300==e.error.code&&(o=!0),1303==e.error.code&&(o=!0),o&&(c.secretCodeProvider=null)!=c.refWindow&&(c.refWindow.close(),c.refWindow=null)}else if(null!=e.result&&null!=e.result.userToken){authAPI._setCurrentUser(e.result);var n=new Date;n.setMinutes(n.getMinutes()-5);var t=new Date(e.result.createdOn);t&&t.getTime()>=n.getTime()&&userTags.setRegistrationTags(null,!0,function(e,o){e&&console.log(e)}),null!=c.refWindow&&(c.refWindow.close(),c.refWindow=null),c.loginCallback&&c.loginCallback(null,authAPI.getCurrentUser())}else null!=c.refWindow&&c.refWindow.closed?(c.refWindow.close(),c.secretCodeProvider=null,c.refWindow=null):setTimeout(s,1e3,r-1)},function(e){console.log(JSON.stringify(e))})}else(c.secretCodeProvider=null)!=c.refWindow&&(c.refWindow.close(),c.refWindow=null),c.loginCallback&&(c.invalidCredentials=!0,c.msgError="Invalid Login",c.loginCallback(null,null));else console.error("invalid appContext")};c.setThemeType=function(e){e||(e={});var o,n,t,s,r=null;(e.customLoginUI&&e.customLoginUI.background&&e.customLoginUI.background.active&&e.customLoginUI.background.activeColor?e.customLoginUI.background.color&&"solid"===e.customLoginUI.background.color.colorType&&(r=e.customLoginUI.background.color.solid.colorHex):e.colors&&e.colors.backgroundColor&&(r=e.colors.backgroundColor),r)&&(t=r.match(/^rgb/)?(o=(r=r.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],n=r[2],r[3]):(o=(r=+("0x"+r.slice(1).replace(r.length<5&&/./g,"$&$&")))>>16,n=r>>8&255,255&r),s=Math.sqrt(o*o*.299+n*n*.587+t*t*.114),c.themeType=127.5<s?"light":"dark")}}]);
"use strict";$app.controller("userProfileCtrl",["Upload","$scope","StringResource",function(n,s,t){function r(e,t){new AnalyticsAPI(window.appContext.currentApp.appId,"user_profile","user_profile",window.appContext.liveMode).trackAction(e,t)}(window.authAPI.userProfileCtrlScope=s).user=null,s.userProfile=null,s.tempUser=null,s.tempUserProfile=null,s.editingProfile=!1,s.uploadProfileImage=null,s.uploadBackgroundImage=null,s._appRoot=window._appRoot,s.tabIndex=0,s.switchTabs=function(e){switch(e){case"info":s.tabIndex=0;break;case"badges":s.tabIndex=1}s.$broadcast("tabClicked",{tabIndex:s.tabIndex})},authAPI.getAuthSettings(null,function(e,n){if(e)return console.error(e);t.getData().then(function(e){var t=void 0===n.data.enablePasswordBasedAuth||!0===n.data.enablePasswordBasedAuth;s.changePasswordShow=""!==e.changePassword&&t})});var i=window.appContext.currentApp.appId,o="appearance",e={appId:window.appContext.currentApp.appId,pluginId:o,instanceId:o},a=new AppDatastoreAPI(i),l=new window.DatastoreAPI(e);a.search({tag:"$$badges",obj:{sort:{rank:1}}},function(e,t){if(e)return console.error(e);s.badges=t,s.$$phase||s.$apply()});var u=function(e,n){var r=e.tags?e.tags[i]:[];if(!r.length)return n([]);var o=[];s.badges.forEach(function(t){var e=r.find(function(e){return e.tagName===t.data.tag&&e.appliedCount>=t.data.tagCount});if(e){var n=Math.floor(e.appliedCount/t.data.tagCount);t.data.appliedCount=n,imageTools&&(t.data.imageUrl=imageTools.cropImage(t.data.imageUrl,{size:"xxs",aspect:"1:1",compression:80,disablePixelRatio:1})),o.push(t.data)}});var t={tag:"$$userDirectory",obj:{filter:{"$json.userId":{$eq:g},"_buildfire.index.string1":g}}};a.search(t,function(e,t){return!e&&t.length&&t[0]&&t[0].data&&t[0].data.badges&&t[0].data.badges.forEach(function(t){var e=o.findIndex(function(e){return e.id===t.id});-1<e&&(o[e].earned=t.earned)}),n(o)})},d=document.getElementsByClassName("profile-container")[0],p=function(){if(s.user.imageUrl)s.user.imageUrl=imageTools.cropImage(s.user.imageUrl,{size:"s",aspect:"1:1"});else{var e={id:1,method:"users/getUserImage",params:{userId:s.user._id,externalAppId:window.currentAppId}},t=window.siteConfig.endPoints.authHost+"/src/server.js?data="+encodeURIComponent(JSON.stringify(e));s.user.imageUrl=t}return s.user.imageUrl};s.getUserProfile=function(){var e={id:1,method:"users/getUserProfile",params:{userId:s.user._id}},t=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result&&(e.result.email=s.user.email,s.userProfile=e.result,r("app/user_profile_view",{userId:s.user._id}))}).error(function(e,t,n,r){s.invalidCredentials=!0,console.error(e)})},s.hideDropdown=function(){s.shownDropdown=!1},s.showDropdown=function(e){e.stopPropagation(),s.shownDropdown=!s.shownDropdown},s.showChangePassword=function(){if(window.siteConfig&&"sdk"===window.siteConfig.scope)return alert("You can't change password from SDK");var o=authAPI.getCurrentUser().loginProviderType;authAPI.getAuthSettings(null,function(e,t){if(e)return console.error(e);var n=t.data.signOnStrategy;if("KAuth"===o&&"SSOLogin"!==n)s.close(),window.closeSideMenu(),authAPI.authCtrlScope.showChangePassword();else{var r="your external account";switch(o){case"facebook":r="Facebook";break;case"apple":r="Apple";break;case"twitter":r="Twitter"}(new ComponentUIAPI).showToastMessage({text:"You used an external registration method, change your password through "+r+".",hideDismiss:!0})}})},s.close=function(e){if(e||!s.busy){if(s.sideMenuScroll.enable(),s.tempUser=null,s.tempUserProfile=null,s.shownDropdown=!1,s.editingProfile=!1,s.uploadProfileImage=null,s.uploadBackgroundImage=null,s.busy=!1,window.spinner.hide(),e)return s.user=null,void(s.userProfile=null);d.addEventListener("animationend",function(){s.user=null,s.userProfile=null,s.$$phase||s.$apply(function(){d.classList.remove("closing")})},{once:!0}),requestAnimationFrame(function(){d.classList.add("closing")})}},s.openProfile=function(){return!(window.location.hash="/editUserProfile")},s.openUrl=function(e){return e&&(e.toLowerCase().indexOf("http")<0&&(e="https://"+e),window.open(e,"_blank","location=yes,enableViewportScale=yes")),!1};var c=function(e,o){var t={id:1,method:"users/getPublicUser",params:{userId:e,externalAppId:window.currentAppId}},n=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(t));window.bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(t){u(t.result,function(e){t.result.badges=e,o(null,t)})}).error(function(e,t,n,r){console.error(e),o(e,null)})},f=function(e,o){var t=window.currentAppId;!t&&window.appContext&&window.appContext.currentApp&&(t=window.appContext.currentApp.appId);var n={id:1,method:"users/getUserByAccessToken",params:{accessToken:e,externalAppId:t}},r=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(n));window.bfUtils.http.jsonp(r,{bypassInterceptorForStatus:404}).success(function(t){t&&t.error?1311===t.error.code?(authAPI.getAuthSettings(null,function(e,t){if(e)console.error(e);else if(t&&t.data&&t.data.sessionSettings){var n=t.data.sessionSettings.kickedOutDialogOptions||{},r=n.content||"Please login again to continue";richModal.display({title:n.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>"+r+"</p>",showDismissButton:!1,forceShow:!0,action:{title:n.dismissBtn||"OK",handler:function(){}}})}}),authAPI.logout()):1309===t.error.code?authAPI.logout():(console.error(t.error),o(t.error,null)):u(t.result,function(e){t.result.badges=e,o(null,t)})}).error(function(e,t,n,r){console.error(e),o(e,null)})},g=null,m=null;s.open=function(e){window.spinner.show(),g=e,m=authAPI.getCurrentUser(),s.sideMenuScroll.disable(),g||m&&m._id&&(g=m._id),g&&l.get({tag:o,withDynamicData:!0},function(e,n){if(e)return console.error(e),void callback(e);n&&n.data&&n.data.customRegistration&&n.data.customRegistration.active&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?(s.showCustomUserProfile=!0,m&&m._id==g?f(m.accessToken,function(e,t){t&&(s.user=t.result,window.spinner.hide(),m&&m._id==s.user._id&&(s.user.userToken=m.userToken),p(),w(n.data.customRegistration,t.result),s.customUserProfile=t.result,s.getUserProfile())}):c(g,function(e,t){t&&(s.user=t.result,window.spinner.hide(),p(),w(n.data.customRegistration,t.result),s.customUserProfile=t.result,s.getUserProfile())})):m&&m._id==g?f(m.accessToken,function(e,t){t&&(s.user=t.result,window.spinner.hide(),m&&m._id==s.user._id&&(s.user.userToken=m.userToken),p(),s.getUserProfile())}):c(g,function(e,t){t&&(s.user=t.result,window.spinner.hide(),p(),s.getUserProfile())})})};var w=function(e,t){customRegistration.getFields({defaults:t,isProfileMode:!0,customRegistrationSettings:e,refreshUI:function(){if(s.customRegistrationFields&&s.customRegistrationFields.length){var e=s.customRegistrationFields.find(function(e){return"address"===e.name});e&&e.validate(e.value)}s.$$phase||s.$apply()}},function(e,t){t&&(t.fields&&t.fields.forEach(function(e){e&&"tel"===e.name&&(e.type="tel")}),s.customRegistrationFields=t.fields,s.customRegistration=t,s.initCustomRegistration=function(){t.initializers.forEach(function(e){e()})},s.initCustomRegistration(),s.$$phase||s.$apply())})};authAPI.onLogout(function(){s.user&&delete s.user.userToken,s.close(!0)}),s.tempUser=null,s.tempUserProfile=null,s.busy=!1,s.cancelEdit=function(){return s.tempUser=null,s.tempUserProfile=null,s.editingProfile=null,s.uploadBackgroundImage=null,s.uploadProfileImage=null,s.showCustomUserProfile&&s.open(s.user._id),s.$$phase||s.$apply(),!1},s.showInvalidFieldsErr=function(){t.getData().then(function(e){var t={richContent:'<p class="padding-top-fifteen">'+(e.editProfileInvalidFields||"One or more fields are invalid.")+"</p>",dismissButtonText:"OK"};richModal.display(t)})};var h=function(t,o){var e={id:1,method:"users/update",params:t},n=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(angular.toJson(e));window.bfUtils.http.jsonp(n).success(function(e){s.tempUser.lastUpdated=(new Date).toISOString(),userTags.setRegistrationTags(t.userProfile,!1,function(e,t){e&&console.log(e)}),o(null,e)}).error(function(e,t,n,r){console.error(e),s.busy=!1,window.spinner.hide(),o(e,null)}).finally()};s.update=function(){s.tempUserProfile||(s.tempUserProfile={}),s.busy=!0,window.spinner.show({timeout:6e4});var n={};s.tempUser.displayName=s.tempUser.firstName+" "+s.tempUser.lastName,s.uploadImage(s.uploadProfileImage,function(e,t){t&&(s.tempUser.imageUrl=t.result,n.imageUrl=s.tempUser.imageUrl),s.uploadImage(s.uploadBackgroundImage,function(e,t){t&&(s.tempUserProfile.backgroundImage=t.result,n.backgroundImage=s.tempUserProfile.backgroundImage),function(o){if(s.customRegistration)s.customRegistration.fetch({validateFields:!0,validateLinks:!1,mode:"edit"},function(e,t){if(e)return s.busy=!1,window.spinner.hide(),void s.showInvalidFieldsErr();for(var n in t.user)t.user.hasOwnProperty(n)&&(s.tempUser[n]=t.user[n]);var r=t.user;r._id=s.tempUser._id,r.userToken=s.tempUser.userToken,r.imageUrl=s.tempUser.imageUrl,r.externalAppId=window.appContext.currentApp.appId,h(r,o)});else{var e={};e._id=s.tempUser._id,e.email=s.tempUser.email,e.userToken=s.tempUser.userToken,e.firstName=s.tempUser.firstName,e.lastName=s.tempUser.lastName,e.displayName=s.tempUser.displayName,e.imageUrl=s.tempUser.imageUrl,e.externalAppId=window.appContext.currentApp.appId,h(e,o)}}(function(){!function(o){var e=JSON.parse(JSON.stringify(s.tempUserProfile));e||(e={}),e.userId=s.tempUser._id,e.userToken=s.tempUser.userToken,e.email=s.tempUser.email,e.firstName=s.tempUser.firstName,e.lastName=s.tempUser.lastName,e.displayName=s.tempUser.displayName;var t={id:1,method:"users/saveUserProfile",params:e},n=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(t));window.bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){o(null,e)}).error(function(e,t,n,r){console.error(e),o(e,null)})}(function(){s.tempUser.badges=s.user.badges,s.user=s.tempUser,s.tempUser=null,s.userProfile=s.tempUserProfile,s.tempUserProfile=null,s.uploadBackgroundImage=null,s.uploadProfileImage=null,authAPI._setCurrentUser(s.user),authAPI.triggerOnUpdate(),s.editingProfile=!1,s.busy=!1,window.spinner.hide(),n.userId=s.user._id,r("app/user_profile_update",n)})})})})},s.uploadImage=function(e,o){if(e){var t=window.siteConfig.endPoints.authHost+"/src/server.js?method=users/uploadImage";n.upload({url:t,data:{file:e,userToken:s.user.userToken,externalAppId:window.currentAppId}}).progress(function(e){s.progressMessage=!0;var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"%")}).success(function(e,t,n,r){console.log("file uploaded."),o&&o(null,e)}).error(function(e){o&&o(e,null)}).finally(function(){})}else o(null,null)},s.validateImage=function(e,r){if(!e)return!1;if(e.type&&["image/jpeg","image/png","image/jpg"].indexOf(e.type)<0)return t.getData().then(function(e){var t=("coverPhoto"===r?"Cover":"Profile")+" photo does not support this file type.",n={richContent:'<p class="padding-top-fifteen">'+(e["coverPhoto"===r?"coverImageTypeInvalid":"profileImageTypeInvalid"]||t)+"</p>",dismissButtonText:"OK"};richModal.display(n)}),!1;return!(e.size&&1e7<e.size)||(t.getData().then(function(e){var t=("coverPhoto"===r?"Cover":"Profile")+" photo must be less than 10mb.",n={richContent:'<p class="padding-top-fifteen">'+(e["coverPhoto"===r?"coverPhotoLess10mb":"profilePhotoLess10mb"]||t)+"</p>",dismissButtonText:"OK"};richModal.display(n)}),!1)},s.editProfile=function(){null!=m&&m._id&&(s.tempUser=m,s.currentUserEmail=m.email,s.tempUserProfile=s.userProfile,s.editingProfile=!0,s.busy=!1,s.customRegistrationFields&&s.customRegistrationFields.forEach(function(e){delete e.error}),s.$$phase||s.$apply())},s.enforceMaxLength=function(e,t){e.value.length>t&&(e.value=e.value.substring(0,t)),e.change&&e.change(e.value),e.validate&&e.validate(e.value)},s.sideMenuScroll={enable:function(){var e=document.getElementsByClassName("menu-body-container")[0];e&&e.classList.remove("disable_overflow_scroll")},disable:function(){var e=document.getElementsByClassName("menu-body-container")[0];e&&e.classList.add("disable_overflow_scroll")}}}]),$app.filter("cropCoverImage",function(){return function(e){if(!e)return"";if(!imageTools||!/(https|http):\/\//g.test(e))return e;var t="full_width";return-1<window.location.href.indexOf("pluginTester")&&(t="xl"),imageTools.cropImage(e,{size:t,aspect:"16:9",compression:80})}});
"use strict";$app.controller("notesCtrl",["$scope","$rootScope","$sce",function(s,t,n){s.notes=[],s.notesShown=!1,s.pluginOpen=!1,s.settings={includeTime:!0},s.tempNoteText="",s.instanceId=!1,(window.notesAPI.notesCtrlScope=s).close=function(){if(s.notesShown=!1,s.callback){var t={};s.tempNoteData.itemId&&(t.itemId=s.tempNoteData.itemId),t.hasNotes=s.notes&&0<s.notes.length,t.noteCount=s.notes?s.notes.length:0,s.callback(null,t)}},s.getAllNotes=function(){window.spinner.show(),window.notesAPI.getAll(function(t,i){if(t)throw t;if(i.length){var e=i.map(function(t){return t.instanceId});postMaster.controlPluginAPI.appAPI.getPluginInstancesByIds(e,function(t,e){if(t)throw t;var n=e.data,o=[];i.forEach(function(e){var t=n.find(function(t){return t.data.instanceId===e.instanceId});t&&(e.pluginId=t.data._buildfire.pluginType.result[0].token,e.folderName=t.data._buildfire.pluginType.result[0].folderName,e.title=t.data.title,e.iconUrl=t.data.iconUrl,e.show=!0,o.push(e))}),s.notes=o,window.spinner.hide(),s.$$phase||s.$apply()})}else s.notes=[],window.spinner.hide(),s.$$phase||s.$apply()})},s.getItemNotes=function(){window.spinner.show(),window.notesAPI.getAllFromItem(s.tempNoteData.itemId,function(t,e){if(t)throw t;s.notes=e,window.spinner.hide(),s.$$phase||s.$apply()})},s.deleteNote=function(e,n,o){if(window.notesAPI.delete(e,n,o,function(){}),s.pluginOpen)s.notes=s.notes.filter(function(t){return t.id!=e});else{var t=s.notes.findIndex(function(t){return t.instanceId===o}),i=s.notes[t].content.findIndex(function(t){return t.itemId===n});if(s.notes[t].content[i].notes=s.notes[t].content[i].notes.filter(function(t){return t.id!=e}),0===s.notes[t].content[i].notes.length)s.notes[t].content.splice(i,1),0===s.notes[t].content.length&&s.notes.splice(t,1)}s.$$phase||s.$apply()},s.addNote=function(){var t=!!s.settings.includeTime&&(!!s.tempNoteData.timeIndex&&s.tempNoteData.timeIndex),e={itemId:s.tempNoteData.itemId,imageUrl:s.tempNoteData.imageUrl,title:s.tempNoteData.title,timeIndex:t,instanceId:s.instanceId};window.notesAPI.add(e,function(t){})},s.getItemTitle=function(t){if(!t)return"";var e=t.title||"";return n.trustAsHtml(e)},s.editNote=function(t,e,n){window.notesAPI.edit(t,e,n,function(){s.fetchNotes()})},s.openItem=function(t,e,n){window.notesAPI.loadNote(t,e,n,function(){return s.close()})},s.toggle=function(t){s.notes[t].show=!s.notes[t].show,s.$$phase||s.$apply()},s.fetchNotes=function(){s.notesShown&&(s.pluginOpen?s.getItemNotes():s.getAllNotes())},s.seekTo=function(t,e,n){window.notesAPI.seekTo(t,e,n,function(){return s.close()})},s.$watch("notesShown",function(){s.notes=[],s.fetchNotes()},!0),s.$watch("notes",function(){s.pluginOpen&&10<s.notes.length&&s.resetPosition()},!0),s.notes_empty=window._appRoot+"media/ic_bookmark_empty.svg",s.resetPosition=function(){document.getElementsByClassName("notes-in-plugin")[0].classList.replace("pos-static","pos-fixed"),setTimeout(function(){document.getElementsByClassName("notes-in-plugin")[0].classList.replace("pos-fixed","pos-static")},100)}}]).filter("cropImg",function(){return function(t){return t?imageTools.cropImage(t,{size:"xs",aspect:"1:1"}):window._appRoot+"media/ic_no_img.png"}}).filter("timeFormat",function(){return function(t){var e=new Date(0,0,0,0,0,0,0);return e.setSeconds(t),e}});
"use strict";$app.factory("StringResource",["$q",function(t){var e=new DatastoreAPI(appContext.currentApp.appId,"stringResources",1,0,appContext.currentApp.keys.datastoreKey),r=n();function n(){var r=t.defer();return e.get({},function(t,e){t||!e?r.reject(t):r.resolve(e.data)}),r.promise}return{getData:function(t){return t&&(r=n()),r}}}]);
"use strict";var authAPI={authCtrlScope:null,userProfileCtrlScope:null,init:function(e){this.context=e},refreshAndTriggerUpdate:function(n){n||(n={});var e=authAPI.getCurrentUser();e&&authAPI.getUserByAccessToken({accessToken:e.accessToken},function(e,t){t&&(authAPI._setCurrentUser(t),authAPI.triggerOnUpdate(t,n.updateType))})},initRefresh:function(){var e=function(){var i=authAPI.getCurrentUser();i&&authAPI.getUserByAccessToken({accessToken:i.accessToken},function(e,t){if(t){var n={isActive:i.isActive,appTags:i.tags?i.tags[window.currentAppId]:null},s={isActive:t.isActive,appTags:t.tags?t.tags[window.currentAppId]:null};authAPI._setCurrentUser(t),JSON.stringify(n)!==JSON.stringify(s)&&(console.log("user update found during sync"),authAPI.triggerOnUpdate(t))}})};bfUtils.isApp&&(setTimeout(e,3e3),setInterval(e,3e5)),authAPI.session.init()},getUserByAccessToken:function(e,i){var t={id:1,method:"users/getUserByAccessToken",params:{accessToken:e.accessToken,externalAppId:window.currentAppId}},n=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(t));window.bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){e?e.error?1311===e.error.code?(authAPI.getAuthSettings(null,function(e,t){if(e)console.error(e);else if(t&&t.data&&t.data.sessionSettings){var n=t.data.sessionSettings.kickedOutDialogOptions||{},s=n.content||"Please login again to continue";richModal.display({title:n.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>"+s+"</p>",showDismissButton:!1,forceShow:!0,action:{title:n.dismissBtn||"OK",handler:function(){}}})}}),authAPI.logout(),i(null,null)):1309===e.error.code?authAPI.logout():(console.error(e.error),i(e.error,null)):i(null,e.result):i(null,null)}).error(function(e,t,n,s){console.error(e),i(e,null)})},login:function(e,n){var t=this.getCurrentUser();t?(n&&n(null,t),authAPI.triggerOnLogin(t)):(authAPI.authCtrlScope.loginOptions=e,authAPI.authCtrlScope.showLogin(function(e,t){!e&&t&&(authAPI._setCurrentUser(t),authAPI.session.start(),authAPI.triggerOnLogin(t),authAPI._checkGDPR(t),authAPI.authCtrlScope.hideLogin(),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply()),n&&n(e,t)}),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply())},_setCurrentUser:function(e){window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&localStorage.setItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER",JSON.stringify(e))},secondaryUserLookup:function(){return null},getCurrentUser:function(e,t){"function"==typeof e&&(t=e);var n=this.secondaryUserLookup();if(n||window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(n=localStorage.getItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"),n=JSON.parse(n)),n&&n.userToken||(n=null),!t)return n;t(null,n)},_checkGDPR:function(o){if(o){var r="bf_terms_and_conditions",a="bf_privacy_policy";customRegistration.getSettings(null,function(e,t){var n=[];if(!e&&t&&t.active){var s=t.singlePage.formControls.find(function(e){return e&&"termsConditionsAndPrivacyPolicy"===e.id});s.settings&&s.active&&s.settings.termsAndConditionsDocumentKey?n.push(s.settings.termsAndConditionsDocumentKey):n.push(r),s.settings&&s.active&&s.settings.privacyPolicyDocumentKey?n.push(s.settings.privacyPolicyDocumentKey):n.push(a)}else n=[r,a];var i=siteConfig.endPoints.crmHost+"/documents/"+n.join(",")+"/check?userKey="+encodeURIComponent(o.email||o.username);(bfUtils.isAppHtml5Version||bfUtils.isMobileDevice||bfUtils.isPwaAndroid||bfUtils.isPwaiOS)&&window.appContext&&1==window.appContext.liveMode&&bfUtils.http.get(i).success(function(e){if(e)for(var t=0;t<n.length;t++)if(e[n[t]]&&!e[n[t]].isAccepted){window.location.hash="gdpr";break}}).error(function(e){console.error(e)})})}},logout:function(){this._setCurrentUser(null),window.localStorage.removeItem("SSO_USER"),authAPI.session.end(),authAPI.triggerOnLogout(null),authAPI.authCtrlScope&&authAPI.authCtrlScope.changePasswordShown&&authAPI.authCtrlScope.hideLogin()},trackRegister:function(e){if(window.appContext&&window.appContext.liveMode){var t=new AnalyticsAPI(authAPI.context);t.setUserProperties({email:e.email,username:e.username,firstName:e.firstName,lastName:e.lastName}),t.trackAction("app/userRegistered");var n=localStorage.getItem("HISTORY_USERS");if(n){var s=JSON.parse(n);s.length&&-1==s.indexOf(e._id)&&(s.push(e._id),localStorage.setItem("HISTORY_USERS",JSON.stringify(s)))}else localStorage.setItem("HISTORY_USERS",JSON.stringify([e._id]))}},onLogin:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGIN",e,!1)},onLogout:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGOUT",e,!1)},onUpdate:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_UPDATE",e,!1)},triggerOnUpdate:function(e,t){e||(e=authAPI.getCurrentUser());var n=new CustomEvent("AUTH_CURRENT_USER_ON_UPDATE",{detail:{user:e,updateType:t}});document.dispatchEvent(n)},triggerOnLogin:function(e){var t=new CustomEvent("AUTH_CURRENT_USER_ON_LOGIN",{detail:e});document.dispatchEvent(t)},triggerOnLogout:function(){var e=new CustomEvent("AUTH_CURRENT_USER_ON_LOGOUT",{detail:null});document.dispatchEvent(e)},openProfile:function(e){if(e)return n(e);var t=this.getCurrentUser();if(t&&t._id)return n(t._id);function n(e){authAPI.userProfileCtrlScope.open(e)}this.login({},function(e,t){!e&&t&&t._id&&n(t._id)})},getUserProfile:function(s,i){if(!s||!s.userId)throw new Error("userId have not been provided to getUserInfo");var o=null,e={id:1,method:"users/getPublicUser",params:{userId:s.userId,externalAppId:window.currentAppId}},t=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){var t,n;i&&(e&&e.result?(o=e.result,t={id:1,method:"users/getUserProfile",params:{userId:s.userId}},n=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(t)),bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){i&&(e&&e.result?(o=angular.extend({},e.result,o),i(null,o||null)):i(null,o))}).error(function(e,t,n,s){i&&i(e,null)})):i(null,null))}).error(function(e,t,n,s){console.error(e),i&&i(e,null)})},getUsersByEmail:function(s,i){if(!s||!s.emails)throw new Error("No emails have not been provided to getUserByEmail");var t=function(t){var e={id:1,method:"users/getUsersProfilesByEmail",params:{emails:s.emails}},n=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){i&&(e&&e.result?function(e,t){for(var n=0;n<e.length;n++)for(var s=0;s<t.length;s++)e[n].email==t[s].email&&(e[n].phone=t[s].phone);i(null,e)}(t,e.result):i(null,t))}).error(function(e,t,n,s){console.error(e),i&&i(e,null)})},e={id:1,method:"users/getUsersByEmail",params:{emails:s.emails,externalAppId:window.currentAppId}},n=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){i&&(e&&e.result?t(e.result):i(null,null))}).error(function(e,t,n,s){console.error(e),i&&i(e,null)})},getUserPictureUrl:function(e){var t=null,n=null;if(e||(e={}),e.userId&&(t="userId",n=e.userId),e.email&&(t="email",n=e.email),e.username&&(t="username",n=e.username),!t||!n)throw Error("Invalid user picture params");return n=encodeURIComponent(n),window.siteConfig.endPoints.authHost+"/src/server.js/user/picture?"+t+"="+n+"&externalAppId="+encodeURIComponent(window.currentAppId)},getAuthSettings:function(e,n){if(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.keys&&window.appContext.currentApp.appId)if(authAPI.authSettings)n(null,{data:authAPI.authSettings});else{var t={appId:window.appContext.currentApp.appId,pluginId:"authSettings",instanceId:"authSettings",liveMode:window.appContext.liveMode,writeKey:window.appContext.currentApp.keys.datastoreKey};new DatastoreAPI(t).get({tag:"authSettings"},function(e,t){t&&t.data&&(authAPI.authSettings=t.data),n(e,t)})}else n("missing currentApp parameters")},keepSessionAlive:function(e,t){var n=new CustomEvent("sessionActivity",{detail:{data:e}});document.dispatchEvent(n),t(null,!0)},fakeTimeOutDialog:function(e){var t=document.getElementById("alertDialog"),n=0;richModal.isVisible()&&!t&&(n=1e3,richModal.clearAll()),t?(document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.continueBtn):(richModal.display({title:e.title||"Your session is about to expire",richContent:"<p id='alertDialog' style='font-size:50px; text-align:center' class='dangerTheme'>00:10</p>",showDismissButton:!1,forceShow:!0,action:{title:e.continueBtn||"CONTINUE",handler:function(){}}}),setTimeout(function(){var t=10,n=setInterval(function(){if(document.getElementById("alertDialog")){var e=10<t--?t:"0"+t;document.getElementById("alertDialog").innerText="00:"+e,t<=0&&clearInterval(n)}else clearInterval(n)},1e3)},n))},fakeExpiredDialog:function(e){var t=document.getElementById("expiredDialog");if(richModal.isVisible()&&!t&&richModal.clearAll(),t)document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.dismissBtn,t.innerText=e.content;else{var n=e.content||"Please login again to continue";richModal.display({title:e.title||"Your session is expired due to inactivity",richContent:"<p id=\"expiredDialog\" style='font-size:2rem'>"+n+"</p>",showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}})}},fakeKickedOutDialog:function(e){var t=document.getElementById("kickedOutDialog");if(richModal.isVisible()&&!t&&richModal.clearAll(),t)document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.dismissBtn,t.innerText=e.content;else{var n=e.content||"Please login again to continue";richModal.display({title:e.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>"+n+"</p>",showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}})}},session:{sessionExpires:!1,idleTimeSeconds:null,lastIdleTimeUpdateOn:null,stopWatchInterval:null,updateIdleTimeInterval:null,init:function(){authAPI.getAuthSettings(null,function(e,t){if(!e&&t&&!bfUtils.isEmulatorCP&&bfUtils.isApp&&t.data&&t.data.sessionSettings&&(t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive||t.data.sessionSettings.expireWhenAppClose)){authAPI.getCurrentUser()&&authAPI.logout(),authAPI.session.sessionExpires=t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive;var n=function(){null===authAPI.session.stopWatchInterval&&authAPI.session._resetIdleTime()};document.addEventListener("sessionActivity",n,!1),s=!1,i=function(){s||(s=!0,setTimeout(function(){s=!1},1e3),setTimeout(n))},document.addEventListener("click",i),document.addEventListener("touchstart",i)}var s,i})},start:function(){authAPI.getAuthSettings(null,function(e,t){if(e)console.error(e);else if(!bfUtils.isEmulatorCP&&bfUtils.isApp&&t&&t.data&&t.data.sessionSettings&&t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive){var n=60*t.data.sessionSettings.expireWhenIdleFor.timeInMinutes,s=t.data.sessionSettings.expireWhenIdleFor.showTimeoutDialog,i=t.data.sessionSettings.expireWhenIdleFor.alertDialogOptions||{},o=t.data.sessionSettings.expireWhenIdleFor.expiredDialogOptions||{},r=!1;authAPI.session.lastIdleTimeUpdateOn=new Date,authAPI.session.idleTimeSeconds=0;var a=function(){var e=o.content||"Please login again to continue";richModal.display({title:o.title||"Your session is expired due to inactivity",richContent:"<p style='font-size:2rem'>"+e+"</p>",showDismissButton:!1,action:{title:o.dismissBtn||"OK",handler:function(){}}})};authAPI.session.updateIdleTimeInterval=setInterval(function(){var e=new Date;if(authAPI.session.idleTimeSeconds+=(e.getTime()-authAPI.session.lastIdleTimeUpdateOn.getTime())/1e3,authAPI.session.lastIdleTimeUpdateOn=e,authAPI.session.idleTimeSeconds>n+5&&(console.error("abnormally forced logout"),authAPI.session._clean(),authAPI.logout()),s&&!r&&authAPI.session.idleTimeSeconds>n-60){r=!0;var t=0;richModal.isVisible()&&(t=1e3,richModal.clearAll());richModal.display({title:i.title||"Your session is about to expire",richContent:"<p id='logout-timer' style='font-size:50px; text-align:center' class='dangerTheme'>01:00</p>",showDismissButton:!1,action:{title:i.continueBtn||"CONTINUE",handler:function(){r=!1,authAPI.session._resetIdleTime(),console.log("login session extended - continue")}}}),setTimeout(function(){var n=(new Date).getTime()/1e3+60;authAPI.session.stopWatchInterval=setInterval(function(){if(document.getElementById("logout-timer")){var e=Math.round(n-(new Date).getTime()/1e3),t=9<e?e:"0"+e;document.getElementById("logout-timer").innerText="00:"+t,e<=0&&(r=!1,authAPI.session._clean(),richModal.close(),setTimeout(function(){a(),authAPI.logout()},1e3),console.log("login session terminated - continue"))}else r=!1,authAPI.session._resetIdleTime(),console.log("login session extended - closed")},1e3)},t)}else!s&&authAPI.session.idleTimeSeconds>n&&(a(),console.log("login session terminated without warning"),authAPI.session._clean(),authAPI.logout())},3e3)}})},end:function(){authAPI.session._clean()},_clean:function(){authAPI.session.stopWatchInterval&&(clearInterval(authAPI.session.stopWatchInterval),authAPI.session.stopWatchInterval=null),authAPI.session.updateIdleTimeInterval&&(clearInterval(authAPI.session.updateIdleTimeInterval),authAPI.session.updateIdleTimeInterval=null),authAPI.session.idleTimeSeconds=0},_resetIdleTime:function(){authAPI.session.idleTimeSeconds=0,authAPI.session.stopWatchInterval&&(clearInterval(authAPI.session.stopWatchInterval),authAPI.session.stopWatchInterval=null)}},changePassword:function(e,i){var t={},n=authAPI.getCurrentUser();if(!(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&n))return console.error("Error",{code:"MissedData",message:"Missed context's data"}),i({code:"MissedData",message:"Missed context's data"},null);t={appId:window.appContext.currentApp.appId,accessToken:n.accessToken,currentPassword:e.oldPassword,newPassword:e.newPassword,passwordStrength:e.passwordStrength},window.bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/auth/user/changePassword",t,{headers:{"Content-Type":"application/json"}}).success(function(e){n.accessToken=e.accessToken,authAPI._setCurrentUser(n),i(null,null)}).error(function(e,t,n,s){i(e,null),console.error("Error",e,t)})}};authAPI.initRefresh();
"use strict";$app.controller("modalCtrl",["$scope","$dialog","$data",function(l,e,o){l.modal={},l.modal.body=o.body,l.modal.title=o.title?o.title:"Confirm",l.modal.okText=o.okText?o.okText:"OK",l.modal.cancelText=o.cancelText?o.cancelText:"Cancel",l.modal.disableCancel=!!o.disableCancel&&o.disableCancel,l.close=function(){e.close(!1)},l.confirm=function(){e.close(!0)}}]);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};setTimeout(function(){if(sessionStorage.getItem("notification"))try{var t=JSON.parse(sessionStorage.getItem("notification"));LocalNotificationsAPI.navToPlugin(t)}finally{sessionStorage.removeItem("notification")}},2e3);var LocalNotificationsAPI=function(){var c={},a="Cordova notification plugin not installed";function l(t){this.context=t}function s(t){return c.hasOwnProperty(t)}function r(t){s(t)&&(clearTimeout(c[t]),delete c[t])}function i(){return"undefined"!=typeof cordova}return l.prototype={schedule:function(t,n){var a=Math.floor(1e9*Math.random()),i=new Date;if(l.isPluginAvailable())t.badge=0,t.at?t.at=Date.parse(t.at):t.at=new Date(i.getTime()+1e3),t.id=a,t.data={actionItem:t.actionItem,pluginData:t.data,returnInstanceId:t.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId,pluginId:this.context.pluginId,analyticsData:t.analyticsData},cordova.plugins.notification.local.schedule(t),n(null,{id:t.id});else{var o=Math.abs(Date.parse(t.at)-Date.now());if(o<-2e3)return;t.data={actionItem:t.actionItem,pluginData:t.data,returnInstanceId:t.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId,pluginId:this.context.pluginId,analyticsData:t.analyticsData};var e=setTimeout(function(){s(a)&&(l.notificationModal(t),r(a))},o);c[a]=e,n(null,{id:a})}},cancel:function(t,n){l.isPluginAvailable()?(cordova.plugins.notification.local.cancel(t),n(null,{id:t})):i()?n(new Error(a),null):(r(t),n(null,{id:t}))},checkPermission:function(t,n){if(i())return l.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(t){n&&n(null,t)}):(n&&n(new Error(a),!1),void console.warn(a));n&&n(null,!0)},requestPermission:function(t,n){if(i())return l.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(t){t?n&&n(null,!0):cordova.plugins.notification.local.registerPermission(function(t){t?n&&n(null,!0):(console.warn("Permission not granted for local notifications"),n&&n(null,!1))})}):(n&&n(new Error(a),!1),void console.warn(a));n&&n(null,!0)}},l.isPluginAvailable=function(){var t=!0;return"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.notification&&cordova.plugins.notification.local||(t=!1),t},l.getPlatform=function(){return device.platform?device.platform.toLowerCase():""},l.notificationModal=function(n){if(n&&(n.title||n.text)){var t={data:{title:n.title,body:n.text}};window.openDialog(t,function(t){t&&l.navToPlugin(n)})}},l.navToPlugin=function(o){var t=postMaster.launcherPluginAPI?0:1500;setTimeout(function(){var t,n,a,i;postMaster.launcherPluginAPI&&(n=2e3,i=(a={doNothing:0,sendToLauncher:1,sendToPlugin:2}).sendToPlugin,"object"!==_typeof(o.data)&&(o.data=JSON.parse(o.data)),o.data.actionItem&&ActionItemsAPI.prototype.execute(o.data.actionItem,function(t,n){}),"home"==(t=o.data.returnInstanceId?o.data.returnInstanceId.toLowerCase():"")||"none"==t?i=a.doNothing:postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.context&&postMaster.launcherPluginAPI.context.instanceId==t&&(i=a.sendToLauncher),i!==a.doNothing&&(a===a.sendToLauncher?(n=500,postMaster.launcherPluginAPI.navigation.navigateHome()):(i=a.sendToPlugin,postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.context&&postMaster.widgetPluginAPI.context.instanceId==o.data.returnInstanceId?n=500:postMaster.launcherPluginAPI.navigation.navigateToPluginInstance({instanceId:o.data.returnInstanceId})),setTimeout(function(){var t=new Packet(null,"notifications.localNotification.onClick",o.data.pluginData);i===a.sendToLauncher?postMaster.launcherPluginAPI.sendMessage(null,t):postMaster.widgetPluginAPI.sendMessage(null,t)},n)))},t)},l.sendAnalytics=function(t){t&&t.data&&("object"!==_typeof(t.data)&&(t.data=JSON.parse(t.data)),t.data&&t.data.analyticsData&&t.data.analyticsData.eventName&&new AnalyticsAPI(window.appContext.currentApp.appId,t.data.pluginId,t.data.launchInstanceId,window.appContext.liveMode).trackAction(t.data.analyticsData.eventName,t.data.analyticsData.metaData))},l}();bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){LocalNotificationsAPI.isPluginAvailable()&&(cordova.plugins.notification.local.on("trigger",function(t){console.log("*** notification trigger ***"),LocalNotificationsAPI.sendAnalytics(t),"ios"==LocalNotificationsAPI.getPlatform()&&LocalNotificationsAPI.notificationModal(t)}),cordova.plugins.notification.local.on("click",function(t){console.log("*** notification click ***"),LocalNotificationsAPI.sendAnalytics(t),LocalNotificationsAPI.navToPlugin(t)}))});
"use strict";function LocalStorageAPI(e){this.instanceId=e.instanceId,this.collectionKey=siteConfig.scope+"-"+this.instanceId+"-storage";var t=localStorage.getItem(this.collectionKey);if(t)try{this.collection=JSON.parse(t)}catch(e){console.error(e),this.collection={}}else this.collection={}}LocalStorageAPI.prototype={setItem:function(e,t){if(e&&e.key&&e.value)if(void 0===e.value)delete this.collection[e.key];else try{var l=JSON.parse(JSON.stringify(this.collection));if(l[e.key]=e.value,(l=JSON.stringify(l))&&2048<l.length){var o="localStorage for a plugin instance may not exceed 2048 characters. consider using other buildfire storage options";return console.error(o),void t(new Error(o))}this.collection[e.key]=e.value,localStorage.setItem(this.collectionKey,JSON.stringify(this.collection)),t(null,!0)}catch(e){console.error(e),t(e,null)}else t(new Error("invalid parameters. Expected Key/Value object"))},getItem:function(e,t){if(e&&e.key&&(e=e.key),e&&t){var l=this.collection[e];t(null,void 0===l?null:l)}else t(new Error("invalid parameters. Expected Key and Callback"))},removeItem:function(e,t){e&&e.key&&(e=e.key),e&&t?(delete this.collection[e],localStorage.setItem(this.collectionKey,JSON.stringify(this.collection)),t(null,!0)):t(new Error("invalid parameters. Expected Key and Callback"))},clear:function(e,t){localStorage.removeItem(this.collectionKey),t(null,!0)},getCollection:function(e,t){t(null,this.collection)}};
"use strict";var validator={validatePassword:function(t,a){if(a&&a.simplePasswordValidation)return t&&6<=t.length&&t.length<=60;if(!t||t.length<8||60<t.length)return!1;var e=/[A-Z]/.test(t),r=/[a-z]/.test(t),n=/\d/.test(t),s=/\W/.test(t);return e&&r&&n&&s},validateEmail:function(t){return!!t&&/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,24}$/.test(t)},passwordPattern:{test:function(t){return validator.validatePassword(t)}}};
"use strict";function PushNotificationsAPI(t){this.context=t}PushNotificationsAPI.prototype={schedule:function(t,o){if(t&&t.text&&t.title)if(this.context&&this.context.instanceId){t.at||(t.at=new Date),t.groupName||(t.groupName="");var i={groupID:PushNotificationsAPI._getGroupID(this.context,t.groupName),users:t.users,userTags:t.userTags,title:t.title,message:t.text,sendAfter:t.at,source:"plugin",richMessage:t.inAppMessage||void 0,deviceIdCreatedBy:"undefined"!=typeof push&&push.deviceId?push.deviceId:null,sendToSelf:!0};!1===t.sendToSelf&&(i.sendToSelf=!1),i.sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+i.source,!1!==t.actionItem&&(t.actionItem?i.actionItem=t.actionItem:i.actionItem={title:"View",action:"linkToApp",instanceId:this.context.instanceId,queryString:t.queryString}),authAPI.getCurrentUser(function(t,e){i.authCreatedBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/",i).success(function(t){o&&o(null,t)}).error(function(t,e,i,n){o&&o(t)})})}else o&&o("instanceId is null, unable to build groupID");else o&&o("text or title is empty")},cancel:function(i,o){if(i)if(this.context&&this.context.instanceId){var n={source:"plugin"};n.sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+n.source,authAPI.getCurrentUser(function(t,e){n.authCanceledBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/"+i+"/cancel",n).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})})}else o&&o("instanceId is null, unable to build groupID");else o&&o("id is empty")},subscribe:function(t,e){if(t||(t={}),t.groupName||(t.groupName=""),this.context&&this.context.instanceId){var i=PushNotificationsAPI._getGroupID(this.context,t.groupName);PushNotificationsAPI._subscribe({groupID:i},e)}else e&&e("instanceId is null, unable to build groupID")},unsubscribe:function(t,e){if(t||(t={}),t.groupName||(t.groupName=""),this.context&&this.context.instanceId){var i=PushNotificationsAPI._getGroupID(this.context,t.groupName);PushNotificationsAPI._unsubscribe({groupID:i},e)}else e&&e("instanceId is null, unable to build groupID")}},PushNotificationsAPI._getGroupID=function(t,e){return window.appContext.currentApp.appId+"_"+t.instanceId+"_"+e},PushNotificationsAPI._unsubscribe=function(i,o){window.push&&window.push.deviceId&&window.push.platform?(i||(i={}),i.groupID?authAPI.getCurrentUser(function(t,e){i.deviceID=push.deviceId,i.os=window.push.platform?window.push.platform.toLowerCase():"",i.authUserId=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/unsubscribe/",i).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})}):o("groupID is not specified")):o&&o("Device not ready to get the deviceId")},PushNotificationsAPI._getSubscriptions=function(e){if(window.push&&window.push.deviceId&&window.push.platform){var t=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/",i={deviceID:push.deviceId,os:window.push.platform?window.push.platform.toLowerCase():""};bfUtils.http.post(t,i).success(function(t){return e(null,t)}).catch(function(t){return e(t,null)})}else e&&e("Device not ready to get the deviceId")},PushNotificationsAPI._subscribe=function(s,u){window.push&&window.push.deviceId&&window.push.platform?(s||(s={}),s.groupID||(s.groupID=""),authAPI.getCurrentUser(function(t,e){var i="undefined"!=typeof PushNotification&&void 0!==PushNotification.listChannels,n=device.platform&&"android"===device.platform.toLowerCase()&&i;s.deviceID=push.deviceId,s.os=window.push.platform?window.push.platform.toLowerCase():"",s.authUserId=e&&e._id?e._id.toString():null,s.device="undefined"!=typeof device?device:null,s.deliveryMethod=n?"FCM":null;var o=localStorage.getItem("currentPushDeviceID");o&&o!==push.deviceId&&(s.oldDeviceID=o),bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscribe/",s).success(function(t){localStorage.setItem("currentPushDeviceID",push.deviceId),u&&u(null,!0)}).error(function(t,e,i,n){u&&u(t)})})):u&&u("Device not ready to get the deviceId")},authAPI.onLogin(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)}),authAPI.onLogout(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)});
"use strict";function FirebaseAPI(n){this.context=n}FirebaseAPI.prototype={createCustomToken:function(o,a){var s=this;function u(i){FirebaseAPI._getUser({instanceId:s.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:o.integrationToken},function(n,e){if(!e||o&&o.forceLogin){var t=null;t="cp"===siteConfig.scope?"/api/user/firebase/cp/login":"/api/user/firebase/login",bfUtils.http.post(window.siteConfig.endPoints.appHost+t,{authUserId:i._id,authAccessToken:i.accessToken,pluginTypesToken:s.context.pluginId,appId:window.appContext.currentApp.appId,instanceId:s.context.instanceId,integrationToken:o.integrationToken}).success(function(n){FirebaseAPI._setUser({instanceId:s.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:o.integrationToken},n),a&&a(null,n)}).error(function(n,e,t,i){401==e||403==e?(authAPI.logout(),authAPI.login({},function(n,e){e?u(e):a&&a(null,null)})):a&&a(n)})}else a&&a(null,e)})}authAPI.getCurrentUser(function(n,e){e?u(e):authAPI.login({},function(n,e){e?u(e):a&&a(null,null)})})}},function(){var a={};FirebaseAPI._getUser=function(n,e){var t=n.appId+"_"+n.instanceId+"_"+n.integrationToken,i=a[t],o=new Date;o.setMinutes(o.getMinutes()-60),i&&i.createdOn>o?e(null,i.value):(a[t]=void 0,e(null,null))},FirebaseAPI._setUser=function(n,e){var t=n.appId+"_"+n.instanceId+"_"+n.integrationToken;a[t]={createdOn:new Date,value:e}},authAPI.onLogout(function(){a={}})}();
"use strict";function PublicFilesAPI(e){this.context=e,this.currentUser=null}PublicFilesAPI.prototype={getFileUrl:function(o,r){var a=this.context.appId;authAPI.getCurrentUser(function(e,t){if(e)return r(e);var n=void 0;t&&(n=t.accessToken);var i=o.fileId,s=new XMLHttpRequest;s.addEventListener("readystatechange",function(){4===this.readyState&&r(null,JSON.parse(this.responseText))}),s.addEventListener("error",function(e){r(e)}),s.open("GET",window.siteConfig.endPoints.publicFilesHost+"/file/"+i+"/?appId="+a+"&returnUrl=true"),s.setRequestHeader("Authorization",n),s.setRequestHeader("x-scope",window.siteConfig.scope),s.send()})},modifyPermissions:function(a,l){var u=this.context.appId;authAPI.getCurrentUser(function(e,t){if(e)return l(e);var n=void 0;t&&(n=t.accessToken);var i=a.fileId,s=a.permissions,o=JSON.stringify({permissions:s,appId:u}),r=new XMLHttpRequest;r.addEventListener("readystatechange",function(){4===this.readyState&&l(null,JSON.parse(this.responseText))}),r.addEventListener("error",function(e){l(e)}),r.open("PATCH",window.siteConfig.endPoints.publicFilesHost+"/file/"+i),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Authorization",n),r.setRequestHeader("x-scope",window.siteConfig.scope),r.send(o)})},deleteFile:function(o,r){authAPI.getCurrentUser(function(e,t){if(e)return r(e);var n=void 0;t&&(n=t.accessToken);var i=o.fileId,s=new XMLHttpRequest;s.addEventListener("readystatechange",function(){4===this.readyState&&r(null,JSON.parse(this.responseText))}),s.addEventListener("error",function(e){r(e)}),s.open("DELETE",window.siteConfig.endPoints.publicFilesHost+"/file/"+i),s.setRequestHeader("x-scope",window.siteConfig.scope),s.setRequestHeader("Authorization",n),s.send()})},showDialog:function(e,t){e||(e={});var n,i=this;(n=document.getElementById("publicFiles_input_form"))?n.innerHTML="":((n=document.createElement("form")).setAttribute("id","publicFiles_input_form"),document.body.appendChild(n));var s=document.createElement("input");s.setAttribute("type","file"),s.setAttribute("style","display:none"),s.setAttribute("id","publicFilesHiddenInput"+(new Date).toISOString()),n.appendChild(s),e&&e.allowMultipleFilesUpload&&(s.setAttribute("multiple",""),s.setAttribute("name","files[]")),e&&e.filter&&(s.accept=e.filter.join(",")),s.addEventListener("change",function(){i.uploadFiles(this.files,e,t)},!1),s.click()},uploadFilesManually:function(e,t){this.uploadFiles(e.files,e,t)},uploadFiles:function(n,l,i){var s=[],o=[],u=this;i||"function"!=typeof l||(i=l,l={}),l||(l={});var p=new AnalyticsAPI(u.context.appId,u.context.pluginId,u.context.instanceId,window.appContext.liveMode);function r(r,a){return new Promise(function(n,e){var t=!0;if(l.filter&&!function(e,t){for(var n=0;n<=t.length;n++)if(t[n]==e.type)return!0;return!1}(r,l.filter)&&(a.status="failed",a.error="invalid File Format",u._onComplete&&u._onComplete(a),t=!1,n(a)),262144e3<r.size&&(a.status="failed",a.error="invalid File Size",u._onComplete&&u._onComplete(a),t=!1,n(a)),t){var i=new FormData;i.append("pluginId",u.context.pluginId),i.append("instanceId",u.context.instanceId),i.append("appId",u.context.appId),l.permissions&&i.append("permissions",JSON.stringify(l.permissions)),u.currentUser&&u.currentUser.accessToken&&i.append("accessToken",u.currentUser.accessToken),i.append("file",r);var s=new XMLHttpRequest,o=function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);a.percentage=t,u._onProgress&&u._onProgress(a)}};bfUtils.isMobileDevice?s.upload.onprogress=o:s.upload.addEventListener("progress",o,!1),s.onload=function(){var e=null;if(s.responseText)try{e=JSON.parse(s.responseText)}catch(e){}if(200==s.status){a.url=e.url,a.size=e.size,a.type=e.type,a.fileId=e.fileId,a.status="success";var t={data:{url:e.url,size:e.size,type:e.type},_buildfire:{aggregationValue:e.size}};"app"==window.siteConfig.scope?p.trackAction("app/publicFilesUpload",t):p.trackAction("cp/publicFilesUpload",t)}else a.status="failed",e.message?a.error=e.message:a.error="An error has occurred";u._onComplete&&u._onComplete(a),n(a)},s.onerror=function(){a.status="failed",u._onComplete&&u._onComplete(a),n(a)},s.timeout=6e4,s.open("POST",window.siteConfig.endPoints.publicFilesHost+"/file/upload/"),s.setRequestHeader("x-scope",window.siteConfig.scope),s.send(i)}})}authAPI.getCurrentUser(function(e,t){if(e)return i(e);t&&(u.currentUser=t),function(e){for(var t=0;t<e.length;t++){var n={fileId:t,filename:e[t].name};e[t].fileId=t,o.push(n),s.push(r(e[t],n))}Promise.all(s).then(function(e){i(null,e)}).catch(function(){i(!0,null)})}(n)})},onProgress:function(e){this._onProgress=e},onComplete:function(e){this._onComplete=e}};
"use strict";var imagePreviewerAPI={show:function(n,t){this.initialized||this.renderHTML();var o=document.querySelectorAll(".pswp")[0];t=t||Function.prototype;var i={index:0<=n.index?n.index:0,history:!1,counterEl:!1,captionEl:!1,fullscreenEl:!1,zoomEl:!1,arrowEl:!1,preloaderEl:!1,shareEl:!1,tapToToggleControls:!1,correctOrientation:!0,clickToCloseNonZoomable:!1,closeOnScroll:!1},s=window.PhotoSwipeUI_Default;if(n&&n.images&&n.images.length){n.images[0]&&n.images[0].name&&(n.images=n.images.map(function(n){return n.name}));var e=[];window.spinner.show(),n.images.forEach(function(t){var n=new Promise(function(n){var e=new Image;e.onload=function(){return n(e)},e.src=window.siteConfig.endPoints.cloudImageHost+"/"+t});e.push(n)}),Promise.all(e).then(function(n){var e=[];n.forEach(function(s){e.push(new Promise(function(i){EXIF.getData(s,function(){var n=EXIF.getTag(this,"Orientation"),e=s.src,t=s.naturalHeight,o=s.naturalWidth;e=e.replace(/q1/,"n"),i(3===n||6===n?{src:imageTools.cropImage(e,{width:o,height:t}),msrc:imageTools.cropImage(e,{width:Math.round(o/3),height:Math.round(t/3)}),w:t,h:o}:{src:imageTools.cropImage(e,{width:o,height:t}),msrc:imageTools.cropImage(e,{width:Math.round(o/3),height:Math.round(t/3)}),w:o,h:t})})}))}),Promise.all(e).then(function(n){window.pswp=new PhotoSwipe(o,s,n,i),window.pswp.listen("close",t),window.pswp.init(),window.spinner.hide()})})}},renderHTML:function(){var n=document.createElement("div");n.style.position="relative",n.style.zIndex=99999999,n.innerHTML='\n    \x3c!-- Root element of PhotoSwipe. Must have class pswp. --\x3e\n    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n\n        \x3c!-- Background of PhotoSwipe.\n             It\'s a separate element as animating opacity is faster than rgba(). --\x3e\n        <div class="pswp__bg"></div>\n\n        \x3c!-- Slides wrapper with overflow:hidden. --\x3e\n        <div class="pswp__scroll-wrap">\n\n            \x3c!-- Container that holds slides.\n                PhotoSwipe keeps only 3 of them in the DOM to save memory.\n                Don\'t modify these 3 pswp__item elements, data is added later on. --\x3e\n            <div class="pswp__container">\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n            </div>\n\n            \x3c!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --\x3e\n            <div class="pswp__ui pswp__ui--hidden">\n\n                <div class="pswp__top-bar" style="background: transparent !important; padding-top: env(safe-area-inset-top); padding-top: const(safe-area-inset-top);">\n\n                    \x3c!--  Controls are self-explanatory. Order can be changed. --\x3e\n\n                    <div class="pswp__counter"></div>\n\n                    <span class="glyphicon glyphicon-remove pswp__button pswp__button--close" title="Close (Esc)" style="color: #FFF !important;font-size: 20pt;padding: 15px;width:55px;height:55px">\n                    </span>\n\n                    <button class="pswp__button pswp__button--share" title="Share"></button>\n\n                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n\n                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n\n                    \x3c!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR --\x3e\n                    \x3c!-- element will get class pswp__preloader--active when preloader is running --\x3e\n                    <div class="pswp__preloader">\n                        <div class="pswp__preloader__icn">\n                          <div class="pswp__preloader__cut">\n                            <div class="pswp__preloader__donut"></div>\n                          </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                    <div class="pswp__share-tooltip"></div>\n                </div>\n\n                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n                </button>\n\n                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n                </button>\n\n                <div class="pswp__caption">\n                    <div class="pswp__caption__center"></div>\n                </div>\n\n            </div>\n\n        </div>\n\n    </div>\n    ',0<=window.location.pathname.toLowerCase().indexOf("plugintester")?document.getElementById("app").appendChild(n):document.body.appendChild(n),this.initialized=!0}};
"use strict";function searchEngineAPI(e){this.context=e}searchEngineAPI.prototype={_sendRequest:function(e,i,s,t){var n="",a=new XMLHttpRequest,d=window.siteConfig.endPoints.searchEngineHost+"/search_engine/"+i;if("GET"===(e=e.toUpperCase())&&s){var l="?";for(var g in s)s.hasOwnProperty(g)&&(l+=g+"="+encodeURIComponent(s[g])+"&");d+=l=l.slice(0,-1)}else n=JSON.stringify(s);a.open(e,d,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("app_id",this.context.appId),a.setRequestHeader("x-api-key","GpzNPRVIld3WxoKDAXJZM7cjoUA5p0rS6pqYkCqy"),a.onreadystatechange=function(){var e=null;try{e=JSON.parse(a.responseText)}catch(e){}4==a.readyState&&(200===a.status?t&&t(null,e):t&&t(e))},a.send(n)},search:function(e,s){var i=this;if(e){var t={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,page_index:e.pageIndex,page_size:e.pageSize,search_text:e.searchText,pre_highlight_tag:e.preHighlightTag,post_highlight_tag:e.postHighlightTag};e.linkedUser?window.authAPI.getCurrentUser(function(e,i){t.user_id=i&&i._id?i._id.toString():null,t.user_id?n():s&&s({message:"no user found"})}):n()}else s&&s("invalid params",null);function n(){i._sendRequest("POST","search",t,function(e,i){s&&s(e,i)})}},insert:function(e,s){var i=this;if(e)if(e.tag)if(e.title){var t={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data};e.linkedUser?window.authAPI.getCurrentUser(function(e,i){t.user_id=i&&i._id?i._id.toString():null,t.user_id?n():s&&s({message:"no user found"})}):n()}else s&&s({message:"Missing params title"},null);else s&&s({message:"Missing params tag"},null);else s&&s({message:"invalid params"},null);function n(){i._sendRequest("POST","",t,function(e,i){s&&s(e,i)})}},save:function(e,s){var i=this;if(e)if(e.key)if(e.tag)if(e.title){var t={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,key:e.key,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data};e.linkedUser?window.authAPI.getCurrentUser(function(e,i){t.user_id=i&&i._id?i._id.toString():null,t.user_id?n():s&&s({message:"no user found"})}):n()}else s&&s({message:"Missing params title"},null);else s&&s({message:"Missing params tag"},null);else s&&s({message:"Missing params key"},null);else s&&s({message:"invalid params"},null);function n(){i._sendRequest("POST","save",t,function(e,i){s&&s(e,i)})}},update:function(e,s){var i=this;if(e)if(e.id)if(e.tag)if(e.title){var t={id:e.id,instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data};e.linkedUser?window.authAPI.getCurrentUser(function(e,i){t.user_id=i&&i._id?i._id.toString():null,t.user_id?n():s&&s({message:"no user found"})}):n()}else s&&s({message:"Missing params title"},null);else s&&s({message:"Missing params tag"},null);else s&&s({message:"Missing params id"},null);else s&&s({message:"invalid params"},null);function n(){i._sendRequest("PUT","",t,function(e,i){s&&s(e,i)})}},delete:function(e,s){var t=this;if(e)if(e.id)if(e.tag){var n={id:e.id,instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag};window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,t._sendRequest("DELETE","",n,function(e,i){s&&s(e,i)})})}else s&&s({message:"Missing params tag"},null);else s&&s({message:"Missing params id"},null);else s&&s({message:"invalid params"},null)},get feeds(){var t=this;return{insert:function(e,s){if(e)if(e.tag)if(e.title)if(e.feedType)if(e.feedConfig&&e.feedConfig.url){e.feedItemConfig||(e.feedItemConfig={});var i={instance_id:t.context.instanceId,plugin_id:t.context.pluginId,tag:e.tag,title:e.title,description:e.description,feed_type:e.feedType,feed_config:{url:e.feedConfig.url},feed_item_config:{unique_key:e.feedItemConfig.uniqueKey,title_key:e.feedItemConfig.titleKey,description_key:e.feedItemConfig.descriptionKey,url_key:e.feedItemConfig.urlKey,publish_date_key:e.feedItemConfig.publishDateKey,image_url_key:e.feedItemConfig.imageUrlKey}};t._sendRequest("POST","feeds",i,function(e,i){s&&s(e,i)})}else s&&s({message:"Missing params feedConfig.url"},null);else s&&s({message:"Missing params feedType"},null);else s&&s({message:"Missing params title"},null);else s&&s({message:"Missing params tag"},null);else s&&s({message:"invalid params"},null)},delete:function(e,s){if(e)if(e.tag)if(e.feedId){var i={instance_id:t.context.instanceId,plugin_id:t.context.pluginId,tag:e.tag,feed_id:e.feedId,remove_feed_data:e.removeFeedData};t._sendRequest("DELETE","feeds",i,function(e,i){s&&s(e,i)})}else s&&s({message:"Missing params feedId"},null);else s&&s({message:"Missing params tag"},null);else s&&s({message:"invalid params"},null)},get:function(e,s){if(e)if(e.tag)if(e.feedType){var i={instance_id:t.context.instanceId,plugin_id:t.context.pluginId,tag:e.tag,feed_type:e.feedType};t._sendRequest("GET","feeds",i,function(e,i){s&&s(e,i)})}else s&&s({message:"Missing params feedType"},null);else s&&s({message:"Missing params tag"},null);else s&&s({message:"invalid params"},null)}}}};
"use strict";function CreditsAPI(e){if(this.context=e,!this.context)throw Error("invalid creditsSystem context");this.context.apiKeys&&(this.secretKey=this.context.apiKeys.creditsSystemSecretKey)}CreditsAPI.prototype={_sendRequest:function(e,n,t,s){var i="",r=void 0,c=void 0;t.public_key&&(r=t.public_key),t.secret_key&&(c=t.secret_key),delete t.public_key,delete t.secret_key;var a=new XMLHttpRequest,o=window.siteConfig.endPoints.creditSystemHost+"/credit_system/"+n;if("GET"===(e=e.toUpperCase())&&t){var u="?";for(var d in t)t.hasOwnProperty(d)&&(u+=d+"="+encodeURIComponent(t[d])+"&");o+=u=u.slice(0,-1)}else i=JSON.stringify(t);a.open(e,o,!0),a.setRequestHeader("Content-Type","application/json"),r&&a.setRequestHeader("public_key",r),c&&a.setRequestHeader("secret_key",c),a.setRequestHeader("x-api-key","ZBtYjI3ZlNaKdhWApTjIF3NYaynO4snJ1zikGTDr"),a.onreadystatechange=function(){var e=null;try{e=JSON.parse(a.responseText)}catch(e){}4==a.readyState&&(200===a.status?s&&s(null,e):s&&s(e))},a.send(i)},updateMerchant:function(s,i){var r=this;appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,json_config:s.jsonConfig};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("PUT","merchants",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})})},purchaseBundle:function(r,c){var a=this;function s(e){var s=e.sessionId,i=e.transactionId;i?s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,payment_provider:r.paymentProvider,transaction_id:i,stripe:{session_id:s},bundle_id:r.bundleId,access_token:r.access_token};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?a._sendRequest("POST","credits/purchase",t,function(e,n){c&&c(e,n)}):c&&c({message:"no logged in user"})})}):c&&c("Missing sessionId parameter in purchase",null):c&&c("Missing transactionId parameter in purchase",null)}r?r.bundleId?window.authAPI.getCurrentUser(function(e,n){r.access_token=n&&n.accessToken?n.accessToken.toString():null,r.access_token?(r.paymentProvider="stripe",appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,payment_provider:r.paymentProvider,bundle_id:r.bundleId,memo:r.memo,x_ref_1:r.xRef1,x_ref_2:r.xRef2,x_ref_3:r.xRef3,access_token:r.access_token};a._sendRequest("POST","credits/transactions",t,function(e,t){e?c(e):t&&t.transactionId&&t.stripe&&t.stripe.clientReferenceId?new StripeAPI(a.context).purchase({items:[{sku:t.stripe.skuId}],clientReferenceId:t.stripe.clientReferenceId},function(e,n){e||s({transactionId:t.transactionId,sessionId:n.id})}):c({message:"missing stripe data in transaction"})})})):c&&c({message:"no logged in user"})}):c&&c("Missing bundleId parameter",null):c&&c("invalid params",null)},getMerchant:function(e,s){var i=this;appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:i.secretKey};i._sendRequest("GET","merchants",t,function(e,n){s&&s(e,n)})})},getBundles:function(e,s){var i=this;appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:i.secretKey};i._sendRequest("GET","bundles",t,function(e,n){s&&s(e,n)})})},deleteBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,bundle_id:s.bundleId};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("DELETE","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},insertBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,name:s.name,stripe_product_id:s.stripeProductId,description:s.description,credit_amount:s.creditAmount,user_token:s.userToken,image_url:s.imageUrl};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("POST","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},updateBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,name:s.name,stripe_product_id:s.stripeProductId,description:s.description,credit_amount:s.creditAmount,bundle_id:s.bundleId,user_token:s.userToken,image_url:s.imageUrl};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("PUT","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},adjustCredits:function(s,i){var r=this;s?s.userToken?s.creditAmount?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,user_token:s.userToken,credit_amount:s.creditAmount,memo:s.memo,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){t.created_by_user_token=n&&n._id?n._id.toString():null,t.created_by_user_token?r._sendRequest("POST","credits/adjust",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid creditAmount",null):i&&i("invalid userToken",null):i&&i("invalid params",null)},consumeCredits:function(s,i){var r=this;s?s.creditAmount?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,credit_amount:s.creditAmount,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3,memo:s.memo};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("POST","credits/consume",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("Missing creditAmount parameter",null):i&&i("invalid params",null)},transferCredits:function(s,i){var r=this;s?s.creditAmount?s.receiverUserToken||s.receiverUserEmail?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,credit_amount:s.creditAmount,receiver_user_token:s.receiverUserToken,receiver_user_email:s.receiverUserEmail,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("POST","credits/transfer",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("Missing (receiverUserToken or receiverUserEmail) parameter",null):i&&i("Missing creditAmount parameter",null):i&&i("invalid params",null)},searchTransactions:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:r.secretKey,users_tokens:s.usersTokens,page_size:s.pageSize,page_index:s.pageIndex,from_date:s.fromDate,to_date:s.toDate,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){!t.public_key||(t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token)?r._sendRequest("POST","credits/transactions/search",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},getUser:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey};s.secretKey&&(t.secret_key=s.secretKey),window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("GET","credits/user",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},searchUsers:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,users_tokens:s.usersTokens,page_size:s.pageSize,page_index:s.pageIndex};r._sendRequest("POST","credits/users",t,function(e,n){i&&i(e,n)})}):i&&i("invalid params",null)},getTransactionsLogs:function(s,i){var r=this;s?appApiKeys.get(function(e,n){if(s.creditTransactionId){var t={secret_key:r.secretKey};r._sendRequest("GET","credits/transaction/"+s.creditTransactionId+"/logs",t,function(e,n){i&&i(e,n)})}else i&&i("Missing creditTransactionId parameter",null)}):i&&i("invalid params",null)}};
"use strict";function StripeAPI(e){if(this.context=e,!this.context)throw Error("stripeAPI: invalid context")}StripeAPI.prototype={_sendRequest:function(e,i,t,n,s){var c="",o=new XMLHttpRequest,a=window.siteConfig.endPoints.stripeHost+"/stripe/"+i;if("GET"===(e=e.toUpperCase())&&t){var u="?";for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&(u+=r+"="+encodeURIComponent(t[r])+"&");a+=u=u.slice(0,-1)}else c=JSON.stringify(t);if(o.open(e,a,!0),o.setRequestHeader("Content-Type","application/json"),n)for(var r in n)n.hasOwnProperty(r)&&o.setRequestHeader(r,n[r]);o.onreadystatechange=function(){var e=null;try{e=JSON.parse(o.responseText)}catch(e){}4==o.readyState&&(200===o.status?s&&s(null,e):s&&s(e))},o.send(c)},_loadScript:function(e,i){var t=document.createElement("script");if(t.type="text/javascript",t.readyState?t.onreadystatechange=function(){"loaded"!=t.readyState&&"complete"!=t.readyState||(t.onreadystatechange=null,i&&i())}:t.onload=function(){i&&i()},t.src=e.url,e.attr)for(var n in e.attr)t.setAttribute(n,e.attr[n]);for(var s=document.getElementsByTagName("script"),c=s.length;c--;)if(s[c].src==e.url)return i&&i(),!0;document.getElementsByTagName("head")[0].appendChild(t)},_guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},_openStripeCheckout:function(e,t){var i=e.items,n=e.successUrl,s=e.cancelUrl,c=e.submitType,o=e.customerEmail,a=e.sessionId,u=e.clientReferenceId,r=e.domain,p=e.events,l=this,d=null,m=!1,y=null,f=!1;function _(e){e||(e={}),clearInterval(d),(e.invokeDismiss||void 0===e.invokeDismiss)&&window.richModal&&window.richModal.close(),y&&y.close(),p&&"function"==typeof p.onClose&&p.onClose()}function K(){l._sendRequest("GET","checkout/sessions",{session_id:a,client_reference_id:u},{"x-api-key":l.context.apiKeys.awsApiPublicKey},function(e,i){if(i){if(f)return;f=!0,_(),t&&t(e,i)}})}var h=r+"/payments/checkout?stripeKey="+l.context.apiKeys.stripePublicKey;function v(){y=window.open(h,"_blank","location=no"),d=setInterval(function(){y&&y.closed&&_(),"visible"==window.document.visibilityState?K():m||(m=!0,setTimeout(function(){m=!1,K()},6e4))},5e3),setTimeout(function(){_()},9e5)}a&&(h+="&sessionId="+encodeURIComponent(a)),u&&(h+="&clientReferenceId="+encodeURIComponent(u)),n&&(h+="&successUrl="+encodeURIComponent(n)),s&&(h+="&cancelUrl="+encodeURIComponent(s)),c&&(h+="&submitType="+encodeURIComponent(c)),o&&(h+="&customerEmail="+encodeURIComponent(o)),i&&(h+="&items="+encodeURIComponent(JSON.stringify(i))),window.bfUtils.isApp&&window.richModal.display({title:"",showDismissButton:!1,richContent:"<div style='text-align:center;'>Payment in progress <br/> Please wait...</div>",action:{title:"Cancel",handler:function(){_({invokeDismiss:!1})}}}),p&&"function"==typeof p.onProgress&&p.onProgress(v),!1===l.openPaymentWindow||v()},_checkApiKeys:function(t){var n=this;function e(){appApiKeys.get(function(e,i){n.context.apiKeys=i,t&&t()})}n.context.apiKeys&&n.context.apiKeys.awsApiPublicKey?t&&t():window.appContext.currentApp.apiKeys?0===Object.keys(window.appContext.currentApp.apiKeys).length&&window.appContext.currentApp.apiKeys.constructor===Object?e():(n.context.apiKeys=window.appContext.currentApp.apiKeys,t&&t()):e()},pay:function(e,t){var n=this;n._checkApiKeys(function(){n.context.apiKeys.stripePublicKey?n._loadScript({url:"https://checkout.stripe.com/checkout.js"},function(){var i=StripeCheckout.configure({key:n.context.apiKeys.stripePublicKey,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(e){i.close(),t&&t(null,{sourceToken:e})}});i.open({}),window.addEventListener("popstate",function(){i.close()})}):t&&t("Missing stripePublicKey in context",null)})},charge:function(c,o){var a=this;a._checkApiKeys(function(){if(a.context.apiKeys.stripePublicKey)if(a.context.apiKeys.awsApiPublicKey)if(c)if(a.openPaymentWindow=c.openPaymentWindow,c.items&&0!=c.items.length){for(var e=[],i=0;i<c.items.length;i++){if(!c.items[i].name)return void(o&&o("Missing name in items index "+i,null));if(!c.items[i].amount)return void(o&&o("Missing amount in items index "+i,null));e.push({name:c.items[i].name,description:c.items[i].description||void 0,amount:c.items[i].amount,currency:c.items[i].currency||"usd",quantity:c.items[i].quantity||1})}var n=window.siteConfig.endPoints.appHost,s="app_id_"+a.context.appId+"_ref_id_"+a._guid(),t={type:"line_items",line_items:e,client_reference_id:s,success_url:n+"/payments/success",cancel_url:n+"/payments/cancel"};c.submitType&&(t.submit_type=c.submitType),c.customerId&&(t.customer_id=c.customerId),c.customerEmail&&(t.customer_email=c.customerEmail),c.captureMethod&&(t.payment_intent_data={capture_method:c.captureMethod}),a._sendRequest("POST","checkout/sessions",t,{"x-api-key":a.context.apiKeys.awsApiPublicKey},function(e,i){if(e)o&&o(e,i);else{var t=i.sessionId;a._openStripeCheckout({sessionId:t,clientReferenceId:s,domain:n,events:c.events},function(e,i){o&&o(e,i)})}})}else o&&o("Missing items",null);else o&&o("invalid params",null);else o&&o("Missing awsApiPublicKey in context",null);else o&&o("Missing stripePublicKey in context",null)})},subscribe:function(c,o){var a=this;a._checkApiKeys(function(){if(a.context.apiKeys.stripePublicKey)if(a.context.apiKeys.awsApiPublicKey)if(c)if(a.openPaymentWindow=c.openPaymentWindow,c.items&&0!=c.items.length){for(var e=[],i=0;i<c.items.length;i++){if(!c.items[i].planId)return void(o&&o("Missing planId in items index "+i,null));e.push({plan_id:c.items[i].planId,quantity:c.items[i].quantity||1})}var n=window.siteConfig.endPoints.appHost,s="app_id_"+a.context.appId+"_ref_id_"+a._guid(),t={type:"subscription",subscription_data:e,client_reference_id:s,success_url:n+"/payments/success",cancel_url:n+"/payments/cancel"};c.trialPeriodDays&&(t.trial_period_days=c.trialPeriodDays),c.customerId&&(t.customer_id=c.customerId),c.customerEmail&&(t.customer_email=c.customerEmail),c.metaData&&(t.metadata=c.metaData),a._sendRequest("POST","checkout/sessions",t,{"x-api-key":a.context.apiKeys.awsApiPublicKey},function(e,i){if(e)o&&o(e,i);else{var t=i.sessionId;a._openStripeCheckout({sessionId:t,clientReferenceId:s,domain:n,events:c.events},function(e,i){o&&o(e,i)})}})}else o&&o("Missing items",null);else o&&o("invalid params",null);else o&&o("Missing awsApiPublicKey in context",null);else o&&o("Missing stripePublicKey in context",null)})},purchase:function(c,o){var a=this;a._checkApiKeys(function(){if(a.context.apiKeys.stripePublicKey)if(a.context.apiKeys.awsApiPublicKey)if(c)if(c.items&&0!=c.items.length){for(var e=[],i=0;i<c.items.length;i++){if(!c.items[i].sku)return void(o&&o("Missing sku in items index "+i,null));e.push({sku:c.items[i].sku,quantity:c.items[i].quantity||1})}var t=window.siteConfig.endPoints.appHost,n="app_id_"+a.context.appId+"_ref_id_"+a._guid();c.clientReferenceId&&(n=c.clientReferenceId);var s={items:e,clientReferenceId:n,successUrl:t+"/payments/success",cancelUrl:t+"/payments/cancel",submitType:c.submitType,customerEmail:c.customerEmail,domain:t,events:c.events};a._openStripeCheckout(s,function(e,i){o&&o(e,i)})}else o&&o("Missing items",null);else o&&o("invalid params",null);else o&&o("Missing awsApiPublicKey in context",null);else o&&o("Missing stripePublicKey in context",null)})},getSubscription:function(i,t){var n=this;n._checkApiKeys(function(){if(n.context.apiKeys.awsApiPublicKey)if(i)if(i.subscriptionId){var e={subscription_id:i.subscriptionId};n._sendRequest("GET","customer/subscription",e,{"x-api-key":n.context.apiKeys.awsApiPublicKey},function(e,i){t&&t(e,i)})}else t&&t("Missing params subscriptionId",null);else t&&t("invalid params",null);else t&&t("Missing awsApiPublicKey in context",null)})},cancelSubscription:function(i,t){var n=this;n._checkApiKeys(function(){if(n.context.apiKeys.awsApiPublicKey)if(i)if(i.subscriptionId)if(i.customerId){var e={subscription_id:i.subscriptionId,customer_id:i.customerId};n._sendRequest("DELETE","customer/subscription",e,{"x-api-key":n.context.apiKeys.awsApiPublicKey},function(e,i){t&&t(e,i)})}else t&&t("Missing params customerId",null);else t&&t("Missing params subscriptionId",null);else t&&t("invalid params",null);else t&&t("Missing awsApiPublicKey in context",null)})},addCustomerCard:function(c,o){var a=this;a._checkApiKeys(function(){if(a.context.apiKeys.stripePublicKey)if(a.context.apiKeys.awsApiPublicKey)if(c)if(c.customerId){var n=window.siteConfig.endPoints.appHost,s="app_id_"+a.context.appId+"_ref_id_"+a._guid(),e={mode:"setup",type:"setup",client_reference_id:s,success_url:n+"/payments/success",cancel_url:n+"/payments/cancel"};c.customerEmail&&(e.customer_email=c.customerEmail),a._sendRequest("POST","checkout/sessions",e,{"x-api-key":a.context.apiKeys.awsApiPublicKey},function(e,i){if(e)o&&o(e,i);else{var t=i.sessionId;a._openStripeCheckout({sessionId:t,clientReferenceId:s,domain:n},function(e,i){if(e)o&&o(e,null);else if(i){var t={customer_id:c.customerId,setup_intent:i.setup_intent};a._sendRequest("POST","customer/card",t,{"x-api-key":a.context.apiKeys.awsApiPublicKey},function(e,i){o&&o(e,i)})}else o&&o(null,null)})}})}else o&&o("Missing params customerId",null);else o&&o("invalid params",null);else o&&o("Missing awsApiPublicKey in context",null);else o&&o("Missing stripePublicKey in context",null)})},capturePayment:function(i,t){var n=this;n._checkApiKeys(function(){if(n.context.apiKeys.awsApiPublicKey)if(i)if(i.paymentIntentsId){var e={payment_intents_id:i.paymentIntentsId};i.amountToCapture&&(e.amount_to_capture=i.amountToCapture),n._sendRequest("POST","payment/capture",e,{"x-api-key":n.context.apiKeys.awsApiPublicKey},function(e,i){t&&t(e,i)})}else t&&t("Missing params paymentIntentsId",null);else t&&t("invalid params",null);else t&&t("Missing awsApiPublicKey in context",null)})}};
"use strict";var userTagsAPI={assignUserTags:function(t,e){if(t&&t.tags&&t.tags.length){for(var n=0;n<t.tags.length;n++){var r=t.tags[n];if(!r)return void e("tag is null or undefined",null);if(-1<r.indexOf(","))return void e("tag ("+r+") error. cannot contain commas",null);if(0!==r.indexOf("$$"))return void e("tag ("+r+") error. must begin with $$",null);if(r.length<5)return void e("tag ("+r+") error. length must be 5 at least",null)}authAPI.getCurrentUser(function(n,r){n?(console.log(n),e(n,null)):r?userTags.assignUserTags(t.tags.join(","),e):e("no current user",null)})}else e("no tags found",null)}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},richModal=function(){var y=document.createElement("div");y.id="richModal",y.className="hidden";var e=document.createElement("div");e.className="focus-screen hidden",y.appendChild(e),document.body.appendChild(y);var b=["default","primary","success","info","warning","danger"],v=null,C=[];function T(){try{if(v)return;var e=!(null==C||!C.length)&&C[0].options.forceShow;if(0<=window.location.hash.indexOf("accessCode")&&!e)return setTimeout(T,5e3);var t=document.getElementsByClassName("login-holder")[0];if(t&&-1===t.className.indexOf("ng-hide")&&!e)return setTimeout(T,5e3);var n=(v=C.shift()).options,i=v.callback;document.getElementById("richModal").className="";var o=document.getElementsByClassName("focus-screen")[0];o.className="focus-screen animated fadeInScreen",o.onclick=function(){n&&n.forceAction||(N(),i&&i(null,{buttonType:null}))};var a=document.createElement("div");if(a.className="detail-modal animated fadeInUp backgroundColorTheme",n.title){var l=document.createElement("h1");if(l.id="modalTitle",l.innerHTML=n.title,n.design){var s="";n.design.title&&n.design.title.align&&(s+="text-align: "+n.design.title.align+" !important;"),n.design.textColor&&(s+="color: "+n.design.textColor+" !important;"),l.setAttribute("style",s)}a.appendChild(l)}if(n.subtitle){var c=document.createElement("span");if(c.className="subtitle",c.innerHTML=n.subtitle,n.design){s="";n.design.subtitle&&n.design.subtitle.align&&(s+="text-align: "+n.design.subtitle.align+" !important;"),n.design.textColor&&(s+="color: "+n.design.textColor+" !important;"),c.setAttribute("style",s)}a.appendChild(c)}var r=document.createElement("div");r.className="rich-content bodyTextTheme",n.isContentHTML||void 0===n.isContentHTML?r.innerHTML=n.richContent||"":r.innerText=n.richContent||"",a.appendChild(r);var d=document.createElement("div");if(d.className="button-container",a.appendChild(d),n.showDismissButton||void 0===n.showDismissButton){var u=document.createElement("button");u.className=n.action?"dismiss-button primaryTheme":"dismiss-button dismiss-large primaryTheme",u.innerHTML=n.dismissButtonText||"Dismiss",u.onclick=function(){N(),i&&i(null,{buttonType:"dismiss"})},d.appendChild(u)}var m="";n.design&&(n.design.fullScreen&&y.classList.add("fullScreen"),n.design.backgroundColor&&(m+="background : "+n.design.backgroundColor+" !important;"),n.design.textColor&&(m+="color : "+n.design.textColor+" !important"),a.setAttribute("style",m),u.setAttribute("style",m))}catch(e){console.error("Failed to render rich modal",e)}if(n.action&&!n.action.length&&(n.action=[n.action]),n.action)for(var f=function(e){var t=n.action[e];try{if(h=document.createElement("button"),t.type||(t.type="primary"),!b.includes(t.type))return{v:i("Invalid button type")};h.className="action-button "+t.type+"Theme",!1===n.showDismissButton&&(h.className="action-button "+t.type+"Theme action-button-large"),h.innerHTML=t.title||"[ Click ]",h.onclick=function(){t.handler?t.handler():((new ActionItemsAPI).execute(t,function(e,t){}),i&&i(null,{buttonType:"action",value:t}));t.preventAutoClose||N()},n.design&&m&&h.setAttribute("style",m),d.appendChild(h)}catch(e){console.error("Failed to bind action to rich modal",e)}},p=0;p<n.action.length;p++){var h,g=f(p);if("object"===(void 0===g?"undefined":_typeof(g)))return g.v}document.getElementById("richModal").appendChild(a)}function N(){var e=document.getElementsByClassName("focus-screen")[0];e&&(e.className="focus-screen animated fadeOutScreen");var t=document.getElementsByClassName("detail-modal")[0];t&&(t.className="detail-modal animated fadeOut");var n=document.getElementById("richModal");setTimeout(function(){t&&t.remove(),v=null,0<C.length?setTimeout(T,300):n&&(n.className="hidden")},700)}return{display:function(e,t){C.push({options:e,callback:t}),T()},close:function(){N()},isVisible:function(){return!(0<=document.getElementById("richModal").className.indexOf("hidden"))},clearAll:function(){C=[],N()}}}();
"use strict";var push={pushNotification:null,deviceId:null,platform:null,unseen:0,notificationHandler:null,_instance:null,init:function(){var e;try{if(!window.PushNotification)return void console.error("PushNotification plugin not installed");push.platform=device.platform.toLowerCase();var i=(e={android:{},ios:{}},"android"==device.platform.toLowerCase()?e.android={senderID:"515869937012"}:e.ios={alert:"true",badge:"true",sound:"true"},e);push._instance=PushNotification.init(i),push._instance.on("registration",function(e){push.registerToken(e.registrationId),console.log("push notification registered...")}),push._instance.on("notification",function(t){var e=new CustomEvent("pushNotificationsOnReceived",{detail:t});document.dispatchEvent(e),t.count&&t.additionalData&&t.additionalData.foreground?push._instance.getApplicationIconBadgeNumber(function(i){t.count!=i&&push._instance.setApplicationIconBadgeNumber(function(){push.decrementBadge(),console.log("push badge updated from notification",{localCount:i,remoteCount:t.count})},function(e){push.decrementBadge(),console.log("push badge failed to update from notification",{err:e,localCount:i,remoteCount:t.count})},parseInt(t.count))},function(e){console.log("failed getting local badge",{err:e,remoteCount:t.count})}):push.decrementBadge();var i={};"social"==t.additionalData.messageType?i.buttons=["Dismiss"]:i.buttons=["Dismiss","Show Details"],push.displayMessage(t,i)}),push._instance.on("error",function(e){console.error(e.message),push.err=e;var i=new CustomEvent("PUSH_ON_REGISTRATION",{detail:null});document.dispatchEvent(i)}),push.getBadgeNumber(function(e,i){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:i}))});var t=function(){push.getBadgeNumber(function(e,i){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:i}))})};document.addEventListener("deviceAppResumed",t,!1),t()}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}},decrementBadge:function(i){if(push._instance){var e=device.platform?device.platform.toLowerCase():"",t=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/decrease";window.bfUtils.http.post(t,{deviceID:push.deviceId,os:e,value:1}).success(function(e){console.log("push badge decremented",e)}).error(function(e,i){var t={data:e,status:i};console.error("error decrementing badge",t)}),push._instance.getApplicationIconBadgeNumber(function(e){e?push._instance.setApplicationIconBadgeNumber(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:e-1})),i&&i(null,e-1)},function(e){i&&i(e)},e-1):i&&i(null,e)},function(e){i&&i(e)})}else i&&i("push not initialized")},getBadgeNumber:function(i){push._instance?push._instance.getApplicationIconBadgeNumber(function(e){i&&i(null,e)},function(e){i&&i(e)}):i&&i("push not initialized")},clearBadge:function(i){if(push._instance){var e=device.platform?device.platform.toLowerCase():"",t=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/update";window.bfUtils.http.post(t,{deviceID:push.deviceId,os:e,value:0}).success(function(e){console.log("push badge cleared",e)}).error(function(e,i){var t={data:e,status:i};console.error("error clearing badge",t)}),push._instance.setApplicationIconBadgeNumber(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:0})),i&&i(null,0)},function(e){i&&i(e)},0)}else i&&i("push not initialized")},registerToken:function(e){if(console.log("registerToken: "+e),push.deviceId=e,window.appContext&&window.appContext.currentApp){var i="undefined"!=typeof PushNotification&&void 0!==PushNotification.listChannels,t=device.platform&&"android"===device.platform.toLowerCase()&&i,o={params:{data:{method:"groups/subscriptions/add",params:{groupID:"",appID:window.appContext.currentApp.appId,deviceID:push.deviceId,os:device.platform?device.platform.toLowerCase():"",deliveryMethod:t?"FCM":null,device:device}}}},n=localStorage.getItem("currentPushDeviceID");n&&n!==e&&(o.params.data.params.oldDeviceID=n);var a=function(){bfUtils.http&&bfUtils.http.jsonp(window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",o).success(function(){console.log("device is now subscribed to PNs"),localStorage.setItem("currentPushDeviceID",e)}).error(function(e){console.error(e)})};setTimeout(function(){PushNotificationsAPI._subscribe(null,function(e){e&&(console.error(e),setTimeout(a,2e3))})},2e3)}else console.error("invalid appContext cant register device")},displayMessage:function(e,i){var o;i||(i={}),o=i._forceToDisplayMessage,push.trackPushNotifications({eventName:"push_notification/viewed",payload:e}),console.log("pushNotifications#displayMessage L152",e),localStorage.payload=JSON.stringify(e);try{var t="";if(e._id?t=e._id:window.plugins&&window.plugins.pushNotification?e&&e.notificationId&&(t=e.notificationId):e&&e.additionalData&&e.additionalData.notificationId&&(t=e.additionalData.notificationId),console.log("Checking message type",e.messageType,e),e.additionalData&&"social"===e.additionalData.messageType)return e.title="Alert",e.richContent=e.message,richModal.display(e),void console.log("Got social notification",e);var n=window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",a={params:{data:{method:"notifications/get",params:{appID:window.appContext.currentApp.appId.toString(),notificationID:t}}}};push.getNotificationData(n,a,e,function(e,i){if(e)return console.error(e);var t=Object.assign({},i);i.actionItem&&(t.action={title:i.actionItem&&i.actionItem.title?i.actionItem.title:"View",handler:function(){var e=new ActionItemsAPI;push.trackPushNotifications({eventName:"push_notification/clicked",payload:i}),window.closeSideMenu&&window.closeSideMenu(),e.execute(i.actionItem,function(e,i){console.info("Action Taken!")})}}),o||i.richMessage?(t.richContent=t.richMessage,t.subtitle="Sent "+moment(t.sendAfter).fromNow(),richModal.display(t)):t.action&&t.action.handler&&t.action.handler()})}catch(e){console.error("Failed to parse push notification",e)}},getNotificationData:function(e,i,t,o){window.bfUtils.http.jsonp(e,i).success(function(e){var i=e&&e.result[0]?e.result[0]:{actionItem:!1};t=Object.assign(t,i),o(null,t)}).catch(o)},notificationsTracked:{},trackPushNotifications:function(e){if("undefined"!=typeof device&&"undefined"!=typeof AnalyticsAPI&&e&&e.payload&&e.eventName){var i=null;if(window.plugins&&window.plugins.pushNotification?e.payload.notificationId&&(i=e.payload.notificationId):window.PushNotification&&e.payload.additionalData&&e.payload.additionalData.notificationId&&(i=e.payload.additionalData.notificationId),i){push.notificationsTracked||(push.notificationsTracked={});var t=push.notificationsTracked[i];if(t||(t=push.notificationsTracked[i]={events:[]}),t.events||(t.events=[]),-1<t.events.indexOf(e.eventName))return;t.events.push(e.eventName);var o=device.platform?device.platform.toLowerCase():"";n=i,a=o,new AnalyticsAPI(window.appContext.currentApp.appId,"push_notification",n,void 0,a).trackAction(e.eventName)}}var n,a}},_oldPush={pushNotification:null,unseen:0,notificationHandler:null,init:function(){console.warn("window.plugins.pushNotification is used for old builds, it's no longer used for new build");try{if(void 0===window.plugins||void 0===window.plugins.pushNotification)return void console.warn("window.plugins.pushNotification is not defined");_oldPush.pushNotification=window.plugins.pushNotification,push.platform=device.platform.toLowerCase(),push.prepareDOM(),"android"==device.platform.toLowerCase()?_oldPush.notificationHandler=new pushAndroidNotificationHandler(_oldPush.pushNotification):_oldPush.notificationHandler=new pushiOSNotificationHandler(_oldPush.pushNotification),_oldPush.notificationHandler.onRegistered=push.registerToken,_oldPush.notificationHandler.register()}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}}};function pushAndroidNotificationHandler(e){this.pushNotification=e,this.androidSenderID="515869937012"}function pushiOSNotificationHandler(e){this.pushNotification=e}pushAndroidNotificationHandler.prototype={register:function(){navigator.onLine?this.pushNotification.register(this.successHandler,this.errorHandler,{senderID:this.androidSenderID,ecb:"_oldPush.notificationHandler.onNotification"}):console.warn("offline: not attempting to register push notifications")},onRegistered:function(e){push.deviceId=e},onNotification:function(e){var i=new CustomEvent("pushNotificationsOnReceived",{detail:e});switch(document.dispatchEvent(i),e.event){case"registered":0<e.regid.length&&this.onRegistered(e.regid);break;case"message":push.decrementBadge(),e.foreground||e.coldstart;var t={};"social"==e.payload.messageType?t.buttons=["Dismiss"]:t.buttons=["Dismiss","Show Details"],push.displayMessage(e.payload,t);break;case"error":console.error("An error occurred: "+e.msg);break;default:console.error("EVENT -> Unknown, an event was received and we do not know what it is")}},successHandler:function(e){},errorHandler:function(e){console.error("error:"+e)}},pushiOSNotificationHandler.prototype={onRegistered:function(e){push.deviceId=e},register:function(){if(navigator.onLine)try{this.pushNotification.register(this.onRegistered,this.errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"_oldPush.notificationHandler.onNotification"})}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}else console.warn("offline: not attempting to register push notifications")},onNotification:function(e){var i=new CustomEvent("pushNotificationsOnReceived",{detail:e});if(document.dispatchEvent(i),e){var t={};"social"==e.messageType?t.buttons=["Dismiss"]:t.buttons=["Dismiss","Show Details"],e.alert&&(push.decrementBadge(),push.displayMessage(e,t))}else window.location.hash="/pushHistory";e.sound},tokenHandler:function(e){push.deviceId=e},successHandler:function(e){this.onRegistered(e)},errorHandler:function(e){console.error("ios error:"+e)}},bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){window.plugins&&window.plugins.pushNotification?(console.log("running old plugin for push notification"),_oldPush.init()):(console.log("running new plugin phonegap-plugin-push"),push.init())}),window.testNotification=function(){push.displayMessage({message:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />",title:"Notification Title",alert:"This is the alert, not sure what it means",messageType:null,additionalData:{notificationId:"5b5f9bbe39003904daa4f093",coldstart:!0,foreground:!0}},{buttons:["Dismiss","Show Details"]})};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function t(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var BleCentralAPI=function(){function e(){if(_classCallCheck(this,e),this.mockMode=void 0===window.ble,this.mockMode)return console.warn("mock bleCentral interaction");this.ble=window.ble}return _createClass(e,[{key:"onDeviceDiscovered",value:function(e){var n=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceDiscovered",e,null);postMaster.broadcast(n)}},{key:"onDeviceConnected",value:function(e){var n=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceConnected",e,null);postMaster.broadcast(n)}},{key:"onDeviceDisconnected",value:function(e){var n=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceDisconnected",e,null);postMaster.broadcast(n)}},{key:"onNotification",value:function(e){var n=new Packet(null,"services.bluetooth.bleCentral.triggerOnNotification",e,null);postMaster.broadcast(n)}},{key:"onStateNotification",value:function(e){var n=new Packet(null,"services.bluetooth.bleCentral.triggerOnStateNotification",e,null);postMaster.broadcast(n)}},{key:"scan",value:function(n,r){var t=this;if(this.mockMode)return console.warn("bleCentral mock scan!");n||(n={}),n.services||(n.services=[]),n.seconds||(n.seconds=5),permissionRequestsAPI.queueRequest("background_location",this,function(){var e=1e3*n.seconds;setTimeout(function(){r&&r(null,{status:"complete"})},e),t.ble&&t.ble.scan(n.services,n.seconds,t.onDeviceDiscovered,function(e){(r||console.error)(e)})})}},{key:"startScan",value:function(e,n){var r=this;if(this.mockMode)return console.warn("bleCentral mock startScan!");e||(e={}),e.services||(e.services=[]),permissionRequestsAPI.queueRequest("background_location",this,function(){r.ble&&r.ble.startScan(e.services,r.onDeviceDiscovered,function(e){(n||console.error)(e)})})}},{key:"startScanWithOptions",value:function(n,r){var t=this;if(this.mockMode)return console.warn("bleCentral mock startScanWithOptions!");n||(n={}),n.services||(n.services=[]),n.reportDuplicates||(n.reportDuplicates=!1),permissionRequestsAPI.queueRequest("background_location",this,function(){var e={reportDuplicates:n.reportDuplicates};t.ble&&t.ble.startScanWithOptions(n.services,e,t.onDeviceDiscovered,function(e){(r||console.error)(e)})})}},{key:"stopScan",value:function(n){if(this.mockMode)return console.warn("bleCentral mock stopScan!");this.ble&&this.ble.stopScan(function(){n&&n(null,!0)},function(e){n&&n(e,null)})}},{key:"connect",value:function(e,n){var r=this;if(!e||!e.device_id){var t=new Error("No device_id provided to bleCentral.connect!");return(n||console.error)(t)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.connect(e.device_id,function(e){n&&n(null,e),r.onDeviceConnected(e)},function(e){r.onDeviceDisconnected(e)})}},{key:"autoConnect",value:function(e,n){var r=this;if(!e||!e.device_id){var t=new Error("No device_id provided to bleCentral.autoConnect!");return(n||console.error)(t)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.autoConnect(e.device_id,function(e){r.onDeviceConnected(e)},function(e){r.onDeviceDisonnected(e)})}},{key:"disconnect",value:function(e,n){var r=this;if(!e||!e.device_id){var t=new Error("No device_id provided to bleCentral.disconnect!");return(n||console.error)(t)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.disconnect(e.device_id,function(e){n&&n(null,e),r.onDeviceDisconnected(e)},function(e){n&&n(e,null)})}},{key:"connectedPeripheralsWithServices",value:function(e,n){if(!n){var r=new Error("No callback provided to bleCentral.connectedPeripheralsWithServices!");return console.error(r)}if(!e||!e.services||!e.services.length){var t=new Error("No services provided to bleCentral.connectedPeripheralsWithServices!");return n(t,null)}if(this.mockMode)return console.warn("bleCentral mock connectedPeripheralsWithServices!"),n(null,[]);this.ble&&this.ble.connectedPeripheralsWithServices(e.services,function(e){n(null,e)},function(e){n(e,null)})}},{key:"peripheralsWithIdentifiers",value:function(e,n){if(!n){var r=new Error("No callback provided to bleCentral.peripheralsWithIdentifiers!");return console.error(r)}if(!e||!e.identifiers){var t=new Error("No identifiers provided to bleCentral.peripheralsWithIdentifiers!");return n(t,null)}if(this.mockMode)return console.warn("bleCentral mock peripheralsWithIdentifiers!"),n(null,[]);this.ble&&this.ble.connectedPeripheralsWithServices(e.services,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"read",value:function(e,r){var t=this;if("function"!=typeof r)return console.error(new Error("No callback provided to bleCentral.read!"));if(!e)return r(new Error("No options provided to bleCentral.read!"),null);var n=e.device_id,o=e.service_uuid,i=e.characteristic_uuid;if(!n||!o||!i){var l=new Error("Invalid device info provided to bleCentral.read: "+JSON.stringify(e));return(r||console.error)(l,null)}if(this.mockMode)return console.warn("bleCentral mock read!"),r(null,null);this.ble&&this.ble.read(n,o,i,function(e){try{var n=t.bufferToArray(e);r(null,n)}catch(e){r(e,null)}},function(e){r(e,null)})}},{key:"write",value:function(e,n){if(!e){var r=new Error("No options provided to bleCentral.write!");return(n||console.error)(r,null)}var t=e.device_id,o=e.service_uuid,i=e.characteristic_uuid,l=e.data;if(!t||!o||!i){var c=new Error("Invalid device info provided to bleCentral.write: "+JSON.stringify(e));return(n||console.error)(c,null)}if("object"!==(void 0===l?"undefined":_typeof(l))||"number"!=typeof l.length){var a=new Error("Invalid data provided to bleCentral.write: Must be an array!",l);return(n||console.error)(a,null)}if(this.mockMode)return console.warn("bleCentral mock write!"),void(n&&n(null,null));var s=null;try{s=this.arrayToBuffer(l)}catch(r){return(n||console.error)(r,null)}this.ble&&this.ble.write(e.device_id,e.service_uuid,e.characteristic_uuid,s,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"writeWithoutResponse",value:function(e,n){if(!e){var r=new Error("No options provided to bleCentral.writeWithoutResponse!");return(n||console.error)(r,null)}var t=e.device_id,o=e.service_uuid,i=e.characteristic_uuid,l=e.data;if(!t||!o||!i){var c=new Error("Invalid device info provided to bleCentral.writeWithoutResponse: "+JSON.stringify(e));return(n||console.error)(c,null)}if("object"!==(void 0===l?"undefined":_typeof(l))||"number"!=typeof l.length){var a=new Error("Invalid data provided to bleCentral.writeWithoutResponse: Must be an array!",l);return(n||console.error)(a,null)}if(this.mockMode)return console.warn("bleCentral mock writeWithoutResponse!"),void(n&&n(null,null));var s=null;try{s=this.arrayToBuffer(l)}catch(r){return(n||console.error)(r,null)}this.ble&&this.ble.writeWithoutResponse(t,o,i,s,function(){n&&n(null)},function(e){n&&n(e)})}},{key:"readRSSI",value:function(e,n){if(!e||!e.device_id){var r=new Error("No device_id provided to bleCentral.readRSSI!");return(n||console.error)(r,null)}if(this.mockMode)return console.warn("bleCentral mock readRSSI!"),void(n&&n(null,null));this.ble&&this.ble.readRSSI(e.device_id,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"startNotification",value:function(e,n){var t=this;if(!e){var r=new Error("No options provided to bleCentral.startNotification!");return(n||console.error)(r)}var o=e.device_id,i=e.service_uuid,l=e.characteristic_uuid;if(!o||!i||!l){var c=new Error("Invalid device info provided to bleCentral.startNotification: "+JSON.stringify(e));return(n||console.error)(c)}if(this.mockMode)return console.warn("bleCentral mock startNotification!"),void(n&&n(null));this.ble&&this.ble.startNotification(o,i,l,function(e){try{var n=t.bufferToArray(e),r={device_id:o,service_uuid:i,characteristic_uuid:l,data:n};t.onNotification(r)}catch(e){console.error(e)}},function(e){n&&n(e)})}},{key:"stopNotification",value:function(e,n){if(!e){var r=new Error("No options provided to bleCentral.stopNotification!");return(n||console.error)(r)}var t=e.device_id,o=e.service_uuid,i=e.characteristic_uuid;if(!t||!o||!i){var l=new Error("Invalid device info provided to bleCentral.stopNotification: "+JSON.stringify(e));return(n||console.error)(l)}if(this.mockMode)return console.warn("bleCentral mock stopNotification!"),void(n&&n(null));this.ble&&this.ble.stopNotification(t,o,i,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"startStateNotifications",value:function(n){if(this.mockMode)return console.warn("bleCentral mock startStateNotifications!"),void(n&&n(null,null));this.ble&&this.ble.startStateNotifications(function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"stopStateNotifications",value:function(n){if(this.mockMode)return console.warn("bleCentral mock stopStateNotifications!"),void(n&&n(null,null));this.ble&&this.ble.stopStateNotifications(function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"isConnected",value:function(e,n){if(!n)return console.error(new Error("No callback provided to bleCentral.isConnected!"));if(!e||!e.device_id){var r=new Error("No device_id provided to bleCentral.isConnected!");return n(r,null)}if(this.mockMode)return console.warn("bleCentral mock isConnected!"),n(null,null);this.ble&&this.ble.isConnected(e.device_id,function(e){n(null,e)},function(e){n(e,null)})}},{key:"isEnabled",value:function(e){if(!e)return console.error(new Error("No callback provided to bleCentral.isEnabled!"));if(this.mockMode)return console.warn("bleCentral mock isEnabled!"),e(null,null);this.ble&&this.ble.isEnabled(function(){e(null,!0)},function(){e(null,!1)})}},{key:"isLocationEnabled",value:function(n){if(this.mockMode)return console.warn("bleCentral mock isLocationEnabled!"),void(n&&n(null,null));this.ble&&this.ble.isLocationEnabled(function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"showBluetoothSettings",value:function(n){if(bfUtils.isIOS)return(n||console.warn)("bleCentral.showBluetoothSettings is not available on iOS!");if(this.mockMode)return console.warn("bleCentral mock showBluetoothSettings!"),void(n&&n(null));this.ble&&this.ble.showBluetoothSettings(function(){n&&n(null)},function(e){n&&n(e)})}},{key:"enable",value:function(n){if(bfUtils.isIOS)return(n||console.warn)("bleCentral.enable is not available on iOS!");if(this.mockMode)return console.warn("bleCentral mock enable!"),void(n&&n(null,null));this.ble&&this.ble.enable(function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"bondedDevices",value:function(n){if(!n)return console.error(new Error("No callback provided to bleCentral.bondedDevices!"));if(this.mockMode)return console.warn("bleCentral mock enable!"),n(null,null);this.ble&&this.ble.bondedDevices(function(e){n(null,e)},function(e){n(e,null)})}},{key:"requestMtu",value:function(e,n){if(!e||!e.device_id){var r=new Error("No device_id provided to bleCentral.requestMtu!");return(n||console.error)(r,null)}if(this.mockMode)return console.warn("bleCentral mock requestMtu!"),void(n&&n(null,null));e.mtu=e.mtu||100,this.ble&&this.ble.requestMtu(e.device_id,e.mtu,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"refreshDeviceCache",value:function(e,n){if(!e||!e.device_id){var r=new Error("No device_id provided to bleCentral.refreshDeviceCache!");return(n||console.error)(r,null)}if(this.mockMode)return console.warn("bleCentral mock refreshDeviceCache!"),void(n&&n(null,null));this.ble&&this.ble.refreshDeviceCache(e.device_id,e.timeoutMillis,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"bufferToArray",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Uint8";return this.arrayTypes[n]||(console.error("Invalid array type! Defaulting to Uint8Array."),n="Uint8"),Array.from(new this.arrayTypes[n](e))}},{key:"arrayToBuffer",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Uint8";return this.arrayTypes[n]||(console.error("Invalid array type! Defaulting to Uint8Array."),n="Uint8"),new this.arrayTypes[n](e).buffer}},{key:"arrayTypes",get:function(){return{Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array}}}]),e}();
"use strict";function ComponentUIAPI(e){this.context=e,this.DRAWER_UI_ID="bottomDrawerContainer",this.SNACKBAR_UI_ID="snackbarhero",this.timeOutId=null,this.init()}ComponentUIAPI.prototype={init:function(){this.openBottomDrawer=this.openDrawer},sanitize:function(e,i,n){window.bfUtils.sanitize({data:e},function(e,t){if(e)return n&&n(e,null),console.error(e);i.innerHTML+=t,n&&n(null,null)})},closeDrawer:function(e,t){e||(e={});var i=document.getElementById(this.DRAWER_UI_ID);i&&(this.scrollBooster&&(this.scrollBooster.destroy(),this.scrollBooster=null),e.force?i.remove():(i.classList.add("closing"),setTimeout(function(){i.remove()},300)))},openDrawer:function(r,o){var e=this;r||(r={});var c=this,a=!0,d=!1,u=[],m=[],h=r.multiSelection?"block":"none",p=[],b=null,v=null;r.isHTML=!1!==r.isHTML,r.multiSelectionActionButton=r.multiSelectionActionButton||{},r.multiSelectionActionButton.text=r.multiSelectionActionButton.text||"OK",r.multiSelectionActionButton.type=r.multiSelectionActionButton.type||"primary",r.allowSelectAll=!1!==r.allowSelectAll,r.enableFilter=!1!==r.enableFilter,r.autoUseImageCdn=!1!==r.autoUseImageCdn;var t=document.createElement("div");t.id=this.DRAWER_UI_ID,t.className="bottom-drawer-container",t.innerHTML='<div class="bottom-drawer-backdrop"></div><div class="bottom-drawer-holder"><div class="bottom-drawer backgroundColorTheme"></div></div>';var y=t.querySelector(".bottom-drawer");t.querySelector(".bottom-drawer-backdrop").onclick=function(){e.closeDrawer(),r.triggerCallbackOnUIDismiss&&o(null,null)},"undefined"!=typeof globalEvents&&(window.addEventListener(globalEvents.TABCHANGE.CONTENT,function(){e.closeDrawer()}),window.addEventListener(globalEvents.TABCHANGE.PURCHASE,function(){e.closeDrawer()}));var f=function(e){return a?-1<u.indexOf(e):-1===m.indexOf(e)};if(r.listItems&&r.listItems.forEach(function(e){e.selected&&u.push(e)}),r.header){var i=document.createElement("div");if(i.className="bottom-drawer-header titleBarBackgroundTheme",i.innerHTML='<div id="headerText" class="titleBarTextAndIcons"></div><div id="selectAllDiv" class="titleBarTextAndIcons">\n\t\t\t<span id="closeSearch" class="material-icons titleBarTextAndIcons">close</span>\n\t\t\t<div id="checkboxSelectAll" class="checkbox margin-top-zero">\n\t\t\t<input id="selectAllCheckbox" type="checkbox">\n\t\t\t<label style="padding:0" for="selectAllCheckbox"></label>\n\t\t    </div>\n\t\t\t<div id="drawerSearch" class="form-outline"><input type="search" class="form-control titleBarTextAndIcons" placeholder="Search" aria-label="Search" disabled></div>\n\t\t\t<span id="searchIcon" class="material-icons titleBarTextAndIcons">search</span>\n\t\t\t</div>',r.isHTML?this.sanitize(r.header,i.children[0]):i.children[0].innerText=r.header,r.multiSelection&&r.allowSelectAll){i.querySelector("#checkboxSelectAll").style.display="block";var n=i.querySelector("#selectAllCheckbox");n.onclick=function(){var e=y.querySelectorAll("input[type=checkbox]");if(a=!n.checked,u=[],m=[],n.checked){if(!r.listItems)return;u=r.listItems.slice(),k(r.listItems.length),e.forEach(function(e){e.checked=!0})}else u=[],k(),e.forEach(function(e){e.checked=!1})}}if(r.enableFilter){var s={},l=i.querySelector("#closeSearch"),S=i.querySelector("#searchIcon"),g=i.querySelector("#drawerSearch"),L=g.children[0];S.style.display="block",S.onclick=function(){g.classList.add("show-drawer-search"),g.classList.remove("hide-drawer-search"),L.disabled=!1,L.focus(),i.querySelector("#checkboxSelectAll").style.display="none",i.children[0].classList.add("hide-header-text"),i.children[0].classList.remove("show-header-text"),l.style.display="block"},l.onclick=function(){g.classList.add("hide-drawer-search"),g.classList.remove("show-drawer-search"),i.children[0].classList.remove("hide-header-text"),i.children[0].classList.add("show-header-text"),i.querySelector("#checkboxSelectAll").style.display=r.allowSelectAll&&r.multiSelection?"block":"none",i.children[0].style.display="block",l.style.display="none",g.children[0].value&&(T({target:{value:""}}),L.value=""),L.disabled=!0},L.onkeydown=function(e){var t=e.target;s&&clearTimeout(s),s=setTimeout(function(){return T({target:t})},500)}}y.appendChild(i)}window.stringResource&&r.header&&window.stringResource.getData().then(function(e){y.querySelector("#drawerSearch").children[0].placeholder=e.appSearch||"Search"});var T=function(e){var t=e.target;if(p&&b){var i=[],n=!0,s=!1,l=t.value,r=l?l.toLowerCase().split(/[\s-_():,/\\|]+/g):[];0<r.length?(i=p.filter(function(e){s=!(n=!0);var i=(e.text+" "+(e.secondaryText||"")).toLowerCase().split(/<[^>]+>|[\s-_():,/\\|]+/g);return r.forEach(function(t){t&&(i.forEach(function(e){e.startsWith(t)&&(s=!0)}),n=!(!s||!n),s=!1)}),n}),b.innerHTML="",b.scrollTop=0,w(i,b),_(i)):(b.innerHTML="",b.scrollTop=0,w(p,b),_(p))}};function k(e){var t=y.querySelector("#drawerButton");t.disabled=e?(y.querySelector("#buttonBadge").innerHTML=e,t.classList.remove("disabled-drawer-button"),!1):(y.querySelector("#buttonBadge").innerHTML="",t.classList.add("disabled-drawer-button"),!0)}function w(n,e){var s={};e?s=e:((s=document.createElement("ul")).classList.add("action-list"),s.onclick=function(e){for(var t=e.target;"LI"!==t.nodeName;){if("UL"===t.nodeName)return void console.log("Wrong Click");t=t.parentElement}if(r.multiSelection){var i=t.querySelector("input[type=checkbox]");"checkbox"!=e.target.type&&(i.checked=!i.checked),function(e,t){if(t){if(a)u.push(e);else{var i=m.indexOf(e);m.splice(i,1)}k(Number(y.querySelector("#buttonBadge").innerHTML)+1)}else{if(a){var n=u.indexOf(e);u.splice(n,1)}else m.push(e);k(Number(y.querySelector("#buttonBadge").innerHTML)-1)}}(t.item,i.checked)}else o(null,t.item)});var l=0;function t(){for(var e=l;e<l+50&&!(n.length-1<e);e++)if(n[e]&&n[e].text){var t=document.createElement("li"),i="";i=r.autoUseImageCdn&&n[e].imageUrl&&!n[e].imageUrl.includes("cloudimg.io")&&0===n[e].imageUrl.indexOf("http")?imageTools.cropImage(n[e].imageUrl,{size:"s",aspect:"1:1"}):n[e].imageUrl,t.innerHTML='<div class="item-icon">\n\t\t\t\t\t\t<img style="display:'+(i?"block":"none")+'" src="'+(i||"")+'" onerror="this.style.display=\'none\'"></div>\n\t\t\t\t\t\t<div class="action-item-texts">\n\t\t\t\t\t\t<div style="font-weight: bold"></div>\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="display: '+h+'; margin-left: auto" class="checkbox checkbox-primary margin-top-zero"><input type="checkbox"><label style="padding:0"></label></div>',r.isHTML?(c.sanitize(n[e].text,t.children[1].children[0]),c.sanitize(n[e].secondaryText,t.children[1].children[1])):(t.children[1].children[0].innerText=n[e].text,t.children[1].children[1].innerText=n[e].secondaryText||""),r.multiSelection&&(t.querySelector("input[type=checkbox]").checked=f(n[e])||!1),t.item=n[e],s.appendChild(t)}l+=50,console.log("Load Other Items")}if(v&&s.removeEventListener("scroll",v),v=function(){s.scrollTop+s.clientHeight+1e3>=s.scrollHeight&&t()},s.addEventListener("scroll",v),t(),!e){for(var i=0;i<n.length;i++)if(n[i].imageUrl){d=!0;break}return d&&s.classList.add("has-images"),s}}if(r.content){var I=document.createElement("div");I.className="drawer-content",r.listItems||r.tabs||I.classList.add("scrollable-content"),r.isHTML?this.sanitize(r.content,I,function(){r.onContentRender&&setTimeout(function(){r.onContentRender()},0)}):I.innerText=r.content,y.appendChild(I)}if(r.listItems)p=r.listItems,b=w(r.listItems),y.appendChild(b);else if(r.tabs&&!r.multiSelection){var x=document.createElement("div");x.className="md-tabs-scroll";var B=document.createElement("div");B.classList.add("md-tabs");for(var A=0;A<r.tabs.length;A++){var q=document.createElement("div"),E=document.createElement("div");E.classList.add("active-indicator","titleBarBackgroundTheme"),q.classList.add("btn-tab-drawer-"+A,"md-tab"),0===A&&q.classList.add("active"),r.isHTML?this.sanitize(r.tabs[A].text,q):q.innerText=r.tabs[A].text,q.appendChild(E),B.appendChild(q)}x.appendChild(B);var C=0,M=[],D=x.querySelectorAll(".md-tab");D.forEach(function(t){t.setAttribute("data-tabindex",C),t.onclick=function(){D.forEach(function(e){e.classList.remove("active")}),t.classList.add("active");var e=t.getAttribute("data-tabindex");M.forEach(function(e){e.classList.add("hide")}),M[e].classList.remove("hide"),M[e].items?(p=M[e].items,b=M[e],r.header&&T({target:{value:document.querySelector("#drawerSearch").children[0].value}})):(b=p=null,y.querySelector(".empty-items")&&(y.querySelector(".empty-items").style.display="none"))},C++}),y.appendChild(x);for(var H=0;H<r.tabs.length;H++){if(r.tabs[H].listItems){var U=w(r.tabs[H].listItems);U.items=r.tabs[H].listItems,0===H&&(p=r.tabs[H].listItems,b=U),M.push(U)}else{var N=document.createElement("div");N.className="drawer-content",r.isHTML?this.sanitize(r.tabs[H].content,N):N.innerText=r.tabs[H].content,M.push(N)}0<H&&M[H].classList.add("hide"),y.appendChild(M[M.length-1])}}function _(e){if(!y.querySelector(".empty-items")){var t=document.createElement("IMG");t.src=window._appRoot+"media/ic_bookmark_empty.svg",t.classList.add("empty-items"),y.appendChild(t)}e&&0===e.length?y.querySelector(".empty-items").style.display="block":y.querySelector(".empty-items").style.display="none"}if((r.listItems||r.tabs&&r.tabs[0]&&r.tabs[0].listItems)&&_(r.listItems||r.tabs&&r.tabs[0]&&r.tabs[0].listItems),r.multiSelection){var O=document.createElement("DIV");O.id="drawerButtonDiv";var R=document.createElement("BUTTON");R.id="drawerButton",R.type="button",R.classList.add("btn","btn-"+r.multiSelectionActionButton.type),R.innerHTML='<span class="btn-'+r.multiSelectionActionButton.type+'"></span><span id="buttonBadge" class="badge btn-'+r.multiSelectionActionButton.type+'"></span>',r.isHTML?this.sanitize(r.multiSelectionActionButton.text,R.children[0]):R.children[0].innerText=r.multiSelectionActionButton.text,O.appendChild(R),y.appendChild(O),y.querySelector("#drawerButton").onclick=function(){e.closeDrawer(),o(null,(a||m.forEach(function(e){var t=u.indexOf(e);u.splice(t,1)}),u))},k(u.length)}this.closeDrawer({force:!0}),(document.getElementById("appBody")||document.getElementById("app")).appendChild(t),!r.tabs||r.multiSelection||r.listItems||setTimeout(function(){e.scrollBooster=new ScrollBooster({viewport:t.querySelector(".md-tabs-scroll"),content:t.querySelector(".md-tabs"),scrollMode:"native",direction:"horizontal"}),setTimeout(function(){e.scrollBooster&&e.scrollBooster.updateMetrics()},1e3),setTimeout(function(){e.scrollBooster&&e.scrollBooster.updateMetrics()},3e3)},0)},showToastMessage:function(e,t){var i=this;e||(e={});var n=document.getElementById(this.SNACKBAR_UI_ID);n.querySelector(".snackbar-message").innerText=e.text;var s=n.querySelector(".snackbar");e.type||(e.type="info"),s.className="snackbar "+e.type+"BackgroundTheme";var l=n.querySelector(".snackbar-actions"),r=l.querySelector(".snackbar-action");e.action&&e.action.title?(r.querySelector("span").innerText=e.action.title,r.classList.remove("hide"),r.onclick=function(){t&&t(null,e.action)}):r.classList.add("hide"),e.hideDismiss?l.querySelector(".dismiss").classList.add("hide"):(l.querySelector(".dismiss").classList.remove("hide"),l.querySelector(".dismiss").onclick=function(){i.closeToastMessage({force:!0})}),n.classList.remove("hide"),n.querySelector(".snackbar").classList.add("open"),this.closeToastMessage(e)},closeToastMessage:function(e,t){e||(e={}),e.duration||(e.duration=8e3);var i=document.getElementById(this.SNACKBAR_UI_ID);e.force?(i.querySelector(".snackbar").classList.remove("closing"),i.querySelector(".snackbar").classList.remove("open"),setTimeout(function(){i.classList.add("hide")},250)):(i.querySelector(".snackbar").classList.add("closing"),this.timeOutId&&clearTimeout(this.timeOutId),this.timeOutId=setTimeout(function(){i.querySelector(".snackbar").classList.remove("closing"),i.querySelector(".snackbar").classList.remove("open"),setTimeout(function(){i.classList.add("hide")},250),this.timeOutId=null},e.duration))}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},imageTools={get ENUMS(){return{SIZES:{xxs:32,xs:64,s:128,m:200,l:304,xl:416,xxl:600,720:720,1080:1080,1440:1440,1920:1920,2560:2560,3840:3840,get full_width(){return this.findNearest(1)},get half_width(){return this.findNearest(2)},get third_width(){return this.findNearest(3)},get fourth_width(){return this.findNearest(4)},get fifth_width(){return this.findNearest(5)},get sixth_width(){return this.findNearest(6)},findNearest:function(i){for(var t=null,e=0;e<this.VALID_SIZES.length;e++){var n=this.VALID_SIZES[e];if(window.innerWidth/i<this[n]){t=n;break}}return this[t]},VALID_SIZES:["xxs","xs","s","m","l","xl","xxl","720","1080","1440","1920","2560","3840","full_width","half_width","third_width","quarter_width","fifth_width","sixth_width"]},ASPECT_RATIOS:{"1:1":1,"4:3":.75,"16:9":.5625,"9:16":1.77777778,"11:5":.45454545,"4:1":.25,"2.39:1":.41841004,VALID_RATIOS:["1:1","4:3","16:9","9:16","11:5","4:1","2.39:1"]}}},resizeImage:function(i,t,e,n){if(!i)return null;if(i&&i.indexOf&&(-1<i.indexOf("://localhost:")||-1<i.indexOf("cdvfile://")))return i;if(/\..{3,4}(?!.)/g.test(i)&&!/.(png|jpg|jpeg)(?!.)/gi.test(i)){var r=(/.{0,4}(?!.)/g.exec(i)||["Selected"])[0];return console.warn(r+" files are not supported by resizeImage. Returning original URL: "+i),i}if(t){if("object"!=(void 0===t?"undefined":_typeof(t)))throw"options not an object"}else t={width:window.innerWidth};if((o=t.disablePixelRation?1:window.devicePixelRatio)<1)var o=1;"full"==t.width&&(t.width=window.innerWidth),"full"==t.height&&(t.height=window.innerHeight);var a=window.siteConfig.endPoints.cloudImageHost,h=-1!==i.indexOf("?"),s=a+"/"+i+(h?"&":"?")+"func=bound";if(t.size&&t.aspect){if(this.ENUMS.SIZES.VALID_SIZES.indexOf(t.size)<0){var l=this.ENUMS.SIZES.VALID_SIZES.join(", ");return console.warn("Inavlid size. Availible options are "+l+". Returning original url"),i}if(this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.indexOf(t.aspect)<0){var d=this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.join(", ");return console.warn("Inavlid aspect ratio. Availible options are "+d+". Returning original url"),i}t.width=this.ENUMS.SIZES[t.size],t.height=t.width*this.ENUMS.ASPECT_RATIOS[t.aspect]}if(t.width&&!t.height)s+="&width="+Math.floor(t.width*o);else if(!t.width&&t.height){s+="&height="+Math.floor(t.height*o)}else if(t.width&&t.height){s+="&width="+Math.floor(t.width*o)+"&height="+Math.floor(t.height*o)}else s=i;return this._handleElement(e,s,n),s},cropImage:function(i,t,e,n){if(!i)return null;if(i&&i.indexOf&&(-1<i.indexOf("://localhost:")||-1<i.indexOf("cdvfile://")))return i;if(/\..{3,4}(?!.)/g.test(i)&&!/.(png|jpg|jpeg)(?!.)/gi.test(i)){var r=(/.{0,4}(?!.)/g.exec(i)||["Selected"])[0];return console.warn(r+" files are not supported by cropImage. Returning original URL: "+i),i}if(t||(t={}),"object"!=(void 0===t?"undefined":_typeof(t)))throw"options not an object";if(t.size&&t.aspect){if(this.ENUMS.SIZES.VALID_SIZES.indexOf(t.size)<0){var o=this.ENUMS.SIZES.VALID_SIZES.join(", ");return console.warn("Inavlid size. Availible options are "+o+". Returning original url"),i}if(this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.indexOf(t.aspect)<0){var a=this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.join(", ");return console.warn("Inavlid aspect ratio. Availible options are "+a+". Returning original url"),i}t.width=this.ENUMS.SIZES[t.size],t.height=t.width*this.ENUMS.ASPECT_RATIOS[t.aspect]}if(t.width||t.height||(t={width:"full",height:"full"}),"full"==t.width&&(t.width=window.innerWidth),"full"==t.height&&(t.height=window.innerHeight),!t.width||!t.height)return console.warn("cropImage doenst have width or height please fix. returning original url"),i+"?h="+t.height+"&w="+t.width;var h=window.devicePixelRatio;t&&t.disablePixelRatio&&(h=t.disablePixelRatio);var s=window.siteConfig.endPoints.cloudImageHost,l=-1!==i.indexOf("?"),d=s+"/"+i+(l?"&":"?")+"func=crop";return d+="&width="+Math.floor(t.width*h)+"&height="+Math.floor(t.height*h),this._handleElement(e,d,n),d},_handleElement:function(e,n,i){if(e&&n){var t=this._getLocalPath(n);"IMG"===e.tagName?(e.style.setProperty("opacity","0","important"),e.src=t,e.onload=function(){e.style.removeProperty("opacity"),i&&i(t)},e.onerror=function(){bfUtils.isAppHtml5Version||imageCacheAPI.download(n,function(i,t){if(i)return e.src=n;e.src=t})}):this._handleBgImage(e,t,n,i)}},_handleBgImage:function(e,i,n,r){o(e,i);var t=new Image;function o(i,t){if(!t)return i.style.removeProperty("background-image");var e='url("'+t+'")';i.style.setProperty("background-image",e,"important")}t.src=i,t.onload=function(){r&&r(i)},t.onerror=function(){if(o(e),bfUtils.isAppHtml5Version)return o(e,n);imageCacheAPI.download(n,function(i,t){if(i)return r&&r(n),o(e,n);window.requestAnimationFrame(function(){o(e,t),r&&r(t)})})}},_getLocalPath:function(i){if(bfUtils.isAppHtml5Version)return i;var t=(i=i.replace(/(http|https):\/\/\S{0,8}.cloudimg.io\//g,"")).match(/(png|jpg|jpeg)/g)[0]||"";t=t?"."+t:"";var e=0;if(!i.length)return e;for(var n=0;n<i.length;n++){e=(e<<5)-e+i.charCodeAt(n),e|=0}return"cdvfile://localhost/persistent/imageCache/images/"+e+t},isProdImageServer:function(i){return 0==i.indexOf("http://imageserver.prod.s3.amazonaws.com")||0==i.indexOf("https://imageserver.prod.s3.amazonaws.com")||0==i.indexOf("https://s3-us-west-2.amazonaws.com/imageserver.prod")}};
"use strict";function DialogAPI(t){this.context=t,this.componentUI=null}DialogAPI.prototype={loadXSSLibrary:function(t){if("undefined"==typeof filterXSS){var e=document.createElement("script");"sdk"==window.siteConfig.scope?e.src="scripts/lib/xss.min.js":window._appRoot?e.src=window._appRoot+"scripts/lib/xss/xss.min.js":e.src="/app/scripts/lib/xss/xss.min.js",e.type="text/javascript",e.onload=function(){t&&t()},document.getElementsByTagName("head")[0].appendChild(e)}else t&&t()},sanitizeMessage:function(t){return filterXSS(t)},confirm:function(t,e){var n=this;return this.loadXSSLibrary(function(){return n._confirm(t,e)})},_confirm:function(n,s){if(n||(n={}),n.message){n.title||(n.title="Are you sure?"),n.confirmButton||(n.confirmButton={text:"Confirm"}),n.cancelButtonText||(n.cancelButtonText="Cancel"),n.isMessageHTML?n.message=this.sanitizeMessage(n.message):n.isMessageHTML=!1;var t={title:n.title,subtitle:n.subtitle,richContent:""+n.message,isContentHTML:n.isMessageHTML,action:{title:n.confirmButton.text,type:n.confirmButton.type||"primary"},dismissButtonText:n.cancelButtonText,forceAction:!0};richModal.display(t,function(t,e){if(s)return t?s(t):e&&e.selectedButton?e.selectedButton.text==n.confirmButton.text?s(null,!0):s(null,!1):e&&"action"===e.buttonType?s(null,!0):s(null,!1)})}else s("invalid parameter, missing message",null)},alert:function(t,e){var n=this;return this.loadXSSLibrary(function(){return n._alert(t,e)})},_alert:function(t,e){if(t||(t={}),t.message){t.title||(t.title="Alert"),t.okButtonText||(t.okButtonText="OK"),t.isMessageHTML?t.message=this.sanitizeMessage(t.message):t.isMessageHTML=!1;var n={title:t.title,subtitle:t.subtitle,richContent:""+t.message,isContentHTML:t.isMessageHTML,action:{title:t.okButtonText,type:"primary"},showDismissButton:!1};richModal.display(n,function(t){return e(t)})}else e("invalid parameter, missing message",null)},show:function(t,e){var n=this;return this.loadXSSLibrary(function(){return n._show(t,e)})},_show:function(t,s){if(t||(t={}),t.title){if(!t.actionButtons||!t.actionButtons.length)return s("`actionButtons` are required",null);if(t.message||(t.message=""),t.cancelButtonText||(t.cancelButtonText="Cancel"),t.isMessageHTML?t.message=this.sanitizeMessage(t.message):t.isMessageHTML=!1,t.design&&t.design.backgroundColor&&!t.design.textColor)return s("'textColor' is required when 'backgroundColor' is present",null);if(t.design&&t.design.textColor&&!t.design.backgroundColor)return s("'backgroundColor' is required when 'textColor' is present",null);var e={title:t.title,subtitle:t.subtitle,richContent:""+t.message,action:t.actionButtons.map(function(t){var e=t.text,n=t.type;return{title:e,handler:function(){s(null,{selectedButton:{text:e,type:n}})},type:n}}),showDismissButton:t.showCancelButton,dismissButtonText:t.cancelButtonText||"Cancel",forceAction:t.forceAction,design:t.design,isContentHTML:t.isMessageHTML};richModal.display(e,function(t,e){return t?s(t):(e&&"dismiss"===e.buttonType&&(e.buttonType="cancel"),e&&e.value&&(e.value={text:e.value.title,action:e.value.handler}),s(null,e))})}else s("invalid parameter, missing title",null)},hide:function(){richModal.close()},toast:function(t,n){var s=this;if(this.componentUI||(this.componentUI=new ComponentUIAPI(this.context)),t||(t={}),t.message&&(t.message=t.message.trim()),t.message){var e={text:t.message,hideDismiss:t.hideDismissButton,duration:t.duration,type:t.type};t.actionButton&&(e.action={title:t.actionButton.text,action:t.actionButton.action}),this.componentUI.showToastMessage(e,function(t,e){return t?n(t):(e&&e.action&&"function"==typeof e.action&&(e.action(),s.componentUI.closeToastMessage({force:!0})),n(t,e))})}else n("invalid parameter, missing message",null)}};
"use strict";var permissionRequestsAPI={appId:"guest",init:function(){var i=permissionRequestsAPI;appContext&&appContext.currentApp&&appContext.currentApp.appId&&(i.appId=window.appContext.currentApp.appId),bfUtils.isAndroid&&(i.ds=new DatastoreAPI(i.appId,"stringResources",1,0,appContext.currentApp.keys.datastoreKey),i.ds.get({},function(e,t){if(e)return console.error(e);t&&t.data&&t.data.appPermissions?i.appPermissionStrings=t.data.appPermissions:localStorage.getItem("geo-declaration-required")&&(i.appPermissionStrings.background_location={android:{title:"App would like to use Background Location",content:"This app collects location data to enable showing your position on the map, getting directions, estimating travel times and other location based features even when the app is closed or not in use",actionBtn:"OK",isActive:!0}})}))},appPermissionStrings:{},showPermissionDelcaration:function(e){var t=this,i=this.appPermissionStrings[e].android,n=i.title,s=i.content,o=i.actionBtn;richModal.display({title:n,richContent:s,showDismissButton:!1,forceAction:!0,action:{title:o,handler:function(){t.setDeclarationShown(e),t.executeQueuedRequests(e)}}})},shouldShowDeclaration:function(e){if(!bfUtils.isAndroid)return!1;if(this.declarationTypes.indexOf(e)<0)return!1;if(!this.appPermissionStrings||!this.appPermissionStrings[e]||!this.appPermissionStrings[e].android)return!1;var t=this.declarationShown(e),i=this.appPermissionStrings[e].android.isActive;return!t&&i},declarationShown:function(e){if(this.declarationTypes.indexOf(e)<0)return!1;var t=this.ENUMS[e].APP_DECLARATION_SHOWN;return localStorage.getItem(""+this.appId+t)},setDeclarationShown:function(e){var t=this.ENUMS[e].APP_DECLARATION_SHOWN;return localStorage.setItem(""+this.appId+t,!0),"background_location"===e?this.setDeclarationShown("location"):"camera"===e?this.setDeclarationShown("photo_library"):void 0},queueMap:{},queueRequest:function(e,t,i){if(!this.shouldShowDeclaration(e))return this.executeRequest(t,i);this.queueMap[e]=this.queueMap[e]||[],this.queueMap[e].push({context:t,method:i}),this.queueMap[e]&&1===this.queueMap[e].length&&this.showPermissionDelcaration(e)},executeRequest:function(e,t){t.apply(e)},executeQueuedRequests:function(e){var n=this;(this.queueMap[e]||[]).forEach(function(e){var t=e.context,i=e.method;n.executeRequest(t,i)}),this.queueMap[e]=[]},get declarationTypes(){return Object.keys(this.ENUMS)},get ENUMS(){return{background_location:{APP_DECLARATION_SHOWN:"-geo-location-perm-request"},location:{APP_DECLARATION_SHOWN:"-location-perm-request"},camera:{APP_DECLARATION_SHOWN:"-camera-perm-request"},calendar:{APP_DECLARATION_SHOWN:"-calendar-perm-request"},photo_library:{APP_DECLARATION_SHOWN:"-photo_lib-perm-request"}}}};bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},permissionRequestsAPI.init);