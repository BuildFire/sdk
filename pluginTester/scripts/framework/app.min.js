"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var postMaster={controlPluginAPI:null,widgetPluginAPI:null,launcherPluginAPI:null,servicePluginAPIs:{},postMessageHandler:function(e){if(e.data){if("object"==_typeof(e.data))e.packet=e.data;else try{e.packet=JSON.parse(e.data)}catch(t){return void console.log("!! Post Master:: Ignore Invalid packet",t,e.data)}postMaster._acceptRequest(e)}},_acceptRequest:function(t){if(t&&t.packet&&t.packet.cmd){var e=!1,e=s(postMaster.widgetPluginAPI,t);if(!e&&!(e=postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI?s(postMaster.launcherPluginAPI,t):e)&&!(e=s(postMaster.controlPluginAPI,t))){for(var n in postMaster.servicePluginAPIs)if(e=s(postMaster.servicePluginAPIs[n],t))return;e||console.warn("no home for this packet (sad face) ")}}function s(t,e){if(!t||!t.postMessageHandler||!e)return!1;try{return t.postMessageHandler(e)}catch(t){return console.error("postMessageHandler error:",t),!1}}},broadcast:function(e,n){function t(t){t&&(n&&t.context.instanceId!=n||t.sendMessage(null,e))}for(var s in t(postMaster.controlPluginAPI),postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI&&t(postMaster.widgetPluginAPI),postMaster.launcherPluginAPI&&postMaster.widgetPluginAPI==postMaster.launcherPluginAPI&&(e.fid=postMaster.launcherPluginAPI.iFrameId),postMaster.launcherPluginAPI&&t(postMaster.launcherPluginAPI),postMaster.servicePluginAPIs)t(postMaster.servicePluginAPIs[s])},attachService:function(t,e){this.servicePluginAPIs[t]=e},dettachService:function(t){delete this.servicePluginAPIs[t]},isLauncherPluginActive:function(){return-1<["","#/","#"].indexOf(window.location.hash)},isWidgetPluginInactive:function(){return null==postMaster.widgetPluginAPI||postMaster.widgetPluginAPI==postMaster.launcherPluginAPI},isPageActive:function(){return!this.isLauncherPluginActive()&&(window.location.href.indexOf("#/pluginContainer")<0||this.isWidgetPluginInactive())}};window.addEventListener("message",postMaster.postMessageHandler,!1);
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,h,u){function s(t,e,i){return setTimeout(a(t,i),e)}function i(t,e,i){return Array.isArray(t)&&(r(t,i[e],i),1)}function r(t,e,i){if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==u)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(var n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function o(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)i&&t[n[r]]!==u||(t[n[r]]=e[n[r]]),r++;return t}function n(t,e){return o(t,e,!0)}function e(t,e,i){var n=e.prototype,e=t.prototype=Object.create(n);e.constructor=t,e._super=n,i&&o(e,i)}function a(t,e){return function(){return t.apply(e,arguments)}}function c(t,e){return _typeof(t)==J?t.apply(e&&e[0]||u,e):t}function l(t,e){return t===u?e:t}function p(e,t,i){r(m(t),function(t){e.addEventListener(t,i,!1)})}function f(e,t,i){r(m(t),function(t){e.removeEventListener(t,i,!1)})}function d(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function v(t,e){return-1<t.indexOf(e)}function m(t){return t.trim().split(/\s+/g)}function g(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function y(t){return Array.prototype.slice.call(t,0)}function T(t,i,e){for(var n=[],r=[],s=0;s<t.length;){var o=i?t[s][i]:t[s];g(r,o)<0&&n.push(t[s]),r[s]=o,s++}return n=e?i?n.sort(function(t,e){return t[i]>e[i]}):n.sort():n}function E(t,e){for(var i,n=e[0].toUpperCase()+e.slice(1),r=0;r<Z.length;){if((i=(i=Z[r])?i+n:e)in t)return i;r++}return u}function I(t){t=t.ownerDocument;return t.defaultView||t.parentWindow}function _(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){c(e.options.enable,[e])&&i.handler(t)},this.init()}function A(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,s=e&ht&&n-r==0,r=e&(at|ut)&&n-r==0;i.isFirst=!!s,i.isFinal=!!r,s&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=S(e)),1<r&&!i.firstMultiple?i.firstMultiple=S(e):1===r&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,h=(o||s).center,r=e.center=b(n);e.timeStamp=$(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=C(h,r),e.distance=w(h,r),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};e.eventType!==ht&&s.eventType!==at||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=D(e.deltaX,e.deltaY),e.scale=o?function(t,e){return w(e[0],e[1],Tt)/w(t[0],t[1],Tt)}(o.pointers,n):1,e.rotation=o?function(t,e){return C(e[1],e[0],Tt)-C(t[1],t[0],Tt)}(o.pointers,n):0,function(t,e){var i,n,r=t.lastInterval||e,s=e.timeStamp-r.timeStamp;{var o,h,a;e.eventType!=ut&&(ot<s||r.velocity===u)?(o=r.deltaX-e.deltaX,h=r.deltaY-e.deltaY,a=function(t,e,i){return{x:e/t||0,y:i/t||0}}(s,o,h),i=a.x,n=a.y,a=Q(a.x)>Q(a.y)?a.x:a.y,h=D(o,h),t.lastInterval=e):(a=r.velocity,i=r.velocityX,n=r.velocityY,h=r.direction)}e.velocity=a,e.velocityX=i,e.velocityY=n,e.direction=h}(i,e);t=t.element;d(e.srcEvent.target,t)&&(t=e.srcEvent.target),e.target=t}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function S(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:K(t.pointers[i].clientX),clientY:K(t.pointers[i].clientY)},i++;return{timeStamp:$(),pointers:e,center:b(e),deltaX:t.deltaX,deltaY:t.deltaY}}function b(t){var e=t.length;if(1===e)return{x:K(t[0].clientX),y:K(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:K(i/e),y:K(n/e)}}function D(t,e){return t===e?ct:Q(t)>=Q(e)?0<t?lt:pt:0<e?ft:dt}function w(t,e,i){var n=e[(i=i||yt)[0]]-t[i[0]],i=e[i[1]]-t[i[1]];return Math.sqrt(n*n+i*i)}function C(t,e,i){var n=e[(i=i||yt)[0]]-t[i[0]],i=e[i[1]]-t[i[1]];return 180*Math.atan2(i,n)/Math.PI}function R(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.allow=!0,this.pressed=!1,_.apply(this,arguments)}function z(){this.evEl=At,this.evWin=St,_.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,_.apply(this,arguments)}function P(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},_.apply(this,arguments)}function M(){_.apply(this,arguments);var t=a(this.handler,this);this.touch=new P(this.manager,t),this.mouse=new R(this.manager,t)}function O(t,e){this.manager=t,this.set(e)}function x(t){this.id=tt++,this.manager=null,this.options=n(t||{},this.defaults),this.options.enable=l(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function X(t){return t==dt?"down":t==ft?"up":t==lt?"left":t==pt?"right":""}function Y(t,e){e=e.manager;return e?e.get(t):t}function F(){x.apply(this,arguments)}function W(){F.apply(this,arguments),this.pX=null,this.pY=null}function q(){F.apply(this,arguments)}function L(){x.apply(this,arguments),this._timer=null,this._input=null}function H(){F.apply(this,arguments)}function k(){F.apply(this,arguments)}function U(){x.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function G(t,e){return(e=e||{}).recognizers=l(e.recognizers,G.defaults.preset),new V(t,e)}function V(t,e){this.options=n(e=e||{},G.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=new((t=this).options.inputClass||(it?z:nt?P:et?M:R))(t,A),this.touchAction=new O(this,this.options.touchAction),j(this,!0),r(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function j(t,i){var n=t.element;r(t.options.cssProps,function(t,e){n.style[E(n.style,e)]=i?t:""})}var Z=["","webkit","moz","MS","ms","o"],B=h.createElement("div"),J="function",K=Math.round,Q=Math.abs,$=Date.now,tt=1,et="ontouchstart"in t,it=E(t,"PointerEvent")!==u,nt=et&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),rt="touch",st="mouse",ot=25,ht=1,at=4,ut=8,ct=1,lt=2,pt=4,ft=8,dt=16,vt=lt|pt,mt=ft|dt,gt=vt|mt,yt=["x","y"],Tt=["clientX","clientY"];_.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(I(this.element),this.evWin,this.domHandler)}};var Et={mousedown:ht,mousemove:2,mouseup:at};e(R,_,{handler:function(t){var e=Et[t.type];e&ht&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=at),this.pressed&&this.allow&&(e&at&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:st,srcEvent:t}))}});var It={pointerdown:ht,pointermove:2,pointerup:at,pointercancel:ut,pointerout:ut},_t={2:rt,3:"pen",4:st,5:"kinect"},At="pointerdown",St="pointermove pointerup pointercancel";t.MSPointerEvent&&(At="MSPointerDown",St="MSPointerMove MSPointerUp MSPointerCancel"),e(z,_,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=It[n],s=_t[t.pointerType]||t.pointerType,o=s==rt,n=g(e,t.pointerId,"pointerId");r&ht&&(0===t.button||o)?n<0&&(e.push(t),n=e.length-1):r&(at|ut)&&(i=!0),n<0||(e[n]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(n,1))}});var bt={touchstart:ht,touchmove:2,touchend:at,touchcancel:ut};e(N,_,{handler:function(t){var e,i=bt[t.type];i===ht&&(this.started=!0),this.started&&(e=function(t,e){var i=y(t.touches),t=y(t.changedTouches);return[i=e&(at|ut)?T(i.concat(t),"identifier",!0):i,t]}.call(this,t,i),i&(at|ut)&&e[0].length-e[1].length==0&&(this.started=!1),this.callback(this.manager,i,{pointers:e[0],changedPointers:e[1],pointerType:rt,srcEvent:t}))}});var Dt={touchstart:ht,touchmove:2,touchend:at,touchcancel:ut};e(P,_,{handler:function(t){var e=Dt[t.type],i=function(t,e){var i=y(t.touches),n=this.targetIds;if(e&(2|ht)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s=y(t.changedTouches),o=[],h=this.target,a=i.filter(function(t){return d(t.target,h)});if(e===ht)for(r=0;r<a.length;)n[a[r].identifier]=!0,r++;for(r=0;r<s.length;)n[s[r].identifier]&&o.push(s[r]),e&(at|ut)&&delete n[s[r].identifier],r++;return o.length?[T(a.concat(o),"identifier",!0),o]:void 0}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:rt,srcEvent:t})}}),e(M,_,{handler:function(t,e,i){var n=i.pointerType==rt,r=i.pointerType==st;if(n)this.mouse.allow=!1;else if(r&&!this.mouse.allow)return;e&(at|ut)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var wt=E(B.style,"touchAction"),Ct=wt!==u,Rt="compute",zt="manipulation",Nt="none",Pt="pan-x",Mt="pan-y";O.prototype={set:function(t){t==Rt&&(t=this.compute()),Ct&&(this.manager.element.style[wt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return r(this.manager.recognizers,function(t){c(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(t){if(v(t,Nt))return Nt;var e=v(t,Pt),i=v(t,Mt);return e&&i?Pt+" "+Mt:e||i?e?Pt:Mt:v(t,zt)?zt:"auto"}(e.join(" "))},preventDefaults:function(t){if(!Ct){var e=t.srcEvent,i=t.offsetDirection;if(!this.manager.session.prevented){var n=this.actions,r=v(n,Nt),t=v(n,Mt),n=v(n,Pt);return r||t&&i&vt||n&&i&mt?this.preventSrc(e):void 0}e.preventDefault()}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ot=2,xt=4,Xt=8,Yt=Xt,Ft=16;x.prototype={defaults:{},set:function(t){return o(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(i(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Y(t,this)).id]||(e[t.id]=t).recognizeWith(this),this},dropRecognizeWith:function(t){return i(t,"dropRecognizeWith",this)||(t=Y(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(i(t,"requireFailure",this))return this;var e=this.requireFail;return-1===g(e,t=Y(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(i(t,"dropRequireFailure",this))return this;t=Y(t,this);t=g(this.requireFail,t);return-1<t&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(e){function t(t){i.manager.emit(i.options.event+(t?(t=n)&Ft?"cancel":t&Xt?"end":t&xt?"move":t&Ot?"start":"":""),e)}var i=this,n=this.state;n<Xt&&t(!0),t(),Xt<=n&&t(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=32)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){t=o({},t);return c(this.options.enable,[this,t])?(this.state&(Yt|Ft|32)&&(this.state=1),this.state=this.process(t),void(this.state&(Ot|xt|Xt|Ft)&&this.tryEmit(t))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}},e(F,x,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Ot|xt),t=this.attrTest(t);return n&&(i&ut||!t)?e|Ft:n||t?i&at?e|Xt:e&Ot?e|xt:Ot:32}}),e(W,F,{defaults:{event:"pan",threshold:10,pointers:1,direction:gt},getTouchAction:function(){var t=this.options.direction,e=[];return t&vt&&e.push(Mt),t&mt&&e.push(Pt),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(n=e.direction&vt?(r=0===s?ct:s<0?lt:pt,i=s!=this.pX,Math.abs(t.deltaX)):(r=0===o?ct:o<0?ft:dt,i=o!=this.pY,Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return F.prototype.attrTest.call(this,t)&&(this.state&Ot||!(this.state&Ot)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=X(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),e(q,F,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Nt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Ot)},emit:function(t){var e;this._super.emit.call(this,t),1!==t.scale&&(e=t.scale<1?"in":"out",this.manager.emit(this.options.event+e,t))}}),e(L,x,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(at|ut)&&!r)this.reset();else if(t.eventType&ht)this.reset(),this._timer=s(function(){this.state=Yt,this.tryEmit()},e.time,this);else if(t.eventType&at)return Yt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Yt&&(t&&t.eventType&at?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=$(),this.manager.emit(this.options.event,this._input)))}}),e(H,F,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Nt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Ot)}}),e(k,F,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:vt|mt,pointers:1},getTouchAction:function(){return W.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(vt|mt)?e=t.velocity:i&vt?e=t.velocityX:i&mt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&Q(e)>this.options.velocity&&t.eventType&at},emit:function(t){var e=X(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),e(U,x,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[zt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&ht&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=at)return this.failTimeout();r=!this.pTime||t.timeStamp-this.pTime<e.interval,i=!this.pCenter||w(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,i&&r?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=s(function(){this.state=Yt,this.tryEmit()},e.interval,this),Ot):Yt}return 32},failTimeout:function(){return this._timer=s(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Yt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),G.VERSION="2.0.4",G.defaults={domEvents:!1,touchAction:Rt,enable:!0,inputTarget:null,inputClass:null,preset:[[H,{enable:!1}],[q,{enable:!1},["rotate"]],[k,{direction:vt}],[W,{direction:vt},["swipe"]],[U],[U,{event:"doubletap",taps:2},["tap"]],[L]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};V.prototype={set:function(t){return o(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r.state&Yt)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(Ot|xt|Xt)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof x)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(i(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),(t.manager=this).touchAction.update(),t},remove:function(t){if(i(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(g(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return r(m(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return r(m(t),function(t){e?i[t].splice(g(i[t],e),1):delete i[t]}),this},emit:function(t,e){var i,n,r;this.options.domEvents&&(i=t,n=e,(r=h.createEvent("Event")).initEvent(i,!0,!0),(r.gesture=n).target.dispatchEvent(r));var s=this.handlers[t]&&this.handlers[t].slice();if(s&&s.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var o=0;o<s.length;)s[o](e),o++}},destroy:function(){this.element&&j(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(G,{INPUT_START:ht,INPUT_MOVE:2,INPUT_END:at,INPUT_CANCEL:ut,STATE_POSSIBLE:1,STATE_BEGAN:Ot,STATE_CHANGED:xt,STATE_ENDED:Xt,STATE_RECOGNIZED:Yt,STATE_CANCELLED:Ft,STATE_FAILED:32,DIRECTION_NONE:ct,DIRECTION_LEFT:lt,DIRECTION_RIGHT:pt,DIRECTION_UP:ft,DIRECTION_DOWN:dt,DIRECTION_HORIZONTAL:vt,DIRECTION_VERTICAL:mt,DIRECTION_ALL:gt,Manager:V,Input:_,TouchAction:O,TouchInput:P,MouseInput:R,PointerEventInput:z,TouchMouseInput:M,SingleTouchInput:N,Recognizer:x,AttrRecognizer:F,Tap:U,Pan:W,Swipe:k,Pinch:q,Rotate:H,Press:L,on:p,off:f,each:r,merge:n,extend:o,inherit:e,bindFn:a,prefixed:E}),("undefined"==typeof define?"undefined":_typeof(define))==J&&define.amd?define(function(){return G}):"undefined"!=typeof module&&module.exports?module.exports=G:t.Hammer=G}(window,document);
"use strict";var WebPullToRefresh=function(){function n(t){f.startingPositionY=document.body.scrollTop,0===f.startingPositionY&&(f.enabled=!0)}function e(t){f.enabled&&(t.preventDefault(),f.distance=t.distance/l.resistance,m(),p())}function r(t){f.enabled&&0!==f.distance&&(t.preventDefault(),f.distance<t.distance/l.resistance?f.distance=0:f.distance=t.distance/l.resistance,m(),p())}function o(t){f.enabled&&(t.preventDefault(),l.contentEl.style.transform=l.contentEl.style.webkitTransform="",l.ptrEl.style.transform=l.ptrEl.style.webkitTransform="",(document.body.classList.contains("ptr-refresh")?E:b)(),f.distance=0,f.enabled=!1)}var a="content",s="ptr",i=70,c=!1,d=2.5,l={},f={enabled:!1,distance:0,startingPositionY:0},u=document.body.classList,m=function(){l.contentEl.style.transform=l.contentEl.style.webkitTransform="translate3d( 0, "+f.distance+"px, 0 )",l.ptrEl.style.transform=l.ptrEl.style.webkitTransform="translate3d( 0, "+(f.distance-l.ptrEl.offsetHeight)+"px, 0 )"},p=function(){f.distance>l.distanceToRefresh?u.add("ptr-refresh"):u.remove("ptr-refresh")},E=function(){if(u.add("ptr-loading"),!l.loadingFunction)return b();var t=l.loadingFunction();setTimeout(function(){t.then(b)},1e3)},b=function(){u.remove("ptr-loading"),u.remove("ptr-refresh"),u.add("ptr-reset");function t(){u.remove("ptr-reset"),document.body.removeEventListener("transitionend",t,!1)}document.body.addEventListener("transitionend",t,!1)};return{init:function(t){if(!(l={contentEl:(t=t||{}).contentEl||document.getElementById(a),ptrEl:t.ptrEl||document.getElementById(s),distanceToRefresh:t.distanceToRefresh||i,loadingFunction:t.loadingFunction||c,resistance:t.resistance||d}).contentEl||!l.ptrEl)return!1;t=new Hammer(l.contentEl);t.get("pan").set({direction:Hammer.DIRECTION_VERTICAL}),t.on("panstart",n),t.on("pandown",e),t.on("panup",r),t.on("panend",o)},disable:function(){var t;l&&l.contentEl&&((t=new Hammer(l.contentEl))&&t.get("pan").set({enable:!1}))},enable:function(){var t;l&&l.contentEl&&((t=new Hammer(l.contentEl))&&t.get("pan").set({enable:!0}))}}}();
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(l){function u(t,e){if(e=e||{},(t=t||"")instanceof u)return t;if(!(this instanceof u))return new u(t,e);var r,n,i,a,o,s,f,h,i=(n={r:0,g:0,b:0},s=o=a=null,h=f=!(i=1),"object"==_typeof(r="string"==typeof(r=t)?function(t){t=t.replace(F,"").replace(C,"").toLowerCase();var e,r=!1;if(j[t])t=j[t],r=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(e=P.rgb.exec(t))?{r:e[1],g:e[2],b:e[3]}:(e=P.rgba.exec(t))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=P.hsl.exec(t))?{h:e[1],s:e[2],l:e[3]}:(e=P.hsla.exec(t))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=P.hsv.exec(t))?{h:e[1],s:e[2],v:e[3]}:(e=P.hsva.exec(t))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=P.hex8.exec(t))?{r:x(e[1]),g:x(e[2]),b:x(e[3]),a:H(e[4]),format:r?"name":"hex8"}:(e=P.hex6.exec(t))?{r:x(e[1]),g:x(e[2]),b:x(e[3]),format:r?"name":"hex"}:(e=P.hex4.exec(t))?{r:x(e[1]+""+e[1]),g:x(e[2]+""+e[2]),b:x(e[3]+""+e[3]),a:H(e[4]+""+e[4]),format:r?"name":"hex8"}:!!(e=P.hex3.exec(t))&&{r:x(e[1]+""+e[1]),g:x(e[2]+""+e[2]),b:x(e[3]+""+e[3]),format:r?"name":"hex"}}(r):r)&&(R(r.r)&&R(r.g)&&R(r.b)?(n=function(t,e,r){return{r:255*v(t,255),g:255*v(e,255),b:255*v(r,255)}}(r.r,r.g,r.b),f=!0,h="%"===String(r.r).substr(-1)?"prgb":"rgb"):R(r.h)&&R(r.s)&&R(r.v)?(a=w(r.s),o=w(r.v),n=function(t,e,r){t=6*v(t,360),e=v(e,100),r=v(r,100);var n=l.floor(t),i=t-n,a=r*(1-e),t=r*(1-i*e),e=r*(1-(1-i)*e),n=n%6;return{r:255*[r,t,a,a,e,r][n],g:255*[e,r,r,t,a,a][n],b:255*[a,a,e,r,r,t][n]}}(r.h,a,o),f=!0,h="hsv"):R(r.h)&&R(r.s)&&R(r.l)&&(a=w(r.s),s=w(r.l),n=function(t,e,r){function n(t,e,r){return r<0&&(r+=1),1<r&&--r,r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}var i,a,o;t=v(t,360),e=v(e,100),r=v(r,100),0===e?i=a=o=r:(i=n(e=2*r-(r=r<.5?r*(1+e):r+e-r*e),r,t+1/3),a=n(e,r,t),o=n(e,r,t-1/3));return{r:255*i,g:255*a,b:255*o}}(r.h,a,s),f=!0,h="hsl"),r.hasOwnProperty("a")&&(i=r.a)),i=y(i),{ok:f,format:r.format||h,r:I(255,L(n.r,0)),g:I(255,L(n.g,0)),b:I(255,L(n.b,0)),a:i});this._originalInput=t,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=M(100*this._a)/100,this._format=e.format||i.format,this._gradientType=e.gradientType,this._r<1&&(this._r=M(this._r)),this._g<1&&(this._g=M(this._g)),this._b<1&&(this._b=M(this._b)),this._ok=i.ok,this._tc_id=q++}function n(t,e,r){t=v(t,255),e=v(e,255),r=v(r,255);var n,i=L(t,e,r),a=I(t,e,r),o=(i+a)/2;if(i==a)n=f=0;else{var s=i-a,f=.5<o?s/(2-i-a):s/(i+a);switch(i){case t:n=(e-r)/s+(e<r?6:0);break;case e:n=(r-t)/s+2;break;case r:n=(t-e)/s+4}n/=6}return{h:n,s:f,l:o}}function i(t,e,r){t=v(t,255),e=v(e,255),r=v(r,255);var n,i=L(t,e,r),a=I(t,e,r),o=i,s=i-a,f=0===i?0:s/i;if(i==a)n=0;else{switch(i){case t:n=(e-r)/s+(e<r?6:0);break;case e:n=(r-t)/s+2;break;case r:n=(t-e)/s+4}n/=6}return{h:n,s:f,v:o}}function e(t,e,r,n){r=[k(M(t).toString(16)),k(M(e).toString(16)),k(M(r).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function a(t,e,r,n){return[k(S(n)),k(M(t).toString(16)),k(M(e).toString(16)),k(M(r).toString(16))].join("")}function t(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.s-=e/100,t.s=A(t.s),u(t)}function r(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.s+=e/100,t.s=A(t.s),u(t)}function o(t){return u(t).desaturate(100)}function s(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.l+=e/100,t.l=A(t.l),u(t)}function f(t,e){e=0===e?0:e||10;t=u(t).toRgb();return t.r=L(0,I(255,t.r-M(-e/100*255))),t.g=L(0,I(255,t.g-M(-e/100*255))),t.b=L(0,I(255,t.b-M(-e/100*255))),u(t)}function h(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.l-=e/100,t.l=A(t.l),u(t)}function c(t,e){t=u(t).toHsl(),e=(t.h+e)%360;return t.h=e<0?360+e:e,u(t)}function g(t){t=u(t).toHsl();return t.h=(t.h+180)%360,u(t)}function b(t){var e=u(t).toHsl(),r=e.h;return[u(t),u({h:(r+120)%360,s:e.s,l:e.l}),u({h:(r+240)%360,s:e.s,l:e.l})]}function d(t){var e=u(t).toHsl(),r=e.h;return[u(t),u({h:(r+90)%360,s:e.s,l:e.l}),u({h:(r+180)%360,s:e.s,l:e.l}),u({h:(r+270)%360,s:e.s,l:e.l})]}function p(t){var e=u(t).toHsl(),r=e.h;return[u(t),u({h:(r+72)%360,s:e.s,l:e.l}),u({h:(r+216)%360,s:e.s,l:e.l})]}function _(t,e,r){e=e||6,r=r||30;var n=u(t).toHsl(),i=360/r,a=[u(t)];for(n.h=(n.h-(i*e>>1)+720)%360;--e;)n.h=(n.h+i)%360,a.push(u(n));return a}function m(t,e){e=e||6;for(var t=u(t).toHsv(),r=t.h,n=t.s,i=t.v,a=[],o=1/e;e--;)a.push(u({h:r,s:n,v:i})),i=(i+o)%1;return a}function y(t){return t=parseFloat(t),t=isNaN(t)||t<0||1<t?1:t}function v(t,e){"string"==typeof(r=t)&&-1!=r.indexOf(".")&&1===parseFloat(r)&&(t="100%");var r,r="string"==typeof(r=t)&&-1!=r.indexOf("%");return t=I(e,L(0,parseFloat(t))),r&&(t=parseInt(t*e,10)/100),l.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function A(t){return I(1,L(0,t))}function x(t){return parseInt(t,16)}function k(t){return 1==t.length?"0"+t:""+t}function w(t){return t=t<=1?100*t+"%":t}function S(t){return l.round(255*parseFloat(t)).toString(16)}function H(t){return x(t)/255}function R(t){return P.CSS_UNIT.exec(t)}var F=/^\s+/,C=/\s+$/,q=0,M=l.round,I=l.min,L=l.max,N=l.random;u.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t=this.toRgb(),e=t.r/255,r=t.g/255,t=t.b/255;return.2126*(e<=.03928?e/12.92:l.pow((.055+e)/1.055,2.4))+.7152*(r<=.03928?r/12.92:l.pow((.055+r)/1.055,2.4))+.0722*(t<=.03928?t/12.92:l.pow((.055+t)/1.055,2.4))},setAlpha:function(t){return this._a=y(t),this._roundA=M(100*this._a)/100,this},toHsv:function(){var t=i(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=i(this._r,this._g,this._b),e=M(360*t.h),r=M(100*t.s),t=M(100*t.v);return 1==this._a?"hsv("+e+", "+r+"%, "+t+"%)":"hsva("+e+", "+r+"%, "+t+"%, "+this._roundA+")"},toHsl:function(){var t=n(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=n(this._r,this._g,this._b),e=M(360*t.h),r=M(100*t.s),t=M(100*t.l);return 1==this._a?"hsl("+e+", "+r+"%, "+t+"%)":"hsla("+e+", "+r+"%, "+t+"%, "+this._roundA+")"},toHex:function(t){return e(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return e=this._r,r=this._g,n=this._b,i=this._a,t=t,i=[k(M(e).toString(16)),k(M(r).toString(16)),k(M(n).toString(16)),k(S(i))],t&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("");var e,r,n,i},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:M(this._r),g:M(this._g),b:M(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+M(this._r)+", "+M(this._g)+", "+M(this._b)+")":"rgba("+M(this._r)+", "+M(this._g)+", "+M(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:M(100*v(this._r,255))+"%",g:M(100*v(this._g,255))+"%",b:M(100*v(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+M(100*v(this._r,255))+"%, "+M(100*v(this._g,255))+"%, "+M(100*v(this._b,255))+"%)":"rgba("+M(100*v(this._r,255))+"%, "+M(100*v(this._g,255))+"%, "+M(100*v(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&O[e(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var e="#"+a(this._r,this._g,this._b,this._a),r=e;return"progid:DXImageTransform.Microsoft.gradient("+(this._gradientType?"GradientType = 1, ":"")+"startColorstr="+e+",endColorstr="+(r=t?"#"+a((t=u(t))._r,t._g,t._b,t._a):r)+")"},toString:function(t){var e=!!t;t=t||this._format;var r=!1,n=this._a<1&&0<=this._a;return!e&&n&&("hex"===t||"hex6"===t||"hex3"===t||"hex4"===t||"hex8"===t||"name"===t)?"name"===t&&0===this._a?this.toName():this.toRgbString():("rgb"===t&&(r=this.toRgbString()),"prgb"===t&&(r=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(r=this.toHexString()),"hex3"===t&&(r=this.toHexString(!0)),"hex4"===t&&(r=this.toHex8String(!0)),"hex8"===t&&(r=this.toHex8String()),"name"===t&&(r=this.toName()),"hsl"===t&&(r=this.toHslString()),(r="hsv"===t?this.toHsvString():r)||this.toHexString())},clone:function(){return u(this.toString())},_applyModification:function(t,e){e=t.apply(null,[this].concat([].slice.call(e)));return this._r=e._r,this._g=e._g,this._b=e._b,this.setAlpha(e._a),this},lighten:function(){return this._applyModification(s,arguments)},brighten:function(){return this._applyModification(f,arguments)},darken:function(){return this._applyModification(h,arguments)},desaturate:function(){return this._applyModification(t,arguments)},saturate:function(){return this._applyModification(r,arguments)},greyscale:function(){return this._applyModification(o,arguments)},spin:function(){return this._applyModification(c,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(_,arguments)},complement:function(){return this._applyCombination(g,arguments)},monochromatic:function(){return this._applyCombination(m,arguments)},splitcomplement:function(){return this._applyCombination(p,arguments)},triad:function(){return this._applyCombination(b,arguments)},tetrad:function(){return this._applyCombination(d,arguments)}},u.fromRatio=function(t,e){if("object"==_typeof(t)){var r,n={};for(r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:w(t[r]));t=n}return u(t,e)},u.equals=function(t,e){return!(!t||!e)&&u(t).toRgbString()==u(e).toRgbString()},u.random=function(){return u.fromRatio({r:N(),g:N(),b:N()})},u.mix=function(t,e,r){r=0===r?0:r||50;t=u(t).toRgb(),e=u(e).toRgb(),r/=100;return u({r:(e.r-t.r)*r+t.r,g:(e.g-t.g)*r+t.g,b:(e.b-t.b)*r+t.b,a:(e.a-t.a)*r+t.a})},u.readability=function(t,e){t=u(t),e=u(e);return(l.max(t.getLuminance(),e.getLuminance())+.05)/(l.min(t.getLuminance(),e.getLuminance())+.05)},u.isReadable=function(t,e,r){var n=u.readability(t,e),i=!1;switch((e={level:r="AA"!==(r=((e=(e=r)||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==r?"AA":r,size:e="small"!==(e=(e.size||"small").toLowerCase())&&"large"!==e?"small":e}).level+e.size){case"AAsmall":case"AAAlarge":i=4.5<=n;break;case"AAlarge":i=3<=n;break;case"AAAsmall":i=7<=n}return i},u.mostReadable=function(t,e,r){for(var n,i=null,a=0,o=(r=r||{}).includeFallbackColors,s=r.level,f=r.size,h=0;h<e.length;h++)a<(n=u.readability(t,e[h]))&&(a=n,i=u(e[h]));return u.isReadable(t,i,{level:s,size:f})||!o?i:(r.includeFallbackColors=!1,u.mostReadable(t,["#fff","#000"],r))};var z,E,T,j=u.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},O=u.hexNames=function(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[t[e]]=e);return r}(j),P=(E="[\\s|\\(]+("+(z="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+z+")[,|\\s]+("+z+")\\s*\\)?",T="[\\s|\\(]+("+z+")[,|\\s]+("+z+")[,|\\s]+("+z+")[,|\\s]+("+z+")\\s*\\)?",{CSS_UNIT:new RegExp(z),rgb:new RegExp("rgb"+E),rgba:new RegExp("rgba"+T),hsl:new RegExp("hsl"+E),hsla:new RegExp("hsla"+T),hsv:new RegExp("hsv"+E),hsva:new RegExp("hsva"+T),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});"undefined"!=typeof module&&module.exports?module.exports=u:"function"==typeof define&&define.amd?define(function(){return u}):window.tinycolor=u}(Math);
"use strict";!function(){function e(t){return this.promise=new Promise(t),this.promise.success=function(t){return this.then(t),this},this.promise.error=function(t){return this.then(null,t),this},this.promise}function o(){}console.log("httpClient is loading"),o.get=function(t,e){return o.request("GET",t,void 0,e)},o.post=function(t,e,n){return o.request("POST",t,e)},o.put=function(t,e,n){return o.request("PUT",t,e)},o.jsonp=function(t,e){function n(t){this.promise=new Promise(t)}return n.prototype.success=function(t){return this.promise.then(t,null),this},n.prototype.error=function(t){return this.promise.then(null,t),this},new n(function(r,s){setTimeout(function(){console.info("Angular $http is not ready"),window.bfUtils.http.jsonp(t,e).success(function(t,e,n,o){return r(t,e,n,o)}).error(function(t,e,n,o){return s(t,e,n,o)})},200)})},o.request=function(o,r,s,t){return console.log("httpClient create request for url: ",r," using method: ",o),new e(function(e,t){var n=new XMLHttpRequest;n.onload=function(){console.log("httpClient read response for url: ",r," using method: ",o);n.status,n.statusText;var t="response"in n?n.response:n.responseText;e(t?JSON.parse(t):null)},n.onerror=function(){console.log("httpClient failed for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},n.ontimeout=function(){console.log("httpClient timed out for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},console.log("httpClient requesting for url: ",r," using method: ",o),n.open(o,r,!0),n.send(s)})},window.httpClient=o}();
"use strict";var bfUtils={get deviceOnline(){return!("undefined"==typeof window||!window.ignoreNavigatorOnline)||("undefined"==typeof navigator||(navigator.connection&&navigator.connection.type?"none"!=navigator.connection.type:void 0===navigator.onLine||navigator.onLine))},get isMobileDevice(){return window.location.protocol.indexOf("http")<0},get isAndroid(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"Android"==device.platform},get isIOS(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"iOS"==device.platform},get isPwaAndroid(){return!!navigator.userAgent.match(/Android/i)},get isPwaiOS(){return"undefined"==typeof device&&"standalone"in window.navigator&&window.navigator.standalone},get isHtml5iOS(){return"undefined"==typeof device&&"standalone"in window.navigator&&!window.navigator.standalone},get isPwaOrHtml5iOS(){return"undefined"==typeof device&&"standalone"in window.navigator},get isAppHtml5Version(){return window.self==window.top},get isEmulatorCP(){return!!window.parseQueryString().emulator},get isApp(){return!!window.siteConfig&&"app"===window.siteConfig.scope},tryParseJSON:function(t){try{return JSON.parse(t)}catch(n){return void console.error("Cannot parse data :: "+t,n.message,n.stack)}},get http(){return window.$http||window.httpClient},get currentApp(){return window.appContext&&window.appContext.currentApp?window.appContext.currentApp:{}},getIPAddress:function(t){bfUtils.http.get(siteConfig.endPoints.crmHost+"/ipinfo?ipOnly=true").success(function(n){t(null,n)}).error(function(n){t(n)})},sanitize:function(n,t){bfUtils.sanitizeCallbacks=bfUtils.sanitizeCallbacks||[];var i,e,o=n.data,r={onIgnoreTagAttr:function(n,t,i,e){if("class"===t||"style"===t||"src"===t||"id"===t)return t+'="'+i+'"'}};"undefined"==typeof filterXSS?bfUtils.isLoadingXSSLibrary?bfUtils.sanitizeCallbacks.push(function(){t(null,filterXSS(o,r))}):(bfUtils.isLoadingXSSLibrary=!0,bfUtils.sanitizeCallbacks.push(function(){t(null,filterXSS(o,r))}),i=function(){bfUtils.sanitizeCallbacks.forEach(function(n){n()})},e=document.createElement("script"),"sdk"==window.siteConfig.scope?e.src="scripts/lib/xss.min.js":"cp"==window.siteConfig.scope?e.src="/app/scripts/lib/xss/xss.min.js":e.src=window._appRoot+"scripts/lib/xss/xss.min.js",e.type="text/javascript",e.onload=function(){i&&i()},document.getElementsByTagName("head")[0].appendChild(e)):t(null,filterXSS(o,r))}};
"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,t){if(r){if("string"==typeof r)return _arrayLikeToArray(r,t);var a=Object.prototype.toString.call(r).slice(8,-1);return"Map"===(a="Object"===a&&r.constructor?r.constructor.name:a)||"Set"===a?Array.from(r):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(r,t):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,t){(null==t||t>r.length)&&(t=r.length);for(var a=0,e=new Array(t);a<t;a++)e[a]=r[a];return e}var atatusAPI={log:function(r){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if("undefined"==typeof atatus||!atatus.notify)return console.warn("atatus not configured");var e=window.appContext.currentApp||{},n=e.appId,e=e.appName;atatus.notify(new Error(r),a,["appId:".concat(n),"appName:".concat(e)].concat(_toConsumableArray(t)))}};
"use strict";var customRegistration={googleMapServices:{},get wl_name(){var e="Full ";return e=appContext&&appContext.currentApp&&appContext.currentApp.config?appContext.currentApp.config.whitlabelName+" ":e},getFields:function(t,e){var a,r,o,n,u,d,i=t.customRegistrationSettings;i&&i.singlePage&&i.singlePage.formControls?(a=[],r={},o=[],n="",u=t.defaults||{},i.singlePage.formControls.forEach(function(e,i){var s;t.isProfileMode&&"registrationOnly"===e.settings.displayOn||("custom"!=e.type?(s={control:e,controlIndex:i,fields:a,rules:r,initializers:o,isProfileMode:t.isProfileMode,defaults:t.defaults,refreshUI:t.refreshUI},customRegistration.preparePresetField(s)):(i={control:e,controlIndex:i,fields:a,defaults:t.defaults},customRegistration.prepareCustomField(i)))}),d=function(e,i){var s=e.field;"edit"!==e.mode||"email"!==s.name&&!s.preventEditing?"edit"===e.mode&&"profilePicture"===s.name?(s.value=e.profilePicture,s.validate(s.value,function(e,i){n=e?e:null})):"multipleSelect"===s.type?s.validate(s.values):s.validate(s.value):s.error=null,i&&i(null,{profilePictureError:n})},e(null,{fields:a,rules:r,initializers:o,fetch:function(i,e){var s,t,r=!1,o={},l=[];i&&i.validateFields&&a.forEach(function(e){if(i.field=e,d(i),e.error&&(r=!0),e.isCustom)switch(e.type){case"singleSelect":l.push({id:e.id,type:e.type,value:e.value,displayValue:e.displayValue,visibilityChoice:e.visibilityChoice});break;case"multipleSelect":l.push({id:e.id,type:e.type,values:e.values,visibilityChoice:e.visibilityChoice});break;case"text":case"number":case"textarea":l.push({id:e.id,type:e.type,value:e.value,visibilityChoice:e.visibilityChoice})}else o[e.name]={value:e.value,extra:e.extra,messages:e.messages,visibilityChoice:e.visibilityChoice}}),r?e({profilePictureError:n},null):((t=(s={user:u}).user).email=o.email.value,t.password=o.password?o.password.value:void 0,t.firstName=o.firstName?o.firstName.value:t.firstName,t.lastName=o.lastName?o.lastName.value:t.lastName,t.displayName=o.displayName?o.displayName.value:t.displayName,t.userProfile=t.userProfile||{},t.userProfile.address=t.userProfile.address||{},t.userProfile.address.fullAddress=o.address?o.address.value:t.userProfile.address.fullAddress,t.userProfile.address.customFields=t.userProfile.address.customFields||{},t.userProfile.address.customFields.aptNo=o.aptNo?o.aptNo.value:t.userProfile.address.customFields.aptNo,t.userProfile.address.customFields.zipCode=o.zipCode?o.zipCode.value:t.userProfile.address.customFields.zipCode,t.userProfile.address.geoLocation=o.address?o.address.value?o.address.extra:void 0:t.userProfile.address.geoLocation,t.userProfile.addressVisibilityChoice=o.address?o.address.visibilityChoice:o.zipCode?o.zipCode.visibilityChoice:t.userProfile.addressVisibilityChoice,t.userProfile.bio=o.bio?o.bio.value:t.userProfile.bio,t.userProfile.bioVisibilityChoice=o.bio?o.bio.visibilityChoice:t.userProfile.bioVisibilityChoice,t.userProfile.birthDate=o.birthDate?o.birthDate.value?new Date(o.birthDate.value):null:"string"==typeof t.userProfile.birthDate?new Date(t.userProfile.birthDate):t.userProfile.birthDate,t.userProfile.birthDateVisibilityChoice=o.birthDate?o.birthDate.visibilityChoice:t.userProfile.birthDateVisibilityChoice,t.userProfile.tel=o.tel?o.tel.value:t.userProfile.tel,t.userProfile.telVisibilityChoice=o.tel?o.tel.visibilityChoice:t.userProfile.telVisibilityChoice,t.userProfile.emailVisibilityChoice=o.email?o.email.visibilityChoice:t.userProfile.emailVisibilityChoice,t.userProfile.customTypeFields=t.userProfile.customTypeFields||[],l.forEach(function(i){var e=t.userProfile.customTypeFields.findIndex(function(e){return i.id===e.id});0<=e?t.userProfile.customTypeFields[e]=i:t.userProfile.customTypeFields.push(i)}),delete t.imageUrl,s.messages={emailAlreadyInUse:o.email.messages.emailAlreadyInUse},o.displayName&&o.displayName.messages&&(s.messages.fullNameAlreadyInUse=o.displayName.messages.fullNameAlreadyInUse),s.profilePictureFile=o.profilePicture?o.profilePicture.value:void 0,e(null,s))},checkFieldsErrors:function(i,s){i&&i.validateFields&&a.forEach(function(e){i.field=e,d(i,s)})}})):e(null,null)},preparePresetField:function(l){var t,e,i,s,a=l.control,r=l.controlIndex,o=l.fields,n=l.rules,u=l.initializers;switch(a.id){case"fullName":a.active&&(a.settings.displayNameEnabled&&(o.push({id:a.id,type:"text",viewType:"none",name:"displayName",maxLength:150,order:r,label:a.options.fieldsLabels.displayName,iconClass:a.icon||"glyphicon glyphicon-font",validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults?l.defaults.displayName:void 0}),n.checkUniqueName=a.active&&a.settings&&a.settings.unique&&a.settings.required&&a.settings.displayNameEnabled),a.settings.firstNameEnabled&&o.push({type:"text",viewType:"text",name:"firstName",maxLength:150,order:r,label:a.options.fieldsLabels.firstName,iconClass:a.icon||"glyphicon glyphicon-font",validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults?l.defaults.firstName:void 0}),a.settings.lastNameEnabled&&o.push({type:"text",viewType:"text",name:"lastName",maxLength:150,order:r,label:a.options.fieldsLabels.lastName,iconClass:a.icon||"glyphicon glyphicon-font",validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults?l.defaults.lastName:void 0}));break;case"email":var d="userChoice"===a.settings.visibility?"public":void 0,d=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.emailVisibilityChoice||d;o.push({type:"email",viewType:"email",name:"email",order:r,label:a.options.fieldsLabels.email,info:a.options.infoMessages?a.options.infoMessages.assistiveText:void 0,iconClass:a.icon||"glyphicon glyphicon-send",visibility:a.settings.visibility||"private",visibilityChoice:d,validate:function(e){this.error=null,e&&e.trim().length?window.validator.validateEmail(e)?e&&e.trim().length||(this.error=a.options.errorMessages.emailAlreadyInUse):this.error=a.options.errorMessages.emailInvalidFormat:this.error=a.options.errorMessages.emailRequired},touch:function(e,i){!e&&i&&i.target&&(e=i.target.value),this.validate(e)},messages:a.options.errorMessages,value:l.defaults?l.defaults.email:void 0});break;case"address":a.active&&(t=a.options.addressGoogleApiKey,e="userChoice"===a.settings.visibility?"public":void 0,e=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.addressVisibilityChoice||e,a.options.addressGoogleApiKey&&u.push(function(){setTimeout(function(){var e=document.getElementById("customRegistrationScript"),i=e&&e.src,s="https://maps.googleapis.com/maps/api/js?key=".concat(t,"&libraries=places&callback=googleMapsInitCallback");e&&i!=s&&document.getElementsByTagName("head")[0].removeChild(e),customRegistration.googleMapServices.mapsApiKeyError=null,i!=s&&((e=document.createElement("script")).id="customRegistrationScript",e.src=s,e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e)),window.googleMapsInitCallback=function(){customRegistration.googleMapServices.autoAddressCompleteService=new google.maps.places.AutocompleteService,customRegistration.googleMapServices.addressGeocoder=new google.maps.Geocoder},l.refreshUI&&l.refreshUI()},0)}),a.settings.showFullAddress&&(o.push({type:"text",viewType:"text",name:"address",maxLength:150,order:r,label:a.options.fieldsLabels.address,iconClass:a.icon||"glyphicon glyphicon-pushpin",visibility:a.settings.visibility||"private",visibilityChoice:e,preventEditing:!1===a.settings.allowEditingInProfile,change:function(e){var s=this;s.extra=null,customRegistration.googleMapServices.mapsApiKeyError&&(s.error=customRegistration.googleMapServices.mapsApiKeyError),customRegistration.googleMapServices.autoAddressCompleteService?(customRegistration.googleMapServices.checkMapsApiKeyErrors=!0,setTimeout(function(){customRegistration.googleMapServices.checkMapsApiKeyErrors=!1},3e3),customRegistration.googleMapServices.autoAddressCompleteService.getPlacePredictions({input:e,types:["street_number","street_address","route"]},function(e,i){i!==google.maps.places.PlacesServiceStatus.OK&&(s.error=a.options.errorMessages.invalidGoogleAddress),s.suggestions=e,l.refreshUI&&l.refreshUI()})):s.error=a.options.errorMessages.invalidGoogleAddress},selectSuggestion:function(r){var o=this;o.error=null,o.suggestions=null,o.value=r.description,customRegistration.googleMapServices.addressGeocoder.geocode({placeId:r.place_id},function(e,i){var s,t;e&&e[0]&&e[0]?(s=e[0].geometry.location.lat(),t=e[0].geometry.location.lng(),a.settings.required&&(e[0].address_components.find(function(e){return e.types&&e.types.find(function(e){return"street_number"===e||"street_address"===e||"route"===e})})||(o.error=a.options.errorMessages.invalidGoogleAddress)),o.extra={lat:s,lng:t,place:r,addressComponents:e[0].address_components}):o.error=a.options.errorMessages.invalidGoogleAddress,l.refreshUI&&l.refreshUI()})},validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required?e&&e.trim().length&&!this.extra&&(this.error=a.options.errorMessages.invalidGoogleAddress):this.error=a.options.errorMessages.addressRequired},touch:function(e){this.suggestions&&this.suggestions.length||this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this),this.change(this.value)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address?l.defaults.userProfile.address.fullAddress:void 0,extra:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address?l.defaults.userProfile.address.geoLocation:void 0}),a.settings.showAptNo&&o.push({type:"text",viewType:"text",name:"aptNo",maxLength:150,order:r,label:a.options.fieldsLabels.aptNo,iconClass:a.icon||"glyphicon glyphicon-pushpin",containerClass:"small-login-field",preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.addressRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address&&l.defaults.userProfile.address.customFields?l.defaults.userProfile.address.customFields.aptNo:void 0})),a.settings.showZipCode&&o.push({type:"text",viewType:"text",name:"zipCode",maxLength:150,order:r,label:a.options.fieldsLabels.zipCode,iconClass:a.icon||"glyphicon glyphicon-pushpin",visibility:a.settings.visibility||"private",visibilityChoice:e,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.addressRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address&&l.defaults.userProfile.address.customFields?l.defaults.userProfile.address.customFields.zipCode:void 0}));break;case"password":l.isProfileMode||(o.push({type:"password",name:"password",order:r,label:a.options.fieldsLabels.password,iconClass:a.icon||"glyphicon glyphicon-lock",togglePasswordVisibility:"showHidePassword"===a.settings.validation,info:"simple"===a.settings.passwordStrength?a.options.infoMessages.passwordSimpleRules:a.options.infoMessages.passwordRules,validate:function(e){this.error=null,"retypePassword"===a.settings.validation&&(o.find(function(e){return"retypePassword"===e.name}).error=null),e&&e.trim().length?window.validator.validatePassword(e,{simplePasswordValidation:"simple"===a.settings.passwordStrength})||(this.error="simple"===a.settings.passwordStrength?a.options.errorMessages.invalidPasswordSimpleRules:a.options.errorMessages.invalidPasswordRules):this.error=a.options.errorMessages.passwordRequired},touch:function(e){this.validate(e)},messages:a.options.errorMessages}),"retypePassword"===a.settings.validation&&o.push({type:"password",name:"retypePassword",order:r,label:a.options.fieldsLabels.retypePassword,iconClass:a.icon||"glyphicon glyphicon-lock",togglePasswordVisibility:"showHidePassword"===a.settings.validation,validate:function(e){var i=o.find(function(e){return"password"===e.name});this.error=null,e&&e.trim().length?i.value!==e&&(this.error=a.options.errorMessages.passwordsDontMatch):this.error=a.options.errorMessages.passwordRequired},touch:function(e){this.validate(e)},messages:a.options.errorMessages})),n.passwordStrength=a.settings.passwordStrength;break;case"bio":a.active&&(e="userChoice"===a.settings.visibility?"public":void 0,e=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.bioVisibilityChoice||e,o.push({type:"textarea",viewType:"multiline",name:"bio",maxLength:1024,order:r,label:a.options.fieldsLabels.bio,info:a.options.infoMessages?a.options.infoMessages.assistiveText:void 0,iconClass:a.icon||"glyphicon glyphicon-list-alt",visibility:a.settings.visibility||"private",visibilityChoice:e,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.bioRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile?l.defaults.userProfile.bio:void 0}));break;case"telephone":a.active&&(i="userChoice"===a.settings.visibility?"public":void 0,i=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.telVisibilityChoice||i,o.push({type:"tel",viewType:"text",name:"tel",maxLength:150,order:r,label:a.options.fieldsLabels.tel,info:a.settings.showReasonForTelephone?a.options.infoMessages.reasonForTelephone:null,iconClass:a.icon||"glyphicon glyphicon-earphone",visibility:a.settings.visibility||"private",visibilityChoice:i,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required?e&&(/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i.test(e)||(this.error=a.options.errorMessages.invalidEntry)):this.error=a.options.errorMessages.invalidEntry},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile?l.defaults.userProfile.tel:void 0}));break;case"birthDate":a.active&&(i="userChoice"===a.settings.visibility?"public":void 0,i=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.birthDateVisibilityChoice||i,s=function(e){return e?moment(e).format("L"):null},o.push({type:"date",viewType:"text",name:"birthDate",order:r,label:a.options.fieldsLabels.dateBirth,info:a.options.infoMessages?a.options.infoMessages.assistiveText:void 0,minDate:a.settings.maxAgeIsRequired&&a.settings.maxAgeRequired?moment().subtract(a.settings.maxAgeRequired,"years").toDate():void 0,maxDate:a.settings.minAgeIsRequired&&a.settings.minAgeRequired?moment().subtract(a.settings.minAgeRequired,"years").toDate():void 0,iconClass:a.icon||"glyphicon glyphicon-calendar",displayValue:s(l.defaults&&l.defaults.userProfile?l.defaults.userProfile.birthDate:void 0),visibility:a.settings.visibility||"private",visibilityChoice:i,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e?(e=moment(e),e=moment().diff(e,"years"),a.settings.maxAgeIsRequired&&a.settings.maxAgeRequired&&e>a.settings.maxAgeRequired?this.error=a.options.errorMessages.maxAge+" "+a.settings.maxAgeRequired:a.settings.minAgeIsRequired&&a.settings.minAgeRequired&&e<a.settings.minAgeRequired&&(this.error=a.options.errorMessages.minAge+" "+a.settings.minAgeRequired)):a.settings.required&&(this.error=a.options.errorMessages.birthRequired)},change:function(e){this.validate(e),this.displayValue=s(e)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile?l.defaults.userProfile.birthDate?new Date(l.defaults.userProfile.birthDate):null:void 0}));break;case"profilePicture":a.active&&o.push({type:"image",viewType:"none",name:"profilePicture",order:r,label:a.options.fieldsLabels.profilePicture,info:a.options.infoMessages.assistiveText,iconClass:a.icon||"icon icon-camera2",resetImage:function(){this.value=null},validate:function(e,i){this.error=null,!e&&a.settings.required&&(this.error=a.options.errorMessages.required),i&&i(this.error,null)},messages:a.options.errorMessages})}},prepareCustomField:function(e){var i,s,t,r,o,l,a,n,u,d,c,g,p=e.control,f=e.controlIndex,h=e.fields;switch(p.customType){case"singleSelect":p.active&&(o="userChoice"===p.settings.visibility?"public":void 0,e.defaults&&e.defaults.userProfile&&e.defaults.userProfile.customTypeFields&&0<e.defaults.userProfile.customTypeFields.length&&((t=e.defaults.userProfile.customTypeFields.find(function(e){return e.id===p.id}))&&(s=p.selectOptions.find(function(e){return e.key===t.value})),i=t&&s?t.value:void 0,s=s?s.label:void 0),o=t&&t.visibilityChoice||o,h.push({id:p.id,name:"singleSelect",type:"singleSelect",viewType:"multiline",isCustom:!0,order:f,display:p.settings.displayOption,label:p.options.fieldsLabels.singleSelect,info:p.options.infoMessages?p.options.infoMessages.assistiveText:void 0,iconClass:p.icon||"glyphicon glyphicon-th-list",selectOptions:p.selectOptions,value:i,displayValue:s,messages:p.options.errorMessages,visibility:p.settings.visibility||"private",visibilityChoice:o,preventEditing:!1===p.settings.allowEditingInProfile,validate:function(e){this.error=null,!e&&p.settings.required&&(this.error=p.options.errorMessages.required)},openDrawer:function(s){var t=this,r=new ComponentUIAPI,i=[];this.selectOptions.forEach(function(e){i.push({text:e.label,value:e.key})}),r.openDrawer({header:this.label,listItems:i},function(e,i){return e?console.error(e):(t.value=i.value,s.target.value=t.displayValue=i.text,t.validate(t.value),void r.closeDrawer())})}}));break;case"multipleSelect":p.active&&(r=function(e,t){var r="";return e.forEach(function(i,s){t.selectOptions.forEach(function(e){i.value===e.key&&(r+=0===s?e.label:", ".concat(e.label))})}),r},o=[],a="",n="userChoice"===p.settings.visibility?"public":void 0,e.defaults&&e.defaults.userProfile&&e.defaults.userProfile.customTypeFields&&0<e.defaults.userProfile.customTypeFields.length&&(o=(l=e.defaults.userProfile.customTypeFields.find(function(e){return e.id===p.id}))?l.values:[])&&0<o.length&&(o=o.filter(function(i){return void 0!==p.selectOptions.find(function(e){return e.key===i.value})}),a=r(o,p)),n=l&&l.visibilityChoice||n,h.push({id:p.id,name:"multipleSelect",type:"multipleSelect",viewType:"multiline",isCustom:!0,order:f,display:p.settings.displayOption,label:p.options.fieldsLabels.multipleSelect,info:p.options.infoMessages?p.options.infoMessages.assistiveText:void 0,iconClass:p.icon||"glyphicon glyphicon-th-list",selectOptions:p.selectOptions,values:o,displayValue:a,messages:p.options.errorMessages,visibility:p.settings.visibility||"private",visibilityChoice:n,preventEditing:!1===p.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.length<1&&p.settings.required&&(this.error=p.options.errorMessages.required)},updateCheckboxValue:function(i,e){e.target.checked?this.values.find(function(e){return e.value===i.key})||this.values.push({value:i.key,displayValue:i.label}):this.values=this.values.filter(function(e){return e.value!==i.key}),this.displayValue="",this.displayValue=r(this.values,p)},isSelected:function(i){return void 0!==this.values.find(function(e){return i.key===e.value})},openDrawer:function(r){var o=this,l=new ComponentUIAPI,e=[];this.selectOptions.forEach(function(i){o.values&&o.values.find(function(e){return i.key===e.value})?e.push({text:i.label,value:i.key,selected:!0}):e.push({text:i.label,value:i.key})}),l.openDrawer({header:this.label,listItems:e,multiSelection:!0,multiSelectionActionButton:{text:"SELECT"}},function(e,i){if(e)return console.error(e);var s=[],t="";i.forEach(function(e,i){t+=0===i?e.text:", ".concat(e.text),s.push({value:e.value,displayValue:e.text})}),o.values=s,r.target.value=o.displayValue=t,o.validate(o.values),l.closeDrawer()})}}));break;case"text":p.active&&(n=a="",g="userChoice"===p.settings.visibility?"public":void 0,e.defaults&&e.defaults.userProfile&&e.defaults.userProfile.customTypeFields&&0<e.defaults.userProfile.customTypeFields.length&&(u=e.defaults.userProfile.customTypeFields.find(function(e){return e.id===p.id}))&&(a=u.value),g=u&&u.visibilityChoice||g,"short"===p.settings.fieldLength?n="text":"long"===p.settings.fieldLength&&(n="textarea"),h.push({id:p.id,name:"customText",type:n,viewType:"multiline",isCustom:!0,maxLength:p.settings.maxCharRequired&&p.settings.maxCharEnabled?p.settings.maxCharRequired:void 0,order:f,label:p.options.fieldsLabels.text,info:p.options.infoMessages?p.options.infoMessages.assistiveText:void 0,iconClass:p.icon||"glyphicon glyphicon-font",value:a,messages:p.options.errorMessages,visibility:p.settings.visibility||"private",visibilityChoice:g,preventEditing:!1===p.settings.allowEditingInProfile,validate:function(e){this.error=null,!e&&p.settings.required?this.error=p.options.errorMessages.required:e&&p.settings.minCharEnabled&&e.length<p.settings.minCharRequired&&(this.error=p.options.errorMessages.minChar+" "+p.settings.minCharRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)}}));break;case"number":p.active&&(g="userChoice"===p.settings.visibility?"public":void 0,e.defaults&&e.defaults.userProfile&&e.defaults.userProfile.customTypeFields&&0<e.defaults.userProfile.customTypeFields.length&&(c=e.defaults.userProfile.customTypeFields.find(function(e){return e.id===p.id}))&&(d=c.value),g=c&&c.visibilityChoice||g,h.push({id:p.id,name:"customNumber",type:"number",viewType:"multiline",inputMode:p.settings.decimalsEnabled?"decimal":"numeric",isCustom:!0,order:f,label:p.options.fieldsLabels.number,info:p.options.infoMessages?p.options.infoMessages.assistiveText:void 0,iconClass:p.icon,value:d,messages:p.options.errorMessages,visibility:p.settings.visibility||"private",visibilityChoice:g,preventEditing:!1===p.settings.allowEditingInProfile,validate:function(e){this.error=null,!e&&0!==e&&p.settings.required?this.error=p.options.errorMessages.required:e>p.settings.maxNumRequired&&p.settings.maxNumEnabled?this.error=p.options.errorMessages.maxNum+" "+p.settings.maxNumRequired:e<p.settings.minNumRequired&&p.settings.minNumEnabled&&(this.error=p.options.errorMessages.minNum+" "+p.settings.minNumRequired)},touch:function(e){this.validate(e)},change:function(e){p.settings.decimalsEnabled||(this.value=e||0===e?Math.round(e):void 0)}}))}},enforceMaxLength:function(e){e.value.length>e.maxLength&&(e.value=e.value.substring(0,e.maxLength))},editVisibilityOptions:function(e,s){var t=new ComponentUIAPI;t.openDrawer({header:e.field.label,listItems:[{text:"Public"},{text:"Private"}],enableFilter:!1},function(e,i){return e?console.error(e):(i&&s(null,i),void t.closeDrawer())})}};function gm_authFailure(){customRegistration.googleMapServices.checkMapsApiKeyErrors&&(customRegistration.googleMapServices.mapsApiKeyError="There seems to be an issue with google maps key")}
"use strict";function _readOnlyError(e){throw new TypeError('"'+e+'" is read-only')}function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var userTags={get isUserTaggingEnabled(){return window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.userTagging&&"hidden"!=window.appContext.currentApp.config.userTagging&&"disabled"!=window.appContext.currentApp.config.userTagging},init:function(){},checkPluginAccessSettings:function(e,n){var t=e||{},r=t.accessSettings,e=t.requiresLogin,t=window.appContext.currentApp,a=t.appId,s=t.config,t=r||{},i=t.requiresTags,o=t.requiredTags;if(bfUtils.isEmulatorCP||!e)return n(null,!0);authAPI.getCurrentUser(function(e,t){if(e)return console.error(e),n(e,null);if(!t)return n(null,!1);if(!userTags.isUserTaggingEnabled||"enabled"!=s.advancedPluginAccessSettings)return n(null,!0);if(!i||!o||!o.length)return n(null,!0);t=(t.tags||[])[a],t=userTags._checkUserTags(_objectSpread(_objectSpread({},r),{},{currentUserTags:t}));n(null,t)})},checkUserTags:function(e,n){var r=(window.appContext&&window.appContext.currentApp||{}).appId,e=e||{},a=e.requiredTags,s=e.giveAccessWhen;if(n=n||console.warn,!a||!a.length)return n(null,!0);s||_readOnlyError("giveAccessWhen"),authAPI.getCurrentUser(function(e,t){if(e)return n(e,null);if(!t)return n(null,!1);t=(t.tags||[])[r],t=userTags._checkUserTags({requiredTags:a,currentUserTags:t,giveAccessWhen:s});n(null,t)})},_checkUserTags:function(e){var e=e||{},t=e.requiredTags,n=e.currentUserTags,e=e.giveAccessWhen;if(!e||!n||!n.length)return!1;switch(e){case"all":case"matchAllTags":return t.every(r);case"any":case"matchAnyTag":return t.some(r);default:return!1}function r(t){return n.some(function(e){return e.tagName==t.name&&t.appliedCount<=e.appliedCount})}},setBehavioralTags:function(n){!bfUtils.isEmulatorCP&&bfUtils.deviceOnline&&userTags.isUserTaggingEnabled&&authAPI.getCurrentUser(null,function(e,t){e?console.log(e):t&&bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/assignBehavioralTag",{instanceId:n,accessToken:t.accessToken}).success(function(e){authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated"})}).error(function(e){console.log(e)})})},removeProfileTags:function(e,n){e=["$$profile_birth_year:","$$profile_birth_month:","$$profile_zip:","$$profile_city:","$$profile_state:","$$profile_town:","$$profile_country:","$$profile_picture"].concat(e);userTags.unassignUserTags(e,{isPrefix:!0,removeTag:!0,preventRefresh:!0},function(e,t){e?n(e,null):n(null,t)})},setRegistrationTags:function(e,t,n){var a=[],s={},r=e?e.userProfile:null;AppearanceAPI.prototype.getAppearance(null,function(e,t){return e?console.error(e):void(t&&(s=t.customRegistration))});function i(e,t){for(var n=0;n<e.length;n++)if(e[n].types[0]==t)return e[n].short_name}var o,u,p,c;userTags.isUserTaggingEnabled&&(o=[],t&&(u=new Date,o.push("$$registered"),o.push("$$registered_year:"+u.getFullYear()),o.push("$$registered_month:"+(u.getMonth()+1))),r&&(r.birthDate&&(o.push("$$profile_birth_year:"+r.birthDate.getFullYear()),o.push("$$profile_birth_month:"+(r.birthDate.getMonth()+1))),r.address&&r.address.customFields&&r.address.customFields.zipCode&&o.push("$$profile_zip:"+r.address.customFields.zipCode),r.address&&r.address.geoLocation&&r.address.geoLocation.addressComponents&&((c=i(r.address.geoLocation.addressComponents,"country"))&&o.push("$$profile_country:"+c.replace(/ /g,"_")),(c=i(r.address.geoLocation.addressComponents,"administrative_area_level_1"))&&o.push("$$profile_state:"+c.replace(/ /g,"_")),(c=i(r.address.geoLocation.addressComponents,"administrative_area_level_2"))&&o.push("$$profile_city:"+c.replace(/ /g,"_")),(c=i(r.address.geoLocation.addressComponents,"locality"))&&o.push("$$profile_town:"+c.replace(/ /g,"_"))),r.customTypeFields&&0<r.customTypeFields.length&&(p=[],(c=authAPI.getCurrentUser())&&c.tags&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(p=c.tags[window.appContext.currentApp.appId]),r.customTypeFields.forEach(function(n){var r=s.singlePage.formControls.find(function(e){return e.id===n.id});if(r&&r.active){switch(r.customType){case"text":case"number":case"singleSelect":p.find(function(e){return e.tagName==="$$profile_".concat(r.uniqueId)})||!n.value&&0!==n.value||o.push("$$profile_".concat(r.uniqueId)),!n.value&&0!==n.value||p.find(function(e){return e.tagName==="$$profile_".concat(r.uniqueId,":").concat(n.value)})||o.push("$$profile_".concat(r.uniqueId,":").concat(n.value));break;case"multipleSelect":!p.find(function(e){return e.tagName==="$$profile_".concat(r.uniqueId)})&&n.values&&0<n.values.length&&o.push("$$profile_".concat(r.uniqueId)),n.values.forEach(function(t){p.find(function(e){return e.tagName==="$$profile_".concat(r.uniqueId,":").concat(t.value)})||o.push("$$profile_".concat(r.uniqueId,":").concat(t.value))})}p.forEach(function(t){if(t.tagName.startsWith("$$profile_".concat(r.uniqueId,":")))switch(r.customType){case"text":case"number":case"singleSelect":t.tagName!=="$$profile_".concat(r.uniqueId,":").concat(n.value)&&a.push(t.tagName);break;case"multipleSelect":n.values.find(function(e){return t.tagName==="$$profile_".concat(r.uniqueId,":").concat(e.value)})||a.push(t.tagName)}})}}))),e&&e.imageUrl&&o.push("$$profile_picture"),t?userTags.assignUserTags(o,{},n):userTags.removeProfileTags(a,function(e,t){e?n(e):userTags.assignUserTags(o,{overridingUser:t},n)}))},assignUserTags:function(n,a,s){"string"==typeof n&&(n=n.split(",")),a=a||{},authAPI.getCurrentUser(function(e,t){var r;t=a.overridingUser||t,e?(console.log(e),s(e,null)):t&&(r=!1,userTags.matchUserTags({tags:n,user:t},function(e,t){var n;r=t.isProfileTagUpdate,t.matchingTag?(t.matchingTag.appliedCount++,t.matchingTag.lastAssgined=(new Date).toISOString()):((n={}).tagName=t.tagName.toLowerCase().trim().replace(/ /g,"-"),n.appliedCount=1,n.firstAssgined=(new Date).toISOString(),n.lastAssgined=(new Date).toISOString(),t.appTags.push(n))},function(){authAPI._setCurrentUser(t)}),bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/assign",{tags:n,accessToken:t.accessToken}).success(function(e){authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated",isProfileTagUpdate:r}),s(null,!0)}).error(function(e){console.log(e),s(e)}))})},unassignUserTags:function(n,r,a){"string"==typeof n&&(n=n.split(",")),authAPI.getCurrentUser(function(e,t){e?(console.log(e),a(e,null)):t&&(userTags.matchUserTags({tags:n,user:t},function(e,t){var n;t.matchingTag&&(1<t.matchingTag.appliedCount&&!r.removeTag?(t.matchingTag.appliedCount--,t.matchingTag.lastAssgined=(new Date).toISOString()):(n=t.appTags.indexOf(t.matchingTag),t.appTags.splice(n,1)))},function(){r.preventRefresh||authAPI._setCurrentUser(t)}),bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/unassign",{tags:n,isPrefix:r.isPrefix||!1,accessToken:t.accessToken,removeTag:r.removeTag||!1}).success(function(e){r.preventRefresh||authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated"}),a(null,t)}).error(function(e){console.log(e),a(e,null)}))})},matchUserTags:function(e,t,n){var r=e.tags,a=e.user;if(r&&0<r.length&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId){var s=!1,i=window.appContext.currentApp.appId;a.tags||(a.tags={}),a.tags[i]||(a.tags[i]=[]);for(var o=0;o<r.length;o++){var u=r[o],p=!1;!s&&u&&0==u.indexOf("$$profile_")&&(s=!0);for(var c=0;c<a.tags[i].length;c++){var g=a.tags[i][c];if(g.tagName.toLowerCase()==u.toLowerCase()||-1<g.tagName.toLowerCase().indexOf(u.toLowerCase())){t(null,{appTags:a.tags[i],tagName:u,matchingTag:g,isProfileTagUpdate:s}),p=!0;break}}p||t(null,{appTags:a.tags[i],tagName:u,matchingTag:null,isProfileTagUpdate:s})}n&&n()}}};userTags.init();
"use strict";function RemoteDatastore(t,e,r,n,i){this.appId=t,this.pluginId=e,this.instanceId=r,this.liveMode=n,this.dataStoreUrl=i}RemoteDatastore.prototype={createReadUrl:function(t,e,r){e=this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+this.liveMode+"/"+e;return r&&(e+="?withDynamicData=true"),e},createSearchUrl:function(t){return this.dataStoreUrl+"/plugin/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+this.liveMode+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createCloneUrl:function(t){return this.dataStoreUrl+"/app/"+this.appId+"/plugin/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/clone/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/plugin/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/plugin/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/plugin/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/plugin/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createPublishUrl:function(){return this.dataStoreUrl+"/publish/"+this.appId},createServicesUrl:function(){return this.dataStoreUrl+"/app/"+this.appId+"/services/"+this.liveMode},createDeletePluginInstanceUrl:function(t){return this.dataStoreUrl+"/plugin/deletePluginInstance/"+this.appId+"/"+t},resolveTag:function(t){return null==t||""==t?"primary":t},_httpGet:function(t,e,s){"function"!=typeof e||s||(s=e,e=this),bfUtils.http?bfUtils.http.get(t).success(function(t){s.apply(e,[null,t])}).error(function(t,e,r,n){var i="datastore GET Error with URL: "+n.url;s(i),console.error("datastore GET Error: "+n.url,e)}):s("datastore GET Error:bfUtils.http is undefined. Try again later.")},_httpPost:function(t,e,s){bfUtils.http.post(t,e).success(function(t){s(null,t)}).error(function(t,e,r,n){var i="datastore POST Error with URL: "+n.url;s(i),console.error("datastore POST Result: ",e,n.url)})},_httpPut:function(t,e,s){bfUtils.http.put(t,e).success(function(t){s(null,t)}).error(function(t,e,r,n){var i="datastore PUT Error with URL: "+n.url;s(i),console.error("datastore PUT Result: ",e,n.url)})},get:function(t,e,r,n,i){return this._httpGet(this.createReadUrl(e,t,n),r,i),this},save:function(t,e,r){return this._httpPost(this.createSaveUrl(t),e,r),this},insert:function(t,e,r){return this._httpPost(this.createWriteUrl(t),e,r),this},clone:function(t,e,r){return this._httpPost(this.createCloneUrl(t),e,r),this},bulkInsert:function(t,e,r){return this._httpPost(this.createBulkInsertUrl(t),e,r),this},update:function(t,e,r){return this._httpPut(this.createWriteUrl(t),e,r),this},searchAndUpdate:function(t,e,r){return this._httpPost(this.createSearchAndUpdateUrl(t),e,r),this},delete:function(t,e,r,n){return this._httpPost(this.createDeleteUrl(t,e),r,n),this},search:function(t,e,r,n){return this._httpPost(this.createSearchUrl(t),r,n),this},publish:function(t,e){return this._httpPost(this.createPublishUrl(),t,e),this},getServices:function(t,e){return this._httpGet(this.createServicesUrl(),t,e),this},deletePluginInstance:function(t,e,r){return this._httpPost(this.createDeletePluginInstanceUrl(t),e,r),this}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function DatastoreAPI(t,e,i,n,r){var o;if(window.appContext&&window.appContext.currentApp||console.warn("invalid appContext in datastore"),this.enableCache=window.location.protocol.indexOf("http")<0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,this._featureSecurityAccess=void 0,window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.featureSecurityAccess?"enterprise"==window.appContext.currentApp.config.type&&(this._featureSecurityAccess="enabled"):this._featureSecurityAccess=window.appContext.currentApp.config.featureSecurityAccess),"object"==_typeof(t)?(this.appId=(o=t).appId,this.pluginId=o.pluginId,this.instanceId=o.instanceId,this.liveMode=o.liveMode,this.writeKey=o.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)):(this.appId=t,this.pluginId=e,this.instanceId=i,this.liveMode=n,r?this.writeKey=r:window.appContext.currentApp&&window.appContext.currentApp.keys&&window.appContext.currentApp.keys.datastoreKey?this.writeKey=window.appContext.currentApp.keys.datastoreKey:window.appContext.currentApp&&window.appContext.currentApp.datastoreWriteKey?this.writeKey=window.appContext.currentApp.datastoreWriteKey:this.writeKey=null),void 0===this.liveMode&&(this.liveMode=window.appContext.liveMode),"undefined"==typeof CustomEvent&&console.warn("Browser doesn't support CustomEvent"),"undefined"==typeof RemoteDatastore&&document.querySelector('script[src="scripts/overrides.js"]'))throw console.error("SDK is outdated. Please update to the most recent version."),"SDK is outdated. Please update to the most recent version.";r=new RemoteDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,this.dataStoreUrl);this.enableCache&&"undefined"!=typeof OfflineDatastore?this._provider=new OfflineDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,r):this._provider=r}DatastoreAPI.prototype={deviceOnline:function(){return"undefined"==typeof navigator||!navigator.connection||!navigator.connection.type||"none"!=navigator.connection.type},onUpdate:function(t){},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t)},onRefresh:function(t){document.addEventListener("datastoreOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("datastoreOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("datastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("datastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},get:function(t,r){if("function"==typeof r){var e,o=this,i="",s=!1;"object"==_typeof(t)?(e="string"==typeof t.tag?t.tag:"",i="string"==typeof t.id?t.id:"",s=t.withDynamicData):"string"==typeof t?e=t:null==e&&(e=""),"string"!=typeof e&&(e="");Date.now();return this._provider.get(i,e,{ds:this,obj:t},s,function(t,i){var n;404==t?r(null,null):t?r(t):null==i?r(null,null):(n=i.tag,i.tag=e,s&&i&&i.data&&i.data._buildfire?o._dynamicDataSecurityFilter(i.data._buildfire,function(t,e){i.data._buildfire=e,r(null,i),i.tag=n}):(r(null,i),i.tag=n))}),this}},save:function(e,i){if(window.toast&&window.toast("saving..."),this.writeKey){var n=e.tag,t=e.obj;"object"==_typeof(t)&&(t=this._cleanUp(t),t="undefined"!=typeof angular?angular.toJson({data:t,writeKey:this.writeKey,id:e.id}):JSON.stringify({data:t,writeKey:this.writeKey,id:e.id}));var r=this;return this._provider.save&&this._provider.save(n,t,function(t){404==t?(window.toast&&window.toast("404","danger"),i(null,null)):t?(window.toast&&window.toast("error saving","danger"),i(t)):(t={id:e.id,data:e.obj,tag:n},i(null,t),r.triggerOnUpdate(t))}),this}console.error("no write key has been provided")},insert:function(i,n){var r=i.tag,t=i.obj,e=i.checkDuplicate;"object"==_typeof(t)&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var o=this;return this._provider.insert&&this._provider.insert(r,t,function(t,e){404==t?n(null,null):t?n(t):(i.id=e.id,e={id:e.id,data:i.obj,tag:r},n(null,e),o.triggerOnUpdate(e))}),this},clone:function(i,n){var r=i.tag,t=i.obj,e=i.checkDuplicate;"object"==_typeof(t)&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var o=this;return this._provider.clone&&this._provider.clone(r,t,function(t,e){404==t?n(null,null):t?n(t):(i.id=e.id,e={id:e.id,data:i.obj,tag:r},n(null,e),o.triggerOnUpdate(e))}),this},bulkInsert:function(i,n){var r=i.tag,t=i.obj;"object"==_typeof(t)&&(t=this._cleanUp(t),t=JSON.stringify({data:t,writeKey:this.writeKey,checkDuplicate:!1}));var o=this;return this._provider.bulkInsert&&this._provider.bulkInsert(r,t,function(t,e){404==t?n(null,null):t?n(t):(t={data:i.obj,tag:r},n(null,t),o.triggerOnUpdate(t))}),this},update:function(i,n){window.toast&&window.toast("saving...");var t=i.tag,e=i.obj;"object"==_typeof(e)&&(e=this._cleanUp(e),e=JSON.stringify({id:i.id,data:e,writeKey:this.writeKey}));var r=this;return this._provider.update&&this._provider.update(t,e,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(e.record.tag=i.tag,n(null,e.record),r.triggerOnUpdate(e.record))}),this},searchAndUpdate:function(t,i){window.toast&&window.toast("saving...");var e=t.tag,n=t.obj;"object"==_typeof(n)&&(n=this._cleanUp(n),n=JSON.stringify({search:t.search,data:n,writeKey:this.writeKey}));var r=this;return this._provider.searchAndUpdate&&this._provider.searchAndUpdate(e,n,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(i(null,e),r.triggerOnUpdate(e))}),this},delete:function(i,n){var t=i.tag,e=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.delete&&this._provider.delete(t,i.id,e,function(t,e){404==t?n(null,null):t?n(t):(n(null,e),r.triggerOnUpdate(i))}),this},deletePluginInstance:function(i,n){var t=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.deletePluginInstance&&this._provider.deletePluginInstance(i.id,t,function(t,e){404==t?n(null,null):t?n(t):(n(null,e),r.triggerOnUpdate(i))}),this},search:function(t,i){var n=this,e=t.tag,r=t.obj;if("function"==typeof i)return"string"!=typeof e&&(e=""),"object"==_typeof(r)&&(r=JSON.stringify(r)),this._provider.search(e,t.obj,r,function(t,e){404==t?i(null,null):t?i(t):null==e?i(null,null):"string"==typeof e?i(null,bfUtils.tryParseJSON(e)):("pluginInstances"===n.pluginId&&"undefined"!=typeof userTags&&userTags.checkPluginAccessSettings&&e.result&&n._pluginInstancesSecurityFilter(e.result),i(null,e))}),this},publish:function(i){var t=JSON.stringify({publishKey:this.publishKey}),n=this;return this._provider.publish&&this._provider.publish(t,function(t,e){404==t?i(null,null):t?i(t):(i(null,bfUtils.tryParseJSON(e)),n.triggerOnUpdate(obj))}),this},getServices:function(t,i){return this._provider.getServices(t,function(t,e){404==t?i(null,null):t?i(t):i(null,e)}),this},_cleanUp:function(t){if(t){var e=JSON.stringify(t);-1<e.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in datastore. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:datastore"]));e=JSON.parse(e);return this._cleanUpTree(e),e}return t},_cleanUpTree:function(t){for(var e in t){var i=t[e];"_buildfire"==e&&i?(delete i.result,delete i.err):null!==i&&"object"==_typeof(i)&&this._cleanUpTree(t[e])}},_dynamicDataSecurityFilter:function(t,e){if("undefined"!=typeof userTags&&userTags.checkPluginAccessSettings)for(var i in t)i&&((i=t[i])&&i.result&&this._pluginInstancesSecurityFilter(i.result));e(null,t)},_pluginInstancesSecurityFilter:function(t){var e=this;t&&t.forEach(function(i){i&&i.data&&(i.hasAccess=!0,"enabled"===e._featureSecurityAccess&&userTags.checkPluginAccessSettings(i.data,function(t,e){i.hasAccess=e}))})}};
"use strict";var appApiKeys={_callbacksQueue:[],_getInProgress:!1,get:function(a){if(window.appContext){if(window.appContext.currentApp.apiKeys)return a&&a(null,window.appContext.currentApp.apiKeys),window.appContext.currentApp.apiKeys;a&&appApiKeys._callbacksQueue.splice(0,0,a),appApiKeys._getInProgress||(appApiKeys._getInProgress=!0,new window.DatastoreAPI({appId:window.appContext.currentApp.appId,pluginId:"apiKeys",instanceId:"apiKeys"}).get({tag:"apiKeys"},function(p,e){if(p){for(;a=appApiKeys._callbacksQueue.pop();)a(p);appApiKeys._getInProgress=!1}else{for(e&&e.data?window.appContext.currentApp.apiKeys=e.data:window.appContext.currentApp.apiKeys={};a=appApiKeys._callbacksQueue.pop();)a(null,window.appContext.currentApp.apiKeys);appApiKeys._getInProgress=!1}}))}else a&&a("no appContext")}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function UserDatastoreAPI(t,e,r,i,n){var s;window.appContext&&window.appContext.currentApp?(this.enableCache=!1,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==_typeof(t)?(this.appId=(s=t).appId,this.pluginId=s.pluginId,this.instanceId=s.instanceId,this.isAppUser="control"!=s.type,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=s.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)):(this.appId=t,this.pluginId=e,this.instanceId=r,this.isAppUser=i,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=n||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)),"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")):console.error("invalid appCOntext in userstore")}UserDatastoreAPI.prototype={onUpdate:function(t){},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t)},onRefresh:function(t){document.addEventListener("userDataOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("userDataOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("userDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("userDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},createReadUrl:function(t,e,r){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"+r},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t,e){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createSearchAndUpdateUrl:function(t,e){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createDeleteUrl:function(t,e,r){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(r)+"/"+e},createSaveUrl:function(t,e){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createBulkInsertUrl:function(t,e){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createAggregateUrl:function(t,e){return this.dataStoreUrl+"/user/aggregate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},_httpGet:function(r,i,n){"function"!=typeof i||n||(n=i,i=this),bfUtils.http.get(r).success(function(t){n.apply(i,[null,t])}).error(function(t,e){n.apply(i,[t=t||"http error with status: "+e]),console.error("user datastore GET Error: ",r,t)})},_httpPost:function(r,t,i){bfUtils.http.post(r,t).success(function(t){i(null,t)}).error(function(t,e){i(t=t||"http error with status: "+e),console.error("user datastore POST Result: ",r,t)})},_httpPut:function(r,t,i){bfUtils.http.put(r,t).success(function(t){i(null,t)}).error(function(t,e){i(t=t||"http error with status: "+e),console.error("user datastore PUT Result: ",r,t)})},get:function(t,n){if(console.log("user datastore: get "+JSON.stringify(t)),"function"==typeof n){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void n("no logged in user found",null);var e,r="";"object"==_typeof(t)?(e="string"==typeof t.tag?t.tag:"",r="string"==typeof t.id?t.id:""):"string"==typeof t?e=t:null==e&&(e=""),"string"!=typeof e&&(e="");var i,s=!1,o=null;try{this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),(o=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))&&(console.log("data cache: found cache"),(i=o).tag=t.tag,i.obj=t.obj,n(null,i),s=!0))}catch(t){console.error("dataDump error: "+t)}var a=Date.now();return this._httpGet(this.createReadUrl(e,this.writeKey,r,!1),{ds:this,isCallBackDone:s,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var r=this,i=Date.now()-a;if(console.log("user datastore: response time "+i),t)r.isCallBackDone||n(t);else if(404==t)r.isCallBackDone||n(null,null);else try{null==e?r.isCallBackDone||n(null,null):(r.ds.enableCache&&void 0!==r.userDataDumpAPI&&r.userDataDumpAPI.setData(r.ds.appId,r.ds.pluginId,r.ds.instanceId,r.ds.resolveTag(r.obj.tag),r.obj.id,e),e.tag=r.obj.tag,r.isCallBackDone?o&&o.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),r.ds.triggerOnUpdate(e)):n(null,e))}catch(t){s||n(t)}}),this}},save:function(r,i){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var n=r.tag,s=r.obj,t=r.userToken||this.writeKey;"object"==_typeof(s)&&(s="undefined"!=typeof angular?this.isAppUser?angular.toJson({data:s,userToken:this.writeKey,id:r.id}):angular.toJson({data:s,writeKey:this.writeKey,id:r.id}):this.isAppUser?JSON.stringify({data:s,userToken:this.writeKey,id:r.id}):JSON.stringify({data:s,writeKey:this.writeKey,id:r.id}));var o=this;return this._httpPost(this.createSaveUrl(n,t),s,function(t,e){404==t?(window.toast&&window.toast("404","danger"),i(null,null)):t?(window.toast&&window.toast("error saving","danger"),i(t)):(t={id:r.id,data:r.obj,tag:n},i(null,t),o.triggerOnUpdate(t),o._analyze(s))}),this},insert:function(r,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var n=r.tag,s=r.obj,t=r.checkDuplicate,e=r.userToken||this.writeKey;"object"==_typeof(s)&&(s=this.isAppUser?{data:s,userToken:this.writeKey}:{data:s,writeKey:this.writeKey},t&&(s.checkDuplicate=t),s=JSON.stringify(s));var o=this;return this._httpPost(this.createWriteUrl(n,e),s,function(t,e){404==t?i(null,null):t?i(t):(r.id=e.id,e={id:e.id,data:r.obj,tag:n},i(null,e),o.triggerOnUpdate(e),o._analyze(s))}),this},bulkInsert:function(r,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var n=r.tag,s=r.obj,t=r.userToken||this.writeKey;"object"==_typeof(s)&&(s=this.isAppUser?JSON.stringify({data:s,userToken:this.writeKey,checkDuplicate:!1}):JSON.stringify({data:s,writeKey:this.writeKey,checkDuplicate:!1}));var o=this;return this._httpPost(this.createBulkInsertUrl(n,t),s,function(t,e){404==t?i(null,null):t?i(t):(t={data:r.obj,tag:n},i(null,t),o.triggerOnUpdate(t),o._analyze(s))}),this},update:function(r,i){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var t=r.tag,n=r.obj,e=r.userToken||this.writeKey;"object"==_typeof(n)&&(n=this.isAppUser?JSON.stringify({id:r.id,data:n,userToken:this.writeKey}):JSON.stringify({id:r.id,data:n,writeKey:this.writeKey}));var s=this;return this._httpPut(this.createWriteUrl(t,e),n,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=r.tag,i(null,e.record),s.triggerOnUpdate(e.record),s._analyze(n))}),this},searchAndUpdate:function(t,r){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var e=t.tag,i=t.obj,n=t.userToken||this.writeKey;"object"==_typeof(i)&&(i=this.isAppUser?JSON.stringify({search:t.search,data:i,userToken:this.writeKey}):JSON.stringify({search:t.search,data:i,writeKey:this.writeKey}));var s=this;return this._httpPost(this.createSearchAndUpdateUrl(e,n),i,function(t,e){404==t?(window.toast&&window.toast("404"),r(null,null)):t?(window.toast&&window.toast("error updating"),r(t)):(r(null,e),s.triggerOnUpdate(e),s._analyze(i))}),this},delete:function(r,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var t={},e=r.tag,n=r.userToken||this.writeKey,t=this.isAppUser?JSON.stringify({userToken:this.writeKey}):JSON.stringify({writeKey:this.writeKey}),s=this;return this._httpPost(this.createDeleteUrl(e,r.id,n),t,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),s.triggerOnUpdate(r))}),this},search:function(t,r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var e=t.tag,t=t.obj;return"function"==typeof r?("string"!=typeof e&&(e=""),"string"==typeof t&&(t=JSON.parse(t)),this.isAppUser?t.userToken=this.writeKey:t.writeKey=this.writeKey,"object"==_typeof(t)&&(t=JSON.stringify(t)),this._httpPost(this.createSearchUrl(e),t,function(t,e){404==t?r(null,null):t?r(t):r(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):void 0},aggregate:function(t,r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var e=t.tag,i=t.obj,t=t.userToken||this.writeKey;return"function"==typeof r?("string"!=typeof e&&(e=""),"string"==typeof i&&(i=JSON.parse(i)),this.isAppUser?i.userToken=this.writeKey:i.writeKey=this.writeKey,"object"==_typeof(i)&&(i=JSON.stringify(i)),this._httpPost(this.createAggregateUrl(e,t),i,function(t,e){404==t?r(null,null):t?r(t):r(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):void 0},dataDump:function(r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var i=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?r(null,null):t?r(t):(r(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this},_analyze:function(t){"string"==typeof t&&-1<t.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in userData. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:userData"]))}};
"use strict";function ownKeys(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function AnalyticsAPI(e,t,n,i,s){var o;this.analyticsHostUrl=siteConfig.endPoints.analyticsHost,"object"==_typeof(e)?(this.appId=(o=e).appId,this.pluginId=o.pluginId,this.instanceId=o.instanceId,this.liveMode=o.liveMode,this.developerId=o.developerId):(this.appId=e,this.pluginId=t,this.instanceId=n,this.liveMode=i,this.developerId=s),this.source=window.siteConfig&&"app"===window.siteConfig.scope?"app":"web",this.config={},this.defaultConfig={buildfireTracking:"identifiedWithoutConsent",thirdPartyTracking:"identifiedWithoutConsent",googleAnalyticsEnabled:!0,facebookAnalyticsEnabled:"undefined"!=typeof facebookConnectPlugin,segmentEnabled:!0},this.initialized=!1,this.eventQueue=[],this.idfa="undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.idfa?cordova.plugins.idfa:null,this._user=this._getUser(),this.secondLevelEmailVerificationEnabled=!1,window.whitelabelContext&&window.whitelabelContext.whitelabelId&&(this.whitelabelId=window.whitelabelContext.whitelabelId,window.whitelabelContext.selfProvSettings&&(this.secondLevelEmailVerificationEnabled=window.whitelabelContext.selfProvSettings.secondLevelEmailVerificationEnabled)),this.init()}AnalyticsAPI.prototype={init:function(){function s(){o.firebase._isEnabled=o.config.googleAnalyticsEnabled,o.firebase._isAnonymous=function(){return o._isAnonymous("thirdPartyTracking")},o.firebase.init(),o.facebook._isEnabled=o.config.facebookAnalyticsEnabled,o.facebook._isAnonymous=function(){return o._isAnonymous("thirdPartyTracking")},o.facebook.init(),window.appContext&&window.appContext.liveMode&&o.appId&&o._trackInstall(),o.initialized=!0,o.executeQueuedEvents()}var o=this;if(this.appId||(this.appId=window.appContext&&window.appContext.currentApp?window.appContext.currentApp.appId:null),!this.appId||"undefined"==typeof DatastoreAPI)return s();new DatastoreAPI(this.appId,"stringResources",1,0,appContext.currentApp.keys.datastoreKey).get({},function(e,t){if(e)return console.error(err),o.config=o.defaultConfig,s();if(o.config=t&&t.data&&t.data.appPermissions&&t.data.appPermissions.analytics_tracking?t.data.appPermissions.analytics_tracking:o.defaultConfig,[o.config.thirdPartyTracking,o.config.buildfireTracking].includes("identifiedWithConsent")){if(!o.idfa)return s();o.idfa.getInfo().then(function(e){if(bfUtils.isAndroid){if(e.limitAdTracking)return localStorage.setItem("trackingConsented",!1),s();if(localStorage.getItem("".concat(o.appId,"-analytics-perm-request"))&&localStorage.getItem("trackingConsented"))return s();var t=o.config.android,n=t.title,i=t.content,t=t.actionBtn;localStorage.getItem("".concat(o.appId,"-analytics-perm-request"))||(richModal.display({title:n,richContent:i,showDismissButton:!0,dismissButtonText:"Decline",forceAction:!0,action:{title:t,handler:function(){localStorage.setItem("trackingConsented",!0),s()}}},function(){localStorage.setItem("trackingConsented",!1),s()}),localStorage.setItem("".concat(o.appId,"-analytics-perm-request"),!0))}bfUtils.isIOS&&(localStorage.setItem("trackingConsented",!e.trackingLimited),e.trackingPermission===o.idfa.TRACKING_PERMISSION_NOT_DETERMINED?(document.addEventListener("IOS_ATT_RESPONSE",function(e){e=e.detail;localStorage.setItem("trackingConsented",e===o.idfa.TRACKING_PERMISSION_AUTHORIZED),s()},{once:!0}),o.idfa.requestPermission().then(function(e){e!==o.idfa.TRACKING_PERMISSION_NOT_DETERMINED&&(e=new CustomEvent("IOS_ATT_RESPONSE",{detail:e}),document.dispatchEvent(e))}).catch(function(){s()})):s())})}else s()})},getTrackingConsented:function(){return 1==localStorage.getItem("trackingConsented")},queueEvent:function(e,t){if(!0===this.initialized)return this.executeEvent(e,t);this.eventQueue.push({context:e,method:t})},executeEvent:function(e,t){t.apply(e)},executeQueuedEvents:function(){var n=this;(this.eventQueue||[]).forEach(function(e){var t=e.context,e=e.method;n.executeEvent(t,e)}),this.eventQueue=[]},_getIpInfo:function(e){function t(){var e=new XMLHttpRequest;e.open("GET",window.siteConfig.endPoints.crmHost+"/ipinfo",!0),e.onreadystatechange=function(){if(4==e.readyState){if(200<=e.status&&e.status<400){if(e.responseText){var t={};try{t=JSON.parse(e.responseText)}catch(e){t={}}}t=t,!0&&(t={data:t,lastSyncDate:new Date},localStorage.setItem("analyticsUserIpInfo",JSON.stringify(t)))}AnalyticsAPI.IPInfoCalled=!1}},e.send(null)}var n,i,s=localStorage.getItem("analyticsUserIpInfo");if(s){try{s=JSON.parse(s)}catch(e){s=null}var o=new Date,a=s&&s.lastSyncDate?new Date(s.lastSyncDate):new Date;i=o,n=(n=a).getTime(),i=i.getTime(),n=Math.abs(i-n),Math.round(n/864e5)<=30&&s&&s.data?e&&e(s.data):(e&&e(s?s.data:null),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t()))}else e&&e(),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t())},_updateMetadata:function(e){var t,n=null;"undefined"==typeof authAPI||(t=authAPI.getCurrentUser())&&t._id&&(n={userId:t._id,username:t.username,email:t.email||t.username,displayName:t.displayName,firstName:t.firstName,lastName:t.lastName,tags:[]},window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&t.tags&&t.tags[window.appContext.currentApp.appId]&&(n.tags=t.tags[window.appContext.currentApp.appId].map(function(e){return{tagName:e.tagName}}))),e.user=n,"undefined"!=typeof push&&null!=push.deviceId&&(e.deviceId=push.deviceId)},_getUser:function(){if("undefined"==typeof authAPI)return this._getAnonymousUser();var e=authAPI.getCurrentUser();return e&&e.username?{userId:e.username,isValidEmail:this.secondLevelEmailVerificationEnabled?e.isValidEmail:1}:"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser()},_getAnonymousUser:function(){var e,t,n=localStorage.getItem("analyticsUser");if(n)try{s=JSON.parse(n)}catch(e){console.log(e)}if(!s){n=this._getCookie("ajs_anonymous_id");if(n)s={anonymousId:n.replace("%22","").replace("%22","")};else{var i=1,s={anonymousId:(e=new Date,t=e.getMilliseconds()+"",++e+t+(1e4==++i?i=1:i))};try{localStorage.setItem("analyticsUser",JSON.stringify(s))}catch(e){console.log(e)}}}return s},_getBrowserInfo:function(){return{path:document.location.pathname,referrer:document.referrer,url:document.location.href,title:document.title,platform:window.device&&window.device.platform?window.device.platform.toLowerCase():""}},_getCookie:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var s=n[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""},_trackInstall:function(){localStorage.getItem("INSTALL_TRACKED")||(this.trackAction("app/installed",{appId:this.appId}),localStorage.setItem("INSTALL_TRACKED","true"))},_isAnonymous:function(e){return!this.config[e]||"anoynomousWithoutConsent"===this.config[e]||"identifiedWithoutConsent"!==this.config[e]&&("identifiedWithConsent"===this.config[e]?"false"==localStorage.getItem("trackingConsented"):void 0)},firebase:{_plugin:void 0,_analytics:void 0,_userId:null,_isEnabled:!1,init:function(){this._isEnabled&&(this._plugin="undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase?cordova.plugins.firebase:null,this._analytics=this._plugin?this._plugin.analytics:null)},logEvent:function(e,t){this._analytics&&(e=this._sanitizeKey(e),t=this._sanitizeMetadata(t),this._analytics.logEvent(e,t))},setScreenName:function(e){this._analytics&&(e=this._sanitizeKey(e),this._analytics.setScreenName(e))},_syncUserId:function(){this._user&&!this._user.userId&&this._userId!==this._user.userId&&(this._userId=this._user.userId,this._analytics.setUserId(this._user.userId))},_setUserProperties:function(){if(this._user)for(var e in this._user)this._user.hasOwnProperty(e)&&this._analytics.setUserProperty(e,this._user[e])},_sanitizeKey:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:40;return"string"!=typeof e?e:e.replace(/[\W_]+/g,"_").slice(0,t)},_sanitizeMetadata:function(e){var o=this;"function"==typeof this._isAnonymous&&!this._isAnonymous()||(delete e.user,delete e.deviceId,delete e.ipInfo);var n=function n(i){var s={};return Object.keys(i).forEach(function(e){var t=i[e];"object"!==_typeof(t)||null===t||Array.isArray(t)?["string","number"].includes(_typeof(t))&&(s[o._sanitizeKey(e)]=o._sanitizeKey(t,100)):Object.assign(s,n(t))}),s}(e);return Object.keys(n).slice(0,25).reduce(function(e,t){return e[t]=n[t],e},{})}},facebook:{_analytics:null,_isEnabled:!1,init:function(){var e;this._isEnabled&&(this._analytics="undefined"!=typeof cordova&&"undefined"!=typeof facebookConnectPlugin?facebookConnectPlugin:null,this._analytics&&(e=localStorage.getItem("trackingConsented"),facebookConnectPlugin.setAdvertiserIDCollectionEnabled(e),facebookConnectPlugin.setAdvertiserTrackingEnabled(e),facebookConnectPlugin.setAutoLogAppEventsEnabled(e)))},logEvent:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;this._analytics&&(e=this._sanitizeKey(e),"function"==typeof this._isAnonymous&&!this._isAnonymous()||(delete t.user,delete t.deviceId,delete t.ipInfo),this._analytics.logEvent(e,t,n))},_sanitizeKey:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:40;return"string"!=typeof e?e:e.replace(/[\W_]+/g,"_").slice(0,t)}},trackAction:function(e,t,n){var i=this;this.queueEvent(this,function(){i._trackAction(e,t,n)})},_trackAction:function(e,t,n){var i,s,o,a,r,l,c,d=this,u=this;if(t){var p,g=this._getBrowserInfo();for(p in g)t[p]=g[p]}return(t=t||this._getBrowserInfo()).source=this.source,this._updateMetadata(t),this.analyticsHostUrl&&e&&(i=function(){u._httpPost(u.analyticsHostUrl+"/event",c,!s,function(e,t){n&&n(e,t)})},s=!!t&&t.forceSync,t&&delete t.forceSync,t.skipThirdParty||(this.queueEvent(this,function(){d.firebase.logEvent(e,t)}),this.queueEvent(this,function(){d.facebook.logEvent(e,t)})),(o=!this._isAnonymous("buildfireTracking"))||(delete t.user,delete t.deviceId),a=(l=this.config).segmentEnabled,r=l.thirdPartyTracking,l=l.buildfireTracking,c={type:"action",value:e,metadata:t,context:{whitelabelId:u.whitelabelId,appId:u.appId,pluginId:u.pluginId,instanceId:u.instanceId,liveMode:u.liveMode,developerId:u.developerId||void 0},config:{segmentEnabled:a,thirdPartyTracking:r,buildfireTracking:l,trackingConsented:o},user:u._user},t.skipThirdParty&&(c.config.segmentEnabled=!1,delete t.skipThirdParty),o?this._getIpInfo(function(e){e&&e.country&&(t.ipInfo=e),i()}):i()),this},trackView:function(e,t,n){var i=this;this.queueEvent(this,function(){i._trackView(e,t,n)})},_trackView:function(e,t,n){var i,s,o,a,r,l,c,d=this;if(t){var u,p=this._getBrowserInfo();for(u in p)t[u]=p[u]}return(t=t||this._getBrowserInfo()).source=this.source,this._updateMetadata(t),this.analyticsHostUrl&&e&&(i=function(){d._httpPost(d.analyticsHostUrl+"/event",c,!0,function(e,t){n&&n()})},(r=this._getCookie("_ga"))&&((s={}).clientId=r.substr(6)),this.firebase.setScreenName(e),(o=!this._isAnonymous("buildfireTracking"))||(delete t.user,delete t.deviceId),a=(l=this.config).segmentEnabled,r=l.thirdPartyTracking,l=l.buildfireTracking,c={type:"view",value:e,metadata:t,context:{whitelabelId:d.whitelabelId,appId:d.appId,pluginId:d.pluginId,instanceId:d.instanceId,liveMode:d.liveMode,developerId:d.developerId||void 0},segmentContext:{"Google Analytics":s},config:{segmentEnabled:a,thirdPartyTracking:r,buildfireTracking:l,trackingConsented:o},user:d._user},o?this._getIpInfo(function(e){e&&(t.ipInfo=e),i()}):i()),this},registerPluginEvent:function(i,s){var n,e,o;"cp"==window.siteConfig.scope||"sdk"==window.siteConfig.scope?i?(i.data||(i.data={}),i.options||(i.options={}),(n=i.data).key?n.title?(n._titleLowerCase=n.title.toLowerCase(),e=this.instanceId+"_pluginEvents",(o=new DatastoreAPI(this.appId,this.pluginId,e,this.liveMode)).searchAndUpdate({tag:"events",obj:{$set:n},search:{key:n.key}},function(e,t){null==e&&t&&0==t.nModified?o.insert({tag:"events",obj:n,checkDuplicate:!1},function(e,t){var n=new CustomEvent("pluginAnalyticsRegisterEvent",{detail:{data:i.data,options:i.options}});document.dispatchEvent(n),s&&s(e,t)}):s&&s(e,t)})):s&&s("Missing event title",null):s&&s("Missing event key",null)):s&&s("invalid params",null):s&&s("This method works only on Control Side",null)},unregisterPluginEvent:function(e,i){var t,s;e&&e.key?(t=this.instanceId+"_pluginEvents",(s=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode)).search({tag:"events",obj:{filter:{"$json.key":e.key}}},function(e,t){if(!e&&t&&0<t.length)for(var n=0;n<t.length;n++)s.delete({tag:"events",id:t[n].id},function(e,t){i&&i(e,t)});else i&&i(e,t)})):i&&i("Missing event key",null)},getPluginEvents:function(e,n){var t=this.instanceId+"_pluginEvents",t=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode);(e=e||{}).skip=e.skip||0,e.limit=e.limit||50,t.search({tag:"events",obj:e},function(e,t){n&&n(e,t)})},setUsername:function(e){this._user.userId=e,this._user.anonymousId&&(this._user.updateIdentity=!0)},setUserProperties:function(e){this._user.properties=e,this._user.updateIdentity=!0},_httpPost:function(e,t,n,i){if(!window.__$haultEvents){var s=new XMLHttpRequest;s.open("POST",e,n),s.setRequestHeader("Content-type","application/JSON");var o=this;t.user&&t.user.userId&&t.user.userId.userId&&(t.user=a(t.user),localStorage.setItem("analyticsUser",JSON.stringify(t.user))),s.onreadystatechange=function(){4==s.readyState&&(200<=s.status&&s.status<400?(o._user&&o._user.userId&&o._user.userId.userId&&(o._user=a(o._user)),o._user.updateIdentity&&(delete o._user.updateIdentity,delete o._user.properties,delete o._user.anonymousId),localStorage.setItem("analyticsUser",JSON.stringify(o._user)),i(null,s.responseText)):0==s.status?(i(s.status),window.__$haultEvents=!0):i(s.status))};n=null;try{n=JSON.stringify(t)}catch(e){console.error("error stringifying analytics data",t.context,t.type+":"+t.value,t.metadata,t,e)}if(n)try{s.send(n)}catch(e){e.code&&console.error("error sending analytics",e,t,t.context,t.type+":"+t.value,t.metadata,n,e)}}function a(e){return e&&"object"==_typeof(e.userId)?a(e.userId):e}},session:{_sessionsObject:{},init:function(){this._sessionsObject=JSON.parse(localStorage.getItem(window.appContext.currentApp.appId+"-sessions")),this._sessionsObject?(this._sessionsObject.appSession&&(this._sessionsObject.appSession.terminationReason="appUnload",this._syncApp()),this._sessionsObject.pluginSession&&(this._sessionsObject.pluginSession.terminationReason="appUnload",this._sessionsObject.pluginSession.old=!0,this._syncPlugin())):this._sessionsObject={},this._trackAppSession(),bfUtils.isMobileDevice?(document.addEventListener("deviceAppResumed",this.onDeviceResumed.bind(this),!1),document.addEventListener("deviceAppBackgrounded",this.onDeviceBackground.bind(this),!1)):document.addEventListener("sessionActivity",this._handleUserActivity.bind(this),!1)},_updateLocalStorage:function(){localStorage.setItem(window.appContext.currentApp.appId+"-sessions",JSON.stringify(this._sessionsObject))},_handleUserActivity:function(){!bfUtils.isMobileDevice&&this._sessionsObject&&(this._sessionsObject.appSession&&(300<this._getTimeDifference(new Date,new Date(this._sessionsObject.appSession.lastPulseTime))?(this._sessionsObject.appSession.terminationReason="inactivity",this._updateLocalStorage(),this.startAppSession()):(this._sessionsObject.appSession.lastPulseTime=new Date,this._updateLocalStorage())),this._sessionsObject.pluginSession&&(300<this._getTimeDifference(new Date,new Date(this._sessionsObject.pluginSession.lastPulseTime))?(this._sessionsObject.pluginSession.terminationReason="inactivity",this._sessionsObject.pluginSession.old=!0,this._updateLocalStorage(),this.startPluginSession()):(this._sessionsObject.pluginSession.lastPulseTime=new Date,this._updateLocalStorage())))},_getTimeDifference:function(e,t){return Math.ceil((e.getTime()-t.getTime())/1e3)},_syncApp:function(){var e;this._sessionsObject.appSession&&((e={}).session=JSON.parse(JSON.stringify(this._sessionsObject.appSession)),e.actionName="app/appSession",this._sessionsObject.appSession=null,this._updateLocalStorage(),this._saveSession(e))},_syncPlugin:function(){var e,t;this._sessionsObject.pluginSession&&(e={},(t=JSON.parse(JSON.stringify(this._sessionsObject.pluginSession))).lastPulseTime=t.old?t.lastPulseTime:new Date,t.terminationReason||(t.terminationReason="pluginNavigation"),e.session=t,e.actionName="app/pluginSession",this._sessionsObject.pluginSession=null,this._updateLocalStorage(),this._saveSession(e))},_trackAppSession:function(){this._handleUserActivity(),this.startAppSession()},trackPluginSession:function(e){this.pluginContext=e.context,this._handleUserActivity(),this.startPluginSession()},_saveSession:function(e){var t,n=e.session,i={appId:window.appContext.currentApp.appId,pluginId:n.pluginId,instanceId:n.instanceId,liveMode:window.appContext.liveMode},s=this._getTimeDifference(new Date(n.lastPulseTime),new Date(n.startSessionTime));s<=0||10800<s||(t={pluginTitle:n.pluginTitle,pluginId:n.pluginId,instanceId:n.instanceId,startSessionTime:n.startSessionTime,endSessionTime:n.lastPulseTime,sessionDurationSeconds:s,terminationReason:n.terminationReason,_buildfire:{aggregationValue:s}},setTimeout(function(){new AnalyticsAPI(i).trackAction(e.actionName,t,function(e,t){e&&console.error("Error: could not track the app action")})},3e3))},createSessionObject:function(e){var t={};return t.lastPulseTime=new Date,t.startSessionTime=new Date,e&&"plugin"==e.type&&(t.pluginId=e.context&&e.context.pluginId,t.instanceId=e.context&&e.context.instanceId,t.pluginTitle=e.context&&e.context.title),t},startAppSession:function(){var e=this;this.endAppSession(),this._syncApp();var t=this.createSessionObject();this._sessionsObject.appSession=t,this._updateLocalStorage(),bfUtils.isMobileDevice&&(this.appSessionInterval=setInterval(function(){t.lastPulseTime=new Date,e._updateLocalStorage()},1e4))},startPluginSession:function(){var e=this;this.endPluginSession(),this._syncPlugin();var t=this.createSessionObject({type:"plugin",context:this.pluginContext});this._sessionsObject.pluginSession=t,this._updateLocalStorage(),bfUtils.isMobileDevice&&(this.pluginSessionInterval=setInterval(function(){t.lastPulseTime=new Date,e._updateLocalStorage()},1e4))},endAppSession:function(){this.appSessionInterval&&(clearInterval(this.appSessionInterval),this.appSessionInterval=void 0)},endPluginSession:function(){this.pluginSessionInterval&&(clearInterval(this.pluginSessionInterval),this.pluginSessionInterval=void 0)},suspendAppSession:function(){this.endAppSession()},suspendPluginSession:function(){this.endPluginSession()},onDeviceResumed:function(){this._sessionsObject&&this._sessionsObject.appSession&&(this._sessionsObject.appSession.terminationReason="paused"),this._sessionsObject&&this._sessionsObject.pluginSession&&(this._sessionsObject.pluginSession.terminationReason="paused",this._sessionsObject.pluginSession.old=!0),this.startAppSession(),this.startPluginSession(),console.log("App resumed")},onDeviceBackground:function(){this.suspendAppSession(),this.suspendPluginSession(),console.log("App on hold")}},_trackPerformanceMetrics:function(){if(bfUtils.isIOS||bfUtils.isAndroid){var e=localStorage.getItem("$$performance_log");if(e)try{var t=JSON.parse(e),n=t.loaderStart,i=t.connectionType,s=t.freshInstall,o=t.manifestResponseTime,a=t.manifestUpdateStart,r=t.manifestUpdateFinish,l=t.manifestComponentsDownloaded,c=localStorage.getItem("$$index_page_start"),d=localStorage.getItem("$$launcher_loaded"),u=localStorage.getItem("$$launcher_splash_hidden"),p=localStorage.getItem("$$onboarding_start")||0,g=localStorage.getItem("$$onboarding_end")||0,h=c-n,f=d-c,_=d-n,I=g-p,y=u-n;0<I&&(y-=I);var v=r-a,m=l&&0<l.length;m&&(l=l.map(function(e){var t=e.downloadFinishedAt-e.downloadStartedAt,n=e.unzipFinishedAt-e.downloadFinishedAt,i=e.unzipFinishedAt-e.downloadStartedAt;return _objectSpread(_objectSpread({},e),{},{downloadSpeed:t,unzipSpeed:n,total:i})}).sort(function(e,t){return t-e}));var S,b={indexPageSpeed:h,launcherIndexLoadTime:f,launcherTotalLoadTime:_,total:y,connectionType:i,freshInstall:s,manifestResponseTime:o,contentManagerUpdateSpeed:v},w=JSON.parse(localStorage.getItem("$$launch_logs_all")||"[]"),A=JSON.parse(localStorage.getItem("$$launch_logs_slow")||"[]");w&&(3<=w.length&&w.pop(),w.unshift(b),localStorage.setItem("$$launch_logs_all",JSON.stringify(w))),(m?2e4<=y:1e4<=y)&&(A&&(3<=A.length&&A.pop(),A.unshift(b),localStorage.setItem("$$launch_logs_slow",JSON.stringify(A))),S=m?"APP: loading with updates took longer than usual":"APP: loading took longer than usual",atatusAPI.log(S,[],_objectSpread(_objectSpread({},b),{},{manifestComponentsDownloaded:l})));var P=m?"app/load_speed_update":"app/load_speed";this.trackAction(P,_objectSpread(_objectSpread({skipThirdParty:!0},b),{},{_buildfire:{aggregationValue:y}}))}catch(e){console.error(e)}finally{localStorage.removeItem("$$performance_log"),localStorage.removeItem("$$index_page_start"),localStorage.removeItem("$$launcher_loaded"),localStorage.removeItem("$$launcher_splash_hidden"),localStorage.removeItem("$$onboarding_start"),localStorage.removeItem("$$onboarding_end")}}}},setTimeout(function(){window.appContext&&window.appContext.liveMode&&AnalyticsAPI.prototype.session.init()},3e3);
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function PublicDatastoreAPI(t,e,n){var i;window.appContext&&window.appContext.currentApp?(this.enableCache=!0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==_typeof(t)?(this.appId=(i=t).appId,this.pluginId=i.pluginId,this.instanceId=i.instanceId):(this.appId=t,this.pluginId=e,this.instanceId=n),this.writeKey="public","undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")):console.error("invalid appCOntext in publicdata")}PublicDatastoreAPI.prototype={onUpdate:function(t){document.addEventListener("publicDataOnUpdate",t,!1)},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t);t=new CustomEvent("publicDataOnUpdate",{detail:t});document.dispatchEvent(t)},onRefresh:function(t){document.addEventListener("publicDataOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("publicDataOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("publicDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("publicDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},createReadUrl:function(t,e){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createAggregateUrl:function(t){return this.dataStoreUrl+"/user/aggregate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},_httpGet:function(e,n,i){"function"!=typeof n||i||(i=n,n=this),bfUtils.http.get(e).success(function(t){i.apply(n,[null,t])}).error(function(t){i.apply(n,[t]),console.error("public datastore GET Error: ",e,t)})},_httpPost:function(e,t,n){bfUtils.http.post(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("public datastore POST Result: ",e,t)})},_httpPut:function(e,t,n){bfUtils.http.put(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("public datastore PUT Result: ",e,t)})},get:function(t,r){if(console.log("public datastore: get "+JSON.stringify(t)),"function"==typeof r){if(this.writeKey){var e,n="";"object"==_typeof(t)?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:""):"string"==typeof t?e=t:null==e&&(e=""),"string"!=typeof e&&(e="");var i,o=!1,a=null;try{this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),(a=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))&&(console.log("data cache: found cache"),(i=a).tag=t.tag,i.obj=t.obj,r(null,i),o=!0))}catch(t){console.error("dataDump error: "+t)}var s=Date.now();return this._httpGet(this.createReadUrl(e,n,!1),{ds:this,isCallBackDone:o,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var n=this,i=Date.now()-s;if(console.log("public datastore: response time "+i),t)n.isCallBackDone||r(t);else if(404==t)n.isCallBackDone||r(null,null);else try{null==e?n.isCallBackDone||r(null,null):(n.ds.enableCache&&void 0!==n.userDataDumpAPI&&n.userDataDumpAPI.setData(n.ds.appId,n.ds.pluginId,n.ds.instanceId,n.ds.resolveTag(n.obj.tag),n.obj.id,e),e.tag=n.obj.tag,n.isCallBackDone?a&&a.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),n.ds.triggerOnUpdate(e)):r(null,e))}catch(t){o||r(t)}}),this}console.error("no write key has been provided")}},save:function(n,i){if(window.toast&&window.toast("saving..."),this.writeKey){var r=n.tag,o=n.obj;"object"==_typeof(o)&&(o="undefined"!=typeof angular?angular.toJson({data:o,userToken:this.writeKey,id:n.id}):JSON.stringify({data:o,userToken:this.writeKey,id:n.id}));var a=this;return this._httpPost(this.createSaveUrl(r),o,function(t,e){404==t?(window.toast&&window.toast("404","danger"),i(null,null)):t?(window.toast&&window.toast("error saving","danger"),i(t)):(t={id:n.id,data:n.obj,tag:r},i(null,t),a.triggerOnUpdate(t),a._analyze(o))}),this}console.error("no write key has been provided")},insert:function(n,i){if(this.writeKey){var r=n.tag,o=n.obj,t=n.checkDuplicate;"object"==_typeof(o)&&(o={data:o,userToken:this.writeKey},t&&(o.checkDuplicate=t),o=JSON.stringify(o));var a=this;return this._httpPost(this.createWriteUrl(r),o,function(t,e){404==t?i(null,null):t?i(t):(n.id=e.id,e={id:e.id,data:n.obj,tag:r},i(null,e),a.triggerOnUpdate(e),a._analyze(o))}),this}console.error("no write key has been provided")},bulkInsert:function(n,i){if(this.writeKey){var r=n.tag,o=n.obj;"object"==_typeof(o)&&(o=JSON.stringify({data:o,userToken:this.writeKey,checkDuplicate:!1}));var a=this;return this._httpPost(this.createBulkInsertUrl(r),o,function(t,e){404==t?i(null,null):t?i(t):(t={data:n.obj,tag:r},i(null,t),a.triggerOnUpdate(t),a._analyze(o))}),this}console.error("no write key has been provided")},update:function(n,i){if(window.toast&&window.toast("saving..."),this.writeKey){var t=n.tag,r=n.obj;"object"==_typeof(r)&&(r=JSON.stringify({id:n.id,data:r,userToken:this.writeKey}));var o=this;return this._httpPut(this.createWriteUrl(t),r,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=n.tag,i(null,e.record),o.triggerOnUpdate(e.record),o._analyze(r))}),this}console.error("no write key has been provided")},searchAndUpdate:function(t,n){if(window.toast&&window.toast("saving..."),this.writeKey){var e=t.tag,i=t.obj;"object"==_typeof(i)&&(i=JSON.stringify({search:t.search,data:i,userToken:this.writeKey}));var r=this;return this._httpPost(this.createSearchAndUpdateUrl(e),i,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),r.triggerOnUpdate(e),r._analyze(i))}),this}console.error("no write key has been provided")},delete:function(n,i){if(this.writeKey){var t=n.tag,e=JSON.stringify({userToken:this.writeKey}),r=this;return this._httpPost(this.createDeleteUrl(t,n.id),e,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),r.triggerOnUpdate(n))}),this}console.error("no write key has been provided")},search:function(t,n){if(this.writeKey){var e=t.tag,t=t.obj;if("function"==typeof n)return"string"!=typeof e&&(e=""),(t="string"==typeof t?JSON.parse(t):t).userToken=this.writeKey,"object"==_typeof(t)&&(t=JSON.stringify(t)),this._httpPost(this.createSearchUrl(e),t,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this}else console.error("no write key has been provided")},aggregate:function(t,n){if(this.writeKey){var e=t.tag,t=t.obj;if("function"==typeof n)return"string"!=typeof e&&(e=""),(t="string"==typeof t?JSON.parse(t):t).userToken=this.writeKey,"object"==_typeof(t)&&(t=JSON.stringify(t)),this._httpPost(this.createAggregateUrl(e),t,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this}else console.error("no write key has been provided")},dataDump:function(n){if(this.writeKey){var i=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this}console.error("no write key has been provided")},_analyze:function(t){"string"==typeof t&&-1<t.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in publicData. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:publicData"]))}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function AppDatastoreAPI(t){window.appContext&&window.appContext.currentApp?(this.enableCache=!0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==_typeof(t)?this.appId=t.appId:this.appId=t,this.pluginId="public",this.instanceId="public",this.writeKey="public","undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")):console.error("invalid appCOntext in publicdata")}AppDatastoreAPI.prototype={onUpdate:function(t){document.addEventListener("appDataOnUpdate",t,!1)},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t);t=new CustomEvent("appDataOnUpdate",{detail:t});document.dispatchEvent(t)},onRefresh:function(t){document.addEventListener("appDataOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("appDataOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("appDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("appDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},createReadUrl:function(t,e){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createAggregateUrl:function(t){return this.dataStoreUrl+"/user/aggregate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},_httpGet:function(e,n,r){"function"!=typeof n||r||(r=n,n=this),bfUtils.http.get(e).success(function(t){r.apply(n,[null,t])}).error(function(t){r.apply(n,[t]),console.error("appDatastore GET Error: ",e,t)})},_httpPost:function(e,t,n){bfUtils.http.post(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("appDatastore POST Result: ",e,t)})},_httpPut:function(e,t,n){bfUtils.http.put(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("appDatastore PUT Result: ",e,t)})},get:function(t,i){if(console.log("appDatastore: get "+JSON.stringify(t)),"function"==typeof i){if(this.writeKey){var e,n="";if("object"==_typeof(t)?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:""):"string"==typeof t&&(e=t),"string"!=typeof e||!e)return i(new Error("tag is required for appData"),null);var r,o=!1,a=null;try{this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),(a=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))&&(console.log("data cache: found cache"),(r=a).tag=t.tag,r.obj=t.obj,i(null,r),o=!0))}catch(t){console.error("dataDump error: "+t)}var s=Date.now();return this._httpGet(this.createReadUrl(e,n,!1),{ds:this,isCallBackDone:o,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var n=this,r=Date.now()-s;if(console.log("appDatastore: response time "+r),t)n.isCallBackDone||i(t);else if(404==t)n.isCallBackDone||i(null,null);else try{null==e?n.isCallBackDone||i(null,null):(n.ds.enableCache&&void 0!==n.userDataDumpAPI&&n.userDataDumpAPI.setData(n.ds.appId,n.ds.pluginId,n.ds.instanceId,n.ds.resolveTag(n.obj.tag),n.obj.id,e),e.tag=n.obj.tag,n.isCallBackDone?a&&a.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),n.ds.triggerOnUpdate(e)):i(null,e))}catch(t){o||i(t)}}),this}console.error("no write key has been provided")}},save:function(n,r){if(window.toast&&window.toast("saving..."),this.writeKey){var i=n.tag,o=n.obj;if("string"!=typeof i||!i)return r(new Error("tag is required for appData"),null);"object"==_typeof(o)&&(o="undefined"!=typeof angular?angular.toJson({data:o,userToken:this.writeKey,id:n.id}):JSON.stringify({data:o,userToken:this.writeKey,id:n.id}));var a=this;return this._httpPost(this.createSaveUrl(i),o,function(t,e){404==t?(window.toast&&window.toast("404","danger"),r(null,null)):t?(window.toast&&window.toast("error saving","danger"),r(t)):(t={id:n.id,data:n.obj,tag:i},r(null,t),a.triggerOnUpdate(t),a._analyze(o))}),this}console.error("no write key has been provided")},insert:function(n,r){if(this.writeKey){var i=n.tag,o=n.obj,t=n.checkDuplicate;if("string"!=typeof i||!i)return r(new Error("tag is required for appData"),null);"object"==_typeof(o)&&(o={data:o,userToken:this.writeKey},t&&(o.checkDuplicate=t),o=JSON.stringify(o));var a=this;return this._httpPost(this.createWriteUrl(i),o,function(t,e){404==t?r(null,null):t?r(t):(n.id=e.id,e={id:e.id,data:n.obj,tag:i},r(null,e),a.triggerOnUpdate(e),a._analyze(o))}),this}console.error("no write key has been provided")},bulkInsert:function(n,r){if(this.writeKey){var i=n.tag,o=n.obj;if("string"!=typeof i||!i)return r(new Error("tag is required for appData"),null);"object"==_typeof(o)&&(o=JSON.stringify({data:o,userToken:this.writeKey,checkDuplicate:!1}));var a=this;return this._httpPost(this.createBulkInsertUrl(i),o,function(t,e){404==t?r(null,null):t?r(t):(t={data:n.obj,tag:i},r(null,t),a.triggerOnUpdate(t),a._analyze(o))}),this}console.error("no write key has been provided")},update:function(n,r){if(window.toast&&window.toast("saving..."),this.writeKey){var t=n.tag,i=n.obj;if("string"!=typeof t||!t)return r(new Error("tag is required for appData"),null);"object"==_typeof(i)&&(i=JSON.stringify({id:n.id,data:i,userToken:this.writeKey}));var o=this;return this._httpPut(this.createWriteUrl(t),i,function(t,e){404==t?(window.toast&&window.toast("404"),r(null,null)):t?(window.toast&&window.toast("error updating"),r(t)):(e.record.tag=n.tag,r(null,e.record),o.triggerOnUpdate(e.record),o._analyze(i))}),this}console.error("no write key has been provided")},searchAndUpdate:function(t,n){if(window.toast&&window.toast("saving..."),this.writeKey){var e=t.tag,r=t.obj;if("string"!=typeof e||!e)return n(new Error("tag is required for appData"),null);"object"==_typeof(r)&&(r=JSON.stringify({search:t.search,data:r,userToken:this.writeKey}));var i=this;return this._httpPost(this.createSearchAndUpdateUrl(e),r,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),i.triggerOnUpdate(e),i._analyze(r))}),this}console.error("no write key has been provided")},delete:function(n,r){if(this.writeKey){var t=n.tag,e=JSON.stringify({userToken:this.writeKey});if("string"!=typeof t||!t)return r(new Error("tag is required for appData"),null);var i=this;return this._httpPost(this.createDeleteUrl(t,n.id),e,function(t,e){404==t?r(null,null):t?r(t):(r(null,e),i.triggerOnUpdate(n))}),this}console.error("no write key has been provided")},search:function(t,n){if(this.writeKey){var e=t.tag,t=t.obj;if("function"==typeof n)return"string"==typeof e&&e?((t="string"==typeof t?JSON.parse(t):t).userToken=this.writeKey,"object"==_typeof(t)&&(t=JSON.stringify(t)),this._httpPost(this.createSearchUrl(e),t,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):n(new Error("tag is required for appData"),null)}else console.error("no write key has been provided")},aggregate:function(t,n){if(this.writeKey){var e=t.tag,t=t.obj;if("function"==typeof n)return"string"==typeof e&&e?((t="string"==typeof t?JSON.parse(t):t).userToken=this.writeKey,"object"==_typeof(t)&&(t=JSON.stringify(t)),this._httpPost(this.createAggregateUrl(e),t,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):n(new Error("tag is required for appData"),null)}else console.error("no write key has been provided")},dataDump:function(n){if(this.writeKey){var r=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),r.triggerOnUpdate(obj))}),this}console.error("no write key has been provided")},_analyze:function(t){"string"==typeof t&&-1<t.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in appData. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:appData"]))}};
"use strict";var deepLinkAPI={navigateToContent:function(n,t){var a=n.pluginInstanceId,i=n.payload,n=JSON.stringify(i),i="".concat("&dld=").concat(n);a&&(n=window.postMaster.launcherPluginAPI.navigation,"function"!=typeof t&&(t=Function.prototype),n.navigateToPluginInstance({instanceId:a,queryString:i},t))}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ShortLinksAPI(t){this.context=t,this.url=window.siteConfig.endPoints.appHost+"/api/app/"+this.context.appId+"/shortlink/"}ShortLinksAPI.prototype={generate:function(e,n){var i=this;if(e.pluginToken=this.context.pluginId,e.instanceId=this.context.instanceId,e.data&&"object"!=_typeof(e.data))n("data is not an object");else{if(e.extraMetaTags){if("object"!=_typeof(e.extraMetaTags))return void n("extraMetaTags is not array of objects");for(var t=0;t<e.extraMetaTags.length;t++)if("object"!=_typeof(e.extraMetaTags[t]))return void n("extraMetaTags is not array of objects")}bfUtils.http.post(this.url,e).success(function(t){var o=new AnalyticsAPI(i.context.appId,i.context.pluginId,i.context.instanceId,i.context.liveMode);e.shortLinkUrl=t.url,o.trackAction("shortlink/generate",e),n(null,t)}).error(function(t){n(t)})}}};
"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,t=function(){};return{s:t,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,p=!0,r=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return p=e.done,e},e:function(e){r=!0,o=e},f:function(){try{p||null==n.return||n.return()}finally{if(r)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function AppearanceAPI(e){this.pluginAPI=e}function resetToDefaults(){postMaster.isLauncherPluginActive()&&AppearanceAPI.prototype.titlebar.hide(),AppearanceAPI.prototype.sideMenu.show(),AppearanceAPI.prototype.fullScreenMode.disable(),AppearanceAPI.prototype.navbar.show();var e=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(e,"disableAutomaticNavigationBar",!1)}AppearanceAPI.prototype={getCSSFiles:function(e,t){return t(null,["https://bootswatch.com/cerulean/bootstrap.css"]),this},autosizeContainer:function(e,t){this.autosizeContainerHandler(e.height),t(null,null)},autosizeContainerHandler:function(){},setHeaderVisibility:function(e){var t=document.getElementById("pluginControlHeader"),n=document.getElementById("pluginControlHeaderTabs");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden")),n&&(e?n.classList.remove("hidden"):n.classList.add("hidden"))},beforeUpdate:function(e){document.addEventListener("appearanceBeforeUpdate",e,!1)},triggerBeforeUpdate:function(e){var t=new CustomEvent("appearanceBeforeUpdate");document.dispatchEvent(t)},onUpdate:function(e){document.addEventListener("appearanceOnUpdate",e,!1)},triggerOnUpdate:function(e){e&&(AppearanceAPI._appearance=e);e=new CustomEvent("appearanceOnUpdate");document.dispatchEvent(e)},onAppThemeUpdate:function(e){document.addEventListener("appThemeOnUpdate",e,!1)},triggerAppThemeUpdate:function(){var e=new CustomEvent("appThemeOnUpdate");document.dispatchEvent(e)},applyToScope:function(e,t,n,a){if(!e)return a&&a();var o=void 0;(o=angular.element(e).scope())[t]=n,o.$$phase||(o.$apply(),a&&a())},getScope:function(e){return angular.element(e).scope()},applyScopeFunction:function(e,t,n){var a=void 0;"function"==typeof(a=angular.element(e).scope())[t]&&a[t](),n&&n()},applyToRootScope:function(e,t,n){var a=void 0;(a=angular.element(document.body).scope().$root)[e]=t,a.$$phase||(a.$apply(),n&&n())},getRootScope:function(){return angular.element(document.body).scope().$root},getFooterMenu:function(e,t){"function"==typeof e&&(t=e);var n=localStorage.getItem("footerMenu"),e={};t(null,e=n?JSON.parse(n):e)},getAppearance:function(e,n){if(AppearanceAPI._appearance)n(null,AppearanceAPI._appearance);else{if(!window.appContext||!window.appContext.currentApp||!window.appContext.currentApp.appId)return n("missing currentApp parameters");var t="appearance",a={appId:window.appContext.currentApp.appId,pluginId:t,instanceId:t,liveMode:window.appContext.liveMode};new window.DatastoreAPI(a).get({tag:t,withDynamicData:!0},function(e,t){return e?n(e,null):t&&t.data?(AppearanceAPI._appearance=t.data,n(null,t.data)):void n("No result",null)})}},updateCustomRegistration:function(e){AppearanceAPI._appearance&&(AppearanceAPI._appearance.customRegistration=e)},updateCustomLoginUI:function(e){AppearanceAPI._appearance&&e&&(AppearanceAPI._appearance.customLoginUI=e)},titlebar:{show:function(e,t){AppearanceAPI.prototype.titlebar.toggleVisibility(!0,"showNavigationBar",t)},hide:function(e,t){AppearanceAPI.prototype.titlebar.toggleVisibility(!1,"showNavigationBar",t)},toggleVisibility:function(e){function t(e){c+=e}function n(){0==--c&&o&&o()}var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"showNavigationBar",o=2<arguments.length?arguments[2]:void 0,p=document.getElementsByClassName("pluginFrame"),r=postMaster.isLauncherPluginActive(),i=AppearanceAPI.prototype.getRootScope(),c=0;if(r||i.accessCodeVisible){i=document.getElementById("launcherPlugin");t(2),AppearanceAPI.prototype.applyToScope(i,"disableAutomaticNavigationBar",!0,n),AppearanceAPI.prototype.applyToScope(i,a,e,n)}else{t(2*p.length);for(var l=0;l<p.length;l++)AppearanceAPI.prototype.applyToScope(p[l],"disableAutomaticNavigationBar",!0,n),AppearanceAPI.prototype.applyToScope(p[l],a,e,n)}},reset:function(e,t){function n(e){r+=e}function a(){0==--r&&t&&t()}var o=document.getElementsByClassName("pluginFrame"),p=postMaster.isLauncherPluginActive(),r=0;if(p){var i=document.getElementById("launcherPlugin");n(2),AppearanceAPI.prototype.applyToScope(i,"disableAutomaticNavigationBar",!1,a),AppearanceAPI.prototype.applyToScope(i,e,!1,a);p=new HistoryAPI;p.historyItems&&1<p.historyItems.length&&AppearanceAPI.prototype.applyToScope(i,"showNavigationBar",!0,a)}else{n(2*o.length);var c,l=_createForOfIteratorHelper(o);try{for(l.s();!(c=l.n()).done;){var u=c.value;AppearanceAPI.prototype.applyToScope(u,"disableAutomaticNavigationBar",!1,a),AppearanceAPI.prototype.applyToScope(u,e,!1,a)}}catch(e){l.e(e)}finally{l.f()}}},isVisible:function(e,t){var n=!postMaster.isWidgetPluginInactive(),a=document.querySelectorAll(n?".pluginFrame":"#launcherPlugin");if(!a.length)return t&&t(null,!1),!1;var o=angular.element(a[0]).scope(),a=o.showNavigationBar;return!0===o.disableAutomaticNavigationBar?(t&&t(null,a),a):(t&&t(null,n),n)}},navbar:{show:function(e,t){AppearanceAPI.prototype.navbar.toggleVisibility(!0,"isFooterMenuHidden",e,t)},hide:function(e,t){AppearanceAPI.prototype.navbar.toggleVisibility(!1,"isFooterMenuHidden",e,t)},toggleVisibility:function(e,t,n,a){function o(e){s+=e}function p(){0==--s&&a&&a()}var r=document.getElementsByClassName("pluginFrame"),i=postMaster.isLauncherPluginActive(),c=document.getElementById("menuNav"),l=document.getElementById("footerMenuParent"),u=document.getElementById("notesDialog"),s=0;if(i){i=document.getElementById("launcherPlugin");o(4),AppearanceAPI.prototype.applyToScope(l,t,!e,p),AppearanceAPI.prototype.applyToScope(c,t,!e,p),AppearanceAPI.prototype.applyToScope(u,t,!e,p),AppearanceAPI.prototype.applyToScope(i,t,!e,p)}else{o(3+r.length),AppearanceAPI.prototype.applyToScope(c,t,!e,p),AppearanceAPI.prototype.applyToScope(l,t,!e,p),AppearanceAPI.prototype.applyToScope(u,t,!e,p);for(var d=0;d<r.length;d++)AppearanceAPI.prototype.applyToScope(r[d],t,!e,p)}},isVisible:function(){return AppearanceAPI.prototype.getRootScope().turnOnFooterMenu}},fullScreenMode:{enable:function(e,t){AppearanceAPI.prototype.fullScreenMode.toggle(!0,e,t)},disable:function(e,t){AppearanceAPI.prototype.fullScreenMode.toggle(!1,e,t)},toggle:function(e){function t(){0==--a&&n&&n()}var n=2<arguments.length?arguments[2]:void 0,a=3,o=postMaster.isLauncherPluginActive(),p=document.getElementById("launcherPlugin");o&&AppearanceAPI.prototype.applyToScope(p,"isInFullScreenMode",!e);var r=AppearanceAPI.prototype.getScope(p)||{},i=r.showNavigationBar,c=r.disableAutomaticNavigationBar,r=r.previousState;e?(r||AppearanceAPI.prototype.applyToScope(p,"previousState",{showNavigationBar:i,disableAutomaticNavigationBar:c}),AppearanceAPI.prototype.titlebar.toggleVisibility(!e,"isInFullScreenMode",t)):o?r?(AppearanceAPI.prototype.applyToScope(p,"previousState",null),AppearanceAPI.prototype.applyToScope(p,"disableAutomaticNavigationBar",r.disableAutomaticNavigationBar,t),1<((new HistoryAPI).historyItems||[]).length&&AppearanceAPI.prototype.applyToScope(p,"showNavigationBar",!0,t)):c?AppearanceAPI.prototype.titlebar[i?"show":"hide"]({},t):AppearanceAPI.prototype.titlebar.reset("isInFullScreenMode",t):t(),AppearanceAPI.prototype.sideMenu.toggleVisibility(!e,"isInFullScreenMode",null,t),AppearanceAPI.prototype.navbar.toggleVisibility(!e,"isInFullScreenMode",null,t)}},sideMenu:{show:function(e,t){AppearanceAPI.prototype.sideMenu.toggleVisibility(!0,"isMenuIconHidden",e,t)},hide:function(e,t){AppearanceAPI.prototype.sideMenu.toggleVisibility(!1,"isMenuIconHidden",e,t)},toggleVisibility:function(e,t,n,a){var o,p=document.getElementById("menuNav"),r=document.getElementById("menu-location");postMaster.isLauncherPluginActive()&&(o=document.getElementById("launcherPlugin"),AppearanceAPI.prototype.applyToScope(o,t,!e)),AppearanceAPI.prototype.applyToScope(r,t,!e,a),AppearanceAPI.prototype.applyToScope(p,t,!e,a);a=AppearanceAPI.prototype.getScope(r)||{},r=a.isMenuIconHidden,a=a.isInFullScreenMode;document.body.classList.contains("menu-inactive")||document.body.classList[a||r?"add":"remove"]("menu-disabled")},open:function(e,t){cpSync.menu.showSideMenu(),t&&t()},close:function(e,t){var n=document.getElementById("sideMenuCloseButton");AppearanceAPI.prototype.applyScopeFunction(n,"closeMenu",t)},getStyles:function(e,a){e={appId:e.appId,pluginId:"sideMenu",instanceId:1,liveMode:e.liveMode,writeKey:e.writeKey};null==this.dataStore&&(this.dataStore=new DatastoreAPI(e)),this.dataStore.get({tag:"",withDynamicData:!0},function(e,t){var n;e?a(e):(e=(n=t.data&&t.data._buildfire?t.data._buildfire:{}).sideMenu,(e=(void 0===(e=void 0===(e=e)?{style:void 0}:e).style&&(e.style={alignLeft:!1,showIcon:!0,icon:"icon-menu",transparent:!1,floating:!1}),e)).id=t.id,e.styleUpdate=n.styleUpdate,a(null,e))})},reset:function(e){AppearanceAPI.prototype.sideMenu.getStyles(e,function(e,t){var n=t.style,a=postMaster&&postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.history&&postMaster.launcherPluginAPI.history.historyItems?postMaster.launcherPluginAPI.history.historyItems:null,o=!postMaster.isLauncherPluginActive()&&window.location.href.indexOf("#/pluginContainer")<0,p=!a||!a.length||1==a.length&&"home"==a[0].source,a=document.getElementById("faux-http-section");a&&((a=AppearanceAPI.prototype.getScope(a)).showIcon=n.showIcon,a.menuIcon=n.icon,a.isMenuLeftAligned=n.alignLeft,a.menuDisabled=!(!t||!t.content)&&t.content.turnOffSideMenu,a.menuDisabled||(a.menuDisabled=a.authShown&&!a.allowCancel&&!0!==a.showMenuOnAuth),n&&n.headerImage&&(a.headerImage=n.headerImage.replace("/width/21/","/width/78/")),t=a.showMenuIcon()?"":" ng-hide ",t+=!o&&p?n.alignLeft?" menu menu-left-align ":" menu menu-right-align ":n&&n.alignLeft?" menu menuLeft ":" menu ",n.transparent&&(t+=" translucent "),n.floating&&(n.alignLeft?t+=" floating-left ":t+=" floating-right "),a.menuClass=t,a.$$phase||a.$apply())})}},ready:function(){var e=document.getElementsByClassName("pluginFrame");if(postMaster.isLauncherPluginActive()){var t=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(t,"readyToShow",!0)}else for(var n=0;n<e.length;n++)AppearanceAPI.prototype.applyToScope(e[n],"readyToShow",!0);window.spinner&&window.spinner.hide()}},document.addEventListener("launcherOnReactivated",function(){var e=document.getElementById("launcherPlugin"),t=AppearanceAPI.prototype.getScope(e),n={};Object.assign(n,t);var a=n.isInFullScreenMode,o=n.isFooterMenuHidden,e=n.disableAutomaticNavigationBar,t=n.showNavigationBar;n.isMenuIconHidden?AppearanceAPI.prototype.sideMenu.hide():AppearanceAPI.prototype.sideMenu.show(),a?AppearanceAPI.prototype.fullScreenMode.enable():AppearanceAPI.prototype.fullScreenMode.disable(),o?AppearanceAPI.prototype.navbar.hide():AppearanceAPI.prototype.navbar.show(),e&&(t?AppearanceAPI.prototype.titlebar.show():AppearanceAPI.prototype.titlebar.hide())}),document.addEventListener("AUTH_CURRENT_USER_ON_LOGOUT",function(){resetToDefaults()},!1),document.addEventListener("pluginOnActivated",function(){AppearanceAPI.prototype.fullScreenMode.disable(),AppearanceAPI.prototype.navbar.show(),AppearanceAPI.prototype.sideMenu.show()});
"use strict";function _typeof(a){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}var audioPlayer={_audio:null,_allowPlay:!0,_interval:{time:5e3,id:null,retries:0},get audio(){return null==this._audio&&("undefined"!=typeof Audio?this._audio=new Audio:this._audio={}),this._audio},_currentTrack:null,settings:{autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1},getSettings:function(a,e){e(null,this.settings)},setSettings:function(a){a&&(this.audio&&this.settings&&(this.audio.volume=this.settings.volume),angular.extend(this.settings,a),this.save())},resetSettingsToDefault:function(){audioPlayer.settings={autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1}},isStream:function(){return!isFinite(audioPlayer.audio.duration)},isAndroid:function(){var a=!1;return a=window.device&&window.device.platform&&"android"===window.device.platform.toLowerCase()?!0:a},retryAllowed:function(){var a;return!(!audioPlayer.isStream()||10<audioPlayer._interval.retries||4===(null===(a=audioPlayer.audio.error)||void 0===a?void 0:a.code))},retryAudio:function(){audioPlayer._interval.id||(audioPlayer._interval.id=setInterval(function(){audioPlayer.retryAllowed()&&(console.info("Retrying to play audio ".concat(audioPlayer._interval.retries++)),audioPlayer._interval.retries++,audioPlayer.resumePlay())},audioPlayer._interval.time))},cancelRetry:function(){null!=audioPlayer._interval.id&&(clearInterval(audioPlayer._interval.id),audioPlayer._interval.id=null,audioPlayer._interval.retries=0)},resumePlay:function(){audioPlayer.audio.paused||(console.warn("restart audio",new Date),audioPlayer._allowPlay=!0,audioPlayer.play(audioPlayer._currentTrack))},init:function(){var e=this;try{this.audio&&this.audio.addEventListener&&this.audio.addEventListener("ended",function(){audioPlayer._allowPlay=!0,e.triggerOnEvent("audioEnded",e._currentTrack),e.settings.autoPlayNext&&e.next()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("stalled",function(a){console.warn("audio stalled: ".concat(a.target)),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(a){console.warn("audio error: ".concat(JSON.stringify(a.target.error))),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("playing",function(){audioPlayer.cancelRetry()})}catch(a){console.warn("error",a)}var a=0;this.audio&&this.audio.addEventListener&&this.audio.addEventListener("timeupdate",function(){e._currentTrack&&(e._currentTrack.lastPosition=e.audio.currentTime),5<Math.abs(a-e.audio.currentTime)&&(e.save(),a=e.audio.currentTime),e.triggerOnEvent("timeUpdate",{currentTime:e.audio.currentTime,duration:e.audio.duration,buffer:{start:e.audio.buffered.length?e.audio.buffered.start(0):0,end:e.audio.buffered.length?e.audio.buffered.end(0):0}})}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(a){e.triggerOnEvent("error",a)});var i=window.appContext;if(null!=i&&void 0!==i&&void 0!==i.currentApp&&void 0!==i.currentApp.appId){i=window.localStorage.getItem("audioPlayer");if("{}"!=i)try{var t=JSON.parse(i);e.settings=t.settings,e.playlist=t.playlist,e._currentTrack=t._currentTrack,e.audio.volume=e.settings.volume}catch(a){console.warn("audioPlayer localStorage error",a)}}else console.warn("no app found for audioPlayer")},getCurrentTrack:function(a,e){return e&&e(this._currentTrack),this._currentTrack},onEvent:function(e){function a(a){e&&e(a.detail)}return document.addEventListener("audioPlayer.onEvent",a,!1),{clear:function(){document.removeEventListener("audioPlayer.onEvent",a,!1)}}},triggerOnEvent:function(a,e){a=new CustomEvent("audioPlayer.onEvent",{detail:{event:a,data:e}});document.dispatchEvent(a)},_tmrSave:null,save:function(){this._tmrSave&&clearTimeout(this._tmrSave),this._tmrSave=setTimeout(function(){try{var e={settings:audioPlayer.settings,playlist:audioPlayer.playlist,_currentTrack:audioPlayer._currentTrack};window.localStorage.setItem("audioPlayer",JSON.stringify(e))}catch(a){e=a.message||"";console.error("Error with JSON.stringify. ",e)}},500)},play:function(a){if(a&&a.url&&0===a.url.indexOf("file:///")&&bfUtils.isIOS&&(a.url=new URL(window._appRoot).origin+new URL(a.url).pathname),(!audioPlayer._currentTrack||a&&audioPlayer._currentTrack.url!=a.url)&&(audioPlayer._allowPlay=!0),audioPlayer._allowPlay&&!this._isAwaitingPlay()){var e=_typeof(a);if("string"==e)a={url:a};else if("number"==e){e=this.playlist.tracks[a];if(!e)return;this.playlist.lastIndex=a,a=e,this.save()}else if(!a)return void(this.audio.paused&&(this.audio.play().catch(function(a){var e;if(4!==(null===(e=audioPlayer.audio.error)||void 0===e?void 0:e.code))throw a;console.warn(a)}),this.triggerOnEvent("resume",{track:this._currentTrack})));this.audio.src=a.url,this.audio.preload="auto",audioPlayer.audio.play().then(function(){audioPlayer.settings&&audioPlayer.settings.autoJumpToLastPosition&&a.lastPosition&&audioPlayer.skip(a.lastPosition),a.startAt&&audioPlayer.skip(a.startAt),audioPlayer._currentTrack=a,audioPlayer.triggerOnEvent("play",{track:a})}).catch(function(a){var e;if(4!==(null===(e=audioPlayer.audio.error)||void 0===e?void 0:e.code))throw a;console.warn(a)}),audioPlayer._allowPlay=!1,!audioPlayer.isBackgroundModeEnabled&&"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&(audioPlayer.isBackgroundModeEnabled=!0,cordova.plugins.backgroundMode.enable&&cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.on("activate",function(){cordova.plugins.backgroundMode.disableWebViewOptimizations()}))}},skip:function(a){this.audio&&(this.audio.currentTime+a<0?this.audio.currentTime=0:this.audio.currentTime+a>this.audio.duration?this.audio.currentTime=this.audio.duration:this.audio.currentTime+=a,this.triggerOnEvent("skip",a))},pause:function(){this._isPlaying()&&(audioPlayer.audio.pause(),audioPlayer._allowPlay=!0,audioPlayer.triggerOnEvent("pause"))},isPaused:function(a,e){e&&e(null,audioPlayer.audio.paused)},_isAwaitingPlay:function(){return!this.audio.paused&&0===this.audio.readyState},_isPlaying:function(){return this.audio&&0<this.audio.currentTime&&!this.audio.paused&&!this.audio.ended&&2<this.audio.readyState},loopTrack:function(a){audioPlayer.audio&&(audioPlayer.audio.loop=a)},next:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex++,audioPlayer.playlist.lastIndex>=audioPlayer.playlist.tracks.length){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1,null;audioPlayer.playlist.lastIndex=0}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("next",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},previous:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex--,audioPlayer.playlist.lastIndex<0){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=0,null;audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("previous",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},removeFromPlaylist:function(a){var e;a<0||a>=audioPlayer.playlist.tracks.length||(e=audioPlayer.playlist.tracks.splice(a,1),a==audioPlayer.playlist.lastIndex?audioPlayer.playlist.lastIndex=-1:a<audioPlayer.playlist.lastIndex&&audioPlayer.playlist.lastIndex--,audioPlayer.triggerOnEvent("removeFromPlaylist",{index:a,track:e,newPlaylist:audioPlayer.playlist}))},addToPlaylist:function(a){audioPlayer.playlist.tracks.push(a),audioPlayer.save(),audioPlayer.triggerOnEvent("addToPlaylist",{track:a,newPlaylist:audioPlayer.playlist})},setTime:function(a){audioPlayer.audio.currentTime=a,audioPlayer._currentTrack.lastPosition=audioPlayer.audio.currentTime,audioPlayer.save(),audioPlayer.triggerOnEvent("timeUpdate",{currentTime:audioPlayer.audio.currentTime,duration:audioPlayer.audio.duration,buffer:{start:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.start(0):0,end:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.end(0):0}})},setVolume:function(a){a<0?a=0:1<a&&a<=100&&(a/=100),audioPlayer.settings&&(audioPlayer.settings.volume=a),audioPlayer.audio&&(audioPlayer.audio.volume=a),audioPlayer.triggerOnEvent("volumeChange",{volume:a}),audioPlayer.save()},playlist:{tracks:[],lastIndex:-1},getPlaylist:function(a,e){e(null,audioPlayer.playlist)}};"undefined"==typeof PluginAPI||PluginAPI.prototype.mediaAPI||(PluginAPI.prototype.mediaAPI={audioPlayer:window.audioPlayer}),audioPlayer.init();
"use strict";function NotificationsAPI(t){this.context=t,this.dialogApi=null}NotificationsAPI.prototype={initDialog:function(){this.dialogApi||(this.dialogApi=new DialogAPI(this.context))},alert:function(t,n){if(this.initDialog(),(t=t||{}).message)return t.okButton||(t.okButton={text:"OK"}),t.okButton.text||(t.okButton.text="OK"),this.dialogApi.alert({title:t.title,message:t.message,okButtonText:t.okButton.text},function(t,i){if(n)return window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.confirm?t?n(t):n(1,void 0):n(i)});n("invalid parameter, messing message")},confirm:function(t,n){if(this.initDialog(),(t=t||{}).message)return t.confirmButton||(t.confirmButton={text:"Confirm"}),t.confirmButton.text||(t.confirmButton.text="Confirm"),t.cancelButton||(t.cancelButton={text:"Cancel"}),t.cancelButton.text||(t.cancelButton.text="Cancel"),t.buttonLabels=[t.confirmButton.text,t.cancelButton.text],this.dialogApi.confirm({title:t.title,message:t.message,confirmButtonText:t.confirmButton.text,cancelButtonText:t.cancelButton.text},function(t,i){if(n)return window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.confirm?n(i?1:2,void 0):n(i)});n("invalid parameter, missing message",null)},prompt:function(n){function t(t,i){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(t,i){window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.prompt?navigator.notification.prompt(t.message,i,t.title,t.buttonLabels,t.defaultText):(t=prompt(t.message),i&&i(t))}),beep:function(t,i){console.log("calling NotificationsAPI.beep ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.beep&&navigator.notification.beep(t.times),i&&i()},vibrate:function(t,i){console.log("calling NotificationsAPI.vibrate ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&("function"==typeof navigator.vibrate?navigator.vibrate(t.milliseconds):navigator.notification&&"function"==typeof navigator.notification.vibrate&&navigator.notification.vibrate(t.milliseconds)),i&&i()}};
"use strict";function appAPI(t){this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=t.endPoints.appHost,"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}appAPI.prototype={getPluginInstances:function(t,n){var e=new DatastoreAPI(this.appId,"pluginInstances",1,this.liveMode,null);(t=t||{}).pageSize||(t.pageSize=50),t.pageIndex||(t.pageIndex=1);t={obj:{filter:{"$json.title":{$regex:null!=t.title?t.title:""}},page:t.pageIndex-1,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};e.search(t,function(t,e){t||n(null,{data:e.result,totals:e.totalRecord})})},getPluginInstancesByIds:function(e,a){var s=0,i=[],o=new DatastoreAPI(this.appId,"pluginInstances",1,this.liveMode,null);!function n(){var t={obj:{filter:{"$json.instanceId":{$in:e||[]}},page:s,pageSize:50,withDynamicData:!0,recordCount:!0},tag:""};o.search(t,function(t,e){!t&&e&&e.result&&(i=i.concat(e.result)),e&&e.result&&50<=e.result.length?(s++,n()):a(null,{data:i,totals:i.length})})}()}};
"use strict";"undefined"==typeof ActionItemsAPI&&(window.ActionItemsAPI=function(e){this.templateUrl="pages/share/actionBuilder.html",this.listTemplateUrl=window._appRoot+"pages/templates/actionItemsListDialog.html",this.controller="actionItemsCtrl",this.context=e,this.init()}),ActionItemsAPI.prototype.init=function(){},ActionItemsAPI.prototype.list=function(e,t){e={templateUrl:this.listTemplateUrl,controller:"actionItemsListDialogCtrl",size:"lg",data:e};window.openDialog(e,function(e){t&&t(null,e)})},ActionItemsAPI.prototype.executeOpenWebLink=function(e,t){ActionItemsAPI.prototype.openWebLink(e.url,e.openIn,t)},ActionItemsAPI.prototype.openWebLink=function(e,t,n){var o,i,a;e&&(o="_blank"===t,i=window.open(e,t,"location=no"),o&&(a=setTimeout(function(){ActionItemsAPI.prototype.openWebLink(e,"_system",n),i&&i.close()},1e3)),i&&i.addEventListener("loadstart",function(){a&&clearTimeout(a)}),n&&n(i?null:"failed to open window"),i||ActionItemsAPI.prototype.popUpCtrlScope.show(e))},ActionItemsAPI.prototype.sendEmail=function(e,t,n){window.open("mailto:"+(null!=e&&""!=e?e:"")+"?"+(null!=t&&""!=t?"subject="+t:"")+"&"+(null!=n&&""!=n?"body="+n:""),"_system")},ActionItemsAPI.prototype.navigateToAddress=function(e,t){var n;e&&t&&(n="https://maps.google.com/?q=",window.device&&null!=window.device.platform&&("android"==window.device.platform.toLowerCase()?n="geo:?q=":"ios"==window.device.platform.toLowerCase()&&(n="maps://maps.apple.com?q=")),window.open(n+e+","+t,"_system","location=no,menubar=no,titlebar=no,toolbar=no"))},ActionItemsAPI.prototype.callNumber=function(e){e&&(e=e.replace(/ /,""),window.open("tel:"+e,"_system","location=no,menubar=no,titlebar=no,toolbar=no"))},ActionItemsAPI.prototype.sendSms=function(e){e&&(e=e.replace(/ /,""),-1!=navigator.platform.indexOf("Android")||-1!=navigator.platform.indexOf("Linux")||null==navigator.platform||-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")?(e="sms:"+e,window.open(e,"_system")):console.error("This action can't be used on browser , it should be used on actual device"))},ActionItemsAPI.prototype.chat=function(p,c){var e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),l=window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI,t={obj:{filter:{"$json.token":"b15c62f2-7a99-48dc-a37a-e42d46bd3289"},pageSize:1,page:0,sort:{createdOn:-1},withDynamicData:!0}};e.search(t,function(e,t){var n,o,i,a,s,r;t&&t.length&&(n=t[0].data.instanceId,o=t[0].data._buildfire.pluginType.result[0].token,i=t[0].data._buildfire.pluginType.result[0].folderName,a=t[0].data.title,s=authAPI.getCurrentUser(),r=function(){var e="wid="+encodeURIComponent(p+":"+s._id)+"&userIds="+encodeURIComponent(c.join(","));l?l.navigation.navigateTo({pluginId:o,instanceId:n,title:a,folderName:i,pushToHistory:!0,queryString:e},null):console.warn("Plugin API is empty")},s?r():authAPI.login(null,function(e,t){t&&(s=t,r())}))})},ActionItemsAPI.prototype.linkToAppContent=function(e,s){var t=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),n={};n.obj={filter:{"$json.instanceId":e},pageSize:1,withDynamicData:!0},t.search(n,function(e,t){var n,o,i,a;t&&t.length&&(n=t[0].data.instanceId,o=t[0].data._buildfire.pluginType.result[0].token,i=t[0].data._buildfire.pluginType.result[0].folderName,a=t[0].data.title,(t=window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI)?t.navigation.navigateTo({pluginId:o,instanceId:n,title:a,folderName:i,pushToHistory:!0,queryString:s?s.queryString:null},null):console.warn("Plugin API is empty"))})},ActionItemsAPI.prototype.navigateToPage=function(e,t){var n;t=t||{},e?"login"!=e?"appSearch"!=e||"enterprise"==window.appContext.currentApp.config.type?(t.queryString&&(n=encodeURIComponent,e=e+"?"+Object.keys(t.queryString).map(function(e){return n(e)+"="+n(t.queryString[e])}).join("&")),window.location.hash=e):console.info("Action Items","Search page only available for Enterprise Plan"):window.authAPI&&window.authAPI.login&&window.authAPI.login():console.error("Action Items","navigateToPage","Please specify Page Name!")},ActionItemsAPI.prototype.purchase=function(n,o,i,a,s,r){var p;bfUtils.isMobileDevice&&("undefined"!=typeof inAppPurchaseAPI?(p=function(e,t){var n;e?(n={data:{title:" ",body:a,disableCancel:!0}},window.openDialog(n,function(){})):t&&t.isApproved&&(bfUtils.isIOS||(n={data:{title:" ",body:i,disableCancel:!0}},window.openDialog(n,function(){}),s&&ActionItemsAPI.prototype.linkToAppContent(s))),r(e,t)},inAppPurchaseAPI.checkAccess(o,function(e,t){e&&console.error("error while checking product",e),t&&t.owned?(s&&ActionItemsAPI.prototype.linkToAppContent(s),r(null,{product:t,isApproved:!0})):(t=o.productId,"subscriptions"===o.purchaseType&&o.subscription&&(t=o.subscription.subscriptionId||o.subscription.id),inAppPurchaseAPI.purchase({productId:t,purchaseType:n},p))})):console.error("inAppPurchaseAPI is undefined"))},ActionItemsAPI.prototype.execute=function(e,t){var n=!1;switch(e.action){case"linkToApp":this.linkToAppContent(e.instanceId,{queryString:e.queryString});break;case"linkToWeb":n=!0,this.openWebLink(e.url,e.openIn,t);break;case"sendEmail":this.sendEmail(e.email,e.subject,e.body);break;case"callNumber":this.callNumber(e.phoneNumber);break;case"sendSms":this.sendSms(e.phoneNumber);break;case"chat":this.chat(e.chatId,e.userIds);break;case"navigateToAddress":this.navigateToAddress(e.lat,e.lng);break;case"navigateToAppSettings":this.navigateToPage("appSettings");break;case"navigateToNotifications":this.navigateToPage("pushGroups");break;case"navigateToBookmarks":this.navigateToPage("bookmarks");break;case"navigateToSearch":var o={};e.searchAppValue&&(o.queryString={searchTerm:e.searchAppValue}),this.navigateToPage("appSearch",o);break;case"navigateToLogin":this.navigateToPage("login");break;case"navigateToNotes":window.notesAPI.openDialog();break;case"linkToSocialGoogle":case"linkToSocialFacebook":case"linkToSocialInstagram":case"linkToSocialTwitter":case"linkToSocialLinkedIn":this.openWebLink(e.url,"_system");break;case"purchase":n=!0,o={productId:e.productId,subscriptions:e.subscriptions,subscription:e.subscription,purchaseType:e.purchaseType};this.purchase(e.purchaseType,o,e.successMessage,e.errorMessage,e.instanceId,t)}n||t(null,!0)},"undefined"!=typeof $app&&$app.controller("actionItemsListDialogCtrl",["$scope","$data","$dialog",function(e,t,o){e.actionItems=t.actionItems,e.executeItem=!0,e.close=function(){o.close(null)},t.options&&t.options.executeItem&&(e.executeItem=t.options.executeItem),e.openActionItem=function(n){e.executeItem?(window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI).actionItems.execute(n,function(e,t){o.close(n)}):o.close(n)}}]);
"use strict";function PluginInstanceAPI(t){this.templateUrl="pages/plugins/pluginInstanceDialog/pluginInstanceDialog.html",this.controller="pluginInstanceDialog",this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=window.siteConfig.endPoints.appHost;t=JSON.parse(JSON.stringify(t));t.pluginId="pluginInstances",t.instanceId=1,this.ds=new DatastoreAPI(t)}PluginInstanceAPI.prototype={showDialog:function(t,n){window.openDialog?(t={templateUrl:this.templateUrl,controller:this.controller,size:"lg",data:t},window.openDialog(t,function(t){n&&n(null,t)})):console.error("openDialog isnt defined")},get:function(t,i){var n={};n.obj={filter:{"$json.instanceId":t},pageSize:1,withDynamicData:!0},this.ds.search(n,function(t,n){t?i(t,null):n&&n.length?i(null,n[0].data):i(null)})},_createReadUrl:function(){return this.appHost+"/api/appPluginInstances/getByIds/"+this.appId},_httpGet:function(t,n,i){bfUtils.http.get(t,{params:n}).success(function(t){i(null,t)}).error(function(t){i(t)})},search:function(t,n){var i;(t.title||t.instanceIds)&&(i={}),t.title&&(i["$json.title"]={$regex:t.title,$options:"-i"}),t.instanceIds&&(i["$json.instanceId"]={$in:t.instanceIds});t={obj:{filter:i,page:t.pageIndex,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};this.ds.search(t,n)}};
"use strict";var deviceAPI={calendar:{addEvent:function(a,i){permissionRequestsAPI.queueRequest("calendar",this,function(){var e;if(!(e=window.plugins&&window.plugins.calendar?window.plugins.calendar:e))return console.warn("cannot complete action add event to calendar. so fake it"),void(0<=window.location.protocol.indexOf("http")?alert("Adding to calendar requires native app."):console.error("Calendar feature not installed"));a.startDate instanceof Date||(a.startDate=new Date(a.startDate)),a.endDate instanceof Date||(a.endDate=new Date(a.endDate));function n(e){i(null,e)}function t(e){i(e)}var o;a.options?((o=e.getCalendarOptions()).firstReminderMinutes=a.options.firstReminderMinutes||o.firstReminderMinutes,o.secondReminderMinutes=a.options.secondReminderMinutes||o.secondReminderMinutes,o.recurrence=a.options.recurrence||o.recurrence,a.options.recurrenceEndDate&&(o.recurrenceEndDate=new Date(a.options.recurrenceEndDate)),e.createEventWithOptions(a.title,a.location,a.notes,a.startDate,a.endDate,o,n,t)):e.createEvent(a.title,a.location,a.notes,a.startDate,a.endDate,n,t)})}},share:function(e,n){function t(){console.warn("device sharing plugin not found. defaulting to email sending"),window.location="mailto:?subject="+encodeURIComponent(e.subject)+"&body="+encodeURIComponent(e.text+" "+e.link),n(null,!0)}var o,a,i;window.plugins&&window.plugins.socialsharing?(window.plugins.socialsharing.share(e.text,e.subject,e.image,e.link),n(null,!0)):navigator.share?(console.warn("device sharing plugin not found. defaulting to the Web Share API"),o=e.subject,a=e.link,i=e.text,navigator.share({title:o,text:i,url:a}).then(function(){n(null,!0)}).catch(function(e){20!=e.code&&t(),console.log("Error sharing:",e)})):t()},onAppBackgrounded:function(e){document.addEventListener("deviceAppBackgrounded",e,!1)},onAppResumed:function(e){document.addEventListener("deviceAppResumed",e,!1)},getAppSchema:function(){var e=null;return e=window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId?"app"+window.appContext.currentApp.appId.slice(0,6):e},contacts:{search:function(e,n){var t=this;permissionRequestsAPI.queueRequest("contacts",this,function(){t._search(e,n)})},_search:function(n,t){var e,o=new ComponentUIAPI,a=[],i={};navigator.contacts&&navigator.contacts.find?((e=new ContactFindOptions).desiredFields=[navigator.contacts.fieldType.displayName,navigator.contacts.fieldType.name,navigator.contacts.fieldType.nickname,navigator.contacts.fieldType.photos,navigator.contacts.fieldType.emails,navigator.contacts.fieldType.phoneNumbers],e.filter="",e.multiple=!0,navigator.contacts.find([""],function(e){e.forEach(function(e){i.text=e.displayName||e.name.formatted||e.nickname||"".concat(e.name.givenName||""," ").concat(e.name.familyName||""),i.imageUrl=e.photos&&0<e.photos.length?e.photos[0].value:window._appRoot+"media/avatar.png",i.secondaryText="",i.name=i.text,i.emails=e.emails||[],i.photos=e.photos||[],i.phoneNumbers=e.phoneNumbers||[],e.phoneNumbers&&e.phoneNumbers.forEach(function(e){i.secondaryText+="<div>".concat(e.value,"</div>")}),e.emails&&e.emails.forEach(function(e){i.secondaryText+="<div>".concat(e.value,"</div>")}),i.text&&(a.push(i),i={})});o.openDrawer({header:n.header||" ",content:n.content||"",listItems:a,multiSelection:!0,multiSelectionActionButton:{text:n.drawerButtonText||"Import",type:n.drawerButtonType||"success"},enableFilter:!0},function(e,n){n&&n.forEach(function(e){delete e.text,delete e.secondaryText,delete e.imageUrl}),t(e,n)})},function(e){t(e,null)},e)):t("Contacts plugin is not integrated or not working properly",null)},showDialog:function(e,n){var t=this;permissionRequestsAPI.queueRequest("contacts",this,function(){t._showDialog(e,n)})},_showDialog:function(e,t){navigator.contacts&&navigator.contacts.pickContact?navigator.contacts.pickContact(function(e){var n={};n.name=e.displayName||e.name.formatted||e.nickname||"".concat(e.name.givenName||""," ").concat(e.name.familyName||""),n.emails=e.emails||[],n.photos=e.photos||[],n.phoneNumbers=e.phoneNumbers||[],t(null,n)},function(e){t(e,null)}):t("Contacts plugin is not integrated or not working properly",null)}}};document.addEventListener("deviceready",function(){window.open=function(e,n,t){var o,a="_blank"===n,n=cordova.InAppBrowser.open(e,n,t),t=n&&n.channels&&n.channels.close;return a&&t&&((o=document.getElementById("webviewBackdrop"))&&(o.querySelector("#removeBackdropBtn").addEventListener("click",function(){i()}),o.classList.remove("hide")),n&&n.addEventListener("close",function(){i()}),n&&n.addEventListener("exit",function(){i()})),n;function i(){var e=document.getElementById("webviewBackdrop");e&&!e.classList.contains("hide")&&(e.classList.add("closing"),setTimeout(function(){e.classList.replace("closing","hide")},250))}},"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&cordova.plugins.backgroundMode.enable&&cordova.plugins.backgroundMode.setDefaults({title:"App is running in background",text:""})});
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function HistoryAPI(t,s,e,i){var n;"object"==_typeof(t)?(this.appId=(n=t).appId,this.pluginId=n.pluginId,this.instanceId=n.instanceId,this.liveMode=n.liveMode):(this.appId=t,this.pluginId=s,this.instanceId=e,this.liveMode=i)}HistoryAPI.prototype={historyItems:[],push:function(t,s){if("undefined"==typeof emulatorSync){if("plugin"!=t.source){var e=-1;if(1<this.historyItems.length){for(var i=1;i<this.historyItems.length;i++)if("plugin"==this.historyItems[i].source&&"control"==this.historyItems[i-1].source){e=i;break}0<=e&&this.historyItems.splice(e)}}t.uid=(new Date).getTime();var n=this.instanceId;t.options=t.options||{},t.options.pluginData=t.options.pluginData||{instanceId:n};var o=this.historyItems.map(function(t){return(t.options.pluginData||{}).instanceId}),n=o.lastIndexOf(n),o=n===o.length-1;-1<n&&!o?this.historyItems.splice(n+1,0,t):this.historyItems.push(t);n=new CustomEvent("historyOnPush",{detail:{pushedItem:t}});document.dispatchEvent(n);n=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});document.dispatchEvent(n)}else{t=new Packet(null,"history.pushAppHistory",t);emulatorSync.sendMessage(t)}return s&&s(null,!0),this},get:function(t,s){var e,i=this;if(t&&t.pluginBreadcrumbsOnly){for(var n=[],o=0,r=o=postMaster.launcherPluginAPI&&this!=postMaster.launcherPluginAPI.history?-1==(t=this.historyItems.findIndex(function(t){return"control"==t.source}))?this.historyItems.length:t:o;r<this.historyItems.length;r++){var h=this.historyItems[r];"plugin"==(e=h).source&&e.options&&e.options.pluginData&&e.options.pluginData.instanceId==i.instanceId&&n.push(this.historyItems[r])}s(null,n)}else s(null,this.historyItems);return this},getNext:function(t){var s=null;if(this.historyItems)for(var e=0;e<this.historyItems.length;e++)if(this.historyItems[e]==t||this.historyItems[e].uid==t.uid){e<this.historyItems.length&&(s=this.historyItems[e+1]);break}return s},pop:function(t,s){if("undefined"==typeof emulatorSync){if(!t&&this.historyItems&&(1<this.historyItems.length?(o=this.historyItems[this.historyItems.length-1])&&"plugin"==o.source&&(t=this.historyItems[this.historyItems.length-2]):this.historyItems[0]&&"plugin"==this.historyItems[0].source&&(t=this.historyItems[0])),t){for(var e=-1,i=!1,n=0;n<this.historyItems.length;n++)if(this.historyItems[n]==t||this.historyItems[n].uid==t.uid){(e=n)+1<this.historyItems.length&&"plugin"==this.historyItems[n+1].source&&(i=!0);break}0<=e&&e<=this.historyItems.length&&this.historyItems.splice(e+1);var o=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});document.dispatchEvent(o);o=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});document.dispatchEvent(o),(i||"plugin"==t.source)&&postMaster&&(r=new Packet(null,"history.triggerOnPop",t),postMaster.widgetPluginAPI?postMaster.widgetPluginAPI.sendMessage(null,r):postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.sendMessage(null,r))}else if(s)return s("breadcrumb not found"),this}else{var r=new Packet(null,"history.popAppHistory",t);emulatorSync.sendMessage(r)}return s&&s(null,!0),this},popToHome:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=1;t<this.historyItems.length;t++)"control"==this.historyItems[t].source&&this.pop(this.historyItems[t-1])},popToPlugin:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=this.historyItems.length-1;1<t&&"plugin"==this.historyItems[t].source;t--)this.pop(this.historyItems[t-1])},clear:function(t,s){var e=this.historyItems[0];this.historyItems.splice(0),s&&s(null);s=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});return document.dispatchEvent(s),e&&(e=new CustomEvent("historyOnPop",{detail:{poppedItem:e}}),document.dispatchEvent(e)),this},triggerOnPop:function(t){t=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});return document.dispatchEvent(t),this},triggerOnUpdate:function(t){this.historyItems=t;t=new CustomEvent("historyOnUpdate",{detail:{historyItems:t}});return document.dispatchEvent(t),this},onUpdate:function(s){function t(t){s&&s({historyItems:t.detail.historyItems})}return document.addEventListener("historyOnUpdate",t,!1),{clear:function(){document.removeEventListener("historyOnUpdate",t,!1)}}},onPop:function(s){function t(t){s&&s(t.detail)}return document.addEventListener("historyOnPop",t,!1),{clear:function(){document.removeEventListener("historyOnPop",t,!1)}}},onPush:function(s){function t(t){s&&s({historyItems:t.detail.historyItems,pushedItem:t.detail.pushedItem})}return document.addEventListener("historyOnPush",t,!1),{clear:function(){document.removeEventListener("historyOnPush",t,!1)}}},clearLauncherBreadcrumbs:function(){for(var t=[],s=0,e=!1;s<this.historyItems.length;s++){var i=this.historyItems[s];if(e){if("control"==i.source){e=!1;break}}else t.push(i);"home"==i.source&&(e=!0)}this.historyItems=t;var n=new CustomEvent("historyOnUpdate",{detail:{historyItems:t}});return document.dispatchEvent(n),this}};
"use strict";function Packet(e,t,n,i){this.id=e,this.cmd=t,this.data=n,this.error=i,this.instanceId}var logger,pluginCount=0;function PluginAPI(e,t,n,i,o,a,s,r){pluginCount++,this.datastore=this.analytics=this.appearance=null,this.iFrameId=e,this.iFrame=document.getElementById(e),this.init(t,n,i,o,a,s,r)}void 0===logger&&(logger={log:function(){}}),PluginAPI._defaultAppTheme={colors:{backgroundColor:"#ffffff",bodyText:"#858585",dangerTheme:"#f24965",defaultTheme:"#07a05e",footerMenuBackgroundColor:"#ffffff",footerMenuIconColor:"#45cae6",headerText:"#000000",icons:"#45cae6",infoTheme:"#66d6ed",primaryTheme:"#45cae6",successTheme:"#0ac775",titleBar:"#0ac775",titleBarTextAndIcons:"#ffffff",warningTheme:"#ffcf40"},fontId:"Lato",fontName:"Lato"},PluginAPI.appTheme={isDefault:!0,appName:"",colors:PluginAPI._defaultAppTheme.colors,fontId:PluginAPI._defaultAppTheme.fontId,fontName:PluginAPI._defaultAppTheme.fontName,updateTheme:function(e){this.appName=e.appName||this.appName,this.colors=e.colors||PluginAPI._defaultAppTheme.colors,this.fontId=e.fontId||PluginAPI._defaultAppTheme.fontId,this.fontName=e.fontName||PluginAPI._defaultAppTheme.fontName,this.fontUrl=e.fontUrl||null,this.fontFormat=e.fontFormat||null,this.fontFileName=e.fontFileName||null,this.isCustomFont=e.isCustomFont||!1,this.fontFolderPath=e.fontFolderPath||null,this.fontLastUpdatedOn=e.fontLastUpdatedOn||null,this.customCSS=e.customCSS,delete this.isDefault}},PluginAPI.prototype={getContentWindow:function(){return this.iFrame=document.getElementById(this.iFrameId),this.iFrame?this.iFrame.contentWindow:null},debugTag:null,init:function(e,t,n,i,o,a,s){if(window.appContext&&window.appContext.currentApp){var r=window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.cpDomain?window.appContext.currentApp.config.cpDomain:window.siteConfig.endPoints.appHost;this.context={appId:e,pluginId:t,instanceId:n,liveMode:i||0,endPoints:window.siteConfig.endPoints,cpDomain:r,device:window.device,deviceId:"undefined"!=typeof push?push.deviceId:null,debugTag:this.debugTag,datastoreWriteKey:o||void 0,type:a,appTheme:PluginAPI.appTheme,configType:PluginAPI.configType,title:s};a=localStorage.getItem("currentAppManifest");if(a){s=null;try{s=JSON.parse(a)}catch(e){console.error("bad currentAppManifest",e)}this.context.offlineModeEnabled=s.offlineModeEnabled}this.context.device||(this.context.device={platform:"web"}),"undefined"!=typeof AppearanceAPI&&(this.appearance=new AppearanceAPI(this.context)),"undefined"!=typeof DatastoreAPI&&(this.datastore=new DatastoreAPI(this.context)),"undefined"!=typeof UserDatastoreAPI&&(this.userData=new UserDatastoreAPI(this.context)),"undefined"!=typeof AnalyticsAPI&&(this.analytics=new AnalyticsAPI(this.context)),"undefined"!=typeof ImageLibAPI&&(this.imageLib=new ImageLibAPI(this.context)),"undefined"!=typeof ColorLibAPI&&(this.colorLib=new ColorLibAPI(this.context),this.colorLib.onChange(function(e){p.sendMessage(null,new Packet(null,"colorLib._triggerOnChange",e))})),"undefined"!=typeof appAPI&&(this.appAPI=new appAPI(this.context)),"undefined"!=typeof ActionItemsAPI&&(this.actionItems=new ActionItemsAPI(this.context)),"undefined"!=typeof NotificationsAPI&&(this.notificationsAPI=new NotificationsAPI(this.context)),"undefined"!=typeof PopupLibAPI&&(this.notificationsAPI=PopupLibAPI),"undefined"!=typeof DialogAPI&&(this.dialogAPI=new DialogAPI(this.context)),"undefined"!=typeof HistoryAPI&&(this.history=new HistoryAPI(this.context)),"undefined"!=typeof PluginInstanceAPI&&(this.pluginInstances=new PluginInstanceAPI(this.context)),"undefined"!=typeof inAppPurchaseAPI&&(this.inAppPurchase=inAppPurchaseAPI),"undefined"!=typeof barcodeScannerAPI&&(this.barcodeScanner=barcodeScannerAPI),"undefined"!=typeof UsersLibAPI&&(this.usersLib=new UsersLibAPI(this.context)),"undefined"!=typeof PublicDatastoreAPI&&(this.publicData=new PublicDatastoreAPI(this.context)),"undefined"!=typeof AppDatastoreAPI&&(this.appData=new AppDatastoreAPI(this.context)),"undefined"!=typeof LocalStorageAPI&&(this.localStorage=new LocalStorageAPI(this.context)),"undefined"!=typeof LocalNotificationsAPI&&(this.localNotifications=new LocalNotificationsAPI(this.context)),"undefined"!=typeof deviceAPI&&(this.device=deviceAPI,this.device.onAppBackgrounded(function(e){p.sendMessage(null,new Packet(null,"device.triggerOnAppBackgrounded",e.detail))}),this.device.onAppResumed(function(e){p.sendMessage(null,new Packet(null,"device.triggerOnAppResumed",e.detail))})),"undefined"!=typeof geoAPI&&(this.geo=geoAPI),"undefined"!=typeof inputAPI&&(this.input=inputAPI),"undefined"!=typeof notesAPI&&(this.notes=notesAPI),"undefined"!=typeof bookmarkAPI&&(this.bookmarkAPI=bookmarkAPI),"undefined"!=typeof deepLinkAPI&&(this.deepLink=deepLinkAPI),"undefined"!=typeof imagePreviewerAPI&&(this.imagePreviewer=imagePreviewerAPI),"undefined"!=typeof bluetoothAPI&&(this.bluetooth=bluetoothAPI),"undefined"!=typeof BleCentralAPI&&(this.bleCentral=new BleCentralAPI),"undefined"!=typeof iBeaconAPI&&(this.iBeacon=iBeaconAPI),"undefined"!=typeof CameraAPI&&(this.camera=new CameraAPI(this.context)),"undefined"!=typeof fileManagerAPI&&(this.fileManager=fileManagerAPI,this.fileManager.onProgress(function(e){p.sendMessage(null,new Packet(null,"services.fileSystem.fileManager._triggerOnProgress",{percentage:e}))})),"undefined"!=typeof imageCacheAPI&&(this.imageCache=imageCacheAPI),"undefined"!=typeof PushNotificationsAPI&&(this.pushNotifications=new PushNotificationsAPI(this.context)),"undefined"!=typeof FirebaseAPI&&(this.firebase=new FirebaseAPI(this.context)),"undefined"!=typeof ComponentUIAPI&&(this.componentUI=new ComponentUIAPI(this.context)),"undefined"!=typeof HealthAPI&&(this.health=new HealthAPI(this.context)),"undefined"!=typeof authAPI&&(this.auth=authAPI,this.auth.init(this.context),(p=this).auth.onLogin(function(e){p.sendMessage(null,new Packet(null,"auth.triggerOnLogin",e.detail))}),this.auth.onLogout(function(){p.sendMessage(null,new Packet(null,"auth.triggerOnLogout"))}),this.auth.onUpdate(function(e){p.sendMessage(null,new Packet(null,"auth.triggerOnUpdate",e.detail))})),"undefined"!=typeof richModal&&(this.popup=richModal);var p=this;this.mediaAPI=new Object,"undefined"!=typeof audioPlayer&&(this.mediaAPI.audioPlayer=audioPlayer,this.mediaAPI.audioPlayer.onEvent(function(e){p.sendMessage(null,new Packet(null,"services.media.audioPlayer.triggerOnEvent",e))})),this.analytics.trackActionCommand=function(e,t){return!!e&&p.analytics.trackAction(e.value,e.metadata,t)},this.analytics.trackViewCommand=function(e,t){return!!e&&p.analytics.trackView(e.value,e.metadata,t)},this.navigation.pluginAPI=this,"undefined"!=typeof PublicFilesAPI&&(this.publicFiles=new PublicFilesAPI(this.context),this.publicFiles.onProgress(function(e){p.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnProgress",{file:e}))}),this.publicFiles.onComplete(function(e){p.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnComplete",{file:e}))})),"undefined"!=typeof searchEngineAPI&&(this.searchEngine=new searchEngineAPI(this.context)),"undefined"!=typeof CreditsAPI&&(this.credits=new CreditsAPI(this.context)),"undefined"!=typeof StripeAPI&&(this.stripe=new StripeAPI(this.context)),"undefined"!=typeof ShortLinksAPI&&(this.shortLinks=new ShortLinksAPI(this.context)),"undefined"!=typeof userTagsAPI&&(this.userTags=userTagsAPI),"undefined"!=typeof ReportAbuseAPI&&(this.reportAbuse=ReportAbuseAPI)}else console.error("invalid appContext cant create pluginAPI")},postMessageHandler:function(n){if(!this.iFrameId)return!1;var i=void 0;try{i=n.packet||JSON.parse(n.data)}catch(e){return void console.warn("error parsing post message data.")}if(i&&i.cmd&&i.cmd.split&&(n.source==this.getContentWindow()||i.fid==this.iFrameId||this.context.instanceId==i.instanceId)){for(var o=this,e=i.cmd.split("."),t=this,a=this,s=0;s<e.length;s++){if(0<s&&(a=t),!t[e[s]])return!0;t=t[e[s]]}return t.apply(a,[i.data,function(e,t){e&&console.warn(n.data,e);e=new Packet(i.id,i.cmd,t,e);o.sendMessage(null,e)}]),!0}},sendMessage:function(e,t){(e=this.getContentWindow())&&e.postMessage&&(t=JSON.parse(JSON.stringify(t)),e.postMessage(t,"*"))},getContext:function(n,i){var o=this;return PluginAPI.appTheme.isDefault?new DatastoreAPI(window.appContext.currentApp.appId,"appearance","appearance",window.appContext.liveMode).get({tag:"appearance",withDynamicData:!0},function(e,t){e&&console.error(e),t&&t.data&&(t=t.data,PluginAPI.appTheme.updateTheme(t),o._getContext(n,i))}):this._getContext(n,i),this},_getContext:function(e,n){var i=Object.assign({},this.context);i.navbarEnabled=this.appearance.navbar.isVisible(),this.localStorage.getCollection(null,function(e,t){i.localStorage=t||{},"undefined"!=typeof appApiKeys?appApiKeys.get(function(e,t){i.apiKeys=t||{},n&&n(null,i)}):(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.apiKeys&&(i.apiKeys=window.appContext.currentApp.apiKeys||{}),n&&n(null,i))})},navigation:{displayPopUpInstructions:function(){window.location.hash="/popUp"},_navigateTo:function(e,t){if(!e)return console.error("Critical error: no pluginData provided to _navigateTo");!1!==e.pushToHistory&&(e.pushToHistory=!0);var n=new HistoryAPI;e.pushToHistory||n.popToHome(),0==n.historyItems.length&&this.createHomeBreadcrumb();var i,o,a,s,r,p,c=n.historyItems[n.historyItems.length-1],l=e.instanceId===c.options.pluginData.instanceId&&(-1<["","#/","#"].indexOf(window.location.hash)||-1<window.location.hash.toLowerCase().indexOf("#/plugincontainer")),d=window.location.hash;if(l||(i=e.pluginId,o=e.instanceId,a=e.title,s=e.folderName,r=e.pushToHistory,c=e.isNavigateBack,d="/pluginContainer/".concat(i,"/").concat(o,"/").concat(encodeURIComponent(encodeURIComponent(a)),"/").concat(s,"/").concat(r),!c||(u=postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.context&&postMaster.widgetPluginAPI.context.instanceId)&&u!==o&&(d+="/".concat(u))),postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.context&&e.instanceId==postMaster.launcherPluginAPI.context.instanceId&&e.pluginId==postMaster.launcherPluginAPI.context.pluginId)return n.popToHome(),window.location.hash="/",void(e.queryString&&(p=new Packet(null,"deeplink.triggerOnUpdate",e.queryString),postMaster.launcherPluginAPI.sendMessage(null,p)));if(!l){var u=void 0;if(e.title){u=e.title;try{u=decodeURIComponent(u)}catch(e){}}n.push({label:u,options:{pluginData:e,context:window.location.href},source:"control"})}e.queryString&&!e.isNavigateBack&&(l?(p=new Packet(null,"deeplink.triggerOnUpdate",e.queryString),postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.sendMessage(null,p)):window.pluginControllerHelper.pluginPassThroughqueryString=e.queryString),e.dontTriggerHashChangeEvent||l?"undefined"!=typeof cpSync&&cpSync.navigation.silentNavigation(d):window.location.hash=d,t&&t(null,{status:"completed"})},navigateTo:function(o,a){var s,e,t;o&&o.pluginId&&o.instanceId&&o.title&&o.folderName?this._navigateTo(o,a):o&&(o.pluginId||o.instanceId||o.folderName)?(s=this,e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),t={obj:{filter:{},pageSize:1,withDynamicData:!0}},o.instanceId&&(t.obj.filter["$json.instanceId"]=o.instanceId),o.pluginId&&(t.obj.filter["$json.token"]=o.pluginId),e.search(t,function(e,t){var n,i;e?a("error fetching pluginInstance",!1):t&&t.length?(n=t[0].data.instanceId,i=t[0].data._buildfire.pluginType.result[0].token,e=t[0].data._buildfire.pluginType.result[0].folderName,t=t[0].data.title,s._navigateTo({pluginId:i,instanceId:n,title:o.title||t,folderName:e,pushToHistory:o.pushToHistory,queryString:o.queryString},a)):a&&a("pluginInstance not found",!1)})):a("either pluginId, instanceId or folderName must be specified",!1)},navigateToPluginInstance:function(i,o){var e,t,a=this;i&&i.instanceId?(e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),(t={}).obj={filter:{"$json.instanceId":i.instanceId},pageSize:1,withDynamicData:!0},e.search(t,function(e,t){var n;e?o&&o("error fetching pluginInstance",!1):t&&t.length?(n=t[0].data._buildfire.pluginType.result[0].token,e=t[0].data._buildfire.pluginType.result[0].folderName,t=t[0].data.title,a._navigateTo({pluginId:n,instanceId:i.instanceId,title:t,folderName:e,pushToHistory:!1,queryString:i.queryString},o)):o&&o("pluginInstance not found",!1)})):o&&o("Invalid parameters. Need to pass instanceId.")},navigateToAppearance:function(e){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/appearanceSample"):window.location.hash="/appearanceSample"},navigateHome:function(e,t){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/"):window.location.hash="/",(new HistoryAPI).clear(),this.createHomeBreadcrumb(),t&&t()},navigateBack:function(){var e=new HistoryAPI;if(e.historyItems&&1<e.historyItems.length){var t=e.historyItems[e.historyItems.length-1],n=e.historyItems[e.historyItems.length-2];if(n&&n.options)switch(n.source){case"control":var i=null;"plugin"==t.source?(e.pop(n),n.options.pluginData&&((i=JSON.parse(JSON.stringify(n.options.pluginData))).isNavigateBack=!0,this._navigateTo(i))):(n.options.pluginData&&((i=JSON.parse(JSON.stringify(n.options.pluginData))).isNavigateBack=!0,this._navigateTo(i)),e.pop(n));break;case"plugin":"control"==t.source?(e.pop(n),window.location.hash="/"):e.pop(n);break;case"home":if("plugin"==t.source){e.pop(n);break}default:e.clear(),this.createHomeBreadcrumb(),window.location.hash="/"}}else e.clear(),this.createHomeBreadcrumb(),window.location.hash="/"},createHomeBreadcrumb:function(){var e=new HistoryAPI,t=(postMaster.launcherPluginAPI?postMaster.launcherPluginAPI.context:appContext.currentPlugin).instanceId;e.push({label:"Home",options:{pluginData:{instanceId:t}},source:"home"})},scrollTop:function(e,t){document.body.scrollTop=e||0,t&&t()},navigateEmulator:function(e){"undefined"!=typeof PreviewerAPI&&"function"==typeof PreviewerAPI.previewApp&&PreviewerAPI.previewApp(e)},exitEmulator:function(){"undefined"!=typeof PreviewerAPI&&"function"==typeof PreviewerAPI.exit&&PreviewerAPI.exit()},navigateToApp:function(e){window.location.search="?env="+window.appContext.environment+"&appId="+e.appId+"&mode="+window.appContext.currentApp.liveMode+"&lastUrl="+encodeURIComponent(window.location.href)},navigateToTab:function(){}},messaging:{triggerOnNewControlMessage:function(e){console.warn("unhandled message [onNewControlMessage]")},triggerOnNewWidgetMessage:function(e){e=new Packet(null,"messaging.onReceivedMessage",e);(postMaster.widgetPluginAPI||postMaster.launcherPluginAPI).sendMessage(null,e)},sendMessageToService:function(e,t){var n=postMaster.widgetPluginAPI;(n=n||postMaster.launcherPluginAPI)&&n.context&&postMaster.servicePluginAPIs&&((n=postMaster.servicePluginAPIs[n.context.instanceId])&&n.sendMessage&&(e=new Packet(null,"messaging.onReceivedMessage",e),n.sendMessage(null,e),t&&t(null,!0))),t&&t("no service available for current widget",null)}},spinner:{show:function(e,t){window.spinner&&window.spinner.show(),t&&t()},hide:function(e,t){window.spinner&&window.spinner.hide(),t&&t()}}};
"use strict";var geoAPI={getPermissionType:function(){return"undefined"==typeof BackgroundGeolocation&&"undefined"==typeof backgroundGeolocation?"location":"background_location"},currentPosition:null,convertPosition:function(o){return{coords:{latitude:o.coords.latitude,longitude:o.coords.longitude,altitude:o.coords.altitude,accuracy:o.coords.accuracy,altitudeAccuracy:o.coords.altitudeAccuracy,heading:o.coords.heading,speed:o.coords.speed},timestamp:o.timestamp,isBackground:o.isBackground||!1}},convertBackGroundPosition:function(o){return{coords:{latitude:o.latitude,longitude:o.longitude,altitude:o.altitude,accuracy:o.accuracy,speed:o.speed},timestamp:o.time,isBackground:!0}},getCurrentPosition:function(o,n){var t=this;permissionRequestsAPI.queueRequest(geoAPI.getPermissionType(),geoAPI,function(){t._getCurrentPosition(o,n)})},_getCurrentPosition:function(n,t){return navigator.geolocation?(bfUtils.isMobileDevice||(n=n||{}).timeout||(n.timeout=5e3),navigator.geolocation.getCurrentPosition(function(o){t(null,geoAPI.convertPosition(o))},function(o){geoAPI.currentPosition&&(!n.maximumAge||Date.now()-geoAPI.currentPosition.timestamp<n.maximumAge)?t(null,geoAPI.currentPosition):t(o,null)},n)):console.error("navigator.geolocation is undefined"),this},isAndroid:!1,watchPosition:function(o,n){var t=this;permissionRequestsAPI.queueRequest(geoAPI.getPermissionType(),geoAPI,function(){t._watchPosition(o,n)})},_watchPosition:function(o,n){function t(o){(o=geoAPI.convertPosition(o)).watchId=i,geoAPI.currentPosition=o;o=new Packet(null,"geo.onPositionChange",o);postMaster.broadcast(o)}function e(o){console.log("Geo watchPosition: ",o.message),o.watchId=i,n(o)}var i,a,c;navigator.geolocation&&navigator.geolocation.watchPosition?(i=navigator.geolocation.watchPosition(t,e,o),a=function(o){t(geoAPI.convertBackGroundPosition(o))},c=function(o){console.error("Background geo error",o)},bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){"undefined"==typeof BackgroundGeolocation&&"undefined"==typeof backgroundGeolocation||("undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&(cordova.plugins.backgroundMode.enable&&cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.on("activate",function(){cordova.plugins.backgroundMode.disableWebViewOptimizations()})),"undefined"==typeof backgroundGeolocation?(BackgroundGeolocation.configure({locationProvider:BackgroundGeolocation.ACTIVITY_PROVIDER,desiredAccuracy:BackgroundGeolocation.HIGH_ACCURACY,stationaryRadius:1,distanceFilter:1,debug:!1,interval:1e4,fastestInterval:5e3,activitiesInterval:1e4,activityType:o?o.activityType:void 0}),BackgroundGeolocation.on("location",a),BackgroundGeolocation.on("error",c),BackgroundGeolocation.on("authorization",function(o){console.log("[INFO] BackgroundGeolocation authorization status: "+o),!0===bfUtils.isIOS&&o!==BackgroundGeolocation.AUTHORIZED&&setTimeout(function(){if(console.log("always permission needed"),confirm("To use background location, you must enable 'Always' in the in the Location Services settings"))return BackgroundGeolocation.showAppSettings()},1e3)}),BackgroundGeolocation.checkStatus(function(o){console.log("[INFO] BackgroundGeolocation service is running",o.isRunning),console.log("[INFO] BackgroundGeolocation services enabled",o.locationServicesEnabled),console.log("[INFO] BackgroundGeolocation auth status: "+o.authorization),o.isRunning||BackgroundGeolocation.start()})):(backgroundGeolocation.configure(a,c,{desiredAccuracy:0,stationaryRadius:1,distanceFilter:1,interval:1e3,locationProvider:backgroundGeolocation.provider.ANDROID_ACTIVITY_PROVIDER}),backgroundGeolocation.start()))})):(console.log("HTML5 position"),i=setInterval(function(){geoAPI.getCurrentPosition(o,function(o,n){o?e(o):t(n)})},o&&o.timeout?o.timeout:5e3)),n()},clearWatch:function(o,n){navigator.geolocation&&navigator.geolocation.watchPosition?navigator.geolocation.clearWatch(o):clearInterval(o),n&&n()},isEnabled:function(o,n){BackgroundGeolocation.checkStatus(function(o){return n(null,o.locationServicesEnabled)})}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var inputAPI={initialized:!1,timer:null,currentStepData:null,currentStepOptions:null,init:function(){var e=this;this.inputDialog?this.inputDialog.innerHTML="":(this.inputDialog=document.createElement("div"),this.inputDialog.style.display="none"),this.listDialog?this.listDialog.innerHTML="":(this.listDialog=document.createElement("div"),this.listDialog.style.display="none"),this.backdrop?this.backdrop.className="":(this.backdrop=document.createElement("div"),this.backdrop.id="input-backdrop"),0<=window.location.pathname.indexOf("pluginTester")?(this.inputDialog.style.height=document.getElementById("app").offsetHeight+"px",this.inputDialog.style.position="absolute",this.listDialog.style.height=document.getElementById("app").offsetHeight+"px",this.listDialog.style.position="absolute"):(this.inputDialog.style.height="var(--full-app-height, 100vh)",this.inputDialog.style.maxHeight="var(--full-app-height, 100vh)",this.listDialog.style.height="var(--full-app-height, 100vh)",this.listDialog.style.maxHeight="var(--full-app-height, 100vh)");var t=localStorage.getItem("footerMenu");this.inputDialog.id="inputDialog",this.inputDialog.className=t?"has-footer-menu":"";var i=document.createElement("div");i.className="input-dialog-container backgroundColorTheme",this.inputDialog.appendChild(i),this.dialogNav=document.createElement("div"),this.dialogNav.className="inputapi-nav titleBarBackgroundTheme",i.appendChild(this.dialogNav),this.dialogNavFlex=document.createElement("div"),this.dialogNavFlex.className="inputapi-nav-flex",this.dialogNav.appendChild(this.dialogNavFlex),this.dialogNavSecondary=document.createElement("div"),this.dialogNavSecondary.className="inputapi-nav secondary titleBarBackgroundTheme",i.appendChild(this.dialogNavSecondary),this.dialogNavFlexSecondary=document.createElement("div"),this.dialogNavFlexSecondary.className="inputapi-nav-flex secondary",this.dialogNavSecondary.appendChild(this.dialogNavFlexSecondary),this.currentUserContainer=document.createElement("div"),this.currentUserContainer.className="inputapi-user-container",i.appendChild(this.currentUserContainer),this.textarea=document.createElement("textarea"),this.textarea.className="inputapi-textarea needsfocus bodyTextTheme",this.textarea.id="inputapi-textarea",this.textarea.onclick=window.keyboardResize,this.textarea.addEventListener("touchend",function(t){t.target.click()}),this.textarea.addEventListener("focus",function(t){var e=t.target;e.style.webkitTransform="translate3d(0px,-10000px,0)",requestAnimationFrame(function(){return e.style.webkitTransform=""})}),this.textarea.addEventListener("input",function(t){e.currentStepData.textValue=t.target.value,e.currentStepData.textValue.length>e.currentStepOptions.maxLength&&(e.currentStepData.textValue=e.currentStepData.textValue.substring(0,e.currentStepOptions.maxLength),t.target.value=e.currentStepData.textValue),e.doneButton.disabled=!e.validate()}),i.appendChild(this.textarea),this.imageGallery=document.createElement("div"),this.imageGallery.id="imageGallery",this.geoContainer=document.createElement("div"),this.geoContainer.id="geo-container",this.geoContainer.classList="img-gallery-container",this.geoContainer.style.display="none",this.geoImage=document.createElement("img"),this.geoImage.id="geo-img",this.geoContainer.appendChild(this.geoImage),this.geoDeleteBtn=document.createElement("span"),this.geoDeleteBtn.className="galery-delete glyphicon glyphicon-minus-sign",this.geoDeleteBtn.onclick=function(){return e.setLocation()},this.geoContainer.appendChild(this.geoDeleteBtn),this.imageGallery.appendChild(this.geoContainer),i.appendChild(this.imageGallery),this.cancelButton=document.createElement("button"),this.cancelButton.className="inputapi-cancel titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.cancelButton),this.title=document.createElement("h1"),this.title.className="inputapi-nav-title primary titleBarTextAndIcons ellipsis",this.title.style.whiteSpace="nowrap",this.dialogNavFlex.appendChild(this.title),this.titleSecondary=document.createElement("h1"),this.titleSecondary.className="inputapi-nav-title secondary titleBarTextAndIcons ellipsis",this.titleSecondary.style.whiteSpace="nowrap",this.dialogNavFlexSecondary.appendChild(this.titleSecondary),this.doneButton=document.createElement("button"),this.doneButton.className="inputapi-done titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.doneButton),this.actionFooter=document.createElement("div"),this.actionFooter.className="inputapi-footer",i.appendChild(this.actionFooter),this.cameraBtn=document.createElement("span"),this.cameraBtn.className="icon icon-camera2 needsclick",this.cameraBtn.onclick=function(t){return e.showFileDialog()},this.actionFooter.appendChild(this.cameraBtn),this.geoPin=document.createElement("span"),this.geoPin.id="goc-pin",this.geoPin.className="icon icon-map-marker",this.geoPin.onclick=function(t){return e.showLocationModal()},this.actionFooter.appendChild(this.geoPin),this.gifBtn=document.createElement("span"),this.gifBtn.className="icon icon-gif",this.gifBtn.id="gif-btn",this.gifBtn.onclick=function(t){return e.showGifDialog()},this.actionFooter.appendChild(this.gifBtn),this.listDialog.id="listDialog";t=document.createElement("div");t.className="body backgroundColorTheme",this.listDialog.appendChild(t),this.listDialogHeader=document.createElement("h1"),this.listDialogHeader.className="list-header",t.appendChild(this.listDialogHeader),this.listDialogItems=document.createElement("form"),this.listDialogItems.className="input-list",t.appendChild(this.listDialogItems);i=document.createElement("div");i.className="button-container",t.appendChild(i),this.listDialogCancelBtn=document.createElement("button"),this.listDialogCancelBtn.className="cancel primaryTheme",i.appendChild(this.listDialogCancelBtn),this.listDialogConfirmBtn=document.createElement("button"),this.listDialogConfirmBtn.className="confirm primaryTheme",i.appendChild(this.listDialogConfirmBtn),0<=window.location.pathname.indexOf("pluginTester")?(document.getElementById("app").appendChild(this.inputDialog),document.getElementById("app").appendChild(this.listDialog),document.getElementById("app").appendChild(this.backdrop)):(document.body.appendChild(this.inputDialog),document.body.appendChild(this.listDialog),document.body.appendChild(this.backdrop)),this.initialized=!0},showLocationModal:function(){var d=this;window.spinner&&window.spinner.show(),this.getLocation(function(t,e){try{if(t)throw t;var i=e.coords,n=i.latitude,a=i.longitude,o=d.getMapUrl(e),l=o.mapUrl,r=o.thumbnail;if(d.currentStepOptions.attachments.location.required)return window.spinner&&window.spinner.hide(),d.geoDeleteBtn.style.display="none",d.setLocation({latitude:n,longitude:a},r);var s={title:"Send My Current Location",richContent:'\n          <img style="height: 90vw !important; width: 90vw !important" src="'.concat(l,'" />\n        '),action:{title:"Confirm",handler:function(){return d.setLocation({latitude:n,longitude:a},r)}}};window.spinner&&window.spinner.hide(),richModal.display(s)}catch(t){console.error("inputAPI location error",t);var c="Failed to determine location. Please try again later.";if(t.code)switch(t.code){case 1:c="App does not have location access.";break;case 2:c="Location information is not availible to this device.";break;case 3:c="Location request timed out. Try again.";break;case 4:c="Failed to determine location. Please try again later (code 4)";break;case 5:c="This app does not have access to this feature."}richModal.display({title:"Could not determine location",richContent:c}),window.spinner&&window.spinner.hide()}})},getLocation:function(i){var n,a=null;appApiKeys.get(function(t,e){(n=e.googleMapKey)||((a=new Error("no google API key")).code=5),a||"object"==("undefined"==typeof geoAPI?"undefined":_typeof(geoAPI))||((a=new Error("geoAPI not defined")).code=4),a?i(a,null):geoAPI.getCurrentPosition({timeout:1e4},function(t,e){e&&(e.googleMapKey=n),i(t,e)})})},setLocation:function(t,e){t&&e?"undefined"!=typeof tinymce&&tinymce.activeEditor?(tinymce.activeEditor.insertContent('<img src="'.concat(e,'" width="100" height="100" class="tinymce-geoImage">')),this.currentStepData.location=t):(this.currentStepData.location=t,this.geoContainer.style.display="block",this.geoImage.src=e):(this.currentStepData.location={},this.geoContainer.style.display="none",this.geoImage.removeAttribute("src")),this.doneButton.disabled=!this.validate()},getMapUrl:function(t){var e=t.coords,i=e.latitude,n=e.longitude,e=t.googleMapKey,t="size=".concat(window.innerWidth,"x").concat(window.innerWidth),t="zoom=15&".concat(t,"&maptype=roadmap&key=").concat(e),e="center=".concat(i,",").concat(n),n="markers=color:blue|size:large|".concat(i,",").concat(n),n="".concat("https://maps.googleapis.com/maps/api/staticmap","?").concat(e,"&").concat(n,"&").concat(t),t=n.replace(/size:large/g,"size:mid").replace(/size=\d{1,4}x\d{1,4}/g,"size=100x100").replace(/zoom=15/g,"zoom=12");return{mapUrl:n,thumbnail:t}},showGifDialog:function(){var n,t,a,o=this,i=0<arguments.length&&void 0!==arguments[0]&&arguments[0];"object"==("undefined"==typeof gifAPI?"undefined":_typeof(gifAPI))&&(t=this.currentStepOptions.attachments.gifs,n=t.multiple,t=t.rating,a=function(t){var e;6<=o.currentStepData.images.length+o.currentStepData.gifs.length||(o.currentStepData.gifs.push(t),e="",e=bfUtils.isIOS?t.images.preview.mp4||t.images.gif.downsized_small.mp4:t.images.downsized_medium.url||t.images.original.url,i?inputAPI._showTinyMceDialog(e,"gif"):o.addToGallery(e,"gifs"))},gifAPI.showGifDialog({multiple:n,rating:t},function(t,e){var i;!t&&e&&(i=e.cancelled,t=e.results,!i&&t&&t.length&&(n?e.results.forEach(function(t){return a(t)}):(o.currentStepData.gifs=[],(t=document.getElementById("gifs_0"))&&o.imageGallery.removeChild(t),e=e.results[0],a(e))))}))},showFileDialog:function(){var n=this,a=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=new PublicFilesAPI(window.appContext.currentApp);t._onComplete=function(t){var e,i;"success"===t.status?(i=(e=n.currentStepData).images,e=e.gifs,i=i?i.length:0,6<=(e?e.length:0)+i||(n.currentStepData.images.push(t.url),a?inputAPI._showTinyMceDialog(t.url,"image"):n.addToGallery(t.url,"images"))):console.error("Image upload failed - inputAPI",t)},t._onProgress=function(){window.spinner&&window.spinner.show(),n.doneButton.disabled=!0};var e=this.currentStepOptions.attachments.images.multiple;t.showDialog({allowMultipleFilesUpload:e||!1,filter:["image/*"]},function(){window.spinner&&setTimeout(window.spinner.hide.bind(null,!0),300),n.doneButton.disabled=!(!n.currentStepOptions.required||!n.currentStepData.textValue||n.currentStepData.textValue.length)})},addToGallery:function(t,e){var i=this,n=this.currentStepData[e].length-1,a=document.createElement("div");a.className="img-gallery-container animated fadeInUp ".concat(e),a.id="".concat(e,"_").concat(n);var o=document.createElement("span");o.className="galery-delete glyphicon glyphicon-minus-sign",o.onclick=function(){i.removeFromGallery(n,e)},a.appendChild(o),"images"===e&&"undefined"!=typeof imageTools&&(t=imageTools.cropImage(t,{size:"s",aspect:"1:1",compression:50}));o=document.createElement("img");o.setAttribute("src",t),o.className="img-gallery-item ".concat(e),a.appendChild(o),this.imageGallery.appendChild(a);o=this.currentStepData,a=o.images,o=o.gifs,a=a?a.length:0;5<(o?o.length:0)+a&&(this.cameraBtn.classList.add("disabled"),this.gifBtn.classList.add("disabled"))},removeFromGallery:function(t,e){this.currentStepData[e].splice(t,1);e=document.getElementById("".concat(e,"_").concat(t));e&&this.imageGallery.removeChild(e);t=this.currentStepData,e=t.images,t=t.gifs,e=e?e.length:0;(t?t.length:0)+e<6&&(this.cameraBtn.classList.remove("disabled"),this.gifBtn.classList.remove("disabled"))},getTinyMceStyles:function(){var t=document.createElement("style");if(t.id="tinymce-styles",!PluginAPI.appTheme)return t;var e=PluginAPI.appTheme.colors,i=e.icons,n=e.backgroundColor,a=e.bodyText,e=e.primaryTheme;return t.innerHTML="\n      .tox .tox-tbtn svg,\n      .tox-icon svg {\n        fill: ".concat(i," !important;\n      }\n\n      .tox .tox-toolbar,\n      .tox .tox-toolbar__overflow,\n      #tinymce-textarea_ifr,\n      .tox .tox-edit-area__iframe,\n      .tox-dialog__header,\n      .tox-dialog,\n      .tox-dialog__footer,\n      .tox .tox-statusbar {\n        background-color: ").concat(n," !important;\n      }\n\n      .tox-editor-header,\n      .tox .tox-toolbar__primary,\n      .tox .tox-toolbar-overlord {\n        background-color: ").concat(n,"33 !important;\n      }\n      .tox .tox-tbtn--enabled {\n        background-color: rgba(155, 155, 155, .3) !important;\n        background: rgba(155, 155, 155, .3) !important;\n      }\n\n      .tox .tox-tbtn--enabled:hover,\n      .tox .tox-tbtn:hover {\n        background-color: rgba(155, 155, 155, .1) !important;\n        background: rgba(155, 155, 155, .1) !important;\n      }\n      \n      .tox-label,\n      .tox-dialog__body-content,\n      .tox-dialog__title,\n      .tox-statusbar__path-item,\n      .tox-statusbar__path {\n        color: ").concat(a," !important;\n      }\n\n      button.tox-button.tox-button--secondary {\n        background: none !important;\n        border: none !important;\n        color: ").concat(a," !important;\n      }\n\n      .tox.tox-tinymce.tox-tinymce--toolbar-bottom {\n        border-left: none;\n        border-right: none;\n        border-top: none;\n        border-bottom: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      @media (min-width: 1200px) {\n        .tox.tox-tinymce.tox-tinymce--toolbar-bottom {\n          min-height: 200px;\n        }\n      }\n\n      .tox-toolbar.tox-toolbar--scrolling {\n        background: transparent !important;\n        border-top: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox:not([dir=rtl]) .tox-toolbar__group:not(:last-of-type) {\n        border-right: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox-statusbar {\n        border-top: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox-dialog__footer {\n        border-top: none !important;\n      }\n\n      .wysiwyg_radio {\n        display: flex;\n      }\n\n      .wysiwyg_radio__label {\n        margin-left: 1rem;\n      }\n\n      .wysiwyg_radio__label:after {\n        background-color: ").concat(e," !important;\n      }\n\n      .wysiwyg_radio__input:checked + .wysiwyg_radio__label:before {\n        border-color: ").concat(e," !important;\n      }\n\n      .wysiwyg_radio__label:before {\n        border: 2px solid ").concat(a," !important;\n      }\n\n      .tox .tox-form__group {\n        margin-bottom: 2rem !important;\n      }\n\n      .tox-dialog {\n        width: calc(100vw - 4rem) !important;\n        border: none !important;\n        border-radius: 5px !important;\n        margin-top: 50% !important; \n      }\n\n      #full_width path#Shape {\n        fill: ").concat(i,";\n      }\n\n      #half_width path#Shape {\n        fill: ").concat(i,";\n      }\n\n      #third_width path#Shape {\n        fill: ").concat(i,";\n      }\n\n      #quarter_width path#Shape {\n        fill: ").concat(i,';\n      }\n\n      .wysiwyg_radio svg {\n        margin-left: auto !important;\n      }\n\n      .tox .tox-dialog-wrap__backdrop--opaque {\n        background-color: rgba(0,0,0,.5) !important;\n      }\n\n      [aria-label="Close"] {\n        visibility: hidden;\n      }\n\n    '),t},getTinyMceOptions:function(t,e){var i,n,a="";return PluginAPI.appTheme&&(i=(n=PluginAPI.appTheme.colors).bodyText,n=n.icons,a="\n          body { \n            color: ".concat(i,"; \n          } \n          .mce-content-body[data-mce-placeholder]:not(.mce-visualblocks)::before { \n            color: ").concat(i,"99;\n          }\n          .tox .tox-tbtn svg {\n            fill: ").concat(n," !important;\n          }\n      ")),{selector:"#inputapi-textarea",plugins:"image lists imagetools",toolbar:["bold italic | bullist numlist | alignleft aligncenter alignright"],placeholder:t.placeholder||"Type something...",toolbar_location:"bottom",height:"100%",menubar:!1,toolbar_mode:"scrolling",content_style:a,setup:function(i){i.on("click",function(t){window.keyboardResize()}),i.on("init",function(t){var e=document.querySelector('[aria-label="Powered by Tiny"]');e.addEventListener("click",function(t){t.preventDefault(),window.open(e.href,"_system")}),setTimeout(function(){i.focus()},500)})}}},fullWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>full_width</title> <desc>Created with Sketch.</desc> <g id="full_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M16,12 C17.1045695,12 18,12.8954305 18,14 L18,16 C18,17.1045695 17.1045695,18 16,18 L2,18 C0.8954305,18 0,17.1045695 0,16 L0,14 C0,12.8954305 0.8954305,12 2,12 L16,12 Z M16,14 L2,14 L2,16 L16,16 L16,14 Z M16,0 C17.1045695,0 18,0.8954305 18,2 L18,8 C18,9.1045695 17.1045695,10 16,10 L2,10 C0.8954305,10 0,9.1045695 0,8 L0,2 C0,0.8954305 0.8954305,0 2,0 L16,0 Z" id="Shape" fill="#000000"></path> </g> </svg>',halfWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>half_width</title> <desc>Created with Sketch.</desc> <g id="half_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M6,3.55271368e-15 C7.1045695,3.55271368e-15 8,0.8954305 8,2 L8,16 C8,17.1045695 7.1045695,18 6,18 L2,18 C0.8954305,18 -3.2162453e-16,17.1045695 -3.2162453e-16,16 L-3.2162453e-16,2 C-3.2162453e-16,0.8954305 0.8954305,3.55271368e-15 2,3.55271368e-15 L6,3.55271368e-15 Z M16,7.10542736e-15 C17.1045695,7.10542736e-15 18,0.8954305 18,2 L18,16 C18,17.1045695 17.1045695,18 16,18 L12,18 C10.8954305,18 10,17.1045695 10,16 L10,2 C10,0.8954305 10.8954305,7.10542736e-15 12,7.10542736e-15 L16,7.10542736e-15 Z M16,2 L12,2 L12,16 L16,16 L16,2 Z" id="Shape" fill="#000000"></path> </g> </svg>',thirdWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>third_width</title> <desc>Created with Sketch.</desc> <g id="third_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M4,4 C4.55228475,4 5,4.44771525 5,5 L5,13 C5,13.5522847 4.55228475,14 4,14 L2,14 C1.44771525,14 1,13.5522847 1,13 L1,5 C1,4.44771525 1.44771525,4 2,4 L4,4 Z M10,4 C10.5522847,4 11,4.44771525 11,5 L11,13 C11,13.5522847 10.5522847,14 10,14 L8,14 C7.44771525,14 7,13.5522847 7,13 L7,5 C7,4.44771525 7.44771525,4 8,4 L10,4 Z M16,4 C16.5522847,4 17,4.44771525 17,5 L17,13 C17,13.5522847 16.5522847,14 16,14 L14,14 C13.4477153,14 13,13.5522847 13,13 L13,5 C13,4.44771525 13.4477153,4 14,4 L16,4 Z M10,5 L8,5 L8,13 L10,13 L10,5 Z M16,5 L14,5 L14,13 L16,13 L16,5 Z" id="Shape" fill="#000000"></path> </g> </svg>',quarterWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>quarter_width</title> <desc>Created with Sketch.</desc> <g id="quarter_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M2,4 C2.55228475,4 3,4.44771525 3,5 L3,13 C3,13.5522847 2.55228475,14 2,14 L1,14 C0.44771525,14 0,13.5522847 0,13 L0,5 C0,4.44771525 0.44771525,4 1,4 L2,4 Z M7,4 C7.55228475,4 8,4.44771525 8,5 L8,13 C8,13.5522847 7.55228475,14 7,14 L6,14 C5.44771525,14 5,13.5522847 5,13 L5,5 C5,4.44771525 5.44771525,4 6,4 L7,4 Z M17,4 C17.5522847,4 18,4.44771525 18,5 L18,13 C18,13.5522847 17.5522847,14 17,14 L16,14 C15.4477153,14 15,13.5522847 15,13 L15,5 C15,4.44771525 15.4477153,4 16,4 L17,4 Z M12,4 C12.5522847,4 13,4.44771525 13,5 L13,13 C13,13.5522847 12.5522847,14 12,14 L11,14 C10.4477153,14 10,13.5522847 10,13 L10,5 C10,4.44771525 10.4477153,4 11,4 L12,4 Z M7,5 L6,5 L6,13 L7,13 L7,5 Z M17,5 L16,5 L16,13 L17,13 L17,5 Z M12,5 L11,5 L11,13 L12,13 L12,5 Z" id="Shape" fill="#000000"></path> </g> </svg>',_showTinyMceDialog:function(a,t){var e="image"===t?"Image":"Gif",i="Insert ".concat(e),t={title:"Save",handler:function(){var e;["fullWidth","halfWidth","thirdWidth","quarterWidth"].some(function(t){if(document.querySelector('input[value="'.concat(t,'"]')).checked)return e=t,!0});var t,i=tinyMCE.activeEditor.getContainer().clientWidth;switch(e){case"fullWidth":i="calc(".concat(i,"px - 2rem)"),t="full_width";break;case"halfWidth":i="calc(".concat(i/2,"px - 1rem)"),t="half_width";break;case"thirdWidth":i="calc((".concat(i,"px - 2rem) / 3)"),t="third_width";break;case"quarterWidth":i="calc(".concat(i/4,"px - .5rem)"),t="quarter_width"}var n=imageTools.resizeImage(a,{size:t,aspect:"1:1"});tinymce.activeEditor.insertContent('<img src="'.concat(n,'" style="width: ').concat(i,';">')),richModal.close()}},e='\n      <div>\n        <p style="margin-bottom: 2rem !important">'.concat(e,' size</p>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="fullWidth" class="wysiwyg_radio__input" value="fullWidth" checked>\n          <label for="fullWidth" class="wysiwyg_radio__label">Full Width</label>\n          ').concat(this.fullWidthIcon,'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="halfWidth" class="wysiwyg_radio__input" value="halfWidth">\n          <label for="halfWidth" class="wysiwyg_radio__label">Half Width</label>\n          ').concat(this.halfWidthIcon,'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="thirdWidth" class="wysiwyg_radio__input" value="thirdWidth">\n          <label for="thirdWidth" class="wysiwyg_radio__label">Third Width</label>\n          ').concat(this.thirdWidthIcon,'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="quarterWidth" class="wysiwyg_radio__input" value="quarterWidth">\n          <label for="quarterWidth" class="wysiwyg_radio__label">Quarter Width</label>\n          ').concat(this.quarterWidthIcon,"\n        </div>\n      </div>\n    ");richModal.display({title:i,richContent:e,action:t})},renderStep:function(e,i,n){var a=this;this.currentStepData={wysiwygValue:e.defaultValue||"",textValue:e.defaultValue||"",images:[],location:{},gifs:[]},e.maxLength=e.maxLength||2e3,this.currentStepOptions=e,this.title.innerHTML=e.title||"",this.titleSecondary.innerHTML=e.title||"";var t=this.currentStepOptions.attachments,o=t.location,l=t.images,r=t.gifs,s=!1;["images","gifs","location"].forEach(function(t){e.attachments[t]&&e.attachments[t].enable&&(e.attachments[t].required||(s=!0))}),this.actionFooter.style.display=s?"flex":"none",this.cameraBtn.style.display=l.enable&&this.currentStepData.images.length<6?"block":"none",this.geoPin.style.display=o.enable&&!o.required?"block":"none",this.gifBtn.style.display=r.enable?"block":"none",this.imageGallery.style.display=e.wysiwyg?"none":"flex",this.currentUserContainer.innerHTML="";var c=authAPI.getCurrentUser();this.userImage=document.createElement("img"),c&&c.imageUrl?"undefined"!=typeof imageTools?this.userImage.src=imageTools.cropImage(c.imageUrl,{size:"xs",aspect:"1:1",compression:70}):this.userImage.src=c.imageUrl:this.userImage.src="https://pluginserver.buildfire.com/styles/media/avatar-placeholder.png",this.userImage.className="inputapi-user-image",this.currentUserContainer.appendChild(this.userImage),this.userTitle=document.createElement("h1"),this.userTitle.className="inputapi-user-title ellipsis",c&&(this.userTitle.innerHTML=c.displayName||(c.firstName?c.firstName+" ":"")+(c.lastName||"")||""),this.currentUserContainer.appendChild(this.userTitle),e.wysiwyg?(document.getElementById("tinymce-styles")||document.head.appendChild(inputAPI.getTinyMceStyles()),"undefined"!=typeof Keyboard&&Keyboard.shrinkView&&Keyboard.shrinkView(!0),this.textarea.innerHTML=e.defaultValue||"",tinymce.init(this.getTinyMceOptions(e,this)),this.cameraBtn.onclick=function(t){return a.showFileDialog(!0)},this.gifBtn.onclick=function(t){return a.showGifDialog(!0)}):(this.textarea.placeholder=e.placeholder||"Type something...",this.textarea.maxLength=e.maxLength||2e3,this.textarea.value=e.defaultValue?e.defaultValue.substring(0,this.textarea.maxLength):"");t=document.createElement("div");t.className="btn-txt primary",t.innerHTML=e.saveText||(e._buffer.length?"Next":"Done");l=document.createElement("div");l.className="btn-txt secondary iconsTheme",l.innerHTML=e.saveText||(e._buffer.length?"Next":"Done");r=document.createElement("div");r.className="btn-txt primary",r.innerHTML=e.cancelText||"Cancel";c=document.createElement("div");for(c.className="btn-txt secondary iconsTheme",c.innerHTML=e.cancelText||"Cancel",this.doneButton.innerHTML="",this.cancelButton.innerHTML="",this.doneButton.appendChild(t),this.doneButton.appendChild(l),this.cancelButton.appendChild(r),this.cancelButton.appendChild(c),this.doneButton.onclick=function(t){return n(a.currentStepData)},this.cancelButton.onclick=function(t){return i()},this.backdrop.onclick=function(t){return i()},e.prefill&&(this.textarea.value=e.prefill),this.doneButton.disabled=!this.validate();this.imageGallery.childNodes[1];)this.imageGallery.removeChild(this.imageGallery.childNodes[1]);"object"==_typeof(e.defaultAttachments)&&(r=(l=e.defaultAttachments).images,c=l.gifs,l=l.location,r&&r.length&&(this.currentStepData.images=r).forEach(function(t){a.addToGallery(t,"images")}),c&&c.length&&(this.currentStepData.gifs=c).forEach(function(t){return a.addToGallery(t,"gifs")}),this.currentStepData.gifs=c,this.currentStepData.location=l),o.required?this.showLocationModal():this.setLocation()},showTextDialog:function(t,e){var i,n=this;t&&e&&("undefined"==typeof tinymce&&("function"==typeof t.some?t.some(function(t){return t.wysiwyg}):t.wysiwyg)?((i=document.createElement("script")).src=window._appRoot+"scripts/lib/tinymce/js/tinymce/tinymce.min.js",i.type="text/javascript",i.onload=function(){n._showTextDialog(t,e)},document.getElementsByTagName("head")[0].appendChild(i)):this._showTextDialog(t,e))},_showTextDialog:function(t,e){var n=this;if(t&&e){if(this.currentStepOptions&&this.currentStepOptions._buffer)return e({message:"inputDialog is already active"});this.initialized||this.init();var a=new PublicFilesAPI(window.appContext.currentApp),o=Array.isArray(t)?t:[t],l=[],i=!1,r=!1;if(o.forEach(function(t){t.cancelText&&9<t.cancelText.length&&(r=!0),t.saveText&&9<t.saveText.length&&(i=!0),t.attachments||(t.attachments={}),t.attachments.images||(t.attachments.images={}),t.attachments.location||(t.attachments.location={}),t.attachments.location.required&&(t.attachments.location.enable=!0),t.attachments.gifs||(t.attachments.gifs={})}),i)return e(new Error("saveText too long, max 9 chars"));if(r)return e(new Error("cancelText too long, max 9 chars"));!t.hideUserData&&authAPI.getCurrentUser()||(this.currentUserContainer.style.display="none"),t.prefill&&(this.textarea.value=t.prefill);var s=function(t){return"undefined"==typeof Keyboard?t():Keyboard.shrinkView?(Keyboard.shrinkView(!1),t()):Keyboard.hide&&Keyboard.isVisible?(window.addEventListener("keyboardWillHide",function(){return t()},{once:!0}),void Keyboard.hide()):t()},c=function(t){e(null,{cancelled:t,results:l}),n.currentStepOptions=null,n.currentStepData=null,n.timer=setTimeout(function(){n.inputDialog.addEventListener("transitionend",function(){n.inputDialog.classList.remove("transition")},{once:!0}),n.inputDialog.classList.add("transition"),n.inputDialog.classList.remove("active"),n.backdrop.classList.remove("active"),setTimeout(function(){n.inputDialog.classList.contains("active")||(n.inputDialog.style.display="none",n.init(),"undefined"!=typeof tinymce&&tinymce.activeEditor&&tinymce.activeEditor.remove())},500)},150)},d=function(){return[n.currentStepData].concat(l).some(function(t){return void 0!==t.gifs&&t.gifs.length||void 0!==t.images&&t.images.length||void 0!==t.textValue&&""!==t.textValue||void 0!==t.wysiwygValue&&""!==t.wysiwygValue||"object"===_typeof(t.location)&&Object.keys(t.location).length})},h=function(){var t;null!==(t=n.currentStepOptions.confirmOnCancel)&&void 0!==t&&t.enable&&d()?richModal.display({title:n.currentStepOptions.confirmOnCancel.titleText||"Unsaved Changes",richContent:n.currentStepOptions.confirmOnCancel.messageText||"Are you sure you want to leave? If you leave now, all the information entered will be lost.",isContentHTML:!1,action:[{title:n.currentStepOptions.confirmOnCancel.confirmText||"Leave",type:n.currentStepOptions.confirmOnCancel.confirmType||"primary"}],dismissButtonText:n.currentStepOptions.confirmOnCancel.dismissText||"Resume",forceAction:!0},function(t,e){e&&"action"===e.buttonType&&s(function(){return c(!0)})}):s(function(){return c(!0)})},u=function e(i){"undefined"!=typeof tinymce&&tinymce.activeEditor&&(i.wysiwygValue=tinymce.activeEditor.getContent(),i.textValue=tinymce.activeEditor.getContent({format:"text"}),i.images&&i.images.length&&(i.images=i.images.filter(function(t){return!!i.wysiwygValue.includes(t)||(a.deleteFile({fileId:t.split("/").pop()},function(t,e){t&&console.error("Error while deleting image")}),!1)})),tinymce.activeEditor.remove(),n.textarea.value=""),l.push(i);s(function(){var t=o.shift();if(!t)return c(!1);t._buffer=o,n.renderStep(t,h,e)})},t=o.shift();t._buffer=o,this.renderStep(t,h,u),this.timer&&(clearTimeout(this.timer),this.timer=null),this.inputDialog.style.display="flex",setTimeout(function(){n.inputDialog.addEventListener("transitionend",function(){n.inputDialog.classList.remove("transition")},{once:!0}),n.inputDialog.classList.add("transition"),n.inputDialog.classList.add("active"),n.backdrop.classList.add("active")},100),setTimeout(function(){"undefined"==typeof tinymce||tinymce.activeEditor||n.textarea.focus()},500)}},showListDialog:function(o,t){var l=this;if(o&&t){if(!o.listItems||!o.listItems.length)return t(new Error("No listItems provided to showListDialog"),null);if(o.listItems.some(function(t){return!t.text||!t.value}))return t(new Error("All listItems must contain text and value"),null);o.cancelButton||(o.cancelButton={text:"Cancel",value:"cancel"}),o.confirmButton||(o.confirmButton={text:"Ok",value:"ok"}),this.initialized||this.init(),this.listDialogItems.innerHTML="",this.listDialogHeader.innerText=o.title||"",o.listItems.forEach(function(t){var e=document.createElement("div");e.className="input-list-item";var i=document.createElement("input");i.value=t.value,i.setAttribute("type",o.multiSelect?"checkbox":"radio"),i.setAttribute("name","listDialogItem"),i.setAttribute("id",t.value),e.appendChild(i);var n=document.createElement("label");n.setAttribute("for",t.value);var a=document.createElement("span");a.className="selector primaryBackgroundTheme";i=document.createElement("div");i.innerText=t.text,n.appendChild(a),n.appendChild(i),e.appendChild(n),l.listDialogItems.appendChild(e)});for(var n=[],e=function(t){var e=t.target.children[0],i=e.value,e=e.type;switch(t.target.children[0].checked?t.target.children[0].checked=!1:t.target.children[0].checked=!0,e){case"checkbox":t.target.checked?n.push({value:i}):n=n.filter(function(t){return t.value!==i});break;case"radio":n=[{value:i}],l.listDialogConfirmBtn.disabled=!1}},i=0;i<this.listDialogItems.childElementCount;i++)this.listDialogItems.children[i].onclick=e;this.listDialogCancelBtn.innerHTML=o.cancelButton.text,this.listDialogCancelBtn.value=o.cancelButton.value,this.listDialogConfirmBtn.innerHTML=o.confirmButton.text,this.listDialogConfirmBtn.value=o.confirmButton.value,o.multiSelect||(this.listDialogConfirmBtn.disabled=!0);var a=function(){l.listDialog.classList.remove("active"),l.backdrop.classList.remove("active"),l.backdrop.classList.remove("isDialog");for(var t=0;t<l.listDialogItems.childElementCount;t++)l.listDialogItems.children[t].onclick=null;l.listDialogItems.innerHTML="",l.listDialogHeader.innerHTML=""};this.backdrop.onclick=function(){return a(),t(null,{cancelled:!0,selected:n})},this.listDialogCancelBtn.onclick=function(){return a(),t(null,{cancelled:!0,selected:n})},this.listDialogConfirmBtn.onclick=function(){return a(),t(null,{cancelled:!1,selected:n})},this.listDialog.classList.add("active"),this.backdrop.classList.add("active"),this.backdrop.classList.add("isDialog")}},validate:function(){var t=!1,e=!1,i=this.currentStepOptions,n=i.required,i=i.attachments;return(!n||this.textarea.value&&0<this.textarea.value.length)&&(t=!0),i.location.required&&!this.currentStepData.location.latitude||(e=!0),t&&e}};setTimeout(function(){inputAPI.initialized||inputAPI.init()},5e3);
"use strict";var gifAPI={initialized:!1,apiKey:"5yISc07frWLGwJJgXt7PKnsDMQP1or1H",results:[],pages:[],options:{},handleClose:null,init:function(){var i=this;this.gifDialog?this.gifDialog.innerHTML="":(this.gifDialog=document.createElement("div"),this.gifDialog.style.display="none"),this.backdrop?this.backdrop.className="":(this.backdrop=document.createElement("div"),this.backdrop.id="gif-backdrop"),this.gifDialog.id="gifDialog",this.gifDialog.className="backgroundColorTheme";var e=document.createElement("div");e.className="gifDialog-container backgroundColorTheme",this.gifDialog.appendChild(e);var t=document.createElement("div");t.className="gifapi-nav backgroundColorTheme",e.appendChild(t);var n=document.createElement("div");n.className="gifapi-nav-flex gifapi-search-bar",t.appendChild(n),this.cancelButton=document.createElement("span"),this.cancelButton.className="icon icon-cross2 gifapi-cancel bodyTextTheme",this.cancelButton.style.width="unset",n.appendChild(this.cancelButton);t=document.createElement("form");t.action=".",n.appendChild(t),this.gifSearchInput=document.createElement("input"),this.gifSearchInput.className="gif-search-input form-control",this.gifSearchInput.placeholder="search GIPHY",this.gifSearchInput.type="search",this.gifSearchInput.onkeydown=function(e){var t=e.key,e=e.target;"Enter"===t&&(i.search(),e.blur())},this.gifSearchInput.oninput=function(e){e=e.target;i.clearSearch.style.display=e.value?"block":"none"},this.setSearchBarStyle(),t.appendChild(this.gifSearchInput);n=document.createElement("i");n.className="glyphicon glyphicon-search search-icon",t.appendChild(n),this.clearSearch=document.createElement("button"),this.clearSearch.className="search-clear",this.clearSearch.style.display="none",this.clearSearch.onclick=function(e){e=e.target;i.gifSearchInput.value="",e.style.display="none"},t.appendChild(this.clearSearch);t=document.createElement("i");t.className="glyphicon glyphicon-minus-sign",this.clearSearch.appendChild(t),this.gifResults=document.createElement("div"),this.gifResults.className="gif-results",this.gifResults.addEventListener("scroll",function(){i.lazyLoad.processLazyImages(),i.loadPage()},!1),e.appendChild(this.gifResults);t=document.createElement("div");t.className="powered-by-giphy",e.appendChild(t);e=document.createElement("img");e.src="".concat(window._appRoot,"media/PoweredByGiphy.png"),t.appendChild(e),0<=window.location.pathname.indexOf("pluginTester")?(this.gifDialog.style.height=document.getElementById("app").offsetHeight+"px",this.gifDialog.style.position="absolute",document.getElementById("app").appendChild(this.gifDialog),document.getElementById("app").appendChild(this.backdrop)):(this.gifDialog.style.height="var(--full-app-height, 100vh)",this.gifDialog.style.maxHeight="var(--full-app-height, 100vh)",document.body.appendChild(this.gifDialog),document.body.appendChild(this.backdrop)),this.initialized=!0},setSearchBarStyle:function(){function e(e,t){var i;!e&&t&&t.data&&t.data.colors&&(e=(i=t.data.colors).backgroundColor,t=i.bodyText,i=tinycolor(e).isDark()?"lighten":"darken",e=tinycolor(e)[i](10).toString(),t=tinycolor(t)[i](10).toString(),(i=document.createElement("style")).innerHTML="\n\t\t\t\t.gif-search-input::placeholder,\n\t\t\t\t.search-icon {\n\t\t\t\t\tcolor: ".concat(t," !important;\n\t\t\t\t}\n\t\t\t\t.gif-search-input {\n\t\t\t\t\tcolor: ").concat(t,";\n\t\t\t\t\tbackground: ").concat(e,"\n\t\t\t\t}\n\t\t\t"),n.gifDialog.appendChild(i))}var n=this;if(PluginAPI.appTheme)return e(null,{data:PluginAPI.appTheme});new DatastoreAPI(window.appContext.currentApp.appId,"appearance","appearance",window.appContext.liveMode).get({tag:"appearance",withDynamicData:!1},e)},showGifDialog:function(e,t){var i=this;this.options=e=e||{multiple:!1,rating:"g"},this.initialized||this.init(),this.gifResults.innerHTML="",this.gifSearchInput.value="";this.results=[],this.handleClose=function(e){t(null,{cancelled:e,results:i.results}),i.handleClose=null,i.pages=[],i.results=[],i.options={},i.timer=setTimeout(function(){i.gifDialog.classList.remove("active"),i.backdrop.classList.remove("active"),setTimeout(function(){i.gifDialog.classList.contains("active")||(i.gifResults.innerHTML="",i.gifSearchInput.value="",i.gifDialog.style.display="none",i.init())},500)},150)},this.cancelButton.onclick=function(){return i.handleClose(!0)},this.backdrop.onclick=function(){return i.handleClose(!0)},this.timer&&(clearTimeout(this.timer),this.timer=null),this.gifDialog.style.display="flex",setTimeout(function(){i.gifDialog.classList.add("active"),i.backdrop.classList.add("active")},100),this.gifDialog.addEventListener("transitionend",function(){return i.getTrending()},{once:!0})},createRequestUrl:function(e){if(e){var t=e.key,i=e.endpoint,n=e.query,a=e.limit,s=e.offset,e=e.rating,t="https://api.giphy.com/v1/gifs/".concat(i,"?api_key=").concat(t),a="&limit=".concat(a||120),s="&offset=".concat(s||0),e="&rating=".concat(e||"g"),n=n&&"search"===i?"&q=".concat(n):"";return"".concat(t).concat(a).concat(s).concat(e).concat(n)}},createProxyUrl:function(e){return"https://proxy.buildfire.com/hop?url=".concat(encodeURIComponent(e))},get:function(e,t,i){var n=this;if(!e||!["trending","search","random"].includes(e))return i(new Error("invalid endpoint"),null);"function"==typeof t&&(i=i||t,t={});var a=t||{},s=a.limit,o=a.offset,t=a.rating,a=a.query,a={key:this.apiKey,endpoint:e,limit:s,offset:o,rating:t,query:a},a=this.createRequestUrl(a),a=this.createProxyUrl(a);fetch(a).then(function(e){return e.json()}).then(function(e){return n.digest(e,i)}).catch(function(e){i?i(e,null):console.error(e)})},digest:function(e,t){var i=this.convertGifs(e.data);if(t)return t(null,i);this.gifResults.innerHTML="",this.pages=[];for(var n=[];i.length;){var a=[],a=24<i.length?i.splice(0,24):i.splice(0,i.length);n.push(a)}this.pages=n,this.loadPage()},convertGifs:function(e){return e?(e=e.id?[e]:e).map(function(e){var t=e.id,i=e.title,n=e.rating,a=e.user,e=e.images;return{id:t,title:i,rating:n,user:a,images:{preview:e.preview,preview_gif:e.preview_gif,original:e.original,downsized_large:e.downsized_large,downsized_medium:e.downsized_medium,downsized_small:e.downsized_small,downsized_still:e.downsized_still,original_still:e.original_still,fixed_height:e.fixed_height}}}):[]},loadPage:function(){var e;this.pages.length<1||(e=this.gifResults).scrollHeight-e.scrollTop<=1.75*e.clientHeight&&(e=this.pages.splice(0,1)[0],this.renderPage(e))},renderPage:function(e){var n=this;e&&e.length&&(bfUtils.isIOS,e.forEach(function(t){var e,i=(e=t).images.preview_gif&&e.images.preview_gif.url?e.images.preview_gif.url:e.images.downsized_medium&&e.images.downsized_medium.url?e.images.downsized_medium.url:e.images.original&&e.images.original.url?e.images.original.url:null;i&&((e=document.createElement("div")).className="gif-container lazy-img",e.id="gif_".concat(t.id),e.setAttribute("data-src",i),e.onclick=function(e){return n.selectGif(e,t)},i=document.createElement("span"),e.appendChild(i),(i=document.createElement("div")).className="gif-thumbnail",e.appendChild(i),n.gifResults.appendChild(e))}),this.lazyLoad.processLazyImages())},selectGif:function(e,t){e.target.classList.add("selected"),this.results=[t],this.handleClose&&this.handleClose(!1)},getTrending:function(){this.get("trending",this.options)},search:function(){gifAPI.options.query=gifAPI.gifSearchInput.value||"",gifAPI.options.query?gifAPI.get("search",gifAPI.options):gifAPI.get("trending",gifAPI.options)},lazyLoad:{process:function(e){var t;!e.hasAttribute("data-src")||(t=e.querySelectorAll(".gif-thumbnail")[0])&&(t.style.backgroundImage=this.isInViewport(e)?"url(".concat(e.getAttribute("data-src"),")"):"unset")},isInViewport:function(e){var t=window.innerHeight,e=e.getBoundingClientRect().top;return e>t*-Math.abs(1.25)&&e<1.25*t},processLazyImages:function(){var t=this;document.querySelectorAll(".lazy-img").forEach(function(e){return t.process(e)})}}};setTimeout(function(){gifAPI.initialized||gifAPI.init()},5e3);
"use strict";var bookmarkAPI={add:function(n,t){var e=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId,r=authAPI.getCurrentUser(),o=r?r._id:"guest",r="".concat(o,".bookmarks"),o=localStorage.getItem(r)?JSON.parse(localStorage.getItem(r)):[];n.id=n.id||n.title,n.pluginInstanceId=e;e=o.findIndex(function(t){var e=t.id===n.id,t=t.pluginInstanceId===n.pluginInstanceId;return e&&t});0<=e?o[e]=n:o.push(n),localStorage.setItem(r,JSON.stringify(o)),t(null,n)},delete:function(e,t){var n=authAPI.getCurrentUser(),r=n?n._id:"guest",o="".concat(r,".bookmarks"),n=localStorage.getItem(o)?JSON.parse(localStorage.getItem(o)):[],r=n.findIndex(function(t){return t.id===e});0<=r&&n.splice(r,1),localStorage.setItem(o,JSON.stringify(n)),t&&t(null,n)},deleteFromPlugin:function(e,t){var n=authAPI.getCurrentUser(),r=n?n._id:"guest",o="".concat(r,".bookmarks"),n=localStorage.getItem(o)?JSON.parse(localStorage.getItem(o)):[],r=n.findIndex(function(t){return t.id===e});0<=r&&n.splice(r,1),localStorage.setItem(o,JSON.stringify(n)),t(null,null)},getAll:function(t){var e=authAPI.getCurrentUser(),e=e?e._id:"guest",e="".concat(e,".bookmarks");t(null,localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):[])},getAllFromPlugin:function(t,e){var n=authAPI.getCurrentUser(),n=n?n._id:"guest",r=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId,n="".concat(n,".bookmarks");e(null,(localStorage.getItem(n)?JSON.parse(localStorage.getItem(n)):[]).filter(function(t){return t.pluginInstanceId===r}))}};
"use strict";var notesAPI={notesCtrlScope:null,_getUserDataContext:function(t,n){this._getUser(function(t){var e=t._id,t=window.currentAppId||window.appContext.currentApp.appId,t=new UserDatastoreAPI(t,"sideMenu",1,!0,e);n(null,{userDatastore:t,userToken:e})})},openDialog:function(e,n){var i=this;this._getUser(function(t){e?(i.notesCtrlScope.tempNoteData=e,i.notesCtrlScope.instanceId=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId,i.notesCtrlScope.pluginOpen=!0,i.notesCtrlScope.callback=n):i.notesCtrlScope.pluginOpen=!1,i._showModal()})},getByItemId:function(n,i){var o=this;(n=n||{}).itemId?this.getAllFromItem(n.itemId,function(t,e){t?i(t):(t=o.formatNotes(e),t={itemId:n.itemId,hasNotes:e&&0<e.length,noteCount:e?e.length:0,notes:t},i(null,t))}):i("invalid params, missing itemId")},formatNotes:function(t){var e=[];return t&&0<t.length&&t.forEach(function(t){e.push({id:t.id,text:t.noteText,timeIndex:t.timeIndex})}),e},_showModal:function(){this.notesCtrlScope.notesShown=!0,notesAPI.notesCtrlScope.$$phase||notesAPI.notesCtrlScope.$apply()},add:function(o,a){var d=this,t={title:o.title||"New Note",hideUserData:!0,placeholder:"Note Text",saveText:"Save"};window.inputAPI.showTextDialog(t,function(t,e){if(t)throw t;o.noteText=e.cancelled?"":e.results[0].textValue,""!==o.noteText&&(o.id=Date.now(),d.notesCtrlScope.notes.push({id:o.id,noteText:o.noteText,timeIndex:o.timeIndex}),d.notesCtrlScope.$$phase||d.notesCtrlScope.$apply(),d._getUser(function(i){d._getUserData(function(t,e){if(t)throw t;var n;o.userToken=i._id,e.id?(t=(n=d._getIndex(e,o.instanceId,o.itemId)).pluginIndex,n=n.itemIndex,-1<t?-1<n?d._addNote(e,o,t,n,a):d._addItem(e,o,t,a):d._initPluginData(e,o,a)):d._initUserData(o,a)})}))})},_addNote:function(t,e,n,i,o){var a=e.id,d=e.noteText,e=e.timeIndex;t.data[n].content[i].notes.push({id:a,noteText:d,timeIndex:e}),this._updatePluginData(t,o)},_addItem:function(t,e,n,i){var o=e.title,a=e.itemId,d=e.imageUrl,r=e.payload,s=e.noteText,u=e.timeIndex,e=e.id;t.data[n].content.push({title:o,itemId:a,imageUrl:d,payload:r,notes:[{id:e,noteText:s,timeIndex:u}]}),this._updatePluginData(t,i)},edit:function(e,d,r,s){var u=this;this._getUserData(function(t,n){if(t)throw t;var t=u._getIndex(n,r,d,e),i=t.pluginIndex,o=t.itemIndex,a=t.noteIndex,t={title:n.data[i].content[o].title||"New Note",hideUserData:!0,placeholder:"",saveText:"Save",prefill:n.data[i].content[o].notes[a].noteText};window.inputAPI.showTextDialog(t,function(t,e){if(t)throw t;e.cancelled||""===e.results[0].textValue||(n.data[i].content[o].notes[a].noteText=e.results[0].textValue,u._updatePluginData(n,s))})})},delete:function(i,o,a,d){var r=this;this._getUserData(function(t,e){if(t)throw t;var n=r._getIndex(e,a,o),t=n.pluginIndex,n=n.itemIndex;e.data[t].content[n].notes=e.data[t].content[n].notes.filter(function(t){return t.id!=i}),0===e.data[t].content[n].notes.length&&(e.data[t].content.splice(n,1),0===e.data[t].content.length&&e.data.splice(t,1)),r._updatePluginData(e,d)})},getAllFromItem:function(n,i){var o=this;this._getUserData(function(t,e){!t&&e.id&&e.data.length?(t=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId,t=o._getIndex(e,t).pluginIndex,t=e.data[t].content.find(function(t){return t.itemId===n}),i(null,t?t.notes:[])):i(null,[])})},getAll:function(n){this._getUserData(function(t,e){if(t)throw t;n(null,e.data)})},loadNote:function(c,p,g,I){var x=this;this._getUserData(function(t,e){if(t)throw t;var n=g.pluginId,i=g.instanceId,o=g.title,a=g.folderName,d=x._getIndex(e,i,p,c),r=d.pluginIndex,s=d.itemIndex,t=d.noteIndex,d=e.data[r].content[s],s=!!c&&e.data[r].content[s].notes[t],t=!1;window.appContext&&window.appContext.currentPlugin&&document.getElementById(window.appContext.currentPlugin.pluginAPI.iFrameId)&&window.appContext.currentPlugin.instanceId===i&&(t=!0);var u=window.postMaster.launcherPluginAPI.navigation,l="";l=d.payload?(d=d.payload,s&&(d.timeIndex=s.timeIndex),d=JSON.stringify(d),"".concat("&dld=").concat(d)):(s=s?JSON.stringify({link:p,timeIndex:s.timeIndex}):JSON.stringify({link:p}),"&dld=".concat(s)),"function"!=typeof I&&(I=Function.prototype),t?u.navigateHome({},function(){u.navigateTo({pluginId:n,instanceId:i,title:o,folderName:a,queryString:l},I)}):u.navigateTo({pluginId:n,instanceId:i,title:o,folderName:a,queryString:l},I)})},_getUserData:function(n){this._getUserDataContext({},function(t,e){if(t)throw t;e.userDatastore.get("notesDB.18",function(t,e){n(t,e)})})},_initUserData:function(t,n){var i=this,o=t.id,a=t.title,d=t.noteText,r=t.timeIndex,s=t.instanceId,u=t.itemId,l=t.imageUrl,c=t.payload;this._getUserDataContext({},function(t,e){if(t)throw t;t={tag:"notesDB.18",userToken:e.userToken,checkDuplicate:!0};t.obj=[{instanceId:s,content:[{title:a,itemId:u,imageUrl:l,payload:c,notes:[{id:o,noteText:d,timeIndex:r}]}]}],e.userDatastore.insert(t,function(t,e){if(t)throw i.notesCtrlScope.notes=JSON.parse(JSON.stringify(i.notesCtrlScope.notesCopy)),t;i.notesCtrlScope.notesCopy=JSON.parse(JSON.stringify(i.notesCtrlScope.notes)),n(e)})})},_initPluginData:function(t,e,n){var i=e.id,o=e.title,a=e.noteText,d=e.timeIndex,r=e.instanceId,s=e.itemId,u=e.imageUrl,e=e.payload;t.data.push({instanceId:r,content:[{title:o,itemId:s,imageUrl:u,payload:e,notes:[{id:i,noteText:a,timeIndex:d}]}]}),this._updatePluginData(t,n)},_updatePluginData:function(n,i){var o=this;this._getUserDataContext({},function(t,e){if(t)throw t;t={id:n.id,tag:"notesDB.18",userToken:e.userToken};t.obj=n.data,e.userDatastore.update(t,function(t,e){if(t)throw o.notesCtrlScope.notes=JSON.parse(JSON.stringify(o.notesCtrlScope.notesCopy)),t;o.notesCtrlScope.notesCopy=JSON.parse(JSON.stringify(o.notesCtrlScope.notes)),i(e)})})},_getUser:function(n){var t=window.authAPI.getCurrentUser();t?n(t):authAPI.login({showMenu:!1},function(t,e){!t&&e&&n(e)})},_getIndex:function(t,e,n,i){var o={},a=t.data.findIndex(function(t){return t.instanceId===e});if((o.pluginIndex=a)<0||!n)return o;var d=t.data[a].content.findIndex(function(t){return t.itemId===n});if((o.itemIndex=d)<0||!i)return o;d=t.data[a].content[d].notes.findIndex(function(t){return t.id===i});return o.noteIndex=d,o},seekTo:function(o,a,d,r){var s=this;this._getUserData(function(t,e){if(t)throw t;var n=s._getIndex(e,d,a,o),i=n.pluginIndex,t=n.itemIndex,n=n.noteIndex,n=!!o&&e.data[i].content[t].notes[n];n&&((window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI).sendMessage(null,new Packet(null,"notes.triggerOnSeekTo",{time:n.timeIndex})),r())})}};
"use strict";function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function CameraAPI(e){this.context=e,this.mockModes={camera:!1,video:!1},this.camera=null,this.capture=null,this.publicFiles=null,this.init()}CameraAPI.prototype={init:function(){var e="undefined"!=typeof device&&window.navigator;return this.mockModes.camera=!e||!navigator.camera,this.mockModes.video=!(e&&navigator.device&&navigator.device.capture&&navigator.device.capture.mp4),this.mockModes.camera?console.warn("mock camera interaction"):this.mockModes.video?console.warn("mock video interaction"):(this.camera=window.navigator.camera,void(this.capture=navigator.device.capture))},isAuthorized:function(e,t){return bfUtils.isMobileDevice?cordova.plugins&&cordova.plugins.diagnostic?void cordova.plugins.diagnostic.isCameraAvailable({successCallback:function(e){t(null,e)},errorCallback:function(e){t(e)},externalStorage:!1}):t("REBUILD_REQUIRED"):t("Camera API is not available on web")},requestAuthorization:function(e,t){return bfUtils.isMobileDevice?cordova.plugins&&cordova.plugins.diagnostic?void cordova.plugins.diagnostic.requestCameraAuthorization({successCallback:function(e){t(null,e)},errorCallback:function(e){t(e)},externalStorage:!1}):t("REBUILD_REQUIRED"):t("Camera API is not available on web")},getPicture:function(e,t){var n=this;if(t=t||function(){},this.mockModes.camera)return console.warn("mock camera interaction"),t(null,null);if((e=e||{}).upload&&(e.destinationType=this.destinationTypes.FILE_URI),["undefined","number"].indexOf(_typeof(e.quality))<0)return t("quality must be a number! received ".concat(_typeof(e.quality)),null);if(["undefined","number"].indexOf(_typeof(e.destinationType))<0)return t("destinationType must be a number! received ".concat(_typeof(e.destinationType)),null);if(["undefined","number"].indexOf(_typeof(e.sourceType))<0)return t("sourceType must be a number! received ".concat(_typeof(e.sourceType)),null);e.sourceType=void 0===e.sourceType?1:e.sourceType,e.correctOrientation=!0;var o=1===e.sourceType?"camera":"photo_library";permissionRequestsAPI.queueRequest(o,this,function(){n._getPicture(e,t)})},_getPicture:function(e,o){var i=this;this.camera.getPicture(function(n){if(e.destinationType===i.destinationTypes.FILE_URI&&(n=i.getLocalURI(n)),!e.upload)return o(null,n);i.getImageAsBlob(n,function(e,t){return e?o(e,n):void i._upload(t,o)})},function(e){console.error("cameraAPI getPicture error: "+e),o(e,null)},e)},getVideo:function(e,t){var n=this;return t=t||function(){},this.mockModes.video?(console.warn("mock video interaction"),t(null,null)):(e=e||{},["undefined","number"].indexOf(_typeof(e.quality))<0?t("quality must be a number! received ".concat(_typeof(e.quality)),null):["undefined","number"].indexOf(_typeof(e.duration))<0?t("duration must be a number! received ".concat(_typeof(e.duration)),null):(e.limit=1,void permissionRequestsAPI.queueRequest("camera",this,function(){permissionRequestsAPI.queueRequest("microphone",n,function(){n._getVideo(e,t)})})))},_getVideo:function(c,a){var l=this;this.capture.captureVideo(function(e){var t=e[0],n=t.fullPath,o=t.name,i=t.size,r=t.trimmed,e=t.warning,t=l.getLocalURI(n),u={localURI:t,path:n,name:o,size:i,trimmed:r};if(!c.upload)return a(e||null,u);l.getImageAsBlob(t,function(n,e){return n?a(n,u):void l._upload(new Blob([e],{type:"video/mp4"}),function(e,t){return e?a("Failed to upload",u):void a(n,_objectSpread(_objectSpread({},u),{},{url:t}))})})},function(e){console.error("cameraAPI getVideo error: "+e),a(e,null)},c)},getImageAsBlob:function(e,t){var n;t&&((n=new XMLHttpRequest).open("GET",e,!0),n.responseType="blob",n.onload=function(){return t(null,n.response)},n.onerror=function(){return t("An error occured while uploading your file",null)},n.send())},_upload:function(e,n){this.publicFiles||(this.publicFiles=new PublicFilesAPI(this.context)),this.publicFiles&&this.publicFiles.uploadFiles([e],function(e,t){return e?n(e,null):void n(null,t[0].url)})},getLocalURI:function(e){if(!bfUtils.isIOS)return e;var t=new URL(window._appRoot),n=t.protocol,t=t.host,t="".concat(n,"//").concat(t);return"cdvfile:"===n?e:0===e.indexOf("/")?"".concat(t).concat(e):e.replace("file://",t)},get destinationTypes(){return{DATA_URL:0,FILE_URI:1,NATIVE_URI:2}}};
"use strict";$app.controller("authCtrl",["$rootScope","$scope","Upload","$sce","$window","$compile","$routeParams","StringResource",function(a,c,s,r,l,d,u,t){c._appRoot=window._appRoot,c.registerClick=!1;document.addEventListener("appThemeOnUpdate",function(){AppearanceAPI.prototype.getAppearance(null,function(e,o){return e?console.error(e):void(o&&c.setThemeType(o))});var e,o,t=document.querySelector(".form.registration").querySelectorAll("input[type=date]");e=t,o=tinycolor(PluginAPI.appTheme.colors.backgroundColor).isDark(),e.forEach(function(e){o?e.classList.add("inverted-input"):e.classList.remove("inverted-input")})},!1);var p,g=void 0;window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.userLoginDomainSettings?"enterprise"==window.appContext.currentApp.config.type&&(g="enabled"):g=window.appContext.currentApp.config.userLoginDomainSettings);var w="Password must be at least 8 characters long, contains an upper case letter, a lower case letter, a number and a symbol.";c.loginTranslation="Log In",c.registerTranslation="Register",c.emailDoesNotExistTxt="Email does not exist in system.",c.updateLoginTranslations=function(e){e.passwordAtLeast8ComplexChars&&(w=e.passwordAtLeast8ComplexChars),e.loginTranslation&&(c.loginTranslation=e.loginTranslation),e.registerTranslation&&(c.registerTranslation=e.registerTranslation),e.emailDoesNotExist&&(c.emailDoesNotExistTxt=e.emailDoesNotExist)},t.getData().then(function(e){e&&(c.loginButtonTitle=e.logIn,c.changedPasswordSuccessfully=e.changedPasswordSuccessfully||"Password Changed Successfully",c.changePasswordAtLeast8ComplexChars=e.changePasswordAtLeast8ComplexChars||"Password must be at least 8 characters long, contains an upper case letter, a lower case letter, a number and a symbol.",c.changePasswordError=e.changePasswordError||"Sorry, we couldn't change your password, please try later.",c.secretCodeInformModal=e.secretCodeInformModal||"We are going to send you a secret code through your email in order to complete changing password process",c.secretCodeError=e.secretCodeError||"Sorry, we have faced a problem while sending you a secret code")});function n(e,t,o){var i,n,r,s;e&&e.active&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?(i=o||(PluginAPI&&PluginAPI.appTheme&&PluginAPI.appTheme.colors?PluginAPI.appTheme.colors:null),customRegistration.getFields({customRegistrationSettings:e,refreshUI:function(){c.$$phase||c.$apply()}},function(e,o){var n,r,s;o&&(c.showCustomRegistration=!0,n=[],s=r=null,termsAPI.getGdprLinks({openGDPRContent:function(e){c.loadGDPR(e.key)}},function(e,o){return e?console.error(e):(n=o.gdprLinks,c.registrationGdprLinks=n,r=o.customTermsAndConditions.key,s=o.customPrivacyPolicy.key,void(c.shouldDisableRegisterButton=!r||!s))}),c.customRegistrationSubmit=function(){o.fetch({validateFields:!0},function(e,o){var t=!1;n&&n.forEach(function(e){e.validate(e.value),e.error&&(t=!0)}),e||t||(c.uploadFile=o.profilePictureFile,o.customTermsAndConditionsKey=r,o.customPrivacyPolicyKey=s,c.register(o))})},o.fields&&o.fields.forEach(function(e){e&&"date"===e.type&&i&&i.backgroundColor&&tinycolor(i.backgroundColor).isDark()&&(e.class="inverted-input")}),c.customRegistrationFields=o.fields,c.customRegistrationRules=o.rules,c.initCustomRegistration=function(){o.initializers.forEach(function(e){e()})},t&&t(null,null),c.$$phase||c.$apply())})):(n=[],s=r=null,termsAPI.getGdprLinks({openGDPRContent:function(e){c.loadGDPR(e.key)}},function(e,o){return e?console.error(e):(n=o.gdprLinks,c.registrationGdprLinks=n,void(o.customTermsAndConditions.key&&o.customPrivacyPolicy.key?(r=o.customTermsAndConditions.key,s=o.customPrivacyPolicy.key,c.shouldDisableRegisterButton=!1):c.shouldDisableRegisterButton=!0))}),c.registerUser=function(){var e={},o=!(c.registerClick=!0);n&&n.forEach(function(e){e.validate(e.value),e.error&&(o=!0)}),c.frmAuthRegister.$invalid||o||(window.validator.validatePassword(c.password)?(e.customTermsAndConditionsKey=r,e.customPrivacyPolicyKey=s,c.register(e),c.registerClick=!1):(e={data:{title:" ",body:w,disableCancel:!0}},window.openDialog(e,function(){})))},c.showCustomRegistration=!1,c.$$phase||c.$apply())}c.checkIfDisable=function(e){var o=!1;e&&e.forEach(function(e){e.value||"termsAndConditions"===e.name||"privacyPolicy"===e.name||(o=!0)}),c.shouldDisableRegisterButton=o},c.editVisibilityOptions=function(t){customRegistration.editVisibilityOptions({field:t},function(e,o){return e?console.error(e):(t.visibilityChoice=o.text.toLowerCase(),void(c.$$phase||c.$apply()))})},window.authAPI.authCtrlScope=c,a.allowCancel=void 0===a.allowCancel||a.allowCancel,a.authShown=!1,c.secretCodeProvider=null,c.refWindow=null,c.errors={},c.msgSuccess=null,c.enablePasswordBasedAuth=!0,c.password="",c.userObj={username:"",email:""},c.changePassword={oldPassword:"",newPassword:"",reTypedPassword:"",secretCode:""},c.loginCallback=null;var i="",h="",m="",f="",C="",y="",b="",P="",v="",I=window.appContext.currentApp.appId;function o(e){e&&(e=window.loginUI.convertToCss(e)||"*{}",localStorage.loginUI=e);var o=e||localStorage.getItem("loginUI_"+I),t=document.getElementById("custom-login-ui");t||(e=document.getElementsByClassName("login-holder")[0],(t=document.createElement("style")).id="custom-login-ui",e.appendChild(t)),t.innerHTML=o}function S(e){return"boolean"!=typeof e||e}function A(e,n){e?console.error(e):(c.authLoginProviders=[],n&&n.data&&0<Object.keys(n.data).length?("SSOLogin"==n.data.signOnStrategy&&(c.SSOLogin=!0,v=n.data.contentType,h="application/x-www-form-urlencoded"==v||"multipart/form-data"==v?(i=window.siteConfig.endPoints.hopHost+"?url="+n.data.accessTokenAPI,window.siteConfig.endPoints.hopHost+"?url="+n.data.loginAPI):(i=n.data.accessTokenAPI,n.data.loginAPI),c.signOnStrategy=y=n.data.signOnStrategy,c.resetPasswordAPI=m=n.data.resetPasswordAPI,f=n.data.resetPasswordMessage,c.registerUrl=C=n.data.registerUrl,b=n.data.clientId,P=n.data.clientSecret,setInterval(k,9e5)),t.getData().then(function(e){var o,t;e&&(c.appleSignIn=e.appleSignIn||"Continue with Apple",c.facebookSignIn=e.facebookSignIn||"Continue with Facebook",c.twitterSignIn=e.twitterSignIn||"Continue with Twitter",c.googleSignIn=e.googleSignIn||"Continue with Google",c.appleRegistration=e.appleRegistration||"Continue with Apple",c.facebookRegistration=e.facebookRegistration||"Continue with Facebook",c.twitterRegistration=e.twitterRegistration||"Continue with Twitter",c.googleRegistration=e.googleRegistration||"Continue with Google"),n.data.authLoginProviders?(c.enablePasswordBasedAuth=S(n.data.enablePasswordBasedAuth),c.authLoginProviders=n.data.authLoginProviders.filter(function(e){return e.isActive}),c.authLoginProviders.forEach(function(e){"oauth2"===e.authType?(e.buttonIcon?"image"===e.buttonIcon.type?e.darkButtonImageUrl=e.lightButtonImageUrl=imageTools.cropImage(e.buttonIcon.value,{size:"xxs",aspect:"1:1"}):(e.buttonIconValue=e.buttonIcon.value+(e.buttonTextColor?"":" bodyTextTheme"),e.buttonIconStyles=(e.buttonTextColor?"color: "+e.buttonTextColor+" !important; ":"")+"width: 1.75em; margin: 0.625em; flex: none;"):e.buttonIconStyles=(e.buttonTextColor?"color: "+e.buttonTextColor+" !important; ":"")+"width: 1.75em; margin: 0.625em; flex: none;",e.buttonColor&&(e.buttonBackground={},"gradient"===e.buttonColor.colorType&&(e.buttonBackground.background=e.buttonColor.gradient&&e.buttonColor.gradient.backgroundCSSValue),"solid"===e.buttonColor.colorType&&(e.buttonBackground.background=e.buttonColor.solid&&e.buttonColor.solid.color))):R(e)})):(o=S(n.data.enableFacebook),t=S(n.data.enableTwitter),e=!!n.data.enableGoogle,c.enablePasswordBasedAuth=S(n.data.enablePasswordBasedAuth),!!(o||t||e||void 0!==n.data.enableApple)&&S(n.data.enableApple)&&c.authLoginProviders.push(R({providerId:"apple",authType:"social"})),o&&c.authLoginProviders.push(R({providerId:"facebook",authType:"social"})),t&&c.authLoginProviders.push(R({providerId:"twitter",authType:"social"})),e&&c.authLoginProviders.push(R({providerId:"google",authType:"social"})))}),y=n.data.signOnStrategy,"enabled"==g&&(p=n.data.domain),c.emailInputType=p?"text":"email"):t.getData().then(function(e){e&&(c.appleSignIn=e.appleSignIn||"Continue with Apple",c.facebookSignIn=e.facebookSignIn||"Continue with Facebook",c.twitterSignIn=e.twitterSignIn||"Continue with Twitter",c.googleSignIn=e.googleSignIn||"Continue with Google",c.appleRegistration=e.appleRegistration||"Continue with Apple",c.facebookRegistration=e.facebookRegistration||"Continue with Facebook",c.twitterRegistration=e.twitterRegistration||"Continue with Twitter",c.googleRegistration=e.googleRegistration||"Continue with Google"),c.enablePasswordBasedAuth=!0,c.authLoginProviders.push(R({providerId:"apple",authType:"social"})),c.authLoginProviders.push(R({providerId:"twitter",authType:"social"})),c.authLoginProviders.push(R({providerId:"facebook",authType:"social"})),c.authLoginProviders.push(R({providerId:"google",authType:"social"}))}))}function R(e){switch(e.providerId){case"apple":return e.classes="btn-apple",e.loginButtonName=c.appleSignIn,e.registerButtonName=c.appleRegistration,e.darkButtonImageUrl=_appRoot+"media/logo_apple_b.png",e.lightButtonImageUrl=_appRoot+"media/logo_apple_w.png",e;case"facebook":return e.classes="btn-fb",e.loginButtonName=c.facebookSignIn,e.registerButtonName=c.facebookRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_facebook.png",e;case"twitter":return e.classes="btn-twitter",e.loginButtonName=c.twitterSignIn,e.registerButtonName=c.twitterRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_twitter.png",e;case"google":return e.classes="btn-google",e.loginButtonName=c.googleSignIn,e.registerButtonName=c.googleRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_google.png",e}}function k(){var e,o,t=JSON.parse(window.localStorage.getItem("SSO_USER"));t&&((new Date).getTime()/1e3>t.ssoExpiresAt&&(a.allowCancel=!1,a.showMenu=!1,c.showLogin(function(e,o){o&&authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()})),o=i,"multipart/form-data"==v||"application/x-www-form-urlencoded"==v?e={headers:{Authorization:"Bearer "+t.ssoUserToken,"Content-Type":"application/json"}}:(e={headers:{"Content-Type":"application/x-www-form-urlencoded"}},o=i+"?access_token="+t.ssoUserToken),window.bfUtils.http.get(o,e).success(function(e){console.log(e)}).error(function(e,o,t,n){a.allowCancel=!1,a.showMenu=!1,c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()})}))}c.updateLoginCss=function(){o()},c.updateSSORegistrationFormStatus=function(e){/htt(p|ps):\/\//g.test(T.src)&&(window.spinner&&window.spinner.hide(),c.ssoRegistrationFormStatus=e,c.$$phase||c.$apply())},o(),c.SSOLogin=!1,authAPI.getAuthSettings(null,A),c.closeLogin=function(){c.loginCallback&&c.loginCallback(),a.allowCancel?c.hideLogin():U()},c.reset=function(){c.errors={},c.showProgressMessage=!1,c.allowToRegister=!1,c.uploadFile=null,c.changePassword.oldPassword=null,c.changePassword.newPassword=null,c.changePassword.reTypedPassword=null,c.changePassword.secretCode=null,c.userObj.email=null,c.userObj.username=null,c.password=null,c.secretCode=null,c.newPassword=null,c.confirmPassword=null,c.msgSuccess=null,c.firstName=null,c.lastName=null,c.secretCodeProvider=null,c.refWindow=null,c.registrationGdprLinks&&c.registrationGdprLinks.forEach(function(e){e.value=void 0,e.error=void 0}),c.customRegistrationFields&&c.customRegistrationFields.forEach(function(e){e.value=void 0,e.error=void 0,"date"===e.type&&tinycolor(PluginAPI.appTheme.colors.backgroundColor).isDark()?e.class="inverted-input":e.class=e.class?e.class.replace("inverted-input",""):""})};var O=function(){c.successShown=!1,c.registrationShown=!1,c.loginShown=!1,c.forgetPasswordShown=!1,c.resetPasswordShown=!1,c.changePasswordShown=!1,(T=T||document.getElementById("frmExternalRegistrationForm")).src="",c.externalRegister=!1,c.ssoRegistrationFormStatus=null};O(),c.openTermsAndConditions=function(){return window.open("https://learn.appdocumentation.com/en/collections/1618556-terms-conditions-and-privacy-policy","_system"),!1},c.hideLogin=function(){c.reset(),O(),a.authShown=!1,c.loginCallback=null};var T=document.getElementById("frmExternalRegistrationForm");function U(){c.reset(),O(),a.allowCancel=!c.loginOptions||!1!==c.loginOptions.allowCancel,a.showMenuOnAuth=!c.loginOptions||!1!==c.loginOptions.showMenu,c.loginShown=!0,c.showAuth(),c.$$phase||c.$apply()}function L(){var o={};if(c.customRegistrationFields&&c.customRegistrationFields.forEach(function(e){"password"===e.type&&(o=e.messages)}),c.customRegistrationRules&&"simple"===c.customRegistrationRules.passwordStrength){if(!window.validator.validatePassword(c.changePassword.newPassword,{simplePasswordValidation:!0}))return c.errors.newPassword=!0,void(c.newPasswordError=o.invalidPasswordSimpleRules)}else if(!window.validator.validatePassword(c.changePassword.newPassword))return c.errors.newPassword=!0,void(c.newPasswordError=o.invalidPasswordRules||c.changePasswordAtLeast8ComplexChars);return 1}function x(e,r){var o=(o=JSON.parse(window.localStorage.getItem("SSO_USER")))||{};if("string"==typeof e)try{e=JSON.parse(e)}catch(e){console.warn("Unexpected parsing issue",e)}e&&e.access_token?o.ssoUserToken=e.access_token:o.ssoUserToken=e.replace(/["]+/g,""),e&&e.expires_in&&e.issued_at?o.ssoExpiresAt=e.issued_at+e.expires_in:o.ssoExpiresAt=1902608081e3,window.localStorage.setItem("SSO_USER",JSON.stringify(o));var t=null,t="undefined"==typeof push?{}:push,e=i.replace(window.siteConfig.endPoints.hopHost+"?url=",""),t={accessToken:o.ssoUserToken,accessTokenAPI:e,deviceId:t.deviceId,osType:t.platform?t.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId,loginProviderType:"SSO",email:c.userObj.username,contentType:v},t=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/loginSSO",params:t}));window.bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result?(authAPI._setCurrentUser(e.result),a.$broadcast("loginSuccessfully",e.result),r(null,e.result),bfUtils.isEmulatorCP&&cpSync.SSO.log("Succeed...")):(o=null,e&&e.error?(console.error(e.error),o=e.error,bfUtils.isEmulatorCP&&cpSync.SSO.log(e.error)):(e=o="Could not retrieve profile data",console.error(e),bfUtils.isEmulatorCP&&cpSync.SSO.log(e)),r&&r(o,null))}).error(function(e,o,t,n){console.error(e),r&&r(e,null),bfUtils.isEmulatorCP&&cpSync.SSO.log("Error while testing SSO Login..")})}c.showRegistration=function(e,n){var o;c.scrolling=bfUtils.isIOS?"no":"auto","SSOLogin"==y&&C?(o=function e(o){if(o&&-1<C.indexOf(o.origin)&&o.data){var t=null;try{t=JSON.parse(o.data)}catch(e){}t&&("success"===t.status&&(t.user&&t.user.username&&(c.userObj.username=t.user.username),window.spinner&&window.spinner.show&&window.spinner.show(!0),x(t.user,function(e,o){e?(console.error(e),window.openDialog({data:{title:" ",body:"Invalid Login",disableCancel:!0}},function(){}),n&&n(e,null)):(n=n||c.loginCallback)&&n(null,o),window.spinner&&window.spinner.hide&&window.spinner.hide(!0)})),window.removeEventListener("message",e,!1),T.src="",c.externalRegister=!1,c.ssoRegistrationFormStatus=null,c.$$phase||c.$apply())}},window.spinner.show(),c.externalRegister=!0,c.ssoRegistrationFormStatus="loading",(T=T||document.getElementById("frmExternalRegistrationForm")).src=C,window.addEventListener("message",o,!1)):(c.reset(),O(),c.registrationShown=!0,c.showAuth())},c.showAuth=function(){a.authShown||(a.authShown=!0,AppearanceAPI.prototype.sideMenu.reset({appId:window.appContext.currentApp.appId}))},c.showForgetPassword=function(){c.reset(),O(),c.forgetPasswordShown=!0,c.showAuth()},c.showSuccess=function(e){O(),c.msgSuccess=e,c.successShown=!0},c.showResetPassword=function(e){c.reset(),O(),c.resetPasswordShown=!0,c.showAuth(),c.loginCallback=e},c.updateLogin=function(e){bfUtils.isEmulatorCP&&a.accessCodeVisible&&(a.accessCodeVisible=!1),e&&"SSOForgetPassword"!=e&&o(e),c.loginCallback=function(e,o){if(e)return console.error(e);o&&(window.authAPI._setCurrentUser(o),window.authAPI.triggerOnLogin(o)),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()},U(),e&&"SSOForgetPassword"==e&&(c.showForgetPassword(),c.$apply()),E()},c.updateRegistration=function(e){c.reset(),O(),e&&n(e,function(){c.initCustomRegistration()}),c.registrationShown=!0,c.showAuth(),c.$$phase||c.$apply()},c.updateLoginAuth=function(e){c.enablePasswordBasedAuth=S(e.enablePasswordBasedAuth),e.domain&&"enabled"==g&&(p=e.domain),c.authLoginProviders=null,c.$$phase||c.$apply(),A(null,{data:e}),c.$$phase||c.$apply()},c.returnToLogin=function(){c.showLogin(c.loginCallback)},c.showLogin=function(e){c.loginCallback=e,U()},c.resetPassword=function(){var e;c.newPassword==c.confirmPassword&&(e={email:c.email,secretCode:c.secretCode,password:c.newPassword,passwordStrength:c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null,externalAppId:window.currentAppId},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/changePassword",params:e})),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result?(c.showSuccess("Password reset successfully"),o={data:{title:" ",body:"Password reset successfully",disableCancel:!0}},window.openDialog(o,function(){})):e&&e.error&&(o={data:{title:" ",body:e.error.message,disableCancel:!0}},window.openDialog(o,function(){}),console.error(e.error))}).error(function(e,o,t,n){console.error(e),callback&&callback(e,null)}))},c.forgotPassword=function(e){var o;"SSOLogin"!=y?(o={email:c.email,sendSecretCode:!0,externalAppId:window.currentAppId},e&&(o.email=e.email),o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/forgotPassword",params:o})),window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result?c.showResetPassword(c.loginCallback):(o={data:{title:" ",body:c.emailDoesNotExistTxt,disableCancel:!0}},window.openDialog(o,function(){}),e&&console.warn(e))}).error(function(e,o,t,n){console.error(e)})):(o=-1===m.indexOf("?")?"?":"&",o=m+o+"email="+c.email,window.bfUtils.http.get(o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(){var e={data:{title:" ",body:f||"An email has been sent, please check your email.",disableCancel:!0}};window.openDialog(e,function(){c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()})}),cpSync.SSO.log("Succeed...")}).error(function(e,o,t,n){e&&console.error(e),bfUtils.isEmulatorCP&&(e||"0"!=o?(o&&cpSync.SSO.log("Error status:"+o),e&&cpSync.SSO.log("Error details:"+JSON.stringify(e))):cpSync.SSO.log("Error while testing SSO Login , CORS policy .."))}))},c.showChangePassword=function(){O(),c.changePasswordShown=!0,c.showAuth(),c.passwordChangeForm.showCurrentPasswordField=!0},c.changePasswordByCurrentPassword=function(){var e;L()&&(e=c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null,authAPI.changePassword({oldPassword:c.changePassword.oldPassword,newPassword:c.changePassword.newPassword,passwordStrength:e},function(e,o){if(e){if("invalidPassword"==e.code)return c.errors.oldPassword=!0;var t=c.changePasswordError;1310===e.code&&(t=e.message),richModal.display({title:"Change Password",richContent:"<p style='font-size:1.8rem'>".concat(t,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}})}else c.changePasswordShown=!1,a.authShown=!1,c.reset(),(new ComponentUIAPI).showToastMessage({text:c.changedPasswordSuccessfully,hideDismiss:!0})}))},c.showSecretCodeModal=function(){richModal.display({title:"Secret Code",richContent:"<p style='font-size:1.8rem'>".concat(c.secretCodeInformModal,"</p>"),showDismissButton:!0,forceShow:!0,action:{title:"OK",handler:function(){var o,e;o=authAPI.getCurrentUser(),e={id:1,method:"users/forgotPassword",params:{email:o.email,sendSecretCode:!0,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result&&(new ComponentUIAPI).showToastMessage({text:"A secret code has been sent to ".concat(o.email),hideDismiss:!0})}).error(function(e,o,t,n){richModal.display({title:"Secret Code",richContent:"<p style='font-size:1.8rem'>".concat(secretCodeError,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}}),console.error(e)}),c.passwordChangeForm.showCurrentPasswordField=!1}}})},c.changePasswordBySecretCode=function(){var e;L()&&(e={email:authAPI.getCurrentUser().email,secretCode:c.changePassword.secretCode,password:c.changePassword.newPassword,passwordStrength:c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null,externalAppId:window.currentAppId},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/changePassword",params:e})),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result?(c.changePasswordShown=!1,a.authShown=!1,c.reset(),authAPI.logout(),(new ComponentUIAPI).showToastMessage({text:c.changedPasswordSuccessfully,hideDismiss:!0})):e&&e.error&&(c.errors.secretCode=!0,console.error(e.error))}).error(function(e,o,t,n){richModal.display({title:"Change Password",richContent:"<p style='font-size:1.8rem'>".concat(c.changePasswordError,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}}),console.error(e)}))},c.showBackLogin=function(){authAPI.login(null,function(){a.$broadcast("displayNav")})},c.login=function(e,n){var r,o,t,s,i;window.spinner&&window.spinner.show&&window.spinner.show(!0),"SSOLogin"!=y?(t=e,s=function(e,o){var t;e||!o?(t=null,t=e?1303===e.code?e.message:"Invalid Login":"To log in, please make sure you have a valid connection.",window.openDialog({data:{title:" ",body:t,disableCancel:!0}},function(){}),console.error(e),n&&n(e,null)):(n=n||c.loginCallback)&&n(null,o),window.spinner&&window.spinner.hide&&window.spinner.hide(!0)},window.appContext&&window.appContext.currentApp?(s=s||c.loginCallback,i=null,i="undefined"==typeof push?{}:push,e=(e=c.userObj.email)||t.email,c.password||(c.password=t.password),"enabled"==g&&p&&!e.includes("@")&&(e+=p),console.warn("email",e),i={email:e,password:c.password,deviceId:i.deviceId,osType:i.platform?i.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId},t&&(i.email=t.email,i.password=t.password),i=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/login",params:i})),window.bfUtils.http.jsonp(i,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result&&e.result.userToken?(authAPI._setCurrentUser(e.result),a.$broadcast("loginSuccessfully",e.result),s&&s(null,e.result)):(o=null,e&&e.error&&(console.warn("login error: ",e.error),o=e.error),s&&s(o,null))}).error(function(e,o,t,n){console.error(e),s&&s(e,null)})):console.error("invalid appContext")):(r=function(e,o){if(e){console.error(e);var t=null;if(e)switch(e.code){case 1303:case 1301:case 1312:t=e.message;break;default:t="Invalid Login"}else t="To log in, please make sure you have a valid connection.";window.openDialog({data:{title:" ",body:t,disableCancel:!0}},function(){}),n&&n(e,null)}else(n=n||c.loginCallback)(null,o);window.spinner&&window.spinner.hide&&window.spinner.hide(!0)},t={headers:{"Content-Type":"application/x-www-form-urlencoded"}},i=c.userObj.username,"enabled"==g&&p&&!i.includes("@")&&(i+=p),"application/x-www-form-urlencoded"==v?o=encodeURIComponent("grant_type")+"="+encodeURIComponent("password")+"&"+encodeURIComponent("username")+"="+encodeURIComponent(i)+"&"+encodeURIComponent("password")+"="+encodeURIComponent(c.password)+"&"+encodeURIComponent("client_id")+"="+encodeURIComponent(b)+"&"+encodeURIComponent("client_secret")+"="+encodeURIComponent(P):"multipart/form-data"==v?(t={transformRequest:angular.identity,headers:{"Content-Type":void 0}},(o=new FormData).append("username",i),o.append("password",c.password)):o={grant_type:"password",username:i,password:c.password,client_id:b},window.bfUtils.http.post(h,o,t).success(function(e){x(e,r)}).error(function(e,o,t,n){e&&e.error_description&&console.error(e),r&&r("Login Failed",null),bfUtils.isEmulatorCP&&(e||"0"!=o?(o&&cpSync.SSO.log("Error status:"+o),e&&cpSync.SSO.log("Error details:"+JSON.stringify(e))):cpSync.SSO.log("Error while testing SSO Login , CORS policy .."))}))};c.getGDPR=function(t,n){var e=c.userObj.email,e=siteConfig.endPoints.crmHost+"/documents/"+t.key+"/check?userKey="+encodeURIComponent(e)+"&withDetails=true";bfUtils.http.get(e).success(function(e){var o={};o.title=r.trustAsHtml(e[t.key].title),o.subtitle=r.trustAsHtml(e[t.key].subtitle),o.details=r.trustAsHtml(e[t.key].details),n(null,o)}).error(function(e){console.error(e),n(e,null)})},c.loadGDPR=function(e){c.getGDPR({key:e},function(e,o){o&&(c.GDPR_content=o,c.showGDPR=!0,a.$broadcast("hideNav"),c.$$phase||c.$apply())})},c.hideGDPR=function(){a.$broadcast("displayNav"),c.showGDPR=!1,c.GDPR_content=null},c.saveGDPR=function(s,i){var o;o=function(e,o){var t=o?o:{};t.appId=appContext.currentApp.appId;var n,r,o=["bf_terms_and_conditions","bf_privacy_policy"];s.customTermsAndConditionsKey&&o.push(s.customTermsAndConditionsKey),s.customPrivacyPolicyKey&&o.push(s.customPrivacyPolicyKey),n=o.join(","),r=function(){i&&i()},n?(n=siteConfig.endPoints.crmHost+"/documents/"+n+"/accept",bfUtils.http.post(n,{userKey:(s||c.userObj).email.toLowerCase(),info:t,source:"app"}).success(function(e){r(null,e)}).error(function(e){r(e),console.error(e)})):r(null,null)},window.$http.get("https://ipapi.co/json/").success(function(e){e?(e={ipInfo:{city:e.city,country:e.country_name,countryCode:e.country,lat:e.latitude,lon:e.longitude,regionName:e.region,timezone:e.timezone,zip:e.postal,ip:e.ip}},o(null,e)):o(null,null)}).error(function(e){o(null,null)})},c.register=function(t,n){var r,e;window.appContext&&window.appContext.currentApp?(n=n||c.loginCallback,e=null,e="undefined"==typeof push?{}:push,(r=(t?t.user:void 0)||{firstName:c.firstName||"",lastName:c.lastName||"",email:c.userObj.email,password:c.password}).deviceId=e.deviceId,r.osType=e.platform?e.platform.toLowerCase():"web",r.passwordStrength=c.customRegistrationRules?c.customRegistrationRules.passwordStrength:null,r.checkUniqueName=!!c.customRegistrationRules&&c.customRegistrationRules.checkUniqueName,r.externalAppId=window.appContext.currentApp.appId,e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(angular.toJson({id:1,method:"users/register",params:r})),c.isRegistering=!0,window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result?(o={email:r.email},t&&(o.customTermsAndConditionsKey=t.customTermsAndConditionsKey,o.customPrivacyPolicyKey=t.customPrivacyPolicyKey),c.saveGDPR(o,function(){c.login({email:r.email,password:r.password},function(e,o){r.userProfile&&userTags.setRegistrationTags(r,!0,function(e,o){e&&console.log(e)}),o&&o.userToken?(authAPI.uploadProfileImage({file:c.uploadFile,uploader:s},function(e,o){var t,r;e?(c.isRegistering=!1,n&&n(e,null)):(e=authAPI.getCurrentUser(),o?(userTags.setRegistrationTags({imageUrl:o.result},!0,function(e,o){e&&console.log(e)}),o={userToken:e.userToken,imageUrl:o.result,externalAppId:window.currentAppId},t=o,r=function(e,o){c.isRegistering=!1,n&&n(e,o)},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/update",params:t})),window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){var o;e.error?(o=null,e&&e.error&&(console.error(e.error),o=e.error),r&&r(o,null)):(null!=(o=authAPI.getCurrentUser())&&(o.imageUrl=t.imageUrl,authAPI._setCurrentUser(o)),r&&r(null,o))}).error(function(e,o,t,n){console.error(e),r&&r(e,null)})):(c.isRegistering=!1,n&&n(null,e)))}),authAPI.trackRegister(o)):c.isRegistering=!1})})):(c.isRegistering=!1,e&&e.error&&(o=e.error.message,1301===e.error.code&&t&&t.messages&&t.messages.emailAlreadyInUse?o=t.messages.emailAlreadyInUse:1313===e.error.code&&t&&t.messages&&t.messages.fullNameAlreadyInUse&&(o=t.messages.fullNameAlreadyInUse,c.customRegistrationFields.forEach(function(e){"fullName"===e.id&&(e.error=t.messages.fullNameAlreadyInUse)})),window.openDialog({data:{title:" ",body:o,disableCancel:!0}},function(){}),console.warn(e.error),e.error))}).error(function(e,o,t,n){console.error(e),c.isRegistering=!1})):console.error("invalid appContext")},c.requestLoginProvider=function(r,s){var e={id:1,method:"secretCode/request",params:{externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));c.refWindow&&!c.refWindow.closed||window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){var o,t,n;null!=e&&null!=e.result&&e.result.code&&(c.secretCodeProvider=e.result.code,"social"===r&&"apple"===s?c.refWindow=window.open(window.siteConfig.endPoints.authHost+"/website/appleLogin.html?code="+encodeURIComponent(c.secretCodeProvider)+"&externalAppId="+encodeURIComponent(window.currentAppId),"_blank","location=no,enableViewportScale=yes"):"oauth2"==r?c.refWindow=window.open(window.siteConfig.endPoints.authHost+"/app/".concat(encodeURIComponent(window.currentAppId),"/oauth2/login")+"?code="+encodeURIComponent(c.secretCodeProvider)+"&providerId="+encodeURIComponent(s),"_blank","location=no,enableViewportScale=yes"):(n="",t="_blank",("facebook"===s&&bfUtils.isAndroid||"google"===s&&bfUtils.isMobileDevice)&&(o=deviceAPI.getAppSchema(),t="_system",e=imageTools.cropImage(window.appContext.currentApp.iconUrl,{width:65,height:65}),n="&appSchema="+encodeURIComponent(o||"")+"&isExternalWindow=true&appName="+encodeURIComponent(window.appContext.currentApp.appName||"")+"&appIcon="+encodeURIComponent(e||"")),n=window.open(window.siteConfig.endPoints.authHost+"/website/index.html?v=2.0&code="+encodeURIComponent(c.secretCodeProvider)+"&loginProviderType="+s+"&externalAppId="+encodeURIComponent(window.currentAppId)+n,t,"location=no,enableViewportScale=yes"),c.refWindow="_blank"===t?n:null),c.refWindow&&c.refWindow.addEventListener&&(c.refWindow.addEventListener("exit",function(){c.refWindow=null}),c.refWindow.addEventListener("close",function(){c.refWindow=null})),setTimeout(D,1e3,480,s))},function(e){console.log(JSON.stringify(e))})};var D=function t(n,r){var e;window.appContext&&window.appContext.currentApp?0<n?(e={id:1,method:"users/secretCodeLogin",params:{code:c.secretCodeProvider,deviceId:push.deviceId,osType:push.platform?push.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){var o;e.error?(o=!1,1300==e.error.code&&(o=!0),(o=1303==e.error.code?!0:o)&&(c.secretCodeProvider=null)!=c.refWindow&&(c.refWindow.close(),c.refWindow=null)):null!=e.result&&null!=e.result.userToken?(authAPI._setCurrentUser(e.result),(o=new Date).setMinutes(o.getMinutes()-5),(e=new Date(e.result.createdOn))&&e.getTime()>=o.getTime()&&userTags.setRegistrationTags(null,!0,function(e,o){e&&console.log(e)}),null!=c.refWindow&&(c.refWindow.close(),c.refWindow=null),c.loginCallback&&c.loginCallback(null,authAPI.getCurrentUser())):null!=c.refWindow&&c.refWindow.closed&&"twitter"!=r?(c.refWindow.close(),c.secretCodeProvider=null,c.refWindow=null):setTimeout(t,1e3,n-1,r)},function(e){console.log(JSON.stringify(e))})):((c.secretCodeProvider=null)!=c.refWindow&&(c.refWindow.close(),c.refWindow=null),c.loginCallback&&c.loginCallback(null,null)):console.error("invalid appContext")};c.setThemeType=function(e){var o,t,n=null;(e=e||{}).customLoginUI&&e.customLoginUI.background&&e.customLoginUI.background.active&&e.customLoginUI.background.activeColor?e.customLoginUI.background.color&&"solid"===e.customLoginUI.background.color.colorType&&(n=e.customLoginUI.background.color.solid.colorHex):e.colors&&e.colors.backgroundColor&&(n=e.colors.backgroundColor),n&&(n=n.match(/^rgb/)?(o=(n=n.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],t=n[2],n[3]):(o=(n=+("0x"+n.slice(1).replace(n.length<5&&/./g,"$&$&")))>>16,t=n>>8&255,255&n),n=Math.sqrt(o*o*.299+t*t*.587+n*n*.114),c.themeType=127.5<n?"light":"dark")},c.validateImage=function(e,o){return authAPI.validateProfileImage({file:e,type:o,stringResource:t})};var E=function(){AppearanceAPI.prototype.getAppearance(null,function(e,o){return e?console.error(e):(o&&n(o.customRegistration,null,o.colors),void(o&&c.setThemeType(o)))})};c.deleteAccountObj={value:"",disabled:!0,error:!1},c.openDeleteAccountOverlay=function(){var l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.getData().then(function(e){var o="Delete Account",t="CONFIRM",n="If you decide to use this app again, you'll need to create a new account.",r='To finish deleting your account, please type "',s='" below to proceed',i="This field is case sensitive",a=new ComponentUIAPI,i='<div class="delete-account-overlay">\n\t\t\t\t\t\t<p class="text-capitalize margin-bottom-twenty">'.concat(e.useAppAgainCreateAccount||n,'</p>\n\t\t\t\t\t\t<p class="margin-bottom-thirty">').concat(e.typeToFinishDeleting||r).concat(e.confirmDeleting||t).concat(e.belowToProceed||s,'</p>\n\t\t\t\t\t\t<div class="bodyTextTheme">\n\t\t\t\t\t\t\t\t<input type="text"\n\t\t\t\t\t\t\t\t\tclass="form-control inputApp margin-bottom-five"\n\t\t\t\t\t\t\t\t\tautocomplete="false"\n\t\t\t\t\t\t\t\t\tng-model="deleteAccountObj.value"\n\t\t\t\t\t\t\t\t\tng-change="deleteAccountValOnChange()"\n\t\t\t\t\t\t\t\t\tng-class="{ \'has-error\': deleteAccountObj.error }"\n\t\t\t\t\t\t\t\t\tonclick="window.keyboardResize()"\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="field-more-info">\n\t\t\t\t\t\t\t<p class="has-info text-muted" ng-class="{ \'has-error\': deleteAccountObj.error }">').concat(e.thisFieldIsCaseSensitive||i,'</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class="btn btn-danger" ng-click="deleteProfile({navigateHomeOnDeletion: ').concat(null==l?void 0:l.navigateHomeOnDeletion,'})" ng-disabled="deleteAccountObj.disabled" >\n\t\t\t\t\t\t\t<span data-translate="deleteAccountObj" class="whiteTheme">').concat(e.deleteAccount||o,"</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>");(c.deleteAccountObj.overlay=a).openTrustedDrawer({header:e.deleteAccount||o,content:i,onContentRender:function(){var e=angular.element(document.querySelector(".delete-account-overlay"));d(e)(c)},allowSelectAll:!1,enableFilter:!1,triggerCallbackOnUIDismiss:!0},function(e){return e?console.error(e):void c.closeDeleteAccountOverlay()})})},c.deleteAccountValOnChange=function(){t.getData().then(function(e){e.confirmDeleting||(e.confirmDeleting="CONFIRM");var o=e.confirmDeleting,e=c.deleteAccountObj.value;c.deleteAccountObj.error=e&&o!==e&&o.toUpperCase()===e.toUpperCase(),c.deleteAccountObj.disabled=!(o===e)})},c.closeDeleteAccountOverlay=function(){c.deleteAccountObj.overlay&&(c.deleteAccountObj.value="",c.deleteAccountObj.disabled=!0,c.deleteAccountObj.error=!1,c.deleteAccountObj.overlay.closeDrawer())},c.deleteProfile=function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.spinner&&window.spinner.show&&window.spinner.show(),t.getData().then(function(o){var t="Error Deleting the Account",n="An error has occurred during the delete operation. Please try again later or contact support for further assistance.",r="OK",s="Please allow 3-4 business days for your account to be fully deleted.";c.deleteAccountObj.disabled=!0,authAPI.deleteProfile(function(e){window.spinner&&window.spinner.hide&&window.spinner.hide(!0),c.closeDeleteAccountOverlay(),e?richModal.display({title:o.errorDeletingAccountTitle||t,richContent:o.errorDeletingAccountMessage||n,showDismissButton:!1,forceShow:!0,action:{title:o.errorDeletingAccountDismissBtn||r,handler:function(){}}}):(richModal.display({title:" ",richContent:o.pleaseAllowToBeFullDeleted||s,action:{title:o.errorDeletingAccountDismissBtn||r,type:"primary"},showDismissButton:!1}),window.closeSideMenu(),i.navigateHomeOnDeletion&&(u.instanceId?postMaster.launcherPluginAPI.navigation.navigateTo({instanceId:u.instanceId}):l.location.hash="/"))})})},E()}]);
"use strict";$app.controller("userProfileCtrl",["Upload","$scope","$compile","StringResource","$timeout",function(o,s,e,n,r){function i(e,r){new AnalyticsAPI(window.appContext.currentApp.appId,"user_profile","user_profile",window.appContext.liveMode).trackAction(e,r)}(window.authAPI.userProfileCtrlScope=s).user=null,s.userProfile=null,s.tempUser=null,s.tempUserProfile=null,s.editingProfile=!1,s.uploadProfileImage=null,s.uploadBackgroundImage=null,s._appRoot=window._appRoot,s.tabIndex=0,s.switchTabs=function(e){switch(e){case"info":s.tabIndex=0;break;case"badges":s.tabIndex=1}s.$broadcast("tabClicked",{tabIndex:s.tabIndex})},authAPI.getAuthSettings(null,function(e,t){return e?console.error(e):void n.getData().then(function(e){var r=void 0===t.data.enablePasswordBasedAuth||!0===t.data.enablePasswordBasedAuth;s.changePasswordShow=""!==e.changePassword&&r})});var a=window.appContext.currentApp.appId,l=new AppDatastoreAPI(a);l.search({tag:"$$badges",obj:{sort:{rank:1}}},function(e,r){return e?console.error(e):(s.badges=r,void(s.$$phase||s.$apply()))});function t(e,t){var o=e.tags?e.tags[a]:[];if(!o.length)return t([]);var n=[];s.badges.forEach(function(r){var e=o.find(function(e){return e.tagName===r.data.tag&&e.appliedCount>=r.data.tagCount});e&&(e=Math.floor(e.appliedCount/r.data.tagCount),r.data.appliedCount=e,imageTools&&(r.data.imageUrl=imageTools.cropImage(r.data.imageUrl,{size:"xxs",aspect:"1:1",compression:80,disablePixelRatio:1})),n.push(r.data))}),e={tag:"$$userDirectory",obj:{filter:{"$json.userId":{$eq:f},"_buildfire.index.string1":f}}},l.search(e,function(e,r){return!e&&r&&r.length&&r[0]&&r[0].data&&r[0].data.badges&&r[0].data.badges.forEach(function(r){var e=n.findIndex(function(e){return e.id===r.id});-1<e&&(n[e].earned=r.earned)}),t(n)})}function u(){var e;return s.user.imageUrl?s.user.imageUrl=imageTools.cropImage(s.user.imageUrl,{size:"s",aspect:"1:1"}):(e={id:1,method:"users/getUserImage",params:{userId:s.user._id,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?data="+encodeURIComponent(JSON.stringify(e)),s.user.imageUrl=e),s.user.imageUrl}var d=document.getElementsByClassName("profile-container")[0];s.getUserProfile=function(e,n){var r={id:1,method:"users/getUserProfile",params:{userId:s.user._id}},r=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(r));window.bfUtils.http.jsonp(r,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result?(e.result.email=s.user.email,s.userProfile=e.result,i("app/user_profile_view",{userId:s.user._id}),n(null,e.result)):n(null,null)}).error(function(e,r,t,o){console.error(e),n(e,null)})},s.hideDropdown=function(){s.shownDropdown=!1},s.showDropdown=function(e){e.stopPropagation(),s.shownDropdown=!s.shownDropdown},s.showChangePassword=function(){if(window.siteConfig&&"sdk"===window.siteConfig.scope)return alert("You can't change password from SDK");var o=authAPI.getCurrentUser().loginProviderType;authAPI.getAuthSettings(null,function(e,r){if(e)return console.error(e);r=r.data.signOnStrategy;if("KAuth"===o&&"SSOLogin"!==r)s.close(),window.closeSideMenu(),authAPI.authCtrlScope.showChangePassword();else{var t="your external account";switch(o){case"facebook":t="Facebook";break;case"apple":t="Apple";break;case"twitter":t="Twitter";break;case"google":t="Google"}(new ComponentUIAPI).showToastMessage({text:"You used an external registration method, change your password through ".concat(t,"."),hideDismiss:!0})}})},s.close=function(e){if(e||!s.busy){if(s.sideMenuScroll.enable(),s.showForceUpdateError=!1,s.showProfilePictureError=!1,s.tempUser=null,s.tempUserProfile=null,s.shownDropdown=!1,s.editingProfile=!1,s.uploadProfileImage=null,s.uploadBackgroundImage=null,s.busy=!1,window.spinner.hide(),e)return s.user=null,void(s.userProfile=null);d.addEventListener("animationend",U,{once:!0}),requestAnimationFrame(function(){d.classList.add("closing")})}},s.openUrl=function(e){return e&&(e.toLowerCase().indexOf("http")<0&&(e="https://"+e),window.open(e,"_blank","location=yes,enableViewportScale=yes")),!1};function c(e,n){e={id:1,method:"users/getPublicUser",params:{userId:e,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(r){t(r.result,function(e){r.result.badges=e,n(null,r)})}).error(function(e,r,t,o){console.error(e),n(e,null)})}function p(e,n){var r=window.currentAppId;!r&&window.appContext&&window.appContext.currentApp&&(r=window.appContext.currentApp.appId),r=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/getUserByAccessToken",params:{accessToken:e,externalAppId:r}})),window.bfUtils.http.jsonp(r,{bypassInterceptorForStatus:404}).success(function(r){r&&r.error?1311===r.error.code?(authAPI.getAuthSettings(null,function(e,r){e?console.error(e):r&&r.data&&r.data.sessionSettings&&(r=(e=r.data.sessionSettings.kickedOutDialogOptions||{}).content||"Please login again to continue",richModal.display({title:e.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>".concat(r,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))}),authAPI.logout()):1309===r.error.code?authAPI.logout():(console.error(r.error),n(r.error,null)):t(r.result,function(e){r.result.badges=e,n(null,r)})}).error(function(e,r,t,o){console.error(e),n(e,null)})}var f=null,m=null;s.openEditProfile=function(e){s.editingProfile=!0,s.open(e,{editMode:!0})},s.open=function(e,n){n=n||{},d.classList.contains("closing")&&U(),window.spinner.show(),f=e,m=authAPI.getCurrentUser(),s.sideMenuScroll.disable(),f||m&&m._id&&(f=m._id),f&&AppearanceAPI.prototype.getAppearance(null,function(e,t){if(e)return console.error(e),void callback(e);function o(){s.getUserProfile(null,function(e,r){n.editMode&&(s.editProfile(),s.customRegistration.checkFieldsErrors({validateFields:!0,mode:"edit",profilePicture:m.imageUrl},function(e,r){r&&r.profilePictureError&&(s.showProfilePictureError=!0),s.showForceUpdateError=!0}))})}t&&t.customRegistration&&t.customRegistration.active&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?(s.showCustomUserProfile=!0,m&&m._id==f?p(m.accessToken,function(e,r){r&&(s.user=r.result,window.spinner.hide(),m&&m._id==s.user._id&&(s.user.userToken=m.userToken),u(),g(t.customRegistration,r.result),s.customUserProfile=r.result,o())}):c(f,function(e,r){r&&(s.user=r.result,window.spinner.hide(),u(),g(t.customRegistration,r.result),s.customUserProfile=r.result,o())})):m&&m._id==f?p(m.accessToken,function(e,r){r&&(s.user=r.result,window.spinner.hide(),m&&m._id==s.user._id&&(s.user.userToken=m.userToken),u(),o())}):c(f,function(e,r){r&&(s.user=r.result,window.spinner.hide(),u(),o())})})};var g=function(e,r){customRegistration.getFields({defaults:r,isProfileMode:!0,customRegistrationSettings:e,refreshUI:function(){var e;s.customRegistrationFields&&s.customRegistrationFields.length&&((e=s.customRegistrationFields.find(function(e){return"address"===e.name}))&&e.validate(e.value)),s.$$phase||s.$apply()}},function(e,r){r&&(s.customRegistrationFields=r.fields,s.customRegistrationRules=r.rules,s.customRegistration=r,s.initCustomRegistration=function(){r.initializers.forEach(function(e){e()})},s.initCustomRegistration(),s.$$phase||s.$apply())})};s.editVisibilityOptions=function(t){customRegistration.editVisibilityOptions({field:t},function(e,r){return e?console.error(e):(t.visibilityChoice=r.text.toLowerCase(),void(s.$$phase||s.$apply()))})},authAPI.onLogout(function(){s.user&&delete s.user.userToken,s.close(!0)}),s.tempUser=null,s.tempUserProfile=null,s.busy=!1,s.cancelEdit=function(){return s.tempUser=null,s.tempUserProfile=null,s.showForceUpdateError=!1,s.showProfilePictureError=!1,s.editingProfile=null,s.uploadBackgroundImage=null,s.uploadProfileImage=null,s.showCustomUserProfile&&s.open(s.user._id),s.$$phase||s.$apply(),!1},s.showInvalidFieldsErr=function(){n.getData().then(function(e){e={richContent:'<p class="padding-top-fifteen">'.concat(e.editProfileInvalidFields||"One or more fields are invalid.","</p>"),dismissButtonText:"OK"};richModal.display(e)})};function w(r,n){var e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(angular.toJson({id:1,method:"users/update",params:r}));window.bfUtils.http.jsonp(e).success(function(e){e&&e.error?n(e.error,null):(s.tempUser.lastUpdated=(new Date).toISOString(),userTags.setRegistrationTags(r,!1,function(e,r){e&&console.log(e)}),n(null,e))}).error(function(e,r,t,o){console.error(e),s.busy=!1,window.spinner.hide(),n(e,null)}).finally()}function h(n){var e;s.customRegistration?s.customRegistration.fetch({validateFields:!0,mode:"edit",profilePicture:s.tempUser.imageUrl},function(e,o){if(e)return s.busy=!1,window.spinner.hide(),s.showInvalidFieldsErr(),void(e.profilePictureError&&(s.showProfilePictureError=!0));for(var r in o.user)o.user.hasOwnProperty(r)&&(s.tempUser[r]=o.user[r]);e=o.user;e._id=s.tempUser._id,e.userToken=s.tempUser.userToken,e.imageUrl=s.tempUser.imageUrl,e.externalAppId=window.appContext.currentApp.appId,e.checkUniqueName=!!s.customRegistrationRules&&s.customRegistrationRules.checkUniqueName,w(e,function(e,r){if(e&&1313===e.code){window.spinner.hide(),s.busy=!1;var t=(o.messages||{}).fullNameAlreadyInUse||e.message;return s.customRegistrationFields.forEach(function(e){"fullName"===e.id&&(e.error=t)}),void function(e){e={richContent:'<p class="padding-top-fifteen">'.concat(e,"</p>"),dismissButtonText:"OK"};richModal.display(e)}(t)}n(e,r)})}):((e={})._id=s.tempUser._id,e.email=s.tempUser.email,e.userToken=s.tempUser.userToken,e.firstName=s.tempUser.firstName||"",e.lastName=s.tempUser.lastName||"",e.displayName=s.tempUser.displayName||"",e.imageUrl=s.tempUser.imageUrl,e.externalAppId=window.appContext.currentApp.appId,w(e,n))}s.update=function(){s.tempUserProfile||(s.tempUserProfile={}),s.busy=!0,window.spinner.show({timeout:6e4});var t={};s.tempUser.displayName=P(s.tempUser.firstName,s.tempUser.lastName),authAPI.uploadProfileImage({file:s.uploadProfileImage,uploader:o},function(e,r){return e?console.error(e):(r&&(s.showProfilePictureError=!1,s.tempUser.imageUrl=imageTools.cropImage(r.result,{size:"s",aspect:"1:1"}),t.imageUrl=s.tempUser.imageUrl),void authAPI.uploadProfileImage({file:s.uploadBackgroundImage,uploader:o},function(e,r){return e?console.error(e):(r&&(s.tempUserProfile.backgroundImage=r.result,t.backgroundImage=s.tempUserProfile.backgroundImage),void h(function(){!function(n){var e=JSON.parse(JSON.stringify(s.tempUserProfile));(e=e||{}).userId=s.tempUser._id,e.userToken=s.tempUser.userToken,e.email=s.tempUser.email,e.firstName=s.tempUser.firstName,e.lastName=s.tempUser.lastName,e.displayName=s.tempUser.displayName;e=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/saveUserProfile",params:e}));window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){n(null,e)}).error(function(e,r,t,o){console.error(e),n(e,null)})}(function(){s.tempUser.badges=s.user.badges,s.user=s.tempUser,s.tempUser=null,s.userProfile=s.tempUserProfile,s.tempUserProfile=null,s.uploadBackgroundImage=null,s.uploadProfileImage=null,authAPI._setCurrentUser(s.user),authAPI.triggerOnUpdate(),s.showForceUpdateError=!1,s.editingProfile=!1,s.busy=!1,window.spinner.hide(),t.userId=s.user._id,i("app/user_profile_update",t)})}))}))})};var P=function(e,r){e=e?r?e+" ":e:"";return r&&(e+=r),e},U=function(){s.user=null,s.userProfile=null,r(function(){d.classList.remove("closing")})};s.validateImage=function(e,r){return authAPI.validateProfileImage({file:e,type:r,stringResource:n})},s.editProfile=function(){null!=m&&m._id&&(s.tempUser=m,s.currentUserEmail=m.email,s.tempUserProfile=s.userProfile,s.editingProfile=!0,s.busy=!1,s.customRegistrationFields&&s.customRegistrationFields.forEach(function(e){delete e.error}),s.$$phase||s.$apply())},s.deleteAccount=function(){authAPI.authCtrlScope.openDeleteAccountOverlay()},s.sideMenuScroll={enable:function(){var e=document.getElementsByClassName("menu-body-container")[0];e&&e.classList.remove("disable_overflow_scroll")},disable:function(){var e=document.getElementsByClassName("menu-body-container")[0];e&&e.classList.add("disable_overflow_scroll")}},authAPI.getCurrentUser(function(e,r){return e?console.error(e):void(r&&setTimeout(function(){authAPI.checkForceUpdate({user:r})},5e3))})}]),$app.filter("cropCoverImage",function(){return function(e){if(!e)return"";if(!imageTools||!/(https|http):\/\//g.test(e))return e;var r="full_width";return-1<window.location.href.indexOf("pluginTester")&&(r="xl"),imageTools.cropImage(e,{size:r,aspect:"16:9",compression:80})}});
"use strict";$app.controller("notesCtrl",["$scope","$rootScope","$sce",function(s,t,e){s.notes=[],s.notesShown=!1,s.pluginOpen=!1,s.settings={includeTime:!0},s.tempNoteText="",s.instanceId=!1,(window.notesAPI.notesCtrlScope=s).close=function(){var t,e;s.notesShown=!1,s.callback&&(t={},s.tempNoteData.itemId&&(t.itemId=s.tempNoteData.itemId),e=window.notesAPI.formatNotes(s.notes),t.hasNotes=s.notes&&0<s.notes.length,t.noteCount=s.notes?s.notes.length:0,t.notes=e,s.callback(null,t)),s.$$phase||s.$apply()},s.getAllNotes=function(){window.spinner.show(),window.notesAPI.getAll(function(t,i){if(t)throw t;i.length?(t=i.map(function(t){return t.instanceId}),postMaster.controlPluginAPI.appAPI.getPluginInstancesByIds(t,function(t,e){if(t)throw t;var n=e.data,o=[];i.forEach(function(e){var t=n.find(function(t){return t.data.instanceId===e.instanceId});t&&(e.pluginId=t.data._buildfire.pluginType.result[0].token,e.folderName=t.data._buildfire.pluginType.result[0].folderName,e.title=t.data.title,e.iconUrl=t.data.iconUrl,e.show=!0,o.push(e))}),s.notes=o,window.spinner.hide(),s.$$phase||s.$apply()})):(s.notes=[],window.spinner.hide(),s.$$phase||s.$apply())})},s.getItemNotes=function(){window.spinner.show(),window.notesAPI.getAllFromItem(s.tempNoteData.itemId,function(t,e){if(t)throw t;s.notes=e,s.notesCopy=JSON.parse(JSON.stringify(e)),window.spinner.hide(),s.$$phase||s.$apply()})},s.deleteNote=function(e,n,o){var t,i;window.notesAPI.delete(e,n,o,function(){}),s.pluginOpen?s.notes=s.notes.filter(function(t){return t.id!=e}):(t=s.notes.findIndex(function(t){return t.instanceId===o}),i=s.notes[t].content.findIndex(function(t){return t.itemId===n}),s.notes[t].content[i].notes=s.notes[t].content[i].notes.filter(function(t){return t.id!=e}),0===s.notes[t].content[i].notes.length&&(s.notes[t].content.splice(i,1),0===s.notes[t].content.length&&s.notes.splice(t,1))),s.$$phase||s.$apply()},s.addNote=function(){var t=s.settings.includeTime&&s.tempNoteData.timeIndex||!1,t={itemId:s.tempNoteData.itemId,imageUrl:s.tempNoteData.imageUrl,title:s.tempNoteData.title,timeIndex:t,instanceId:s.instanceId};window.notesAPI.add(t,function(t){})},s.getItemTitle=function(t){if(!t)return"";t=t.title||"";return e.trustAsHtml(t)},s.editNote=function(t,e,n){window.notesAPI.edit(t,e,n,function(){s.fetchNotes()})},s.openItem=function(t,e,n){window.notesAPI.loadNote(t,e,n,function(){return s.close()})},s.toggle=function(t){s.notes[t].show=!s.notes[t].show,s.$$phase||s.$apply()},s.fetchNotes=function(){s.notesShown&&(s.pluginOpen?s.getItemNotes():s.getAllNotes())},s.seekTo=function(t,e,n){window.notesAPI.seekTo(t,e,n,function(){return s.close()})},s.$watch("notesShown",function(){s.notes=[],s.fetchNotes()},!0),s.$watch("notes",function(){s.pluginOpen&&10<s.notes.length&&s.resetPosition()},!0),s.notes_empty=window._appRoot+"media/ic_bookmark_empty.svg",s.resetPosition=function(){document.getElementsByClassName("notes-in-plugin")[0].classList.replace("pos-static","pos-fixed"),setTimeout(function(){document.getElementsByClassName("notes-in-plugin")[0].classList.replace("pos-fixed","pos-static")},100)}}]).filter("cropImg",function(){return function(t){return t?imageTools.cropImage(t,{size:"xs",aspect:"1:1"}):window._appRoot+"media/ic_no_img.png"}}).filter("timeFormat",function(){return function(t){var e=new Date(0,0,0,0,0,0,0);return e.setSeconds(t),e}});
"use strict";$app.factory("StringResource",["$q",function(t){var e=new DatastoreAPI(appContext.currentApp.appId,"stringResources",1,0,appContext.currentApp.keys.datastoreKey),r=n();function n(){var r=t.defer();return e.get({},function(t,e){t||!e?r.reject(t):r.resolve(e.data)}),r.promise}return{getData:function(t){return r=t?n():r}}}]);
"use strict";var authAPI={authCtrlScope:null,userProfileCtrlScope:null,init:function(e){this.context=e},refreshAndTriggerUpdate:function(n){n=n||{};var e=authAPI.getCurrentUser();e&&authAPI.getUserByAccessToken({accessToken:e.accessToken},function(e,t){t&&(authAPI._setCurrentUser(t),authAPI.triggerOnUpdate(t,n.updateType,n.isProfileTagUpdate))})},initRefresh:function(){function e(){var o=authAPI.getCurrentUser();o&&authAPI.getUserByAccessToken({accessToken:o.accessToken},function(e,t){var n,s;t&&(n={isActive:o.isActive,appTags:o.tags?o.tags[window.currentAppId]:null},s={isActive:t.isActive,appTags:t.tags?t.tags[window.currentAppId]:null},authAPI._setCurrentUser(t),JSON.stringify(n)!==JSON.stringify(s)&&(console.log("user update found during sync"),authAPI.triggerOnUpdate(t)))})}bfUtils.isApp&&(setTimeout(e,3e3),setInterval(e,3e5)),authAPI.session.init()},getUserByAccessToken:function(e,o){e={id:1,method:"users/getUserByAccessToken",params:{accessToken:e.accessToken,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){e?e.error?1311===e.error.code?(authAPI.getAuthSettings(null,function(e,t){e?console.error(e):t&&t.data&&t.data.sessionSettings&&(t=(e=t.data.sessionSettings.kickedOutDialogOptions||{}).content||"Please login again to continue",richModal.display({title:e.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>".concat(t,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))}),authAPI.logout(),o(null,null)):1309===e.error.code?authAPI.logout():(console.error(e.error),o(e.error,null)):o(null,e.result):o(null,null)}).error(function(e,t,n,s){console.error(e),o(e,null)})},login:function(e,n){var t=this.getCurrentUser();t?(n&&n(null,t),authAPI.triggerOnLogin(t)):(t=function(){authAPI.authCtrlScope.loginOptions=e,authAPI.authCtrlScope.showLogin(function(e,t){!e&&t&&(authAPI._setCurrentUser(t),authAPI.session.start(),authAPI.triggerOnLogin(t),authAPI._checkGDPR(t),authAPI.checkForceUpdate({user:t}),authAPI.authCtrlScope.hideLogin(),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply()),n&&n(e,t)}),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply()},authAPI.authCtrlScope?t():setTimeout(t,250))},_setCurrentUser:function(e){window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(e?localStorage.setItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER",JSON.stringify(e)):localStorage.removeItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"))},secondaryUserLookup:function(){return null},getCurrentUser:function(e,t){"function"==typeof e&&(t=e);e=this.secondaryUserLookup();if(e||window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(e=localStorage.getItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"),e=JSON.parse(e)),e&&e.userToken||(e=null),!t)return e;t(null,e)},_checkGDPR:function(t){t&&termsAPI.getKeys(function(e,n){if(e)return console.error(e);e=siteConfig.endPoints.crmHost+"/documents/"+n.join(",")+"/check?userKey="+encodeURIComponent(t.email||t.username);(bfUtils.isAppHtml5Version||bfUtils.isMobileDevice||bfUtils.isPwaAndroid||bfUtils.isHtml5iOS)&&window.appContext&&1==window.appContext.liveMode&&bfUtils.http.get(e).success(function(e){if(e)for(var t=0;t<n.length;t++)if(e[n[t]]&&!e[n[t]].isAccepted){window.location.hash="gdpr";break}}).error(function(e){console.error(e)})})},logout:function(){this._setCurrentUser(null),window.localStorage.removeItem("SSO_USER"),authAPI.session.end(),authAPI.triggerOnLogout(null),authAPI.authCtrlScope&&authAPI.authCtrlScope.changePasswordShown&&authAPI.authCtrlScope.hideLogin()},trackRegister:function(e){var t;window.appContext&&window.appContext.liveMode&&((t=new AnalyticsAPI(authAPI.context)).setUserProperties({email:e.email,username:e.username,firstName:e.firstName,lastName:e.lastName}),t.trackAction("app/userRegistered"),(t=localStorage.getItem("HISTORY_USERS"))?(t=JSON.parse(t)).length&&-1==t.indexOf(e._id)&&(t.push(e._id),localStorage.setItem("HISTORY_USERS",JSON.stringify(t))):localStorage.setItem("HISTORY_USERS",JSON.stringify([e._id])))},onLogin:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGIN",e,!1)},onLogout:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGOUT",e,!1)},onUpdate:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_UPDATE",e,!1)},triggerOnUpdate:function(e,t,n){e=e||authAPI.getCurrentUser();n=new CustomEvent("AUTH_CURRENT_USER_ON_UPDATE",{detail:{user:e,updateType:t,isProfileTagUpdate:n}});document.dispatchEvent(n)},triggerOnLogin:function(e){e=new CustomEvent("AUTH_CURRENT_USER_ON_LOGIN",{detail:e});document.dispatchEvent(e)},triggerOnLogout:function(){var e=new CustomEvent("AUTH_CURRENT_USER_ON_LOGOUT",{detail:null});document.dispatchEvent(e)},openProfile:function(e,t){if(t=t||{},e)return n(e);e=this.getCurrentUser();if(e&&e._id)return n(e._id);function n(e){t.editingMode?authAPI.userProfileCtrlScope.openEditProfile(e):authAPI.userProfileCtrlScope.open(e)}this.login({},function(e,t){!e&&t&&t._id&&n(t._id)})},getUserProfile:function(t,o){if(!t||!t.userId)throw new Error("userId have not been provided to getUserInfo");var n=null,e={id:1,method:"users/getPublicUser",params:{userId:t.userId,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?(n=e.result,e={id:1,method:"users/getUserProfile",params:{userId:t.userId}},e=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?(n=angular.extend({},e.result,n),o(null,n||null)):o(null,n))}).error(function(e,t,n,s){o&&o(e,null)})):o(null,null))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})},getUserProfiles:function(e,o){if(!e||!e.userIds)throw new Error("userIds have not been provided to getUsersInfo");if(!Array.isArray(e.userIds))throw new Error("userIds param must be of type Array");if(!e.userIds.length)throw new Error("userIds param must contain at least one id");if(50<e.userIds.length)throw new Error("userIds param must not exceed 50 id");e={id:1,method:"users/getPublicUsers",params:{userIds:e.userIds,externalAppId:window.appContext.currentApp.appId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?o(null,e.result):o(null,null))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})},getUsersByEmail:function(n,o){if(!n||!n.emails)throw new Error("No emails have not been provided to getUserByEmail");function t(t){var e={id:1,method:"users/getUsersProfilesByEmail",params:{emails:n.emails}},e=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?function(e,t){for(var n=0;n<e.length;n++)for(var s=0;s<t.length;s++)e[n].email==t[s].email&&(e[n].phone=t[s].phone);o(null,e)}(t,e.result):o(null,t))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})}var e={id:1,method:"users/getUsersByEmail",params:{emails:n.emails,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?t(e.result):o(null,null))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})},getUserPictureUrl:function(e){var t=null,n=null;if((e=e||{}).userId&&(t="userId",n=e.userId),e.email&&(t="email",n=e.email),e.username&&(t="username",n=e.username),!t||!n)throw Error("Invalid user picture params");return n=encodeURIComponent(n),window.siteConfig.endPoints.authHost+"/src/server.js/user/picture?"+t+"="+n+"&externalAppId="+encodeURIComponent(window.currentAppId)},getAuthSettings:function(e,n){var t;window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.keys&&window.appContext.currentApp.appId?authAPI.authSettings?n(null,{data:authAPI.authSettings}):(t={appId:window.appContext.currentApp.appId,pluginId:"authSettings",instanceId:"authSettings",liveMode:window.appContext.liveMode,writeKey:window.appContext.currentApp.keys.datastoreKey},new DatastoreAPI(t).get({tag:"authSettings"},function(e,t){t&&t.data&&(authAPI.authSettings=t.data),n(e,t)})):n("missing currentApp parameters")},keepSessionAlive:function(e,t){e=new CustomEvent("sessionActivity",{detail:{data:e}});document.dispatchEvent(e),t(null,!0)},fakeTimeOutDialog:function(e){var t=document.getElementById("alertDialog"),n=0;richModal.isVisible()&&!t&&(n=1e3,richModal.clearAll()),t?(document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.continueBtn):(richModal.display({title:e.title||"Your session is about to expire",richContent:"<p id='alertDialog' style='font-size:50px; text-align:center' class='dangerTheme'>00:10</p>",showDismissButton:!1,forceShow:!0,action:{title:e.continueBtn||"CONTINUE",handler:function(){}}}),setTimeout(function(){var t=10,n=setInterval(function(){var e;document.getElementById("alertDialog")?(e=10<t--?t:"0".concat(t),document.getElementById("alertDialog").innerText="00:".concat(e),t<=0&&clearInterval(n)):clearInterval(n)},1e3)},n))},fakeExpiredDialog:function(e){var t=document.getElementById("expiredDialog");richModal.isVisible()&&!t&&richModal.clearAll(),t?(document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.dismissBtn,t.innerText=e.content):(t=e.content||"Please login again to continue",richModal.display({title:e.title||"Your session is expired due to inactivity",richContent:"<p id=\"expiredDialog\" style='font-size:2rem'>".concat(t,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))},fakeKickedOutDialog:function(e){var t=document.getElementById("kickedOutDialog");richModal.isVisible()&&!t&&richModal.clearAll(),t?(document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.dismissBtn,t.innerText=e.content):(t=e.content||"Please login again to continue",richModal.display({title:e.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>".concat(t,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))},session:{sessionExpires:!1,idleTimeSeconds:null,lastIdleTimeUpdateOn:null,stopWatchInterval:null,updateIdleTimeInterval:null,init:function(){authAPI.getAuthSettings(null,function(e,t){var n,s;function o(){s||(s=!0,setTimeout(function(){s=!1},1e3),setTimeout(n))}!e&&t&&!bfUtils.isEmulatorCP&&bfUtils.isApp&&t.data&&t.data.sessionSettings&&(t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive||t.data.sessionSettings.expireWhenAppClose)&&(authAPI.getCurrentUser()&&authAPI.logout(),authAPI.session.sessionExpires=t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive,n=function(){null===authAPI.session.stopWatchInterval&&authAPI.session._resetIdleTime()},document.addEventListener("sessionActivity",n,!1),s=!1,document.addEventListener("click",o),document.addEventListener("touchstart",o))})},start:function(){authAPI.getAuthSettings(null,function(e,t){var n,s,o,i,r,a;e?console.error(e):!bfUtils.isEmulatorCP&&bfUtils.isApp&&t&&t.data&&t.data.sessionSettings&&t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive&&(n=60*t.data.sessionSettings.expireWhenIdleFor.timeInMinutes,s=t.data.sessionSettings.expireWhenIdleFor.showTimeoutDialog,o=t.data.sessionSettings.expireWhenIdleFor.alertDialogOptions||{},i=t.data.sessionSettings.expireWhenIdleFor.expiredDialogOptions||{},r=!1,authAPI.session.lastIdleTimeUpdateOn=new Date,authAPI.session.idleTimeSeconds=0,a=function(){var e=i.content||"Please login again to continue";richModal.display({title:i.title||"Your session is expired due to inactivity",richContent:"<p style='font-size:2rem'>".concat(e,"</p>"),showDismissButton:!1,action:{title:i.dismissBtn||"OK",handler:function(){}}})},authAPI.session.updateIdleTimeInterval=setInterval(function(){var e,t=new Date;authAPI.session.idleTimeSeconds+=(t.getTime()-authAPI.session.lastIdleTimeUpdateOn.getTime())/1e3,authAPI.session.lastIdleTimeUpdateOn=t,authAPI.session.idleTimeSeconds>5+n&&(console.error("abnormally forced logout"),authAPI.session._clean(),authAPI.logout()),s&&!r&&authAPI.session.idleTimeSeconds>n-60?(r=!0,e=0,richModal.isVisible()&&(e=1e3,richModal.clearAll()),richModal.display({title:o.title||"Your session is about to expire",richContent:"<p id='logout-timer' style='font-size:50px; text-align:center' class='dangerTheme'>01:00</p>",showDismissButton:!1,action:{title:o.continueBtn||"CONTINUE",handler:function(){r=!1,authAPI.session._resetIdleTime(),console.log("login session extended - continue")}}}),setTimeout(function(){var n=(new Date).getTime()/1e3+60;authAPI.session.stopWatchInterval=setInterval(function(){var e,t;document.getElementById("logout-timer")?(t=9<(e=Math.round(n-(new Date).getTime()/1e3))?e:"0".concat(e),document.getElementById("logout-timer").innerText="00:".concat(t),e<=0&&(r=!1,authAPI.session._clean(),richModal.close(),setTimeout(function(){a(),authAPI.logout()},1e3),console.log("login session terminated - continue"))):(r=!1,authAPI.session._resetIdleTime(),console.log("login session extended - closed"))},1e3)},e)):!s&&authAPI.session.idleTimeSeconds>n&&(a(),console.log("login session terminated without warning"),authAPI.session._clean(),authAPI.logout())},3e3))})},end:function(){authAPI.session._clean()},_clean:function(){authAPI.session.stopWatchInterval&&(clearInterval(authAPI.session.stopWatchInterval),authAPI.session.stopWatchInterval=null),authAPI.session.updateIdleTimeInterval&&(clearInterval(authAPI.session.updateIdleTimeInterval),authAPI.session.updateIdleTimeInterval=null),authAPI.session.idleTimeSeconds=0},_resetIdleTime:function(){authAPI.session.idleTimeSeconds=0,authAPI.session.stopWatchInterval&&(clearInterval(authAPI.session.stopWatchInterval),authAPI.session.stopWatchInterval=null)}},changePassword:function(e,o){var t={},n=authAPI.getCurrentUser();if(!(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&n))return console.error("Error",{code:"MissedData",message:"Missed context's data"}),o({code:"MissedData",message:"Missed context's data"},null);t={appId:window.appContext.currentApp.appId,accessToken:n.accessToken,currentPassword:e.oldPassword,newPassword:e.newPassword,passwordStrength:e.passwordStrength},window.bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/auth/user/changePassword",t,{headers:{"Content-Type":"application/json"}}).success(function(e){n.accessToken=e.accessToken,authAPI._setCurrentUser(n),o(null,null)}).error(function(e,t,n,s){o(e,null),console.error("Error",e,t)})},validateProfileImage:function(e){var t=e.file,n=e.type;if(!t)return!1;if(t.type&&["image/jpeg","image/png","image/jpg"].indexOf(t.type)<0)return e.stringResource.getData().then(function(e){e={forceShow:!0,richContent:'<p class="padding-top-fifteen">'.concat(e["coverPhoto"===n?"coverImageTypeInvalid":"profileImageTypeInvalid"]||("coverPhoto"===n?"Cover":"Profile")+" photo does not support this file type.","</p>"),dismissButtonText:"OK"};richModal.display(e)}),!1;return!(t.size&&1e7<t.size)||(e.stringResource.getData().then(function(e){e={forceShow:!0,richContent:'<p class="padding-top-fifteen">'.concat(e["coverPhoto"===n?"coverPhotoLess10mb":"profilePhotoLess10mb"]||("coverPhoto"===n?"Cover":"Profile")+" photo must be less than 10mb.","</p>"),dismissButtonText:"OK"};richModal.display(e)}),!1)},uploadProfileImage:function(e,o){var t,n=authAPI.getCurrentUser();n?(t=window.siteConfig.endPoints.authHost+"/src/server.js?method=users/uploadImage",e.file?e.uploader.upload({url:t,data:{file:e.file,userToken:n.userToken,externalAppId:window.currentAppId}}).progress(function(e){e=parseInt(100*e.loaded/e.total);console.log("progress: "+e+"%")}).success(function(e,t,n,s){console.log("file "+s.data.file.name+" uploaded."),o&&o(null,e)}).error(function(e){o&&o(e,null)}):o&&o(null,null)):o&&o("Invalid user",null)},checkForceUpdate:function(n,e){var s;!bfUtils.isEmulatorCP&&bfUtils.isApp&&(s=!1,AppearanceAPI.prototype.getAppearance(null,function(e,t){return e?console.error(e):void(t&&t.customRegistration&&t.customRegistration.active&&t.customRegistration.singlePage&&t.customRegistration.singlePage.formControls&&(t.customRegistration.singlePage.formControls.forEach(function(t){var e;if(t.active&&t.settings.required&&"registrationOnly"!==t.settings.displayOn&&!1!==t.settings.allowEditingInProfile)if("custom"!==t.type)switch(t.id){case"fullName":(t.settings.displayNameEnabled&&!n.user.displayName||t.settings.firstNameEnabled&&!n.user.firstName||t.settings.lastNameEnabled&&!n.user.lastName)&&(s=!0);break;case"address":(!t.settings.showFullAddress||n.user.userProfile&&n.user.userProfile.address&&n.user.userProfile.address.fullAddress)&&(!t.settings.showFullAddress||!t.settings.showAptNo||n.user.userProfile&&n.user.userProfile.address&&n.user.userProfile.address.customFields&&n.user.userProfile.address.customFields.aptNo)&&(!t.settings.showZipCode||n.user.userProfile&&n.user.userProfile.address&&n.user.userProfile.address.customFields&&n.user.userProfile.address.customFields.zipCode)||(s=!0);break;case"bio":n.user.userProfile&&n.user.userProfile.bio||(s=!0);break;case"telephone":n.user.userProfile&&n.user.userProfile.tel||(s=!0);break;case"birthDate":n.user.userProfile&&n.user.userProfile.birthDate||(s=!0);break;case"profilePicture":n.user.imageUrl||(s=!0)}else"custom"===t.type&&(n.user.userProfile&&n.user.userProfile.customTypeFields&&((e=n.user.userProfile.customTypeFields.find(function(e){return e.id===t.id}))&&e.value||e&&e.values&&0<e.values.length)||(s=!0))}),s&&(t=n.user?n.user._id:null,authAPI.openProfile(t,{editingMode:!0}))))}))},searchUsers:function(e,o){e=e||{};var t=authAPI.getCurrentUser();t&&t.accessToken?(t={externalAppId:window.currentAppId,accessToken:t.accessToken},e.searchText&&(t.searchText=e.searchText),e.sort&&(t.sort=e.sort),e.limit&&(t.limit=e.limit),e.skip&&(t.skip=e.skip),e.page&&(t.page=e.page),e.pageSize&&(t.pageSize=e.pageSize),t=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/searchUsers",params:t})),window.bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result?o(null,e.result):o(null,null)}).error(function(e,t,n,s){console.error(e),o(e,null)})):o(new Error("Login is required"),null)},deleteProfile:function(n){var e=authAPI.getCurrentUser();if(!(e&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId))return console.error("Error",{code:"MissedData",message:"Missed context's data"}),n({code:"MissedData",message:"Missed context's data"},null);e={appId:window.appContext.currentApp.appId,accessToken:e.accessToken};window.bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/auth/user/deleteProfile",e,{headers:{"Content-Type":"application/json"}}).success(function(){authAPI.logout(),n(null,null)}).error(function(e,t){n(e,null),console.error("Error deleting profile",e,t)})}};authAPI.initRefresh();
"use strict";var termsAPI={termsConditionsKey:"bf_terms_and_conditions",privacyPolicyKey:"bf_privacy_policy",getKeys:function(e){var i=[],o=this;authAPI.getAuthSettings(null,function(t,n){return t?e(t,null):void(n&&n.data&&n.data.termsConditionsAndPrivacyPolicy&&n.data.termsConditionsAndPrivacyPolicy.custom&&n.data.termsConditionsAndPrivacyPolicy.custom.active?(t=n.data.termsConditionsAndPrivacyPolicy.custom,i=o._checkKeys(t),e(null,i)):n&&n.data&&!n.data.termsConditionsAndPrivacyPolicy&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?AppearanceAPI.prototype.getAppearance(null,function(t,n){return t?e(t,null):(i=n&&n.customRegistration&&n.customRegistration.singlePage&&n.customRegistration.active?(n=n.customRegistration.singlePage.formControls.find(function(t){return t&&"termsConditionsAndPrivacyPolicy"===t.id}),o._checkKeys(n)):[o.termsConditionsKey,o.privacyPolicyKey],void e(null,i))}):(i=[o.termsConditionsKey,o.privacyPolicyKey],e(null,i)))})},_checkKeys:function(t){var n=[];return t&&t.settings&&t.active&&t.settings.termsAndConditionsDocumentKey?n.push(t.settings.termsAndConditionsDocumentKey):n.push(this.termsConditionsKey),t&&t.settings&&t.active&&t.settings.privacyPolicyDocumentKey?n.push(t.settings.privacyPolicyDocumentKey):n.push(this.privacyPolicyKey),n},getGdprLinks:function(i,o){var s,r=this,c=[],a=null,p=null,u={id:"termsAndConditions",isCustom:!1,preLinkText:"I accept the",linkText:"Terms of use",validate:function(t){this.error=null,t||(this.error="You have to agree to the terms/policies")},open:function(){var t=r.termsConditionsKey;i.openGDPRContent({key:t})}},d={id:"privacyPolicy",isCustom:!1,preLinkText:"I accept the",linkText:"Privacy policy",validate:function(t){this.error=null,t||(this.error="You have to agree to the terms/policies")},open:function(){var t=r.privacyPolicyKey;i.openGDPRContent({key:t})}},l={id:"appTerms",isCustom:!1,preLinkText:"I accept the",linkText:"App terms",validate:function(t){this.error=null,t||(this.error="You have to agree to the terms/policies")},open:function(){window.open(appContext.currentApp.config.TermsOfUse,"_system")}},y=!!(appContext&&appContext.currentApp&&appContext.currentApp.config&&appContext.currentApp.config.TermsOfUse)&&(appContext.currentApp.config.TermsOfUse.indexOf("appdocumentation.com")<0&&appContext.currentApp.config.TermsOfUse.indexOf("buildfire.com")<0);authAPI.getAuthSettings(null,function(t,n){return t?o(t,null):void(n&&n.data&&n.data.termsConditionsAndPrivacyPolicy&&n.data.termsConditionsAndPrivacyPolicy.custom&&n.data.termsConditionsAndPrivacyPolicy.custom.active?e(s=n&&n.data&&n.data.termsConditionsAndPrivacyPolicy.custom):n&&n.data&&!n.data.termsConditionsAndPrivacyPolicy&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?AppearanceAPI.prototype.getAppearance(null,function(t,n){return t?o(t,null):void e(s=n&&n.customRegistration&&n.customRegistration.singlePage&&n.customRegistration.active?n.customRegistration.singlePage.formControls.find(function(t){return t&&"termsConditionsAndPrivacyPolicy"===t.id}):s)}):e());function e(n){n&&n.options&&n.active?(a=n.settings&&n.settings.termsAndConditionsDocumentKey,c.push({id:"customTermsAndConditions",name:"termsAndConditions",isCustom:!0,preLinkText:n.options.fieldsLabels.iAccept,linkText:n.options.fieldsLabels.termsAndConditions,validate:function(t){this.error=null,t||(this.error=n.options.errorMessages.termsAndConditionsAcceptRequired)},open:function(){var t=a||r.termsConditionsKey;i.openGDPRContent({key:t})}}),p=n.settings&&n.settings.privacyPolicyDocumentKey,c.push({id:"customPrivacyPolicy",name:"privacyPolicy",isCustom:!0,preLinkText:n.options.fieldsLabels.iAccept,linkText:n.options.fieldsLabels.privacyPolicy,validate:function(t){this.error=null,t||(this.error=n.options.errorMessages.termsAndConditionsAcceptRequired)},open:function(){var t=p||r.privacyPolicyKey;i.openGDPRContent({key:t})}})):(c.push(u),c.push(d)),y&&c.push(l),o(null,{gdprLinks:c,customTermsAndConditions:{key:a},customPrivacyPolicy:{key:p}})}})}};
"use strict";$app.controller("modalCtrl",["$scope","$dialog","$data",function(l,o,e){l.modal={},l.modal.body=e.body,l.modal.title=e.title||"Confirm",l.modal.okText=e.okText||"OK",l.modal.cancelText=e.cancelText||"Cancel",l.modal.disableCancel=e.disableCancel||!1,l.close=function(){o.close(!1)},l.confirm=function(){o.close(!0)}}]);
"use strict";function _typeof(n){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}setTimeout(function(){if(sessionStorage.getItem("notification"))try{var n=JSON.parse(sessionStorage.getItem("notification"));LocalNotificationsAPI.navToPlugin(n)}finally{sessionStorage.removeItem("notification")}},2e3);var LocalNotificationsAPI=function(){var o={},a="Cordova notification plugin not installed";function e(n){var t=this;this.context=n,this.localNotificationChannel=null,"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging&&bfUtils.isAndroid&&7<device.version&&cordova.plugins.firebase.messaging.listChannels().then(function(n){n=(n=n.find(function(n){return"local-notifications"===n.id}))||cordova.plugins.firebase.messaging.createChannel({id:"local-notifications",name:"Local Notifications",importance:5}).then(console.log).catch(console.warn);t.localNotificationChannel=n}).catch(console.warn)}function c(n){return o.hasOwnProperty(n)}function l(n){c(n)&&(clearTimeout(o[n]),delete o[n])}function i(){return"undefined"!=typeof cordova}return e.prototype={schedule:function(n,t){var a=Math.floor(1e9*Math.random()),i=new Date;e.isPluginAvailable()?(n.badge=0,n.at?n.at=Date.parse(n.at):n.at=new Date(i.getTime()+1e3),n.id=a,n.data={actionItem:n.actionItem,pluginData:n.data,returnInstanceId:n.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId,pluginId:this.context.pluginId,analyticsData:n.analyticsData},this.localNotificationChannel&&this.localNotificationChannel.id&&(n.channel=this.localNotificationChannel.id),cordova.plugins.notification.local.schedule(n),t(null,{id:n.id})):(i=Math.abs(Date.parse(n.at)-Date.now()))<-2e3||(n.data={actionItem:n.actionItem,pluginData:n.data,returnInstanceId:n.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId,pluginId:this.context.pluginId,analyticsData:n.analyticsData},i=setTimeout(function(){c(a)&&(e.notificationModal(n),l(a))},i),o[a]=i,t(null,{id:a}))},cancel:function(n,t){e.isPluginAvailable()?(cordova.plugins.notification.local.cancel(n),t(null,{id:n})):i()?t(new Error(a),null):(l(n),t(null,{id:n}))},checkPermission:function(n,t){if(i())return e.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(n){t&&t(null,n)}):(t&&t(new Error(a),!1),void console.warn(a));t&&t(null,!0)},requestPermission:function(n,t){if(i())return e.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(n){n?t&&t(null,!0):cordova.plugins.notification.local.registerPermission(function(n){n?t&&t(null,!0):(console.warn("Permission not granted for local notifications"),t&&t(null,!1))})}):(t&&t(new Error(a),!1),void console.warn(a));t&&t(null,!0)}},e.isPluginAvailable=function(){var n=!0;return n=!("undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.notification&&cordova.plugins.notification.local)?!1:n},e.getPlatform=function(){return device.platform?device.platform.toLowerCase():""},e.notificationModal=function(t){var n;t&&(t.title||t.text)&&(n={data:{title:t.title,body:t.text}},window.openDialog(n,function(n){n&&e.navToPlugin(t)}))},e.navToPlugin=function(c){var n=postMaster.launcherPluginAPI?0:1500;setTimeout(function(){postMaster.launcherPluginAPI&&function(){var n=2e3,t=0,a=1,i=2,o=i;"object"!==_typeof(c.data)&&(c.data=JSON.parse(c.data)),c.data.actionItem&&ActionItemsAPI.prototype.execute(c.data.actionItem,function(){});var e=c.data.returnInstanceId?c.data.returnInstanceId.toLowerCase():"";"home"!==e&&"none"!==e?(postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.context&&postMaster.launcherPluginAPI.context.instanceId===e?(o=a,n=500,postMaster.launcherPluginAPI.navigation.navigateHome()):(o=i,postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.context&&postMaster.widgetPluginAPI.context.instanceId===c.data.returnInstanceId?n=500:postMaster.launcherPluginAPI.navigation.navigateToPluginInstance({instanceId:c.data.returnInstanceId})),setTimeout(function(){var n=new Packet(null,"notifications.localNotification.onClick",c.data.pluginData);(o===a?postMaster.launcherPluginAPI:postMaster.widgetPluginAPI).sendMessage(null,n)},n)):o=t}()},n)},e.sendAnalytics=function(n){n&&n.data&&("object"!==_typeof(n.data)&&(n.data=JSON.parse(n.data)),n.data&&n.data.analyticsData&&n.data.analyticsData.eventName&&new AnalyticsAPI(window.appContext.currentApp.appId,n.data.pluginId,n.data.launchInstanceId,window.appContext.liveMode).trackAction(n.data.analyticsData.eventName,n.data.analyticsData.metaData))},e.onTrigger=function(n){console.log("*** notification trigger ***"),LocalNotificationsAPI.sendAnalytics(n),"ios"==LocalNotificationsAPI.getPlatform()&&LocalNotificationsAPI.notificationModal(n)},e.onClick=function(n){console.log("*** notification click ***"),LocalNotificationsAPI.sendAnalytics(n),LocalNotificationsAPI.navToPlugin(n)},e}();bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){LocalNotificationsAPI.isPluginAvailable()&&(cordova.plugins.notification.local.on("trigger",LocalNotificationsAPI.onTrigger),cordova.plugins.notification.local.on("click",LocalNotificationsAPI.onClick))});
"use strict";function LocalStorageAPI(e){this.instanceId=e.instanceId,this.collectionKey=siteConfig.scope+"-"+this.instanceId+"-storage";e=localStorage.getItem(this.collectionKey);if(e)try{this.collection=JSON.parse(e)}catch(e){console.error(e),this.collection={}}else this.collection={}}LocalStorageAPI.prototype={setItem:function(e,t){if(e&&e.key&&e.value)if(void 0===e.value)delete this.collection[e.key];else try{var o=JSON.parse(JSON.stringify(this.collection));if(o[e.key]=e.value,(o=JSON.stringify(o))&&2048<o.length){var l="localStorage for a plugin instance may not exceed 2048 characters. consider using other buildfire storage options";return console.error(l),void t(new Error(l))}this.collection[e.key]=e.value,localStorage.setItem(this.collectionKey,JSON.stringify(this.collection)),t(null,!0)}catch(e){console.error(e),t(e,null)}else t(new Error("invalid parameters. Expected Key/Value object"))},getItem:function(e,t){(e=e&&e.key?e.key:e)&&t?t(null,void 0===(e=this.collection[e])?null:e):t(new Error("invalid parameters. Expected Key and Callback"))},removeItem:function(e,t){(e=e&&e.key?e.key:e)&&t?(delete this.collection[e],localStorage.setItem(this.collectionKey,JSON.stringify(this.collection)),t(null,!0)):t(new Error("invalid parameters. Expected Key and Callback"))},clear:function(e,t){localStorage.removeItem(this.collectionKey),t(null,!0)},getCollection:function(e,t){t(null,this.collection)}};
"use strict";var validator={validatePassword:function(t,a){if(a&&a.simplePasswordValidation)return t&&6<=t.length&&t.length<=60;if(!t||t.length<8||60<t.length)return!1;var e=/[A-Z]/.test(t),r=/[a-z]/.test(t),a=/\d/.test(t),t=/\W/.test(t);return e&&r&&a&&t},validateEmail:function(t){return!!t&&/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,24}$/.test(t)},passwordPattern:{test:function(t){return validator.validatePassword(t)}}};
"use strict";function PushNotificationsAPI(t){this.context=t}PushNotificationsAPI.prototype={schedule:function(t,o){var i;t&&t.text&&t.title?this.context&&this.context.instanceId?(t.groupName||(t.groupName=""),!(i={groupID:PushNotificationsAPI._getGroupID(this.context,t.groupName),users:t.users,userTags:t.userTags,title:t.title,message:t.text,sendAfter:t.at,source:"plugin",richMessage:t.inAppMessage||void 0,deviceIdCreatedBy:"undefined"!=typeof push&&push.deviceId?push.deviceId:null,sendToSelf:!0})===t.sendToSelf&&(i.sendToSelf=!1),i.sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+i.source,!1!==t.actionItem&&(t.actionItem?i.actionItem=t.actionItem:i.actionItem={title:"View",action:"linkToApp",instanceId:this.context.instanceId,queryString:t.queryString}),authAPI.getCurrentUser(function(t,e){i.authCreatedBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/",i).success(function(t){o&&o(null,t)}).error(function(t,e,i,n){o&&o(t)})})):o&&o("instanceId is null, unable to build groupID"):o&&o("text or title is empty")},cancel:function(i,o){var n;i?this.context&&this.context.instanceId?((n={source:"plugin"}).sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+n.source,authAPI.getCurrentUser(function(t,e){n.authCanceledBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/"+i+"/cancel",n).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})})):o&&o("instanceId is null, unable to build groupID"):o&&o("id is empty")},subscribe:function(t,e){(t=t||{}).groupName||(t.groupName=""),this.context&&this.context.instanceId?(t=PushNotificationsAPI._getGroupID(this.context,t.groupName),PushNotificationsAPI._subscribe({groupID:t},e)):e&&e("instanceId is null, unable to build groupID")},unsubscribe:function(t,e){(t=t||{}).groupName||(t.groupName=""),this.context&&this.context.instanceId?(t=PushNotificationsAPI._getGroupID(this.context,t.groupName),PushNotificationsAPI._unsubscribe({groupID:t},e)):e&&e("instanceId is null, unable to build groupID")}},PushNotificationsAPI._getGroupID=function(t,e){return window.appContext.currentApp.appId+"_"+t.instanceId+"_"+e},PushNotificationsAPI._unsubscribe=function(i,o){window.push&&window.push.deviceId&&window.push.platform?(i=i||{}).groupID?authAPI.getCurrentUser(function(t,e){i.deviceID=push.deviceId,i.os=window.push.platform?window.push.platform.toLowerCase():"",i.authUserId=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/unsubscribe/",i).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})}):o("groupID is not specified"):o&&o("Device not ready to get the deviceId")},PushNotificationsAPI._getSubscriptions=function(e){var t,i;window.push&&window.push.deviceId&&window.push.platform?(t=window.siteConfig.endPoints.pushV2,i=window.appContext.currentApp.appId,t="".concat(t,"/api/app/").concat(i,"/subscriptions/"),i={deviceID:push.deviceId,os:window.push.platform?window.push.platform.toLowerCase():""},bfUtils.http.post(t,i).success(function(t){return e(null,t)}).catch(function(t){return e(t,null)})):e&&e("Device not ready to get the deviceId")},PushNotificationsAPI._subscribe=function(o,s){window.push&&window.push.deviceId&&window.push.platform?((o=o||{}).groupID||(o.groupID=""),authAPI.getCurrentUser(function(t,e){var i=window.push.platform?window.push.platform.toLowerCase():"",n="undefined"!=typeof PushNotification&&void 0!==PushNotification.listChannels,n="android"===i&&n||"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging;o.deviceID=push.deviceId,o.os=i,o.authUserId=e&&e._id?e._id.toString():null,o.device="undefined"!=typeof device?device:null,o.deliveryMethod=n?"FCM":null;n=localStorage.getItem("currentPushDeviceID");n&&n!==push.deviceId&&(o.oldDeviceID=n),bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscribe/",o).success(function(t){localStorage.setItem("currentPushDeviceID",push.deviceId),s&&s(null,!0)}).error(function(t,e,i,n){s&&s(t)})})):s&&s("Device not ready to get the deviceId")},authAPI.onLogin(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)}),authAPI.onLogout(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)});
"use strict";function FirebaseAPI(n){this.context=n}FirebaseAPI.prototype={createCustomToken:function(s,u){var r=this;function c(a){FirebaseAPI._getUser({instanceId:r.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:s.integrationToken},function(n,e){var t,i,o;!e||s&&s.forceLogin?(t=null,i={},"cp"===siteConfig.scope?(t="/api/user/firebase/cp/login",i.headers={auth:a._cpUser.auth,userToken:a._cpUser.userToken}):t="/api/user/firebase/login",o={authUserId:a._id,authAccessToken:a.accessToken,pluginTypesToken:r.context.pluginId,appId:window.appContext.currentApp.appId,instanceId:r.context.instanceId,integrationToken:s.integrationToken},bfUtils.http.post(window.siteConfig.endPoints.appHost+t,o,i).success(function(n){FirebaseAPI._setUser({instanceId:r.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:s.integrationToken},n),u&&u(null,n)}).error(function(n,e,t,i){401!=e&&403!=e||"cp"===siteConfig.scope?u&&u(n):(authAPI.logout(),authAPI.login({},function(n,e){e?c(e):u&&u(null,null)}))})):u&&u(null,e)})}authAPI.getCurrentUser(function(n,e){e?c(e):authAPI.login({},function(n,e){e?c(e):u&&u(null,null)})})}},function(){var o={};FirebaseAPI._getUser=function(n,e){var t=n.appId+"_"+n.instanceId+"_"+n.integrationToken,i=o[t],n=new Date;n.setMinutes(n.getMinutes()-60),i&&i.createdOn>n?e(null,i.value):(o[t]=void 0,e(null,null))},FirebaseAPI._setUser=function(n,e){n=n.appId+"_"+n.instanceId+"_"+n.integrationToken;o[n]={createdOn:new Date,value:e}},authAPI.onLogout(function(){o={}})}();
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function PublicFilesAPI(e){this.context=e,this.currentUser=null}PublicFilesAPI.prototype={getFileUrl:function(r,i){var o=this.context.appId;authAPI.getCurrentUser(function(e,t){if(e)return i(e);var n;t&&(n=t.accessToken);e=r.fileId,t=new XMLHttpRequest;t.addEventListener("readystatechange",function(){4===this.readyState&&i(null,JSON.parse(this.responseText))}),t.addEventListener("error",function(e){i(e)}),t.open("GET","".concat(window.siteConfig.endPoints.publicFilesHost,"/file/").concat(e,"/?appId=").concat(o,"&returnUrl=true")),t.setRequestHeader("Authorization",n),t.setRequestHeader("x-scope",window.siteConfig.scope),t.send()})},modifyPermissions:function(i,o){var s=this.context.appId;authAPI.getCurrentUser(function(e,t){if(e)return o(e);var n;t&&(n=t.accessToken);var r=i.fileId,e=i.permissions,t=JSON.stringify({permissions:e,appId:s}),e=new XMLHttpRequest;e.addEventListener("readystatechange",function(){4===this.readyState&&o(null,JSON.parse(this.responseText))}),e.addEventListener("error",function(e){o(e)}),e.open("PATCH","".concat(window.siteConfig.endPoints.publicFilesHost,"/file/").concat(r)),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",n),e.setRequestHeader("x-scope",window.siteConfig.scope),e.send(t)})},deleteFile:function(r,i){authAPI.getCurrentUser(function(e,t){if(e)return i(e);var n;t&&(n=t.accessToken);e=r.fileId,t=new XMLHttpRequest;t.addEventListener("readystatechange",function(){4===this.readyState&&i(null,JSON.parse(this.responseText))}),t.addEventListener("error",function(e){i(e)}),t.open("DELETE","".concat(window.siteConfig.endPoints.publicFilesHost,"/file/").concat(e)),t.setRequestHeader("x-scope",window.siteConfig.scope),t.setRequestHeader("Authorization",n),t.send()})},showDialog:function(e,t){e=e||{};var n=this,r=document.getElementById("publicFiles_input_form");r?r.innerHTML="":((r=document.createElement("form")).setAttribute("id","publicFiles_input_form"),document.body.appendChild(r));var i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("style","display:none"),i.setAttribute("id","publicFilesHiddenInput"+(new Date).toISOString()),r.appendChild(i),e&&e.allowMultipleFilesUpload&&(i.setAttribute("multiple",""),i.setAttribute("name","files[]")),e&&e.filter&&(i.accept=e.filter.join(",")),i.addEventListener("change",function(){n.uploadFiles(this.files,e,t)},!1),i.click()},uploadFilesManually:function(e,t){this.uploadFiles(e.files,e,t)},uploadFiles:function(n,a,r){var i=[],o=[],l=this;r||"function"!=typeof a||(r=a,a={}),a=a||{};var u=new AnalyticsAPI(l.context.appId,l.context.pluginId,l.context.instanceId,window.appContext.liveMode);authAPI.getCurrentUser(function(e,t){return e?r(e):t&&t.accessToken?(l.currentUser=t,void function(e){for(var t=0;t<e.length;t++){var n={fileId:t,filename:e[t].name};e[t].fileId=t,o.push(n),i.push(function(o,s){return new Promise(function(n,e){var t,r,i=!0;a.filter&&!function(e,t){for(var n=0;n<=t.length;n++)if(t[n]==e.type||function(e,t){if("string"!=typeof t||t.indexOf("/")<0)return!1;if("string"!=typeof e||e.indexOf("/")<0)return!1;var n=_slicedToArray(e.split("/"),2),r=n[0],e=n[1],n=_slicedToArray(t.split("/"),2),t=n[0],n=n[1],n="*"===e||e===n;return r===t&&n}(t[n],e.type))return!0;return!1}(o,a.filter)&&(s.status="failed",s.error="invalid File Format",l._onComplete&&l._onComplete(s),i=!1,n(s)),1073741824<o.size&&(s.status="failed",s.error="invalid File Size",l._onComplete&&l._onComplete(s),i=!1,n(s)),i&&((t=new FormData).append("pluginId",l.context.pluginId),t.append("instanceId",l.context.instanceId),t.append("appId",l.context.appId),a.permissions&&t.append("permissions",JSON.stringify(a.permissions)),l.currentUser&&l.currentUser.accessToken&&t.append("accessToken",l.currentUser.accessToken),t.append("file",o),r=new XMLHttpRequest,i=function(e){e.lengthComputable&&(e=Math.round(100*e.loaded/e.total),s.percentage=e,l._onProgress&&l._onProgress(s))},bfUtils.isMobileDevice?r.upload.onprogress=i:r.upload.addEventListener("progress",i,!1),r.onload=function(){var e,t=null;if(r.responseText)try{t=JSON.parse(r.responseText)}catch(e){}200==r.status?(s.url=t.url,s.size=t.size,s.type=t.type,s.fileId=t.fileId,s.status="success",e={data:{url:t.url,size:t.size,type:t.type},_buildfire:{aggregationValue:t.size}},"app"==window.siteConfig.scope?u.trackAction("app/publicFilesUpload",e):u.trackAction("cp/publicFilesUpload",e)):(s.status="failed",t.message?s.error=t.message:s.error="An error has occurred"),l._onComplete&&l._onComplete(s),n(s)},r.onerror=function(){s.status="failed",l._onComplete&&l._onComplete(s),n(s)},r.timeout=48e4,r.open("POST",window.siteConfig.endPoints.publicFilesHost+"/file/upload/"),r.setRequestHeader("x-scope",window.siteConfig.scope),r.send(t))})}(e[t],n))}Promise.all(i).then(function(e){r(null,e)}).catch(function(){r(!0,null)})}(n)):r(new Error("Login is required"))})},onProgress:function(e){this._onProgress=e},onComplete:function(e){this._onComplete=e}};
"use strict";var imagePreviewerAPI={show:function(n,e){this.initialized||this.renderHTML();var i=document.querySelector("#bfPsContainer .pswp");e=e||Function.prototype;var t={index:0<=n.index?n.index:0,history:!1,counterEl:!1,captionEl:!1,fullscreenEl:!1,zoomEl:!1,arrowEl:!1,preloaderEl:!1,shareEl:!1,tapToToggleControls:!1,correctOrientation:!0,clickToCloseNonZoomable:!1,closeOnScroll:!1},o=window.PhotoSwipeUI_Default;n&&n.images&&n.images.length&&(window.spinner.show(),n.images[0]&&n.images[0].name&&(n.images=n.images.map(function(n){return n.name})),n.images=n.images.map(function(n){var e=-1!==n.indexOf("?");return{src:"".concat(window.siteConfig.endPoints.cloudImageHost,"/").concat(n),msrc:"".concat(window.siteConfig.endPoints.cloudImageHost,"/").concat(n+(e?"&":"?"),"w=300&q=10"),h:window.innerHeight,w:window.innerWidth}}),window.pswp=new PhotoSwipe(i,o,n.images,t),window.pswp.listen("close",e),window.pswp.listen("destroy",function(){document.querySelector("div#bfPsContainer").remove(),imagePreviewerAPI.initialized=!1}),window.pswp.listen("imageLoadComplete",function(n,e){var i,t=(null===(i=e.container)||void 0===i?void 0:i.children)?Array.from(null===(t=e.container)||void 0===t?void 0:t.children).find(function(n){return n.classList.contains("pswp__img--placeholder")}):null;t&&(t.style.display="none")}),window.pswp.listen("gettingData",function(n,i){var e=new Image;e.onload=function(){var n,e=(null===(n=i.container)||void 0===n?void 0:n.children)?Array.from(null===(e=i.container)||void 0===e?void 0:e.children).find(function(n){return n.src===i.src}):null;e&&!e.dataset.updated&&(e.dataset.updated="1",i.w=this.width,i.h=this.height,window.pswp.updateSize(!0))},e.src=i.src}),window.pswp.init(),window.spinner.hide())},renderHTML:function(){var n=document.createElement("div");n.id="bfPsContainer",n.style.zIndex=99999999,n.style.position="relative",n.innerHTML='\n    \x3c!-- Root element of PhotoSwipe. Must have class pswp. --\x3e\n    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n\n        \x3c!-- Background of PhotoSwipe.\n             It\'s a separate element as animating opacity is faster than rgba(). --\x3e\n        <div class="pswp__bg"></div>\n\n        \x3c!-- Slides wrapper with overflow:hidden. --\x3e\n        <div class="pswp__scroll-wrap">\n\n            \x3c!-- Container that holds slides.\n                PhotoSwipe keeps only 3 of them in the DOM to save memory.\n                Don\'t modify these 3 pswp__item elements, data is added later on. --\x3e\n            <div class="pswp__container">\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n            </div>\n\n            \x3c!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --\x3e\n            <div class="pswp__ui pswp__ui--hidden">\n\n                <div class="pswp__top-bar" style="background: transparent !important; padding-top: env(safe-area-inset-top); padding-top: const(safe-area-inset-top);">\n\n                    \x3c!--  Controls are self-explanatory. Order can be changed. --\x3e\n\n                    <div class="pswp__counter"></div>\n                    <span class="icon icon-cross2 bodyTextTheme bf-pswp-close" aria-hidden="true" onclick="window.pswp.close();"></span>\n                    <button class="pswp__button pswp__button--share" title="Share"></button>\n\n                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n\n                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n\n                    \x3c!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR --\x3e\n                    \x3c!-- element will get class pswp__preloader--active when preloader is running --\x3e\n                    <div class="pswp__preloader">\n                        <div class="pswp__preloader__icn">\n                          <div class="pswp__preloader__cut">\n                            <div class="pswp__preloader__donut"></div>\n                          </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                    <div class="pswp__share-tooltip"></div>\n                </div>\n\n                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n                </button>\n\n                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n                </button>\n\n                <div class="pswp__caption">\n                    <div class="pswp__caption__center"></div>\n                </div>\n\n            </div>\n\n        </div>\n\n    </div>\n    ',(0<=window.location.pathname.toLowerCase().indexOf("plugintester")?document.getElementById("app"):document.body).appendChild(n),this.initialized=!0}};
"use strict";function searchEngineAPI(e){this.context=e}searchEngineAPI.prototype={_sendRequest:function(e,i,t,n){var s="",a=new XMLHttpRequest,i=window.siteConfig.endPoints.searchEngineHost+"/search_engine/"+i;if("GET"===(e=e.toUpperCase())&&t){var d,g="?";for(d in t)t.hasOwnProperty(d)&&(g+=d+"="+encodeURIComponent(t[d])+"&");i+=g=g.slice(0,-1)}else s=JSON.stringify(t);a.open(e,i,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("app_id",this.context.appId),a.setRequestHeader("x-api-key","GpzNPRVIld3WxoKDAXJZM7cjoUA5p0rS6pqYkCqy"),a.onreadystatechange=function(){var e=null;try{e=JSON.parse(a.responseText)}catch(e){}4==a.readyState&&(200===a.status?n&&n(null,e):n&&n(e))},a.send(s)},search:function(e,t){var n,i=this;function s(){i._sendRequest("POST","search",n,function(e,i){t&&t(e,i)})}e?(n={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,page_index:e.pageIndex,page_size:e.pageSize,search_text:e.searchText,pre_highlight_tag:e.preHighlightTag,post_highlight_tag:e.postHighlightTag},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t("invalid params",null)},insert:function(e,t){var n,i=this;function s(){i._sendRequest("POST","",n,function(e,i){t&&t(e,i)})}e?e.tag?e.title?(n={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)},save:function(e,t){var n,i=this;function s(){i._sendRequest("POST","save",n,function(e,i){t&&t(e,i)})}e?e.key?e.tag?e.title?(n={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,key:e.key,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"Missing params key"},null):t&&t({message:"invalid params"},null)},update:function(e,t){var n,i=this;function s(){i._sendRequest("PUT","",n,function(e,i){t&&t(e,i)})}e?e.id?e.tag?e.title?(n={id:e.id,instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"Missing params id"},null):t&&t({message:"invalid params"},null)},delete:function(e,t){var n,s=this;e?e.id?e.tag?(n={id:e.id,instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag},window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,s._sendRequest("DELETE","",n,function(e,i){t&&t(e,i)})})):t&&t({message:"Missing params tag"},null):t&&t({message:"Missing params id"},null):t&&t({message:"invalid params"},null)},get feeds(){var n=this;return{insert:function(e,t){var i;e?e.tag?e.title?e.feedType?e.feedConfig&&e.feedConfig.url?(e.feedItemConfig||(e.feedItemConfig={}),i={instance_id:n.context.instanceId,plugin_id:n.context.pluginId,tag:e.tag,title:e.title,description:e.description,feed_type:e.feedType,feed_config:{url:e.feedConfig.url},feed_item_config:{unique_key:e.feedItemConfig.uniqueKey,title_key:e.feedItemConfig.titleKey,description_key:e.feedItemConfig.descriptionKey,url_key:e.feedItemConfig.urlKey,publish_date_key:e.feedItemConfig.publishDateKey,image_url_key:e.feedItemConfig.imageUrlKey}},n._sendRequest("POST","feeds",i,function(e,i){t&&t(e,i)})):t&&t({message:"Missing params feedConfig.url"},null):t&&t({message:"Missing params feedType"},null):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)},delete:function(e,t){var i;e?e.tag?e.feedId?(i={instance_id:n.context.instanceId,plugin_id:n.context.pluginId,tag:e.tag,feed_id:e.feedId,remove_feed_data:e.removeFeedData},n._sendRequest("DELETE","feeds",i,function(e,i){t&&t(e,i)})):t&&t({message:"Missing params feedId"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)},get:function(e,t){var i;e?e.tag?e.feedType?(i={instance_id:n.context.instanceId,plugin_id:n.context.pluginId,tag:e.tag,feed_type:e.feedType},n._sendRequest("GET","feeds",i,function(e,i){t&&t(e,i)})):t&&t({message:"Missing params feedType"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)}}}};
"use strict";function CreditsAPI(e){if(this.context=e,!this.context)throw Error("invalid creditsSystem context");this.context.apiKeys&&(this.secretKey=this.context.apiKeys.creditsSystemSecretKey)}CreditsAPI.prototype={_sendRequest:function(e,n,t,s){var i="",r=void 0,c=void 0;t.public_key&&(r=t.public_key),t.secret_key&&(c=t.secret_key),delete t.public_key,delete t.secret_key;var a=new XMLHttpRequest,n=window.siteConfig.endPoints.creditSystemHost+"/credit_system/"+n;if("GET"===(e=e.toUpperCase())&&t){var o,u="?";for(o in t)t.hasOwnProperty(o)&&(u+=o+"="+encodeURIComponent(t[o])+"&");n+=u=u.slice(0,-1)}else i=JSON.stringify(t);a.open(e,n,!0),a.setRequestHeader("Content-Type","application/json"),r&&a.setRequestHeader("public_key",r),c&&a.setRequestHeader("secret_key",c),a.setRequestHeader("x-api-key","ZBtYjI3ZlNaKdhWApTjIF3NYaynO4snJ1zikGTDr"),a.onreadystatechange=function(){var e=null;try{e=JSON.parse(a.responseText)}catch(e){}4==a.readyState&&(200===a.status?s&&s(null,e):s&&s(e))},a.send(i)},updateMerchant:function(s,i){var r=this;appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,json_config:s.jsonConfig};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("PUT","merchants",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})})},purchaseBundle:function(r,c){var a=this;function s(e){var s=e.sessionId,i=e.transactionId;i?s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,payment_provider:r.paymentProvider,transaction_id:i,stripe:{session_id:s},bundle_id:r.bundleId,access_token:r.access_token};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?a._sendRequest("POST","credits/purchase",t,function(e,n){c&&c(e,n)}):c&&c({message:"no logged in user"})})}):c&&c("Missing sessionId parameter in purchase",null):c&&c("Missing transactionId parameter in purchase",null)}r?r.bundleId?window.authAPI.getCurrentUser(function(e,n){r.access_token=n&&n.accessToken?n.accessToken.toString():null,r.access_token?(r.paymentProvider="stripe",appApiKeys.get(function(e,n){n={public_key:n.creditsSystemPublicKey,payment_provider:r.paymentProvider,bundle_id:r.bundleId,memo:r.memo,x_ref_1:r.xRef1,x_ref_2:r.xRef2,x_ref_3:r.xRef3,access_token:r.access_token};a._sendRequest("POST","credits/transactions",n,function(e,t){e?c(e):t&&t.transactionId&&t.stripe&&t.stripe.clientReferenceId?new StripeAPI(a.context).purchase({items:[{sku:t.stripe.skuId}],clientReferenceId:t.stripe.clientReferenceId},function(e,n){e||s({transactionId:t.transactionId,sessionId:n.id})}):c({message:"missing stripe data in transaction"})})})):c&&c({message:"no logged in user"})}):c&&c("Missing bundleId parameter",null):c&&c("invalid params",null)},getMerchant:function(e,s){var i=this;appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:i.secretKey};i._sendRequest("GET","merchants",t,function(e,n){s&&s(e,n)})})},getBundles:function(e,s){var i=this;appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:i.secretKey};i._sendRequest("GET","bundles",t,function(e,n){s&&s(e,n)})})},deleteBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,bundle_id:s.bundleId};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("DELETE","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},insertBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,name:s.name,stripe_product_id:s.stripeProductId,description:s.description,credit_amount:s.creditAmount,user_token:s.userToken,image_url:s.imageUrl};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("POST","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},updateBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,name:s.name,stripe_product_id:s.stripeProductId,description:s.description,credit_amount:s.creditAmount,bundle_id:s.bundleId,user_token:s.userToken,image_url:s.imageUrl};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("PUT","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},adjustCredits:function(s,i){var r=this;s?s.userToken?s.creditAmount?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,user_token:s.userToken,credit_amount:s.creditAmount,memo:s.memo,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){t.created_by_user_token=n&&n._id?n._id.toString():null,t.created_by_user_token?r._sendRequest("POST","credits/adjust",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid creditAmount",null):i&&i("invalid userToken",null):i&&i("invalid params",null)},consumeCredits:function(s,i){var r=this;s?s.creditAmount?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,credit_amount:s.creditAmount,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3,memo:s.memo};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("POST","credits/consume",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("Missing creditAmount parameter",null):i&&i("invalid params",null)},transferCredits:function(s,i){var r=this;s?s.creditAmount?s.receiverUserToken||s.receiverUserEmail?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,credit_amount:s.creditAmount,receiver_user_token:s.receiverUserToken,receiver_user_email:s.receiverUserEmail,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("POST","credits/transfer",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("Missing (receiverUserToken or receiverUserEmail) parameter",null):i&&i("Missing creditAmount parameter",null):i&&i("invalid params",null)},searchTransactions:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:r.secretKey,users_tokens:s.usersTokens,page_size:s.pageSize,page_index:s.pageIndex,from_date:s.fromDate,to_date:s.toDate,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){!t.public_key||(t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token)?r._sendRequest("POST","credits/transactions/search",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},getUser:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey};s.secretKey&&(t.secret_key=s.secretKey),window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("GET","credits/user",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},searchUsers:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,users_tokens:s.usersTokens,page_size:s.pageSize,page_index:s.pageIndex};r._sendRequest("POST","credits/users",t,function(e,n){i&&i(e,n)})}):i&&i("invalid params",null)},getTransactionsLogs:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t;s.creditTransactionId?(t={secret_key:r.secretKey},r._sendRequest("GET","credits/transaction/"+s.creditTransactionId+"/logs",t,function(e,n){i&&i(e,n)})):i&&i("Missing creditTransactionId parameter",null)}):i&&i("invalid params",null)}};
"use strict";function StripeAPI(e){if(this.context=e,!this.context)throw Error("stripeAPI: invalid context")}StripeAPI.prototype={_sendRequest:function(e,n,t,i,s){var c="",o=new XMLHttpRequest,n=window.siteConfig.endPoints.stripeHost+"/stripe/"+n;if("GET"===(e=e.toUpperCase())&&t){var a="?";for(u in t)t.hasOwnProperty(u)&&void 0!==t[u]&&(a+=u+"="+encodeURIComponent(t[u])+"&");n+=a=a.slice(0,-1)}else c=JSON.stringify(t);if(o.open(e,n,!0),o.setRequestHeader("Content-Type","application/json"),i)for(var u in i)i.hasOwnProperty(u)&&o.setRequestHeader(u,i[u]);o.onreadystatechange=function(){var e=null;try{e=JSON.parse(o.responseText)}catch(e){}4==o.readyState&&(200===o.status?s&&s(null,e):s&&s(e))},o.send(c)},_loadScript:function(e,n){var t=document.createElement("script");if(t.type="text/javascript",t.readyState?t.onreadystatechange=function(){"loaded"!=t.readyState&&"complete"!=t.readyState||(t.onreadystatechange=null,n&&n())}:t.onload=function(){n&&n()},t.src=e.url,e.attr)for(var i in e.attr)t.setAttribute(i,e.attr[i]);for(var s=document.getElementsByTagName("script"),c=s.length;c--;)if(s[c].src==e.url)return n&&n(),!0;document.getElementsByTagName("head")[0].appendChild(t)},_guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},_openStripeCheckout:function(e,t){var n=e.items,i=e.successUrl,s=e.cancelUrl,c=e.submitType,o=e.customerEmail,a=e.sessionId,u=e.clientReferenceId,r=e.domain,l=e.events,p=this,d=null,m=!1,y=null,f=!1;function _(){window.richModal&&window.richModal.close()}function K(e){e=e||{},clearInterval(d),!e.invokeDismiss&&void 0!==e.invokeDismiss||_(),y&&y.close(),l&&"function"==typeof l.onClose&&l.onClose()}function w(){p._sendRequest("GET","checkout/sessions",{session_id:a,client_reference_id:u},{"x-api-key":p.context.apiKeys.awsApiPublicKey},function(e,n){n&&(f||(f=!0,K(),t&&t(e,n)))})}var v=r+"/payments/checkout?stripeKey="+p.context.apiKeys.stripePublicKey;function x(){(y=window.open(v,"_blank","location=no")).addEventListener("exit",function(){_()}),y.addEventListener("close",function(){_()}),d=setInterval(function(){y&&y.closed&&K(),"visible"==window.document.visibilityState?w():m||(m=!0,setTimeout(function(){m=!1,w()},6e4))},5e3),setTimeout(function(){K()},9e5)}a&&(v+="&sessionId="+encodeURIComponent(a)),u&&(v+="&clientReferenceId="+encodeURIComponent(u)),i&&(v+="&successUrl="+encodeURIComponent(i)),s&&(v+="&cancelUrl="+encodeURIComponent(s)),c&&(v+="&submitType="+encodeURIComponent(c)),o&&(v+="&customerEmail="+encodeURIComponent(o)),n&&(v+="&items="+encodeURIComponent(JSON.stringify(n))),window.bfUtils.isApp&&window.richModal.display({title:"",showDismissButton:!1,richContent:"<div style='text-align:center;'>Payment in progress <br/> Please wait...</div>",action:{title:"Cancel",handler:function(){K({invokeDismiss:!1})}}}),l&&"function"==typeof l.onProgress&&l.onProgress(x),x()},_openStripeConnect:function(e,t){var n=e.accessToken,i=e.accountLinkUrl,s=e.events,c=this,o=null,a=!1,u=null,r=!1;function l(e){e=e||{},clearInterval(o),(e.invokeDismiss||void 0===e.invokeDismiss)&&window.richModal&&window.richModal.close(),u&&u.close(),s&&"function"==typeof s.onClose&&s.onClose()}function p(){c._sendRequest("GET","connect/account",{access_token:n},{"x-api-key":c.context.apiKeys.awsApiPublicKey},function(e,n){n&&n.is_active&&(r||(r=!0,l(),t&&t(e,n)))})}var d=i;function m(){u=window.open(d,"_blank","location=no"),o=setInterval(function(){u&&u.closed&&l(),"visible"==window.document.visibilityState?p():a||(a=!0,setTimeout(function(){a=!1,p()},6e4))},1e4),setTimeout(function(){l()},18e5)}s&&"function"==typeof s.onProgress&&s.onProgress(m),window.bfUtils.isApp&&window.richModal.display({title:"",showDismissButton:!1,richContent:"<div style='text-align:center;'>Stripe Connect in progress <br/> Please wait...</div>",action:{title:"Cancel",handler:function(){l({invokeDismiss:!1})}}}),!1===c.openPaymentWindow||m()},_checkApiKeys:function(t){var i=this;function e(){appApiKeys.get(function(e,n){i.context.apiKeys=n,t&&t()})}i.context.apiKeys&&i.context.apiKeys.awsApiPublicKey?t&&t():!window.appContext.currentApp.apiKeys||0===Object.keys(window.appContext.currentApp.apiKeys).length&&window.appContext.currentApp.apiKeys.constructor===Object?e():(i.context.apiKeys=window.appContext.currentApp.apiKeys,t&&t())},pay:function(e,t){var i=this;i._checkApiKeys(function(){i.context.apiKeys.stripePublicKey?i._loadScript({url:"https://checkout.stripe.com/checkout.js"},function(){var n=StripeCheckout.configure({key:i.context.apiKeys.stripePublicKey,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(e){n.close(),t&&t(null,{sourceToken:e})}});n.open({}),window.addEventListener("popstate",function(){n.close()})}):t&&t("Missing stripePublicKey in context",null)})},charge:function(o,a){var u=this;u._checkApiKeys(function(){if(u.context.apiKeys.stripePublicKey)if(o)if(u.openPaymentWindow=o.openPaymentWindow,o.items&&0!=o.items.length){for(var e=[],n=0;n<o.items.length;n++){if(!o.items[n].name)return void(a&&a("Missing name in items index "+n,null));if(!o.items[n].amount)return void(a&&a("Missing amount in items index "+n,null));var t={name:o.items[n].name,description:o.items[n].description||void 0,amount:o.items[n].amount,currency:o.items[n].currency||"usd",quantity:o.items[n].quantity||1};o.items[n].taxBehavior&&(t.tax_behavior=o.items[n].taxBehavior),e.push(t)}var i=window.siteConfig.endPoints.appHost,s="app_id_"+u.context.appId+"_ref_id_"+u._guid(),c={type:"line_items",mode:"payment",line_items:e,client_reference_id:s,success_url:i+"/payments/success",cancel_url:i+"/payments/cancel"};o.submitType&&(c.submit_type=o.submitType),o.customerId&&(c.customer_id=o.customerId),o.customerEmail&&(c.customer_email=o.customerEmail),o.captureMethod&&(c.payment_intent_data={capture_method:o.captureMethod}),o.automaticTax&&(c.automatic_tax={enabled:o.automaticTax}),u._sendRequest("POST","checkout/sessions",c,{"x-api-key":u.context.apiKeys.awsApiPublicKey},function(e,n){e?a&&a(e,n):(n=n.sessionId,u._openStripeCheckout({sessionId:n,clientReferenceId:s,domain:i,events:o.events},function(e,n){a&&a(e,n)}))})}else a&&a("Missing items",null);else a&&a("invalid params",null);else a&&a("Missing stripePublicKey in context",null)})},subscribe:function(c,o){var a=this;a._checkApiKeys(function(){if(a.context.apiKeys.stripePublicKey)if(a.context.apiKeys.awsApiPublicKey)if(c)if(a.openPaymentWindow=c.openPaymentWindow,c.items&&0!=c.items.length){for(var e=[],n=0;n<c.items.length;n++){if(!c.items[n].planId)return void(o&&o("Missing planId in items index "+n,null));e.push({plan_id:c.items[n].planId,quantity:c.items[n].quantity||1})}var t=window.siteConfig.endPoints.appHost,i="app_id_"+a.context.appId+"_ref_id_"+a._guid(),s={type:"subscription",subscription_data:e,client_reference_id:i,success_url:t+"/payments/success",cancel_url:t+"/payments/cancel"};c.trialPeriodDays&&(s.trial_period_days=c.trialPeriodDays),c.customerId&&(s.customer_id=c.customerId),c.customerEmail&&(s.customer_email=c.customerEmail),c.metadata&&(s.metadata=c.metadata),c.automaticTax&&(s.automatic_tax={enabled:c.automaticTax}),a._sendRequest("POST","checkout/sessions",s,{"x-api-key":a.context.apiKeys.awsApiPublicKey},function(e,n){e?o&&o(e,n):(n=n.sessionId,a._openStripeCheckout({sessionId:n,clientReferenceId:i,domain:t,events:c.events},function(e,n){o&&o(e,n)}))})}else o&&o("Missing items",null);else o&&o("invalid params",null);else o&&o("Missing awsApiPublicKey in context",null);else o&&o("Missing stripePublicKey in context",null)})},purchase:function(r,l){var p=this;p._checkApiKeys(function(){if(p.context.apiKeys.stripePublicKey)if(p.context.apiKeys.awsApiPublicKey)if(r)if(r.items&&0!=r.items.length){for(var e=[],n=!1,t=!1,i=0;i<r.items.length;i++)r.items[i].sku?n=!0:r.items[i].price&&(t=!0);if(n||t)if(n&&t)l&&l("You can't use sku and price together in a request",null);else{for(var s=0;s<r.items.length;s++){if(!r.items[s].sku&&!r.items[s].price)return void(l&&l("Missing property, one of sku or price is required in items index "+s,null));var c={quantity:r.items[s].quantity||1};n?c.sku=r.items[s].sku:c.price=r.items[s].price,e.push(c)}var o=window.siteConfig.endPoints.appHost,a="app_id_"+p.context.appId+"_ref_id_"+p._guid();r.clientReferenceId&&(a=r.clientReferenceId);var u={};t?(u={type:"purchase",mode:"payment",line_items:e,client_reference_id:a,success_url:o+"/payments/success",cancel_url:o+"/payments/cancel"},r.submitType&&(u.submit_type=r.submitType),r.customerId&&(u.customer_id=r.customerId),r.customerEmail&&(u.customer_email=r.customerEmail),r.automaticTax&&(u.automatic_tax={enabled:r.automaticTax}),p._sendRequest("POST","checkout/sessions",u,{"x-api-key":p.context.apiKeys.awsApiPublicKey},function(e,n){e?l&&l(e,n):p._openStripeCheckout({sessionId:n.sessionId,clientReferenceId:a,domain:o,events:r.events},function(e,n){l&&l(e,n)})})):(u={items:e,clientReferenceId:a,successUrl:o+"/payments/success",cancelUrl:o+"/payments/cancel",submitType:r.submitType,customerEmail:r.customerEmail,domain:o,events:r.events},p._openStripeCheckout(u,function(e,n){l&&l(e,n)}))}else l&&l("One of sku or price field is required for items",null)}else l&&l("Missing items",null);else l&&l("invalid params",null);else l&&l("Missing awsApiPublicKey in context",null);else l&&l("Missing stripePublicKey in context",null)})},getSubscription:function(n,t){var i=this;i._checkApiKeys(function(){var e;i.context.apiKeys.awsApiPublicKey?n?n.subscriptionId?(e={subscription_id:n.subscriptionId},i._sendRequest("GET","customer/subscription",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,n){t&&t(e,n)})):t&&t("Missing params subscriptionId",null):t&&t("invalid params",null):t&&t("Missing awsApiPublicKey in context",null)})},cancelSubscription:function(n,t){var i=this;i._checkApiKeys(function(){var e;i.context.apiKeys.awsApiPublicKey?n?n.subscriptionId?n.customerId?(e={subscription_id:n.subscriptionId,customer_id:n.customerId},i._sendRequest("DELETE","customer/subscription",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,n){t&&t(e,n)})):t&&t("Missing params customerId",null):t&&t("Missing params subscriptionId",null):t&&t("invalid params",null):t&&t("Missing awsApiPublicKey in context",null)})},addCustomer:function(e,t){var n=this;n._checkApiKeys(function(){n.context.apiKeys.awsApiPublicKey?e?e.email?n._sendRequest("POST","customer",e,{"x-api-key":n.context.apiKeys.awsApiPublicKey},function(e,n){t&&t(e,n)}):t&&t("Missing params email",null):t&&t("invalid params",null):t&&t("Missing awsApiPublicKey in context",null)})},addCustomerCard:function(s,c){var o=this;o._checkApiKeys(function(){var t,i,e;o.context.apiKeys.stripePublicKey?o.context.apiKeys.awsApiPublicKey?s?s.customerId?(t=window.siteConfig.endPoints.appHost,e={type:"setup",client_reference_id:i="app_id_"+o.context.appId+"_ref_id_"+o._guid(),customer_id:s.customerId,success_url:t+"/payments/success",cancel_url:t+"/payments/cancel"},s.customerEmail&&(e.customer_email=s.customerEmail),o._sendRequest("POST","checkout/sessions",e,{"x-api-key":o.context.apiKeys.awsApiPublicKey},function(e,n){e?c&&c(e,n):(n=n.sessionId,o._openStripeCheckout({sessionId:n,clientReferenceId:i,domain:t},function(e,n){e?c&&c(e,null):n?(n={customer_id:s.customerId,setup_intent:n.setup_intent},o._sendRequest("POST","customer/card",n,{"x-api-key":o.context.apiKeys.awsApiPublicKey},function(e,n){c&&c(e,n)})):c&&c(null,null)}))})):c&&c("Missing params customerId",null):c&&c("invalid params",null):c&&c("Missing awsApiPublicKey in context",null):c&&c("Missing stripePublicKey in context",null)})},capturePayment:function(n,t){var i=this;i._checkApiKeys(function(){var e;i.context.apiKeys.awsApiPublicKey?n?n.paymentIntentsId?(e={payment_intents_id:n.paymentIntentsId},n.amountToCapture&&(e.amount_to_capture=n.amountToCapture),i._sendRequest("POST","payment/capture",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,n){t&&t(e,n)})):t&&t("Missing params paymentIntentsId",null):t&&t("invalid params",null):t&&t("Missing awsApiPublicKey in context",null)})},cancelPayment:function(n,t){var i=this;i._checkApiKeys(function(){var e;i.context.apiKeys.awsApiPublicKey?n?n.paymentIntentsId?(e={payment_intents_id:n.paymentIntentsId},n.cancellationReason&&(e.cancellation_reason=n.cancellationReason),i._sendRequest("POST","payment/cancel",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,n){t&&t(e,n)})):t&&t("Missing params paymentIntentsId",null):t&&t("invalid params",null):t&&t("Missing awsApiPublicKey in context",null)})},refundPayment:function(n,t){var i=this;i._checkApiKeys(function(){var e;i.context.apiKeys.awsApiPublicKey?n?n.paymentIntentsId?(e={payment_intents_id:n.paymentIntentsId},n.amount&&(e.amount=n.amount),n.reason&&(e.reason=n.reason),n.metadata&&(e.metadata=n.metadata),i._sendRequest("POST","payment/refund",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,n){t&&t(e,n)})):t&&t("Missing params paymentIntentsId",null):t&&t("invalid params",null):t&&t("Missing awsApiPublicKey in context",null)})},get connect(){var c=this;return{account:function(i,s){c._checkApiKeys(function(){var e,t;c.context.apiKeys.awsApiPublicKey?(e=window.siteConfig.endPoints.appHost,t={return_url:e+"/stripe/connect/return",refresh_url:e+"/stripe/connect/reauth",account_type:"express"},i.email&&(t.email=i.email),i.metadata&&(t.metadata=i.metadata),window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?c._sendRequest("POST","connect/account",t,{"x-api-key":c.context.apiKeys.awsApiPublicKey},function(e,n){e?s&&s(e,n):n?n.is_active?s(null,n):(n=n.account_link_url,c._openStripeConnect({accessToken:t.access_token,accountLinkUrl:n,events:i.events},function(e,n){e?s&&s(e,null):s&&s(null,n)})):s("Something went wrong!")}):s&&s({message:"no logged in user"})})):s&&s("Missing awsApiPublicKey in context",null)})},deleteAccount:function(e,i){c._checkApiKeys(function(){var t;c.context.apiKeys.awsApiPublicKey?(window.siteConfig.endPoints.appHost,t={},window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?c._sendRequest("DELETE","connect/account",t,{"x-api-key":c.context.apiKeys.awsApiPublicKey},function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})):i&&i("Missing awsApiPublicKey in context",null)})}}}};
"use strict";var userTagsAPI={assignUserTags:function(r,e){if(r&&r.tags&&r.tags.length){for(var n=0;n<r.tags.length;n++){var t=r.tags[n];if(!t)return void e("tag is null or undefined",null);if(-1<t.indexOf(","))return void e("tag (".concat(t,") error. cannot contain commas"),null);if(0!==t.indexOf("$$"))return void e("tag (".concat(t,") error. must begin with $$"),null);if(t.length<5)return void e("tag (".concat(t,") error. length must be 5 at least"),null)}authAPI.getCurrentUser(function(n,t){n?(console.log(n),e(n,null)):t?userTags.assignUserTags(r.tags.join(","),{},e):e("no current user",null)})}else e("no tags found",null)}};
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var richModal=function(){var g=document.createElement("div");g.id="richModal",g.className="hidden";var e=document.createElement("div");e.className="focus-screen hidden",g.appendChild(e),document.body.appendChild(g);var y=["default","primary","success","info","warning","danger"],b=null,v=[];function C(){try{if(b)return;var e=!(null==v||!v.length)&&v[0].options.forceShow;if(0<=window.location.hash.indexOf("accessCode")&&!e)return setTimeout(C,5e3);var t=document.getElementsByClassName("login-holder")[0];if(t&&-1===t.className.indexOf("ng-hide")&&!e)return setTimeout(C,5e3);var n=(b=v.shift()).options,i=b.callback;document.getElementById("richModal").className="";var o=document.getElementsByClassName("focus-screen")[0];o.className="focus-screen animated fadeInScreen",o.onclick=function(){n&&n.forceAction||(T(),i&&i(null,{buttonType:null}))};var a,l,s,c=document.createElement("div");c.className="detail-modal animated fadeInUp backgroundColorTheme",n.title&&((a=document.createElement("h1")).id="modalTitle",a.innerHTML=n.title,n.design&&(s="",n.design.title&&n.design.title.align&&(s+="text-align: "+n.design.title.align+" !important;"),n.design.textColor&&(s+="color: "+n.design.textColor+" !important;"),a.setAttribute("style",s)),c.appendChild(a)),n.subtitle&&((l=document.createElement("span")).className="subtitle",l.innerHTML=n.subtitle,n.design&&(s="",n.design.subtitle&&n.design.subtitle.align&&(s+="text-align: "+n.design.subtitle.align+" !important;"),n.design.textColor&&(s+="color: "+n.design.textColor+" !important;"),l.setAttribute("style",s)),c.appendChild(l));var r=document.createElement("div");r.className="rich-content bodyTextTheme",n.isContentHTML||void 0===n.isContentHTML?r.innerHTML=n.richContent||"":r.innerText=n.richContent||"",c.appendChild(r);var d,u=document.createElement("div");u.className="button-container",c.appendChild(u),!n.showDismissButton&&void 0!==n.showDismissButton||((d=document.createElement("button")).className=n.action?"dismiss-button primaryTheme":"dismiss-button dismiss-large primaryTheme",d.innerHTML=n.dismissButtonText||"Dismiss",d.onclick=function(){T(),i&&i(null,{buttonType:"dismiss"})},u.appendChild(d));var m="";n.design&&(n.design.fullScreen&&g.classList.add("fullScreen"),n.design.backgroundColor&&(m+="background : "+n.design.backgroundColor+" !important;"),n.design.textColor&&(m+="color : "+n.design.textColor+" !important"),c.setAttribute("style",m),d.setAttribute("style",m))}catch(e){console.error("Failed to render rich modal",e)}if(n.action&&!n.action.length&&(n.action=[n.action]),n.action)for(var p=0;p<n.action.length;p++){var f,h=function(e){var t=n.action[e];try{if(f=document.createElement("button"),t.type||(t.type="primary"),!y.includes(t.type))return{v:i("Invalid button type")};f.className="action-button ".concat(t.type,"Theme"),!1===n.showDismissButton&&(f.className="action-button ".concat(t.type,"Theme action-button-large")),f.innerHTML=t.title||"[ Click ]",f.onclick=function(){t.handler?t.handler():((new ActionItemsAPI).execute(t,function(e,t){}),i&&i(null,{buttonType:"action",value:t})),t.preventAutoClose||T()},n.design&&m&&f.setAttribute("style",m),u.appendChild(f)}catch(e){console.error("Failed to bind action to rich modal",e)}}(p);if("object"===_typeof(h))return h.v}document.getElementById("richModal").appendChild(c)}function T(){var e=document.getElementsByClassName("focus-screen")[0];e&&(e.className="focus-screen animated fadeOutScreen");var t=document.getElementsByClassName("detail-modal")[0];t&&(t.className="detail-modal animated fadeOut");var n=document.getElementById("richModal");setTimeout(function(){t&&t.remove(),b=null,0<v.length?setTimeout(C,300):n&&(n.className="hidden")},700)}return{display:function(e,t){v.push({options:e,callback:t}),C()},close:function(){T()},isVisible:function(){return!(0<=document.getElementById("richModal").className.indexOf("hidden"))},clearAll:function(){v=[],T()}}}();
"use strict";var _push;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}var push=(_defineProperty(_push={get instance(){return window.plugins&&window.plugins.pushNotification?_oldPush:"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging?push_firebase:push_phonegap},init:function(){return window.push=this,window.plugins&&window.plugins.pushNotification?(console.log("running old plugin for push notification"),_oldPush.init()):"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging?push_firebase.init():(console.log("running new plugin phonegap-plugin-push"),void push_phonegap.init())},get deviceId(){return this.instance.deviceId},get platform(){return"undefined"!=typeof device&&device.platform&&device.platform.toLowerCase()||""},get getBadgeNumber(){return this.instance.getBadgeNumber},get decrementBadge(){return this.instance.decrementBadge},get clearBadge(){return this.instance.clearBadge},get displayMessage(){return this.instance.displayMessage},getNotificationData:function(e,n,o,i){window.bfUtils.http.jsonp(e,n).success(function(e){e=e&&e.result[0]?e.result[0]:{actionItem:!1};o=Object.assign(o,e),i(null,o)}).catch(i)}},"displayMessage",function(e,n){n=n||{};push.trackPushNotifications({eventName:"push_notification/viewed",payload:e}),console.log("pushNotifications#displayMessage L152",e),localStorage.payload=JSON.stringify(e);try{var o=e._id||e.notificationId||e.additionalData.notificationId;if(console.log("Checking message type",e.messageType,e),e.additionalData&&"social"===e.additionalData.messageType)return e.title="Alert",e.richContent=e.message,richModal.display(e),void console.log("Got social notification",e);var i=window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",t={params:{data:{method:"notifications/get",params:{appID:window.appContext.currentApp.appId.toString(),notificationID:o}}}};push.getNotificationData(i,t,e,function(e,n){if(e)return console.error(e);e=Object.assign({},n);n.actionItem&&(e.action={title:n.actionItem&&n.actionItem.title?n.actionItem.title:"View",handler:function(){var e=new ActionItemsAPI;push.trackPushNotifications({eventName:"push_notification/clicked",payload:n}),window.closeSideMenu&&window.closeSideMenu(),e.execute(n.actionItem,function(e,n){console.info("Action Taken!")})}}),e.richContent=e.richMessage||e.message,e.subtitle="Sent "+moment(e.sendAfter).fromNow(),richModal.display(e)})}catch(e){console.error("Failed to parse push notification",e)}}),_defineProperty(_push,"notificationsTracked",{}),_defineProperty(_push,"trackPushNotifications",function(e){var n,o,i;"undefined"!=typeof device&&"undefined"!=typeof AnalyticsAPI&&e&&e.payload&&e.eventName&&((n=e.payload._id||e.payload.notificationId||e.payload.additionalData.notificationId)&&(push.notificationsTracked||(push.notificationsTracked={}),(o=(o=push.notificationsTracked[n])||(push.notificationsTracked[n]={events:[]})).events||(o.events=[]),-1<o.events.indexOf(e.eventName)||(o.events.push(e.eventName),i=device.platform?device.platform.toLowerCase():"",new AnalyticsAPI(window.appContext.currentApp.appId,"push_notification",n,void 0,i).trackAction(e.eventName))))}),_push),push_firebase={deviceId:null,init:function(){var n=this;if("undefined"==typeof cordova||!cordova.plugins&&!cordova.plugins.firebase||!cordova.plugins.firebase.messaging)return console.error("FCM plugin not installed");cordova.plugins.firebase.messaging.requestPermission().then(console.log).catch(console.warn);var e=function(){return cordova.plugins.firebase.messaging.getToken().then(function(e){return n.registerToken(e)}).catch(console.warn)};cordova.plugins.firebase.messaging.onTokenRefresh(e,console.warn),e();e=function(){n.getBadgeNumber(function(e,n){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:n}))})};e(),document.addEventListener("deviceAppResumed",e,!1),cordova.plugins.firebase.messaging.onMessage(function(e){return n.notificationTriggerHandler(e)},console.warn),cordova.plugins.firebase.messaging.onBackgroundMessage(function(e){return n.notificationClickHandler(e)},console.warn)},registerToken:function(e){var n=this;if(console.log("registerToken: "+e),this.deviceId=e,!window.appContext||!window.appContext.currentApp)return console.error("invalid appContext cant register device");var o={params:{data:{method:"groups/subscriptions/add",params:{groupID:"",appID:window.appContext.currentApp.appId,deviceId:this.deviceId,os:device.platform?device.platform.toLowerCase():"",deliveryMethod:"FCM",device:device}}}},e=localStorage.getItem("currentPushDeviceID");e&&e!==this.deviceId&&(o.params.data.params.olddeviceId=e);function i(){bfUtils.http&&bfUtils.http.jsonp(window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",o).success(function(){console.log("device is now subscribed to PNs"),localStorage.setItem("currentPushDeviceID",n.deviceId)}).error(function(e){console.error(e)})}setTimeout(function(){PushNotificationsAPI._subscribe(null,function(e){e&&(console.error(e),setTimeout(i,2e3))})},2e3)},notificationTriggerHandler:function(e){var o=this;if(console.warn("***** notificationTriggerHandler *****"),e.meta)return LocalNotificationsAPI.onTrigger(e);var n=new CustomEvent("pushNotificationsOnReceived",{detail:e});document.dispatchEvent(n);var i=this.normalizePayload(e);i.count&&i.additionalData&&i.additionalData.foreground?cordova.plugins.firebase.messaging.getBadge().then(function(n){i.count!=n&&cordova.plugins.firebase.messaging.setBadge(parseInt(i.count)).then(function(){o.decrementBadge(),console.log("push badge updated from notification",{localCount:n,remoteCount:i.count})},function(e){o.decrementBadge(),console.log("push badge failed to update from notification",{err:e,localCount:n,remoteCount:i.count})}).catch(console.warn)},function(e){console.log("failed getting local badge",{err:e,remoteCount:i.count})}).catch(console.warn):this.decrementBadge();e={};i.additionalData&&"social"==i.additionalData.messageType?e.buttons=["Dismiss"]:e.buttons=["Dismiss","Show Details"],push.displayMessage(i,e)},notificationClickHandler:function(e){return console.warn("***** notificationClickHandler *****"),e.meta?LocalNotificationsAPI.onClick(e):(e.foreground=!1,this.notificationTriggerHandler(e))},getBadgeNumber:function(n){if(!this.deviceId)return n("push_firebase not initialized",null);cordova.plugins.firebase.messaging.getBadge().then(function(e){return n(null,e)}).catch(console.warn)},decrementBadge:function(n){var e,o;this.deviceId?(e=device.platform?device.platform.toLowerCase():"",o=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/decrease",window.bfUtils.http.post(o,{deviceID:this.deviceId,os:e,value:1}).success(function(e){console.log("push badge decremented",e)}).error(function(e,n){console.error("error decrementing badge",{data:e,status:n})}),cordova.plugins.firebase.messaging.getBadge().then(function(e){e?cordova.plugins.firebase.messaging.setBadge(e-1).then(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:e-1})),n&&n(null,e-1)},function(e){n&&n(e)}).catch(console.warn):n&&n(null,e)},function(e){n&&n(e)}).catch(console.warn)):n&&n("push not initialized")},clearBadge:function(n){if(!this.deviceId)return push._instance?push.clearBadge(n):n("push not initialized");var e=device.platform?device.platform.toLowerCase():"",o=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/update";window.bfUtils.http.post(o,{deviceID:this.deviceId,os:e,value:0}).success(function(e){console.log("push badge decremented",e)}).error(function(e,n){console.error("error decrementing badge",{data:e,status:n})}),cordova.plugins.firebase.messaging.setBadge(0).then(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:0})),n&&n(null,0)},function(e){n&&n(e)}).catch(console.warn)},normalizePayload:function(e){var n=e.aps||e,o=n.sound,i=n.badge,t=n.alert||e,a=t.title,s=t.body,n=e.notificationId,t=e.messageFrom;return{additionalData:{notificationId:n,messageType:e.messageType,messageFrom:t,foreground:!1!==e.foreground},title:a,sound:o,count:-1<["number","string"].indexOf(_typeof(i))?parseInt(i):null,message:s}}},push_phonegap={pushNotification:null,deviceId:null,platform:null,unseen:0,notificationHandler:null,_instance:null,init:function(){var e;try{if(!window.PushNotification)return void console.error("PushNotification plugin not installed");var n=(e={android:{},ios:{}},"android"==device.platform.toLowerCase()?e.android={senderID:"515869937012"}:e.ios={alert:"true",badge:"true",sound:"true"},e);push_phonegap._instance=PushNotification.init(n),push_phonegap._instance.on("registration",function(e){push_phonegap.registerToken(e.registrationId),console.log("push notification registered...")}),push_phonegap._instance.on("notification",function(o){var e=new CustomEvent("pushNotificationsOnReceived",{detail:o});document.dispatchEvent(e),o.count&&o.additionalData&&o.additionalData.foreground?push_phonegap._instance.getApplicationIconBadgeNumber(function(n){o.count!=n&&push_phonegap._instance.setApplicationIconBadgeNumber(function(){push_phonegap.decrementBadge(),console.log("push badge updated from notification",{localCount:n,remoteCount:o.count})},function(e){push_phonegap.decrementBadge(),console.log("push badge failed to update from notification",{err:e,localCount:n,remoteCount:o.count})},parseInt(o.count))},function(e){console.log("failed getting local badge",{err:e,remoteCount:o.count})}):push_phonegap.decrementBadge();e={};"social"==o.additionalData.messageType?e.buttons=["Dismiss"]:e.buttons=["Dismiss","Show Details"],push.displayMessage(o,e)}),push_phonegap._instance.on("error",function(e){console.error(e.message),push_phonegap.err=e;e=new CustomEvent("PUSH_ON_REGISTRATION",{detail:null});document.dispatchEvent(e)}),push_phonegap.getBadgeNumber(function(e,n){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:n}))});var o=function(){push_phonegap.getBadgeNumber(function(e,n){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:n}))})};document.addEventListener("deviceAppResumed",o,!1),o()}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}},decrementBadge:function(n){var e,o;push_phonegap._instance?(e=device.platform?device.platform.toLowerCase():"",o=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/decrease",window.bfUtils.http.post(o,{deviceID:push_phonegap.deviceId,os:e,value:1}).success(function(e){console.log("push badge decremented",e)}).error(function(e,n){console.error("error decrementing badge",{data:e,status:n})}),push_phonegap._instance.getApplicationIconBadgeNumber(function(e){e?push_phonegap._instance.setApplicationIconBadgeNumber(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:e-1})),n&&n(null,e-1)},function(e){n&&n(e)},e-1):n&&n(null,e)},function(e){n&&n(e)})):n&&n("push_phonegap not initialized")},getBadgeNumber:function(n){push_phonegap._instance?push_phonegap._instance.getApplicationIconBadgeNumber(function(e){n&&n(null,e)},function(e){n&&n(e)}):n&&n("push_phonegap not initialized")},clearBadge:function(n){var e,o;push_phonegap._instance?(e=device.platform?device.platform.toLowerCase():"",o=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/update",window.bfUtils.http.post(o,{deviceID:push_phonegap.deviceId,os:e,value:0}).success(function(e){console.log("push badge cleared",e)}).error(function(e,n){console.error("error clearing badge",{data:e,status:n})}),push_phonegap._instance.setApplicationIconBadgeNumber(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:0})),n&&n(null,0)},function(e){n&&n(e)},0)):n&&n("push_phonegap not initialized")},registerToken:function(e){var n,o,i;console.log("registerToken: "+e),push_phonegap.deviceId=e,window.appContext&&window.appContext.currentApp?(o="undefined"!=typeof PushNotification&&void 0!==PushNotification.listChannels,o=device.platform&&"android"===device.platform.toLowerCase()&&o,n={params:{data:{method:"groups/subscriptions/add",params:{groupID:"",appID:window.appContext.currentApp.appId,deviceId:push_phonegap.deviceId,os:device.platform?device.platform.toLowerCase():"",deliveryMethod:o?"FCM":null,device:device}}}},(o=localStorage.getItem("currentPushDeviceID"))&&o!==e&&(n.params.data.params.oldDeviceID=o),i=function(){bfUtils.http&&bfUtils.http.jsonp(window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",n).success(function(){console.log("device is now subscribed to PNs"),localStorage.setItem("currentPushDeviceID",e)}).error(function(e){console.error(e)})},setTimeout(function(){PushNotificationsAPI._subscribe(null,function(e){e&&(console.error(e),setTimeout(i,2e3))})},2e3)):console.error("invalid appContext cant register device")}},_oldPush={pushNotification:null,unseen:0,notificationHandler:null,init:function(){console.warn("window.plugins.pushNotification is used for old builds, it's no longer used for new build");try{if(void 0===window.plugins||void 0===window.plugins.pushNotification)return void console.warn("window.plugins.pushNotification is not defined");_oldPush.pushNotification=window.plugins.pushNotification,push.platform=device.platform.toLowerCase(),push.prepareDOM(),"android"==device.platform.toLowerCase()?_oldPush.notificationHandler=new pushAndroidNotificationHandler(_oldPush.pushNotification):_oldPush.notificationHandler=new pushiOSNotificationHandler(_oldPush.pushNotification),_oldPush.notificationHandler.onRegistered=push.registerToken,_oldPush.notificationHandler.register()}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}}};function pushAndroidNotificationHandler(e){this.pushNotification=e,this.androidSenderID="515869937012"}function pushiOSNotificationHandler(e){this.pushNotification=e}pushAndroidNotificationHandler.prototype={register:function(){navigator.onLine?this.pushNotification.register(this.successHandler,this.errorHandler,{senderID:this.androidSenderID,ecb:"_oldPush.notificationHandler.onNotification"}):console.warn("offline: not attempting to register push notifications")},onRegistered:function(e){push.deviceId=e},onNotification:function(e){var n=new CustomEvent("pushNotificationsOnReceived",{detail:e});switch(document.dispatchEvent(n),e.event){case"registered":0<e.regid.length&&this.onRegistered(e.regid);break;case"message":push.decrementBadge(),e.foreground||e.coldstart;var o={};"social"==e.payload.messageType?o.buttons=["Dismiss"]:o.buttons=["Dismiss","Show Details"],push.displayMessage(e.payload,o);break;case"error":console.error("An error occurred: "+e.msg);break;default:console.error("EVENT -> Unknown, an event was received and we do not know what it is")}},successHandler:function(e){},errorHandler:function(e){console.error("error:"+e)}},pushiOSNotificationHandler.prototype={onRegistered:function(e){push.deviceId=e},register:function(){if(navigator.onLine)try{this.pushNotification.register(this.onRegistered,this.errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"_oldPush.notificationHandler.onNotification"})}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}else console.warn("offline: not attempting to register push notifications")},onNotification:function(e){var n=new CustomEvent("pushNotificationsOnReceived",{detail:e});document.dispatchEvent(n),e?(n={},"social"==e.messageType?n.buttons=["Dismiss"]:n.buttons=["Dismiss","Show Details"],e.alert&&(push.decrementBadge(),push.displayMessage(e,n))):window.location.hash="/pushHistory",e.sound},tokenHandler:function(e){push.deviceId=e},successHandler:function(e){this.onRegistered(e)},errorHandler:function(e){console.error("ios error:"+e)}},bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){window.plugins&&window.plugins.pushNotification?(console.log("running old plugin for push notification"),_oldPush.init()):(console.log("running new plugin phonegap-plugin-push"),push.init())}),window.testNotification=function(){push.displayMessage({message:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />",title:"Notification Title",alert:"This is the alert, not sure what it means",messageType:null,additionalData:{notificationId:"5b5f9bbe39003904daa4f093",coldstart:!0,foreground:!0}},{buttons:["Dismiss","Show Details"]})};
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}var BleCentralAPI=function(){function e(){if(_classCallCheck(this,e),this.mockMode=void 0===window.ble,this.mockMode)return console.warn("mock bleCentral interaction");this.ble=window.ble}return _createClass(e,[{key:"onDeviceDiscovered",value:function(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceDiscovered",e,null);postMaster.broadcast(e)}},{key:"onDeviceConnected",value:function(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceConnected",e,null);postMaster.broadcast(e)}},{key:"onDeviceDisconnected",value:function(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceDisconnected",e,null);postMaster.broadcast(e)}},{key:"onNotification",value:function(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnNotification",e,null);postMaster.broadcast(e)}},{key:"onStateNotification",value:function(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnStateNotification",e,null);postMaster.broadcast(e)}},{key:"scan",value:function(n,t){var o=this;if(this.mockMode)return console.warn("bleCentral mock scan!");(n=n||{}).services||(n.services=[]),n.seconds||(n.seconds=5),permissionRequestsAPI.queueRequest("background_location",this,function(){var e=1e3*n.seconds;setTimeout(function(){t&&t(null,{status:"complete"})},e),o.ble&&o.ble.scan(n.services,n.seconds,o.onDeviceDiscovered,function(e){(t||console.error)(e)})})}},{key:"startScan",value:function(e,n){var t=this;if(this.mockMode)return console.warn("bleCentral mock startScan!");(e=e||{}).services||(e.services=[]),permissionRequestsAPI.queueRequest("background_location",this,function(){t.ble&&t.ble.startScan(e.services,t.onDeviceDiscovered,function(e){(n||console.error)(e)})})}},{key:"startScanWithOptions",value:function(n,t){var o=this;if(this.mockMode)return console.warn("bleCentral mock startScanWithOptions!");(n=n||{}).services||(n.services=[]),n.reportDuplicates||(n.reportDuplicates=!1),permissionRequestsAPI.queueRequest("background_location",this,function(){var e={reportDuplicates:n.reportDuplicates};o.ble&&o.ble.startScanWithOptions(n.services,e,o.onDeviceDiscovered,function(e){(t||console.error)(e)})})}},{key:"stopScan",value:function(n){if(this.mockMode)return console.warn("bleCentral mock stopScan!");this.ble&&this.ble.stopScan(function(){n&&n(null,!0)},function(e){n&&n(e,null)})}},{key:"connect",value:function(e,n){var t=this;if(!e||!e.device_id){var o=new Error("No device_id provided to bleCentral.connect!");return(n||console.error)(o)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.connect(e.device_id,function(e){n&&n(null,e),t.onDeviceConnected(e)},function(e){t.onDeviceDisconnected(e)})}},{key:"autoConnect",value:function(e,n){var t=this;if(!e||!e.device_id){var o=new Error("No device_id provided to bleCentral.autoConnect!");return(n||console.error)(o)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.autoConnect(e.device_id,function(e){t.onDeviceConnected(e)},function(e){t.onDeviceDisonnected(e)})}},{key:"disconnect",value:function(e,n){var t=this;if(!e||!e.device_id){var o=new Error("No device_id provided to bleCentral.disconnect!");return(n||console.error)(o)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.disconnect(e.device_id,function(e){n&&n(null,e),t.onDeviceDisconnected(e)},function(e){n&&n(e,null)})}},{key:"connectedPeripheralsWithServices",value:function(e,n){if(!n){var t=new Error("No callback provided to bleCentral.connectedPeripheralsWithServices!");return console.error(t)}if(!e||!e.services||!e.services.length){t=new Error("No services provided to bleCentral.connectedPeripheralsWithServices!");return n(t,null)}if(this.mockMode)return console.warn("bleCentral mock connectedPeripheralsWithServices!"),n(null,[]);this.ble&&this.ble.connectedPeripheralsWithServices(e.services,function(e){n(null,e)},function(e){n(e,null)})}},{key:"peripheralsWithIdentifiers",value:function(e,n){if(!n){var t=new Error("No callback provided to bleCentral.peripheralsWithIdentifiers!");return console.error(t)}if(!e||!e.identifiers){t=new Error("No identifiers provided to bleCentral.peripheralsWithIdentifiers!");return n(t,null)}if(this.mockMode)return console.warn("bleCentral mock peripheralsWithIdentifiers!"),n(null,[]);this.ble&&this.ble.connectedPeripheralsWithServices(e.services,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"read",value:function(e,t){var o=this;if("function"!=typeof t)return console.error(new Error("No callback provided to bleCentral.read!"));if(!e)return t(new Error("No options provided to bleCentral.read!"),null);var n=e.device_id,r=e.service_uuid,i=e.characteristic_uuid;if(!n||!r||!i){e=new Error("Invalid device info provided to bleCentral.read: ".concat(JSON.stringify(e)));return(t||console.error)(e,null)}if(this.mockMode)return console.warn("bleCentral mock read!"),t(null,null);this.ble&&this.ble.read(n,r,i,function(e){try{var n=o.bufferToArray(e);t(null,n)}catch(e){t(e,null)}},function(e){t(e,null)})}},{key:"write",value:function(e,n){if(!e){var t=new Error("No options provided to bleCentral.write!");return(n||console.error)(t,null)}var o=e.device_id,r=e.service_uuid,i=e.characteristic_uuid,l=e.data;if(!o||!r||!i){i=new Error("Invalid device info provided to bleCentral.write: ".concat(JSON.stringify(e)));return(n||console.error)(i,null)}if("object"!==_typeof(l)||"number"!=typeof l.length){var c=new Error("Invalid data provided to bleCentral.write: Must be an array!",l);return(n||console.error)(c,null)}if(this.mockMode)return console.warn("bleCentral mock write!"),void(n&&n(null,null));c=null;try{c=this.arrayToBuffer(l)}catch(t){return(n||console.error)(t,null)}this.ble&&this.ble.write(e.device_id,e.service_uuid,e.characteristic_uuid,c,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"writeWithoutResponse",value:function(e,n){if(!e){var t=new Error("No options provided to bleCentral.writeWithoutResponse!");return(n||console.error)(t,null)}var o=e.device_id,r=e.service_uuid,i=e.characteristic_uuid,l=e.data;if(!o||!r||!i){e=new Error("Invalid device info provided to bleCentral.writeWithoutResponse: ".concat(JSON.stringify(e)));return(n||console.error)(e,null)}if("object"!==_typeof(l)||"number"!=typeof l.length){var c=new Error("Invalid data provided to bleCentral.writeWithoutResponse: Must be an array!",l);return(n||console.error)(c,null)}if(this.mockMode)return console.warn("bleCentral mock writeWithoutResponse!"),void(n&&n(null,null));c=null;try{c=this.arrayToBuffer(l)}catch(t){return(n||console.error)(t,null)}this.ble&&this.ble.writeWithoutResponse(o,r,i,c,function(){n&&n(null)},function(e){n&&n(e)})}},{key:"readRSSI",value:function(e,n){if(!e||!e.device_id){var t=new Error("No device_id provided to bleCentral.readRSSI!");return(n||console.error)(t,null)}if(this.mockMode)return console.warn("bleCentral mock readRSSI!"),void(n&&n(null,null));this.ble&&this.ble.readRSSI(e.device_id,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"startNotification",value:function(e,n){var o=this;if(!e){var t=new Error("No options provided to bleCentral.startNotification!");return(n||console.error)(t)}var r=e.device_id,i=e.service_uuid,l=e.characteristic_uuid;if(!r||!i||!l){e=new Error("Invalid device info provided to bleCentral.startNotification: ".concat(JSON.stringify(e)));return(n||console.error)(e)}if(this.mockMode)return console.warn("bleCentral mock startNotification!"),void(n&&n(null));this.ble&&this.ble.startNotification(r,i,l,function(e){try{var n=o.bufferToArray(e),t={device_id:r,service_uuid:i,characteristic_uuid:l,data:n};o.onNotification(t)}catch(e){console.error(e)}},function(e){n&&n(e)})}},{key:"stopNotification",value:function(e,n){if(!e){var t=new Error("No options provided to bleCentral.stopNotification!");return(n||console.error)(t)}var o=e.device_id,r=e.service_uuid,t=e.characteristic_uuid;if(!o||!r||!t){e=new Error("Invalid device info provided to bleCentral.stopNotification: ".concat(JSON.stringify(e)));return(n||console.error)(e)}if(this.mockMode)return console.warn("bleCentral mock stopNotification!"),void(n&&n(null));this.ble&&this.ble.stopNotification(o,r,t,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"startStateNotifications",value:function(n){if(this.mockMode)return console.warn("bleCentral mock startStateNotifications!"),void(n&&n(null,null));this.ble&&this.ble.startStateNotifications(function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"stopStateNotifications",value:function(n){if(this.mockMode)return console.warn("bleCentral mock stopStateNotifications!"),void(n&&n(null,null));this.ble&&this.ble.stopStateNotifications(function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"isConnected",value:function(e,n){if(!n)return console.error(new Error("No callback provided to bleCentral.isConnected!"));if(!e||!e.device_id){var t=new Error("No device_id provided to bleCentral.isConnected!");return n(t,null)}if(this.mockMode)return console.warn("bleCentral mock isConnected!"),n(null,null);this.ble&&this.ble.isConnected(e.device_id,function(e){n(null,e)},function(e){n(e,null)})}},{key:"isEnabled",value:function(e){return e?this.mockMode?(console.warn("bleCentral mock isEnabled!"),e(null,null)):void(this.ble&&this.ble.isEnabled(function(){e(null,!0)},function(){e(null,!1)})):console.error(new Error("No callback provided to bleCentral.isEnabled!"))}},{key:"isLocationEnabled",value:function(n){if(this.mockMode)return console.warn("bleCentral mock isLocationEnabled!"),void(n&&n(null,null));this.ble&&this.ble.isLocationEnabled(function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"showBluetoothSettings",value:function(n){return bfUtils.isIOS?(n||console.warn)("bleCentral.showBluetoothSettings is not available on iOS!"):this.mockMode?(console.warn("bleCentral mock showBluetoothSettings!"),void(n&&n(null))):void(this.ble&&this.ble.showBluetoothSettings(function(){n&&n(null)},function(e){n&&n(e)}))}},{key:"enable",value:function(n){return bfUtils.isIOS?(n||console.warn)("bleCentral.enable is not available on iOS!"):this.mockMode?(console.warn("bleCentral mock enable!"),void(n&&n(null,null))):void(this.ble&&this.ble.enable(function(e){n&&n(null,e)},function(e){n&&n(e,null)}))}},{key:"bondedDevices",value:function(n){return n?this.mockMode?(console.warn("bleCentral mock enable!"),n(null,null)):void(this.ble&&this.ble.bondedDevices(function(e){n(null,e)},function(e){n(e,null)})):console.error(new Error("No callback provided to bleCentral.bondedDevices!"))}},{key:"requestMtu",value:function(e,n){if(!e||!e.device_id){var t=new Error("No device_id provided to bleCentral.requestMtu!");return(n||console.error)(t,null)}if(this.mockMode)return console.warn("bleCentral mock requestMtu!"),void(n&&n(null,null));e.mtu=e.mtu||100,this.ble&&this.ble.requestMtu(e.device_id,e.mtu,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"refreshDeviceCache",value:function(e,n){if(!e||!e.device_id){var t=new Error("No device_id provided to bleCentral.refreshDeviceCache!");return(n||console.error)(t,null)}if(this.mockMode)return console.warn("bleCentral mock refreshDeviceCache!"),void(n&&n(null,null));this.ble&&this.ble.refreshDeviceCache(e.device_id,e.timeoutMillis,function(e){n&&n(null,e)},function(e){n&&n(e,null)})}},{key:"arrayTypes",get:function(){return{Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array}}},{key:"bufferToArray",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Uint8";return this.arrayTypes[n]||(console.error("Invalid array type! Defaulting to Uint8Array."),n="Uint8"),Array.from(new this.arrayTypes[n](e))}},{key:"arrayToBuffer",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Uint8";return this.arrayTypes[n]||(console.error("Invalid array type! Defaulting to Uint8Array."),n="Uint8"),new this.arrayTypes[n](e).buffer}}]),e}();
"use strict";function ComponentUIAPI(e){this.context=e,this.DRAWER_UI_ID="bottomDrawerContainer",this.SNACKBAR_UI_ID="snackbarhero",this.timeOutId=null,this.init()}ComponentUIAPI.prototype={init:function(){},sanitize:function(e,n,i){window.bfUtils.sanitize({data:e},function(e,t){return e?(i&&i(e,null),console.error(e)):(n.innerHTML+=t,void(i&&i(null,null)))})},closeDrawer:function(e,t){e=e||{};var n=document.getElementById(this.DRAWER_UI_ID);n&&(this.scrollBooster&&(this.scrollBooster.destroy(),this.scrollBooster=null),e.force?n.remove():(n.classList.add("closing"),setTimeout(function(){n.remove()},300)))},openTrustedDrawer:function(e,t){e.isTrusted=!0,this._openDrawer(e,t)},openDrawer:function(e,t){delete e.isTrusted,this._openDrawer(e,t)},_openDrawer:function(c,l){var e=this,r=this,a=!0,d=!1,u=[],m=[],h=(c=c||{}).multiSelection?"block":"none",o=[],p=null,b=null;c.isHTML=!1!==c.isHTML,c.multiSelectionActionButton=c.multiSelectionActionButton||{},c.multiSelectionActionButton.text=c.multiSelectionActionButton.text||"OK",c.multiSelectionActionButton.type=c.multiSelectionActionButton.type||"primary",c.allowSelectAll=!1!==c.allowSelectAll,c.enableFilter=!1!==c.enableFilter,c.autoUseImageCdn=!1!==c.autoUseImageCdn;var t=document.createElement("div");t.id=this.DRAWER_UI_ID,t.className="bottom-drawer-container",t.innerHTML='<div class="bottom-drawer-backdrop"></div><div class="bottom-drawer-holder"><div class="bottom-drawer backgroundColorTheme bodyTextTheme"></div></div>';var y=t.querySelector(".bottom-drawer");t.querySelector(".bottom-drawer-backdrop").onclick=function(){e.closeDrawer(),c.triggerCallbackOnUIDismiss&&l(null,null)},c.height&&(y.style.height=c.height),"undefined"!=typeof globalEvents&&(window.addEventListener(globalEvents.TABCHANGE.CONTENT,function(){e.closeDrawer()}),window.addEventListener(globalEvents.TABCHANGE.PURCHASE,function(){e.closeDrawer()}));var n,i,s,v,f,S,g,T=function(e){return a?-1<u.indexOf(e):-1===m.indexOf(e)};c.listItems&&c.listItems.forEach(function(e){e.selected&&u.push(e)}),c.header&&((n=document.createElement("div")).className="bottom-drawer-header titleBarBackgroundTheme",n.innerHTML='<div id="headerText" class="titleBarTextAndIcons"></div><div id="selectAllDiv" class="titleBarTextAndIcons">\n\t\t\t<span id="closeSearch" class="material-icons titleBarTextAndIcons">close</span>\n\t\t\t<div id="checkboxSelectAll" class="checkbox margin-top-zero">\n\t\t\t<input id="selectAllCheckbox" type="checkbox">\n\t\t\t<label style="padding:0" for="selectAllCheckbox"></label>\n\t\t    </div>\n\t\t\t<div id="drawerSearch" class="form-outline"><input type="search" onclick="window.keyboardResize()"class="form-control titleBarTextAndIcons" placeholder="'.concat("Search",'" aria-label="Search" disabled></div>\n\t\t\t<span id="searchIcon" class="material-icons titleBarTextAndIcons">search</span>\n\t\t\t</div>'),c.isHTML?this.sanitize(c.header,n.children[0]):n.children[0].innerText=c.header,c.multiSelection&&c.allowSelectAll&&(n.querySelector("#checkboxSelectAll").style.display="block",(i=n.querySelector("#selectAllCheckbox")).onclick=function(){var e=y.querySelectorAll("input[type=checkbox]");a=!i.checked,u=[],m=[],i.checked?c.listItems&&(u=c.listItems.slice(),L(c.listItems.length),e.forEach(function(e){e.checked=!0})):(u=[],L(),e.forEach(function(e){e.checked=!1}))}),c.enableFilter&&(s={},v=n.querySelector("#closeSearch"),f=n.querySelector("#searchIcon"),S=n.querySelector("#drawerSearch"),g=S.children[0],f.style.display="block",f.onclick=function(){S.classList.add("show-drawer-search"),S.classList.remove("hide-drawer-search"),g.disabled=!1,window.keyboardResize(),g.focus(),n.querySelector("#checkboxSelectAll").style.display="none",n.children[0].classList.add("hide-header-text"),n.children[0].classList.remove("show-header-text"),v.style.display="block"},v.onclick=function(){S.classList.add("hide-drawer-search"),S.classList.remove("show-drawer-search"),n.children[0].classList.remove("hide-header-text"),n.children[0].classList.add("show-header-text"),n.querySelector("#checkboxSelectAll").style.display=c.allowSelectAll&&c.multiSelection?"block":"none",n.children[0].style.display="block",v.style.display="none",S.children[0].value&&(w({target:{value:""}}),g.value=""),g.disabled=!0},g.onkeydown=function(e){var t=e.target;s&&clearTimeout(s),s=setTimeout(function(){return w({target:t})},500)}),y.appendChild(n)),window.stringResource&&c.header&&window.stringResource.getData().then(function(e){y.querySelector("#drawerSearch").children[0].placeholder=e.appSearch||"Search"});var k,w=function(e){var i,s,t,n=e.target;o&&p&&(e=[],s=!(i=!0),n=n.value,0<(t=n?n.toLowerCase().split(/[\s-_():,/\\|]+/g):[]).length?(e=o.filter(function(e){s=!(i=!0);var n=(e.text+" "+(e.secondaryText||"")).toLowerCase().split(/<[^>]+>|[\s-_():,/\\|]+/g);return t.forEach(function(t){t&&(n.forEach(function(e){e.startsWith(t)&&(s=!0)}),i=!(!s||!i),s=!1)}),i}),p.innerHTML="",p.scrollTop=0,x(e,p),_(e)):(p.innerHTML="",p.scrollTop=0,x(o,p),_(o)))};function L(e){var t=y.querySelector("#drawerButton");e?(y.querySelector("#buttonBadge").innerHTML=e,t.classList.remove("disabled-drawer-button"),t.disabled=!1):(y.querySelector("#buttonBadge").innerHTML="",t.classList.add("disabled-drawer-button"),t.disabled=!0)}function x(i,e){var s={};e?s=e:((s=document.createElement("ul")).classList.add("action-list"),s.onclick=function(e){for(var t,n=e.target;"LI"!==n.nodeName;){if("UL"===n.nodeName)return void console.log("Wrong Click");n=n.parentElement}c.multiSelection?(t=n.querySelector("input[type=checkbox]"),"checkbox"!=e.target.type&&(t.checked=!t.checked),function(e,t){{var n;t?(a?u.push(e):(n=m.indexOf(e),m.splice(n,1)),L(Number(y.querySelector("#buttonBadge").innerHTML)+1)):(a?(n=u.indexOf(e),u.splice(n,1)):m.push(e),L(Number(y.querySelector("#buttonBadge").innerHTML)-1))}}(n.item,t.checked)):l(null,n.item)});var o=0;function t(){for(var e,t,n=o;n<o+50&&!(i.length-1<n);n++)i[n]&&i[n].text&&(e=document.createElement("li"),t="",t=!c.autoUseImageCdn||!i[n].imageUrl||i[n].imageUrl.includes("cloudimg.io")||0!==i[n].imageUrl.indexOf("http")||i[n].imageUrl.includes("localhost")?i[n].imageUrl:imageTools.cropImage(i[n].imageUrl,{size:"xs",aspect:"1:1"}),e.innerHTML='<div class="item-icon">\n\t\t\t\t\t\t<img style="display:'.concat(t?"block":"none",'" src="').concat(t||"",'" onerror="this.style.display=\'none\'"></div>\n\t\t\t\t\t\t<div class="action-item-texts">\n\t\t\t\t\t\t<div style="font-weight: bold"></div>\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="display: ').concat(h,' ; margin-left: auto" class="checkbox checkbox-primary margin-top-zero ').concat(i[n].secondaryText?"drawer-checkboxes":"",'"><input type="checkbox"><label style="padding:0"></label></div>'),c.isHTML?(r.sanitize(i[n].text,e.children[1].children[0]),r.sanitize(i[n].secondaryText,e.children[1].children[1])):(e.children[1].children[0].innerText=i[n].text,e.children[1].children[1].innerText=i[n].secondaryText||""),c.multiSelection&&(e.querySelector("input[type=checkbox]").checked=T(i[n])||!1),e.item=i[n],s.appendChild(e));o+=50,console.log("Load Other Items")}if(b&&s.removeEventListener("scroll",b),b=function(){s.scrollTop+s.clientHeight+1e3>=s.scrollHeight&&t()},s.addEventListener("scroll",b),t(),!e){for(var n=0;n<i.length;n++)if(i[n].imageUrl){d=!0;break}return d&&s.classList.add("has-images"),s}}if(c.content&&((k=document.createElement("div")).className="drawer-content",c.listItems||c.tabs||k.classList.add("scrollable-content"),c.isHTML?c.isTrusted?(k.innerHTML=c.content,c.onContentRender&&setTimeout(function(){c.onContentRender()},0)):this.sanitize(c.content,k,function(){c.onContentRender&&setTimeout(function(){c.onContentRender()},0)}):k.innerText=c.content,y.appendChild(k)),c.listItems)o=c.listItems,p=x(c.listItems),y.appendChild(p);else if(c.tabs&&!c.multiSelection){var I=document.createElement("div");I.className="md-tabs-scroll";var A=document.createElement("div");A.classList.add("md-tabs");for(var B=0;B<c.tabs.length;B++){var q=document.createElement("div"),E=document.createElement("div");E.classList.add("active-indicator","titleBarBackgroundTheme"),q.classList.add("btn-tab-drawer-"+B,"md-tab"),0===B&&q.classList.add("active"),c.isHTML?this.sanitize(c.tabs[B].text,q):q.innerText=c.tabs[B].text,q.appendChild(E),A.appendChild(q)}I.appendChild(A);var C=0,M=[],D=I.querySelectorAll(".md-tab");D.forEach(function(t){t.setAttribute("data-tabindex",C),t.onclick=function(){D.forEach(function(e){e.classList.remove("active")}),t.classList.add("active");var e=t.getAttribute("data-tabindex");M.forEach(function(e){e.classList.add("hide")}),M[e].classList.remove("hide"),M[e].items?(o=M[e].items,p=M[e],c.header&&w({target:{value:document.querySelector("#drawerSearch").children[0].value}})):(p=o=null,y.querySelector(".empty-items")&&(y.querySelector(".empty-items").style.display="none"))},C++}),y.appendChild(I);for(var H,U=0;U<c.tabs.length;U++)c.tabs[U].listItems?((H=x(c.tabs[U].listItems)).items=c.tabs[U].listItems,0===U&&(o=c.tabs[U].listItems,p=H),M.push(H)):((H=document.createElement("div")).className="drawer-content",c.isHTML?this.sanitize(c.tabs[U].content,H):H.innerText=c.tabs[U].content,M.push(H)),0<U&&M[U].classList.add("hide"),y.appendChild(M[M.length-1])}function _(e){var t;y.querySelector(".empty-items")||((t=document.createElement("IMG")).src=window._appRoot+"media/ic_bookmark_empty.svg",t.classList.add("empty-items"),y.appendChild(t)),e&&0===e.length?y.querySelector(".empty-items").style.display="block":y.querySelector(".empty-items").style.display="none"}(c.listItems||c.tabs&&c.tabs[0]&&c.tabs[0].listItems)&&_(c.listItems||c.tabs&&c.tabs[0]&&c.tabs[0].listItems),c.multiSelection&&((k=document.createElement("DIV")).id="drawerButtonDiv",(I=document.createElement("BUTTON")).id="drawerButton",I.type="button",I.classList.add("btn","btn-".concat(c.multiSelectionActionButton.type)),I.innerHTML='<span class="btn-'.concat(c.multiSelectionActionButton.type,'"></span><span id="buttonBadge" class="badge btn-').concat(c.multiSelectionActionButton.type,'"></span>'),c.isHTML?this.sanitize(c.multiSelectionActionButton.text,I.children[0]):I.children[0].innerText=c.multiSelectionActionButton.text,k.appendChild(I),y.appendChild(k),y.querySelector("#drawerButton").onclick=function(){e.closeDrawer(),l(null,(a||m.forEach(function(e){e=u.indexOf(e);u.splice(e,1)}),u))},L(u.length)),this.closeDrawer({force:!0}),(document.querySelector("#emulatorContainer #app")||document.body).appendChild(t),!c.tabs||c.multiSelection||c.listItems||setTimeout(function(){e.scrollBooster=new ScrollBooster({viewport:t.querySelector(".md-tabs-scroll"),content:t.querySelector(".md-tabs"),scrollMode:"native",direction:"horizontal"}),setTimeout(function(){e.scrollBooster&&e.scrollBooster.updateMetrics()},1e3),setTimeout(function(){e.scrollBooster&&e.scrollBooster.updateMetrics()},3e3)},0)},showToastMessage:function(e,t){var n=this;e=e||{};var i=document.getElementById(this.SNACKBAR_UI_ID);i.querySelector(".snackbar-message").innerText=e.text;var s=i.querySelector(".snackbar");e.type||(e.type="info"),s.className="snackbar ".concat(e.type+"BackgroundTheme");var o=i.querySelector(".snackbar-actions"),s=o.querySelector(".snackbar-action");e.action&&e.action.title?(s.querySelector("span").innerText=e.action.title,s.classList.remove("hide"),s.onclick=function(){t&&t(null,e.action)}):s.classList.add("hide"),e.hideDismiss?o.querySelector(".dismiss").classList.add("hide"):(o.querySelector(".dismiss").classList.remove("hide"),o.querySelector(".dismiss").onclick=function(){n.closeToastMessage({force:!0})}),i.classList.remove("hide"),i.querySelector(".snackbar").classList.add("open"),this.closeToastMessage(e)},closeToastMessage:function(e,t){(e=e||{}).duration||(e.duration=8e3);var n=document.getElementById(this.SNACKBAR_UI_ID);e.force?(n.querySelector(".snackbar").classList.remove("closing"),n.querySelector(".snackbar").classList.remove("open"),setTimeout(function(){n.classList.add("hide")},250)):(n.querySelector(".snackbar").classList.add("closing"),this.timeOutId&&clearTimeout(this.timeOutId),this.timeOutId=setTimeout(function(){n.querySelector(".snackbar").classList.remove("closing"),n.querySelector(".snackbar").classList.remove("open"),setTimeout(function(){n.classList.add("hide")},250),this.timeOutId=null},e.duration))}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var imageTools={get ENUMS(){return{SIZES:{xxs:32,xs:64,s:128,m:200,l:304,xl:416,xxl:600,720:720,1080:1080,1440:1440,1920:1920,2560:2560,3840:3840,get full_width(){return this.findNearest(1)},get half_width(){return this.findNearest(2)},get third_width(){return this.findNearest(3)},get fourth_width(){return this.findNearest(4)},get fifth_width(){return this.findNearest(5)},get sixth_width(){return this.findNearest(6)},findNearest:function(t){for(var i=null,e=0;e<this.VALID_SIZES.length;e++){var n=this.VALID_SIZES[e];if(window.innerWidth/t<this[n]){i=n;break}}return this[i]},VALID_SIZES:["xxs","xs","s","m","l","xl","xxl","720","1080","1440","1920","2560","3840","full_width","half_width","third_width","quarter_width","fifth_width","sixth_width"]},ASPECT_RATIOS:{"1:1":1,"4:3":.75,"16:9":.5625,"9:16":1.77777778,"11:5":.45454545,"4:1":.25,"2.39:1":.41841004,VALID_RATIOS:["1:1","4:3","16:9","9:16","11:5","4:1","2.39:1"]}}},resizeImage:function(t,i,e,n){if(!t)return null;if(t&&t.indexOf&&(-1<t.indexOf("://localhost:")||-1<t.indexOf("cdvfile://"))||-1<t.indexOf("file://"))return t;if(/\..{3,4}(?!.)/g.test(t)&&!/.(png|jpg|jpeg)(?!.)/gi.test(t)){var r=(/.{0,4}(?!.)/g.exec(t)||["Selected"])[0];return console.warn(r+" files are not supported by resizeImage. Returning original URL: "+t),t}if(i){if("object"!=_typeof(i))throw"options not an object"}else i={width:window.innerWidth};var o=i.disablePixelRation?1:window.devicePixelRatio;o<1&&(o=1),"full"==i.width&&(i.width=window.innerWidth),"full"==i.height&&(i.height=window.innerHeight);var a=window.siteConfig.endPoints.cloudImageHost,r=-1!==t.indexOf("?"),r=a+"/"+t+(r?"&":"?")+"func=bound";if(i.size&&i.aspect){if(this.ENUMS.SIZES.VALID_SIZES.indexOf(i.size)<0){var h=this.ENUMS.SIZES.VALID_SIZES.join(", ");return console.warn("Inavlid size. Availible options are "+h+". Returning original url"),t}if(this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.indexOf(i.aspect)<0){h=this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.join(", ");return console.warn("Inavlid aspect ratio. Availible options are "+h+". Returning original url"),t}i.width=this.ENUMS.SIZES[i.size],i.height=i.width*this.ENUMS.ASPECT_RATIOS[i.aspect]}return i.width&&!i.height?r+="&width="+Math.floor(i.width*o):!i.width&&i.height?r+="&height="+Math.floor(i.height*o):i.width&&i.height?r+="&width="+Math.floor(i.width*o)+"&height="+Math.floor(i.height*o):r=t,this._handleElement(e,r,n),r},cropImage:function(t,i,e,n){if(!t)return null;if(t&&t.indexOf&&(-1<t.indexOf("://localhost:")||-1<t.indexOf("cdvfile://"))||-1<t.indexOf("file://"))return t;if(/\..{3,4}(?!.)/g.test(t)&&!/.(png|jpg|jpeg)(?!.)/gi.test(t)){var r=(/.{0,4}(?!.)/g.exec(t)||["Selected"])[0];return console.warn(r+" files are not supported by cropImage. Returning original URL: "+t),t}if("object"!=_typeof(i=i||{}))throw"options not an object";if(i.size&&i.aspect){if(this.ENUMS.SIZES.VALID_SIZES.indexOf(i.size)<0){var o=this.ENUMS.SIZES.VALID_SIZES.join(", ");return console.warn("Inavlid size. Availible options are "+o+". Returning original url"),t}if(this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.indexOf(i.aspect)<0){var a=this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.join(", ");return console.warn("Inavlid aspect ratio. Availible options are "+a+". Returning original url"),t}i.width=this.ENUMS.SIZES[i.size],i.height=i.width*this.ENUMS.ASPECT_RATIOS[i.aspect]}if("full"==(i=!i.width&&!i.height?{width:"full",height:"full"}:i).width&&(i.width=window.innerWidth),"full"==i.height&&(i.height=window.innerHeight),!i.width||!i.height)return console.warn("cropImage doenst have width or height please fix. returning original url"),t+"?h="+i.height+"&w="+i.width;r=window.devicePixelRatio;i&&i.disablePixelRatio&&(r=i.disablePixelRatio);o=window.siteConfig.endPoints.cloudImageHost,a=-1!==t.indexOf("?"),t=o+"/"+t+(a?"&":"?")+"func=crop",a=Math.floor(i.width*r),r=Math.floor(i.height*r);return this._handleElement(e,t+="&width="+a+"&height="+r,n),t},_handleElement:function(e,n,t){var i;e&&n&&(i=this._getLocalPath(n),"IMG"===e.tagName?(e.style.setProperty("opacity","0","important"),e.src=i,e.onload=function(){e.style.removeProperty("opacity"),t&&t(i)},e.onerror=function(){bfUtils.isApp&&imageCacheAPI.download(n,function(t,i){return t?e.src=n:void(e.src=i)})}):this._handleBgImage(e,i,n,t))},_handleBgImage:function(e,t,n,r){o(e,t);var i=new Image;function o(t,i){if(!i)return t.style.removeProperty("background-image");t.style.setProperty("background-image",'url("'+i+'")',"important")}i.src=t,i.onload=function(){r&&r(t)},i.onerror=function(){if(o(e),!bfUtils.isApp)return o(e,n);imageCacheAPI.download(n,function(t,i){return t?(r&&r(n),o(e,n)):void window.requestAnimationFrame(function(){o(e,i),r&&r(i)})})}},_getLocalPath:function(t){if(!bfUtils.isApp)return t;var i=(i=(t=t.replace(/(http|https):\/\/\S{0,8}.cloudimg.io\//g,"")).match(/(png|jpg|jpeg)/g)[0]||"")?"."+i:"",e=0;if(!t.length)return e;for(var n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n);e|=0}return"".concat(window._appRoot.replace("app","imageCache/images")).concat(e).concat(i)},isProdImageServer:function(t){return 0==t.indexOf("http://imageserver.prod.s3.amazonaws.com")||0==t.indexOf("https://imageserver.prod.s3.amazonaws.com")||0==t.indexOf("https://s3-us-west-2.amazonaws.com/imageserver.prod")}};
"use strict";function DialogAPI(t){this.context=t,this.componentUI=null}DialogAPI.prototype={confirm:function(n,i){var o=this;(n=n||{}).message?(n.title||(n.title="Are you sure?"),n.confirmButton||(n.confirmButton={text:"Confirm"}),n.cancelButtonText||(n.cancelButtonText="Cancel"),n.isMessageHTML?window.bfUtils.sanitize({data:n.message},function(t,e){return t?(i&&i(t,null),console.error(t)):void(e&&(n.message=e,o._confirm(n,i)))}):(n.isMessageHTML=!1,this._confirm(n,i))):i("invalid parameter, missing message",null)},_confirm:function(n,i){var t={title:n.title,subtitle:n.subtitle,richContent:"".concat(n.message),isContentHTML:n.isMessageHTML,action:{title:n.confirmButton.text,type:n.confirmButton.type||"primary"},dismissButtonText:n.cancelButtonText,forceAction:!0};richModal.display(t,function(t,e){if(i)return t?i(t):e&&e.selectedButton?e.selectedButton.text==n.confirmButton.text?i(null,!0):i(null,!1):e&&"action"===e.buttonType?i(null,!0):i(null,!1)})},alert:function(n,i){var o=this;(n=n||{}).message?(n.title||(n.title="Alert"),n.okButtonText||(n.okButtonText="OK"),n.isMessageHTML?window.bfUtils.sanitize({data:n.message},function(t,e){return t?(i&&i(t,null),console.error(t)):void(e&&(n.message=e,o._alert(n,i)))}):(n.isMessageHTML=!1,this._alert(n,i))):i("invalid parameter, missing message",null)},_alert:function(t,e){t={title:t.title,subtitle:t.subtitle,richContent:"".concat(t.message),isContentHTML:t.isMessageHTML,action:{title:t.okButtonText,type:"primary"},showDismissButton:!1};richModal.display(t,function(t){return e(t)})},show:function(n,i){var o=this;if((n=n||{}).title)return n.actionButtons&&n.actionButtons.length?(n.message||(n.message=""),n.cancelButtonText||(n.cancelButtonText="Cancel"),n.design&&n.design.backgroundColor&&!n.design.textColor?i("'textColor' is required when 'backgroundColor' is present",null):n.design&&n.design.textColor&&!n.design.backgroundColor?i("'backgroundColor' is required when 'textColor' is present",null):void(n.isMessageHTML?window.bfUtils.sanitize({data:n.message},function(t,e){return t?(i&&i(t,null),console.error(t)):void(e&&(n.message=e,o._show(n,i)))}):(n.isMessageHTML=!1,this._show(n,i)))):i("`actionButtons` are required",null);i("invalid parameter, missing title",null)},_show:function(t,i){t={title:t.title,subtitle:t.subtitle,richContent:"".concat(t.message),action:t.actionButtons.map(function(t){var e=t.text,n=t.type;return{title:e,handler:function(){i(null,{selectedButton:{text:e,type:n}})},type:n}}),showDismissButton:t.showCancelButton,dismissButtonText:t.cancelButtonText||"Cancel",forceAction:t.forceAction,design:t.design,isContentHTML:t.isMessageHTML};richModal.display(t,function(t,e){return t?i(t):(e&&"dismiss"===e.buttonType&&(e.buttonType="cancel"),e&&e.value&&(e.value={text:e.value.title,action:e.value.handler}),i(null,e))})},hide:function(){richModal.close()},toast:function(t,n){var e,i=this;this.componentUI||(this.componentUI=new ComponentUIAPI(this.context)),(t=t||{}).message&&(t.message=t.message.trim()),t.message?(e={text:t.message,hideDismiss:t.hideDismissButton,duration:t.duration,type:t.type},t.actionButton&&(e.action={title:t.actionButton.text,action:t.actionButton.action}),this.componentUI.showToastMessage(e,function(t,e){return t?n(t):(e&&e.action&&"function"==typeof e.action&&(e.action(),i.componentUI.closeToastMessage({force:!0})),n(t,e))})):n("invalid parameter, missing message",null)}};
"use strict";var permissionRequestsAPI={appId:"guest",init:function(){var i=permissionRequestsAPI;appContext&&appContext.currentApp&&appContext.currentApp.appId&&(i.appId=window.appContext.currentApp.appId),bfUtils.isAndroid&&(i.ds=new DatastoreAPI(i.appId,"stringResources",1,0,appContext.currentApp.keys.datastoreKey),i.ds.get({},function(e,t){return e?console.error(e):void(t&&t.data&&t.data.appPermissions?i.appPermissionStrings=t.data.appPermissions:localStorage.getItem("geo-declaration-required")&&(i.appPermissionStrings.background_location={android:{title:"App would like to use Background Location",content:"This app collects location data to enable showing your position on the map, getting directions, estimating travel times and other location based features even when the app is closed or not in use",actionBtn:"OK",isActive:!0}}))}))},appPermissionStrings:{},showPermissionDelcaration:function(e){var t=this,i=this.appPermissionStrings[e].android,n=i.title,o=i.content,i=i.actionBtn;richModal.display({title:n,richContent:o,showDismissButton:!1,forceAction:!0,action:{title:i,handler:function(){t.setDeclarationShown(e),t.executeQueuedRequests(e)}}})},shouldShowDeclaration:function(e){if(!bfUtils.isAndroid)return!1;if(this.declarationTypes.indexOf(e)<0)return!1;if(!this.appPermissionStrings||!this.appPermissionStrings[e]||!this.appPermissionStrings[e].android)return!1;var t=this.declarationShown(e),e=this.appPermissionStrings[e].android.isActive;return!t&&e},declarationShown:function(e){if(this.declarationTypes.indexOf(e)<0)return!1;e=this.ENUMS[e].APP_DECLARATION_SHOWN;return localStorage.getItem("".concat(this.appId).concat(e))},setDeclarationShown:function(e){var t=this.ENUMS[e].APP_DECLARATION_SHOWN;return localStorage.setItem("".concat(this.appId).concat(t),!0),"background_location"===e?this.setDeclarationShown("location"):"camera"===e?this.setDeclarationShown("photo_library"):void 0},queueMap:{},queueRequest:function(e,t,i){if(!this.shouldShowDeclaration(e))return this.executeRequest(t,i);this.queueMap[e]=this.queueMap[e]||[],this.queueMap[e].push({context:t,method:i}),this.queueMap[e]&&1===this.queueMap[e].length&&this.showPermissionDelcaration(e)},executeRequest:function(e,t){t.apply(e)},executeQueuedRequests:function(e){var i=this;(this.queueMap[e]||[]).forEach(function(e){var t=e.context,e=e.method;i.executeRequest(t,e)}),this.queueMap[e]=[]},get declarationTypes(){return Object.keys(this.ENUMS)},get ENUMS(){return{background_location:{APP_DECLARATION_SHOWN:"-geo-location-perm-request"},location:{APP_DECLARATION_SHOWN:"-location-perm-request"},camera:{APP_DECLARATION_SHOWN:"-camera-perm-request"},calendar:{APP_DECLARATION_SHOWN:"-calendar-perm-request"},photo_library:{APP_DECLARATION_SHOWN:"-photo_lib-perm-request"},contacts:{APP_DECLARATION_SHOWN:"-contacts-perm-request"},microphone:{APP_DECLARATION_SHOWN:"-microphone-perm-request"}}}};bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},permissionRequestsAPI.init);
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function HealthAPI(e){this.context=e}HealthAPI.prototype={get mockMode(){return!(window.hasOwnProperty("navigator")&&navigator.health)},requestAuthorization:function(e,t){return"function"!=typeof t&&(t=console.error),e&&e.length?this.mockMode?t(null):void navigator.health.requestAuthorization(e,t,t):t("requestAuthorization:: dataTypes must be an array")},query:function(e,t){return"function"!=typeof t&&(t=console.error),e&&"object"===_typeof(e)?e.dataType&&"string"==typeof e.dataType?!e.startDate||["object","number"].indexOf(_typeof(e.startDate))<0?t("query:: options.startDate is required and must be an object or a number"):(e.endDate||(e.endDate=new Date),["object","number"].indexOf(_typeof(e.endDate))<0?t("query:: options.endDate must be an object or a number"):e.limit&&"number"!=typeof e.limit?t("query:: options.limit must be a number"):this.mockMode?t(null):void navigator.health.query(e,function(e){return t(null,e)},t)):t("query:: options.dataType is required and must be a string"):t("query:: options are required")},queryAggregated:function(e,t){return"function"!=typeof t&&(t=console.error),e&&"object"===_typeof(e)?e.dataType&&"string"==typeof e.dataType?!e.startDate||["object","number"].indexOf(_typeof(e.startDate))<0?t("query:: options.startDate is required and must be an object or a number"):(e.endDate||(e.endDate=new Date),["object","number"].indexOf(_typeof(e.endDate))<0?t("query:: options.endDate must be an object or a number"):e.bucket&&"string"!=typeof e.bucket?t("query:: options.bucket must be a number"):e.bucket&&["hour","day","week","month","year"].indexOf(e.bucket)<0?t("query:: invalid value for options.bucket. Accepted values: hour day week month, year"):this.mockMode?t(null):void navigator.health.queryAggregated(e,function(e){return t(null,e)},t)):t("query:: options.dataType is required and must be a string"):t("query:: options are required")}};