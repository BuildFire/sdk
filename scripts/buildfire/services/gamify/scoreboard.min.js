if("undefined"==typeof buildfire)throw"please add buildfire.js first to use BuildFire services";buildfire.gamify||(buildfire.gamify={}),buildfire.gamify.Scoreboard=function(e,i,t){this.size=i||10,this.autoSubscribeToPushNotification=t,this.size<1&&(this.size=10),this.tagName=e||"scoreboard",this.pushGroupName="scoreboard_"+this.tagName},buildfire.gamify.Scoreboard.prototype={size:10,getScoreboard:function(t){buildfire.publicData.get(this.tagName,function(e,i){e?t(e):i.data.topScores?t(void 0,i.data):t(void 0,{gamesPlayed:0,topScores:[]})})},reset:function(){buildfire.publicData.save({gamesPlayed:0,topScores:[]},this.tagName,function(){})},_PNEnabled:function(){return buildfire.notifications&&buildfire.notifications.pushNotification},subscribe:function(i){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.subscribe({groupName:this.pushGroupName},function(e){e&&console.error(e),i&&i(e)}),!0)},unsubscribe:function(i){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.unsubscribe({groupName:this.pushGroupName},function(e){e&&console.error(e),i&&i(e)}),!0)},logScore:function(n,c,d){this.autoSubscribeToPushNotification&&!this.subscribe()&&console.warn("Cannot subscribe to scoreboard push notifications because buildfire push notification services is not attached");var f=this,l=new Date;buildfire.publicData.get(this.tagName,function(e,i){function t(e){e&&d(e)}var o,a,s={user:n,score:c,createdOn:l},r={gamesPlayed:0,topScores:[s]};if(e)d(e);else if(i)if(i.data.topScores){i.data.topScores.length>f.size&&i.data.topScores[f.size-1].score>c&&d(),(r=i.data).topScores.push(s),r.topScores=r.topScores.sort(function(e,i){return i.score-e.score}),r.topScores.length>f.size&&(o=r.topScores.pop()),r.gamesPlayed++,buildfire.publicData.update(i.id,r,f.tagName,t);for(var u=0;u<r.topScores.length;u++)if(r.topScores[u].createdOn==l){a=u;break}e={bumpedOff:o,rankedAt:a};f._PNEnabled()&&(e.bumpedOff&&e.bumpedOff.user.email!=n.email&&buildfire.notifications.pushNotification.schedule({title:"You got kicked off !!!",text:"Your old score is no longer on the top 10. "+n.displayName+" has taken your spot. Honestly, I dont know how you sleep at night.",users:[e.bumpedOff.user.id]},t),0==a&&buildfire.notifications.pushNotification.schedule({title:"There is a new champion!",text:n.displayName+" has taken the lead at the new undisputed champion with a score of "+c,groupName:f.pushGroupName},t),1==a&&buildfire.notifications.pushNotification.schedule({title:"There is a challenger to the champion",text:n.displayName+" has taken 2nd place with a score of "+c+". Watch out "+r.topScores[0].user.displayName,groupName:f.pushGroupName},t),2==a&&buildfire.notifications.pushNotification.schedule({title:"There is a kid in town!",text:n.displayName+" has taken 3rd place. Keep an eye on this one",groupName:f.pushGroupName},t)),d(null,e)}else r.gamesPlayed++,buildfire.publicData.save(r,f.tagName,t);else r.gamesPlayed++,buildfire.publicData.save(r,f.tagName,t),d(null,{rankedAt:0})})}};
//# sourceMappingURL=scoreboard.min.js.map
