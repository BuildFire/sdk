!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(Jd){"use strict";try{(function(){Jd=Jd&&Jd.hasOwnProperty("default")?Jd.default:Jd;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,e,f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(o,s,a,u){return new(a=a||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,s||[])).next())})}function y(n,r){var i,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(e=o=o||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,a(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var i=o.INFO,u=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.ERROR],t))},h);function h(t){this.name=t,this._logLevel=i,this._logHandler=n}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var c,d=(t(v,c=Error),v);function v(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(g.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,r){return t.replace(w,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new d(i,a),h=0,c=Object.keys(r);h<c.length;h++){var f=c[h];"_"!==f.slice(-1)&&(f in u&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),u[f]=r[f])}return u},g);function g(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,b=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},T=T||{},A=N;function S(t){return"string"==typeof t}function k(t){return"number"==typeof t}function D(t,e){t=t.split("."),e=e||A;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function R(){}function _(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){return"array"==_(t)}function C(t){var e=_(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),L=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:U).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var G=Date.now||function(){return+new Date};function j(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function F(){this.j=this.j,this.i=this.i}F.prototype.j=!1,F.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[P]||(this[P]=++L)},F.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(S(t))return S(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=S(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function J(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Y,X=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function K(t,e){return t<e?-1:e<t?1:0}t:{var $=A.navigator;if($){var Z=$.userAgent;if(Z){Y=Z;break t}}Y=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=R;var ot,st,at=Q(Y,"Opera"),ut=Q(Y,"Trident")||Q(Y,"MSIE"),ht=Q(Y,"Edge"),ct=ht||ut,ft=Q(Y,"Gecko")&&!(Q(Y.toLowerCase(),"webkit")&&!Q(Y,"Edge"))&&!(Q(Y,"Trident")||Q(Y,"MSIE"))&&!Q(Y,"Edge"),lt=Q(Y.toLowerCase(),"webkit")&&!Q(Y,"Edge");function pt(){var t=A.document;return t?t.documentMode:void 0}t:{var dt="",yt=(st=Y,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):at?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(yt&&(dt=yt?yt[1]:""),ut){var vt=pt();if(null!=vt&&vt>parseFloat(dt)){ot=String(vt);break t}}ot=dt}var mt,gt={};function wt(a){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(a,function(){for(var t=0,e=X(String(ot)).split("."),n=X(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=K(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||K(0==o[2].length,0==s[2].length)||K(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t})}var bt=A.document;mt=bt&&ut?pt()||("CSS1Compat"==bt.compatMode?parseInt(ot,10):5):void 0;var Et=!ut||9<=Number(mt),It=ut&&!wt("9"),Nt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",R,e),A.removeEventListener("test",R,e)}catch(t){}return t}();function Tt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function At(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=S(t.pointerType)?t.pointerType:St[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Tt.prototype.b=function(){this.Ia=!1},j(At,Tt);var St={2:"touch",3:"pen",4:"mouse"};At.prototype.b=function(){At.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var kt="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Rt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Dt,this.X=this.Z=!1}function _t(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function xt(t){this.src=t,this.a={},this.b=0}function Ct(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=B(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Rt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Mt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(x(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Ht(r);return e&&e[kt]?e.Aa(n,r,O(i)?!!i.capture:!!i,o):Ut(e,n,r,!0,i,o)}(t,e,n,r,i);if(x(e)){for(var o=0;o<e.length;o++)Mt(t,e[o],n,r,i);return null}return n=Ht(n),t&&t[kt]?t.za(e,n,O(r)?!!r.capture:!!r,i):Ut(t,e,n,!1,r,i)}function Ut(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!Et)return null;var a=Ft(t);if(a||(t[Pt]=a=new xt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var e=jt,n=Et?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Nt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qt(t){if(!k(t)&&t&&!t.X){var e=t.src;if(e&&e[kt])Ct(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Ct(n,t),0==n.b&&(n.src=null,e[Pt]=null)):_t(t)}}}function Vt(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function Gt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&qt(t),n.call(r,e)}function jt(t,e){return!!t.X||(Et?Gt(t,new At(e,this)):Gt(t,e=new At(e||D("window.event"),this)))}function Ft(t){return(t=t[Pt])instanceof xt?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ht(e){return"function"==_(e)?e:(e[Bt]||(e[Bt]=function(t){return e.handleEvent(t)}),e[Bt])}function zt(){F.call(this),this.c=new xt(this),(this.J=this).B=null}function Jt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Ct(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ia}j(zt,F),zt.prototype[kt]=!0,(I=zt.prototype).addEventListener=function(t,e,n,r){Mt(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(x(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Ht(r),e&&e[kt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ot(s=e.a[n],r,i,o))&&(_t(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Ot(n,r,i,o)),(r=-1<e?n[e]:null)&&qt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(S(t))t=new Tt(t,n);else if(t instanceof Tt)t.target=t.target||n;else{var i=t;rt(t=new Tt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Jt(s,r,!0,t)&&i}if(i=Jt(s=t.a=n,r,!0,t)&&i,i=Jt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Jt(s=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(zt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Wt=A.JSON.stringify;function Yt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Xt(){this.b=this.a=null}Yt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Qt,Kt=new Yt(function(){return new $t},function(t){t.reset()});function $t(){this.next=this.b=this.a=null}function Zt(t){A.setTimeout(function(){throw t},0)}function te(t,e){Qt||function(){var t=A.Promise.resolve(void 0);Qt=function(){t.then(re)}}(),ee||(Qt(),ee=!0),ne.add(t,e)}Xt.prototype.add=function(t,e){var n=Kt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ee=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ne=new Xt;function re(){for(var t;r=n=void 0,r=null,(n=ne).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Zt(t)}var e=Kt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ee=!1}function ie(t,e){zt.call(this),this.b=t||1,this.a=e||A,this.f=q(this.gb,this),this.g=G()}function oe(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function se(t,e,n){if("function"==_(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function ae(t,e,n){F.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function ue(t){t.U=se(t.b,t.c),t.f.apply(null,t.a)}function he(t){F.call(this),this.b=t,this.a={}}j(ie,zt),(I=ie.prototype).ba=!1,I.L=null,I.gb=function(){if(this.ba){var t=G()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(oe(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=G())},I.G=function(){ie.N.G.call(this),oe(this),delete this.a},j(ae,F),(I=ae.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ue(this)},I.G=function(){ae.N.G.call(this),this.U&&(A.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,ue(this))},j(he,F);var ce=[];function fe(t,e,n,r){x(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=Mt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function pe(){}he.prototype.G=function(){he.N.G.call(this),le(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=new zt;function ye(t){Tt.call(this,"serverreachability",t)}function ve(t){de.dispatchEvent(new ye(de,t))}function me(t){Tt.call(this,"statevent",t)}function ge(t){de.dispatchEvent(new me(de,t))}function we(t){Tt.call(this,"timingevent",t)}function be(t,e){if("function"!=_(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}j(ye,Tt),j(me,Tt),j(we,Tt);var Ee={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,La:7,TIMEOUT:8,sb:9},Ie={jb:"complete",wb:"success",Ma:"error",La:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Ne(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function Ae(){}Ne.prototype.a=null;var Se,ke={OPEN:"a",ib:"b",Ma:"c",rb:"d"};function De(){Tt.call(this,"d")}function Re(){Tt.call(this,"c")}function _e(){}function xe(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new he(this),this.O=Ce,t=ct?125:void 0,this.P=new ie(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}j(De,Tt),j(Re,Tt),j(_e,Ne),Se=new _e;var Ce=45e3,Oe={},Pe={};function Le(t,e,n){t.F=1,t.f=an(Ze(e)),t.l=n,t.H=!0,Ue(t,null)}function Me(t,e,n,r){t.F=1,t.f=an(Ze(e)),t.l=null,t.H=n,Ue(t,r)}function Ue(t,e){t.v=G(),Ge(t),t.D=Ze(t.f),sn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ae(q(t.Ja,t,t.a),t.J)),fe(t.I,t.a,"readystatechange",t.cb),e=t.h?et(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ve(1)}function qe(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ve(t,n);if(i==Pe){4==e&&(t.c=4,ge(14),r=!1);break}if(i==Oe){t.c=4,ge(15),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(He(t),Be(t))}function Ve(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Oe:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.A=r+n,e))}function Ge(t){t.R=G()+t.O,je(t,t.O)}function je(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=be(q(t.ab,t),e)}function Fe(t){t.i&&(A.clearTimeout(t.i),t.i=null)}function Be(t){t.g.Ca()||t.m||t.g.na(t)}function He(t){Fe(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,oe(t.P),le(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function ze(t,e){try{t.g.Fa(t,e),ve(4)}catch(t){}}function Je(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||S(t))H(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(C(t)||S(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(S(t))return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function We(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof We)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ye(t,e){Qe(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Xe(t))}function Xe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Qe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=xe.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==Zn(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=Zn(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ct&&!this.a.aa())){this.m||4!=e||7==n||ve(8==n||r<=0?3:2),Fe(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=tr(this.a,"X-HTTP-Initial-Response");if(s&&!W(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),He(this),Be(this);break t}this.s=!0,ze(this,a)}this.H?(qe(this,e,o),ct&&this.b&&3==e&&(fe(this.I,this.P,"tick",this.bb),this.P.start())):ze(this,o),4==e&&He(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Ge(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),He(this),Be(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=Zn(this.a),e=this.a.aa();this.A<e.length&&(Fe(this),qe(this,t,e),this.b&&4!=t&&Ge(this))}},I.cancel=function(){this.m=!0,He(this)},I.ab=function(){this.i=null;var t=G();0<=t-this.R?(2!=this.F&&(ve(3),ge(17)),He(this),this.c=2,Be(this)):je(this,this.R-t)},(I=We.prototype).C=function(){Xe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return Xe(this),this.a.concat()},I.get=function(t,e){return Qe(this.b,t)?this.b[t]:e},I.set=function(t,e){Qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ke=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $e?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,En(t.c)),this.g=t.g):t&&(n=String(t).match(Ke))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=un(n[7]||"")):(this.h=!!e,this.c=new vn(null,this.h))}function Ze(t){return new $e(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){e instanceof vn?(t.c=e,function(t,e){e&&!t.f&&(mn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),bn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=hn(e,dn)),t.c=new vn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function sn(t,e,n){x(n)||(n=[String(n)]),bn(t.c,e,n)}function an(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^G()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return S(t)?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,fn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",hn(n,yn)),t.join("")},$e.prototype.resolve=function(t){var e=Ze(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Q(i,"./")||Q(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,En(t.c)):n=!!t.g,n&&(e.g=t.g),e};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,yn=/#/g;function vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new We,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){mn(t),e=In(t,e),Qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ye(t.a,e))}function wn(t,e){return mn(t),e=In(t,e),Qe(t.a.b,e)}function bn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),J(n)),t.b+=n.length)}function En(t){var e=new vn;return e.c=t.c,t.a&&(e.a=new We(t.a),e.b=t.b),e}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Nn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Tn(t){var e=t.a.F.a;if(null!=e)ge(4),e?(ge(10),lr(t.a,t,!1)):(ge(11),lr(t.a,t,!0));else{t.b=new xe(t,void 0,void 0),t.b.h=t.h,e=mr(e=t.a,e.Y()?t.f:null,t.i),ge(4),sn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),Me(t.b,e,!1,t.f)}}function An(){this.a=this.b=null}function Sn(){this.a=new We}function kn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[P]||(t[P]=++L)):e.charAt(0)+t}function Dn(t,e){this.b=t,this.a=e}function Rn(t){this.g=t||_n,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ka&&A.ka.Da&&A.ka.Da()&&A.ka.Da().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Sn),this.b=null,this.c=[]}(I=vn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){H(t,function(t){n.call(r,t,e,this)},this)},this)},I.K=function(){mn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){mn(this);var e=[];if(S(t))wn(this,t)&&(e=z(e,this.a.get(In(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},I.set=function(t,e){return mn(this),this.c=null,wn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},j(function(){},function(){}),(I=Nn.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void yr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,yr(e,2)}else 1==this.M&&(this.g?ge(6):"11111"==e?(ge(5),this.g=!0,(!ut||10<=Number(mt))&&(this.c=200,this.b.cancel(),ge(11),lr(this.a,this,!0))):(ge(7),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Tn(this)):1==this.M&&(this.g?(ge(11),lr(this.a,this,!0)):(ge(10),lr(this.a,this,!1)));else{0==this.M?ge(8):1==this.M&&ge(9);var t=this.a;t.m=this.c,yr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},Sn.prototype.add=function(t){this.a.set(kn(t),t)},Sn.prototype.C=function(){return this.a.C()};var _n=10;function xn(t,e){!t.a&&(Q(e,"spdy")||Q(e,"quic")||Q(e,"h2"))&&(t.f=t.g,t.a=new Sn,t.b&&(Ln(t,t.b),t.b=null))}function Cn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function On(t){return t.b?1:t.a?t.a.a.c:0}function Pn(t,e){return t=t.b?t.b==e:!!t.a&&(e=kn(e),Qe(t.a.a.b,e))}function Ln(t,e){t.a?t.a.add(e):t.b=e}function Mn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=kn(e),n=Qe(t.a.a.b,n)),n&&Ye(t.a.a,kn(e)))}function Un(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return J(t.c);var e=t.c;return H(t.a.C(),function(t){e=e.concat(t.j)}),e}function qn(){}function Vn(){this.a=new qn}function Gn(t,r,e){var i=e||"";try{Je(t,function(t,e){var n=t;O(t)&&(n=Wt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function jn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Rn.prototype.cancel=function(){this.c=Un(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(H(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},qn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Fn=A.JSON.parse;function Bn(t){zt.call(this),this.headers=new We,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Hn,this.D=this.F=!1}j(Bn,zt);var Hn="",zn=/^https?$/i,Jn=["POST","PUT"];function Wn(t){return"content-type"==t.toLowerCase()}function Yn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Xn(t),Kn(t)}function Xn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Qn(t){if(t.b&&void 0!==T&&(!t.s[1]||4!=Zn(t)||2!=t.T()))if(t.l&&4==Zn(t))se(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Zn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Ke)[1]||null;if(!o&&A.self&&A.self.location){var s=A.self.location.protocol;o=s.substr(0,s.length-1)}i=!zn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Zn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",Xn(t)}}finally{Kn(t)}}}function Kn(t,e){if(t.a){$n(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Zn(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return tt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),S(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new An,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!D("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=D("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=D("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=D("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=D("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Rn(t&&t.concurrentRequestLimit),this.ja=new Vn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=Ze(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ur(t,n),(e=new xe(t,e,void 0)).F=2,e.f=an(Ze(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.f.toString(),"")),!n&&A.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=G(),Ge(e)}vr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(A.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(k(t.h)&&A.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new Dn(t.Qa++,e)),3==t.u&&sr(t)}function sr(t){Cn(t.b)||t.h||(t.h=!0,te(t.Ha,t),t.A=0)}function ar(t,e){var n;n=e?e.W:t.P++;var r=Ze(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ur(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new xe(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ln(t.b,n),Le(n,r,e)}function ur(t,n){t.c&&Je({},function(t,e){on(n,e,t)})}function hr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?q(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var h=i[u].b,c=i[u].a;if((h-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{Gn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function cr(t){t.a||t.l||(t.S=1,te(t.Ga,t),t.v=0)}function fr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=be(q(t.Ga,t),dr(t,t.v)),t.v++,!0)}function lr(t,e,n){var r=e.l;r&&xn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=mr(t,null,t.ha),sr(t)}function pr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function yr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=q(t.eb,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||tn(n,"https"),an(n)),function(t,e){var n=new pe;if(A.Image){var r=new Image;r.onload=V(jn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(jn,n,r,"TestLoadImage: error",!1,e),r.onabort=V(jn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(jn,n,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.ta(e),vr(t),ir(t)}function vr(t){t.u=0,t.m=-1,t.c&&(0==Un(t.b).length&&0==t.f.length||(t.b.c.length=0,J(t.f),t.f.length=0),t.c.sa())}function mr(t,e,n){var r=function(t){return t instanceof $e?Ze(t):new $e(t,void 0)}(n);if(""!=r.b)e&&en(r,e+"."+r.b),nn(r,r.i);else{var i,o=A.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new $e(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&tt(t.V,function(t,e){on(r,e,t)}),e=t.j,n=t.I,e&&n&&on(r,e,n),on(r,"VER",t.wa),ur(t,r),r}function gr(){}function wr(){if(ut&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function br(t,e){zt.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.fb?e.fb:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Nr(this)}function Er(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Re.call(this),this.status=1}function Nr(t){this.a=t}(I=Bn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Te(this.H):Te(Se),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Yn(this,t)}t=n||"";var i=new We(this.headers);r&&Je(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Wn,n=t.length,r=S(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:S(t)?t.charAt(e):t[e]}(i.K()),n=A.FormData&&t instanceof A.FormData,0<=B(Jn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$n(this),0<this.o&&((this.D=function(t){return ut&&wt(9)&&k(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=se(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Yn(this,t)}},I.Ba=function(){void 0!==T&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Kn(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Kn(this,!0)),Bn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Qn(this):this.Za())},I.Za=function(){Qn(this)},I.T=function(){try{return 2<Zn(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Fn(e)}},I.ya=function(){return this.h},I.Xa=function(){return S(this.f)?this.f:String(this.f)},(I=nr.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new xe(this,t,void 0),r=this.i;if(this.J&&(r?rt(r=et(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&S(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=hr(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ur(this,i),this.g&&r&&er(i,this.g,r),Ln(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,Le(n,i,null)):Le(n,i,e),this.u=2}}else 3==this.u&&(t?ar(this,t):0==this.f.length||Cn(this.b)||ar(this))},I.Ga=function(){this.l=null,this.a=new xe(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ze(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ur(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Me(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Pn(this.b,t)))if(this.m=t.o,!t.s&&Pn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(x(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}fr(this),ge(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=be(q(this.Ya,this),6e3));if(On(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else yr(this,11)}else if(!t.s&&this.a!=t||pr(this),!W(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&k(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&xn(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=mr(this,this.Y()?this.ga:null,this.ha),r.s?(Mn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Fe(r),Ge(r)),this.a=r):cr(this),0<this.f.length&&sr(this)}else"stop"!=r[0]&&"close"!=r[0]||yr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?yr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,fr(this),ge(19))},I.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!Pn(this.b,t))return;e=t.j,Mn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=G()-t.v,de.dispatchEvent(new we(de,t.l?t.l.length:0,e,this.A)),sr(this)):cr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(On(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=be(q(t.Ha,t,e),dr(t,t.A)),t.A++,!0))}(this,t)||2==n&&fr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:yr(this,5);break;case 4:yr(this,10);break;case 3:yr(this,6);break;default:yr(this,2)}}},I.eb=function(t){ge(t?2:1)},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Bn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=gr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},wr.prototype.a=function(t,e){return new br(t,e)},j(br,zt),(I=br.prototype).addEventListener=function(t,e,n,r){br.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){br.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ge(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Nn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=mr(t.a,null,t.i),ge(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Tn(t)):(sn(e,"MODE","init"),!t.a.o&&t.a.j&&sn(e,"X-HTTP-Session-Id",t.a.j),t.b=new xe(t,void 0,void 0),t.b.h=t.h,Me(t.b,e,!1,null),t.M=0)},I.close=function(){rr(this.a)},I.Wa=function(t){if(S(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=Wt(t),or(this.a,e)):or(this.a,t)},I.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,br.N.G.call(this)},j(Er,De),j(Ir,Re),j(Nr,gr),Nr.prototype.va=function(){this.a.dispatchEvent("a")},Nr.prototype.ua=function(t){this.a.dispatchEvent(new Er(t))},Nr.prototype.ta=function(t){this.a.dispatchEvent(new Ir(t))},Nr.prototype.sa=function(){this.a.dispatchEvent("b")};var Tr=V(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},wr);wr.prototype.createWebChannel=wr.prototype.a,br.prototype.send=br.prototype.Wa,br.prototype.open=br.prototype.Va,br.prototype.close=br.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ie.COMPLETE="complete",(Ae.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",zt.prototype.listen=zt.prototype.za,Bn.prototype.listenOnce=Bn.prototype.Aa,Bn.prototype.getLastError=Bn.prototype.Xa,Bn.prototype.getLastErrorCode=Bn.prototype.ya,Bn.prototype.getStatus=Bn.prototype.T,Bn.prototype.getResponseJson=Bn.prototype.Ua,Bn.prototype.getResponseText=Bn.prototype.aa,Bn.prototype.send=Bn.prototype.ca;var Ar,Sr,kr={createWebChannelTransport:Tr,ErrorCode:Ee,EventType:Ie,WebChannel:Ae,XhrIo:Bn},Dr=kr.createWebChannelTransport,Rr=kr.ErrorCode,_r=kr.EventType,xr=kr.WebChannel,Cr=kr.XhrIo,Or=Jd.SDK_VERSION,Pr=new u("@firebase/firestore");function Lr(){return Pr.logLevel===o.DEBUG?Ar.DEBUG:Pr.logLevel===o.SILENT?Ar.SILENT:Ar.ERROR}function Mr(t){switch(t){case Ar.DEBUG:Pr.logLevel=o.DEBUG;break;case Ar.ERROR:Pr.logLevel=o.ERROR;break;case Ar.SILENT:Pr.logLevel=o.SILENT;break;default:Pr.error("Firestore ("+Or+"): Invalid value passed to `setLogLevel`")}}function Ur(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Pr.logLevel<=o.DEBUG){var i=n.map(Vr);Pr.debug.apply(Pr,s(["Firestore ("+Or+") ["+t+"]: "+e],i))}}function qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Pr.logLevel<=o.ERROR){var r=e.map(Vr);Pr.error.apply(Pr,s(["Firestore ("+Or+"): "+t],r))}}function Vr(t){if("string"==typeof t)return t;var e=zu.t();try{return e.i(t)}catch(e){return t}}function Gr(t){var e="FIRESTORE ("+Or+") INTERNAL ASSERTION FAILED: "+t;throw qr(e),new Error(e)}function jr(t,e){t||Gr(e)}(Sr=Ar=Ar||{})[Sr.DEBUG=0]="DEBUG",Sr[Sr.ERROR=1]="ERROR",Sr[Sr.SILENT=2]="SILENT";var Fr=(Br.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return jr(20===e.length,"Invalid auto ID: "+e),e},Br);function Br(){}function Hr(t,e){return t<e?-1:e<t?1:0}function zr(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Jr(t){return t+"\0"}function Wr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}function Yr(t,e){this.user=e,this.type="OAuth",this.g={},this.g.Authorization="Bearer "+t}var Xr,Qr="(default)",Kr=(Object.defineProperty(fi.prototype,"o",{get:function(){return this.database===Qr},enumerable:!0,configurable:!0}),fi.prototype.isEqual=function(t){return t instanceof fi&&t.projectId===this.projectId&&t.database===this.database},fi.prototype.h=function(t){return Hr(this.projectId,t.projectId)||Hr(this.database,t.database)},fi),$r=(ci.prototype.l=function(){return null!=this.uid},ci.prototype.v=function(){return this.l()?"uid:"+this.uid:"anonymous-user"},ci.prototype.isEqual=function(t){return t.uid===this.uid},ci.UNAUTHENTICATED=new ci(null),ci.m=new ci("google-credentials-uid"),ci.p=new ci("first-party-uid"),ci),Zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ti=(t(hi,Xr=Error),hi),ei=(ui.prototype.getToken=function(){return Promise.resolve(null)},ui.prototype.I=function(){},ui.prototype.T=function(t){jr(!this._,"Can only call setChangeListener() once."),(this._=t)($r.UNAUTHENTICATED)},ui.prototype.R=function(){jr(null!==this._,"removeChangeListener() when no listener registered"),this._=null},ui),ni=(ai.prototype.getToken=function(){var e=this;jr(null!=this.A,"getToken cannot be called after listener removed.");var n=this.P,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.P!==n)throw new ti(Zr.ABORTED,"getToken aborted due to token change.");return t?(jr("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Yr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},ai.prototype.I=function(){this.forceRefresh=!0},ai.prototype.T=function(t){jr(!this._,"Can only call setChangeListener() once."),this._=t,this.D&&t(this.currentUser)},ai.prototype.R=function(){jr(null!=this.A,"removeChangeListener() called twice"),jr(null!==this._,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.A),this.A=null,this._=null},ai.prototype.S=function(){var t=this.auth&&this.auth.getUid();return jr(null===t||"string"==typeof t,"Received invalid UID: "+t),new $r(t)},ai),ri=(Object.defineProperty(si.prototype,"g",{get:function(){var t={"X-Goog-AuthUser":this.k},e=this.C.auth.V([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),si),ii=(oi.prototype.getToken=function(){return Promise.resolve(new ri(this.C,this.k))},oi.prototype.T=function(t){t($r.p)},oi.prototype.R=function(){},oi.prototype.I=function(){},oi);function oi(t,e){this.C=t,this.k=e}function si(t,e){this.C=t,this.k=e,this.type="FirstParty",this.user=$r.p}function ai(t){var e=this;this.A=null,this.currentUser=$r.UNAUTHENTICATED,this.D=!1,this.P=0,this._=null,this.forceRefresh=!1,this.A=function(){e.P++,e.currentUser=e.S(),e.D=!0,e._&&e._(e.currentUser)},this.P=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.A):(this.A(null),t.get().then(function(t){e.auth=t,e.A&&e.auth.addAuthTokenListener(e.A)},function(){}))}function ui(){this._=null}function hi(t,e){var n=Xr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function ci(t){this.uid=t}function fi(t,e){this.projectId=t,this.database=e||Qr}function li(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function pi(t,e){return void 0!==t?t:e}function di(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function yi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vi(t){for(var e in jr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function mi(t,e){if(0!==e.length)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Pi(e.length,"argument")+".")}function gi(t,e,n){if(e.length!==n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires "+Pi(n,"argument")+", but was called with "+Pi(e.length,"argument")+".")}function wi(t,e,n){if(e.length<n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Pi(n,"argument")+", but was called with "+Pi(e.length,"argument")+".")}function bi(t,e,n,r){if(e.length<n||e.length>r)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Pi(e.length,"argument")+".")}function Ei(t,e,n,r){Si(t,e,Oi(n)+" argument",r)}function Ii(t,e,n,r){void 0!==r&&Ei(t,e,n,r)}function Ni(t,e,n,r){Si(t,e,n+" option",r)}function Ti(t,e,n,r){void 0!==r&&Ni(t,e,n,r)}function Ai(t,e,n,r,h){void 0!==r&&function(t,e,n,r){for(var i=[],o=0,s=h;o<s.length;o++){var a=s[o];if(a===r)return;i.push(Di(a))}var u=Di(r);throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+i.join(", "))}(t,0,n,r)}function Si(t,e,n,r){if(!("object"===e?ki(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Di(r);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ki(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Di(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Gr("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Ri(t,e,n){if(void 0===n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Oi(e)+" argument, but it was undefined.")}function _i(n,t,r){yi(t,function(t,e){if(r.indexOf(t)<0)throw new ti(Zr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function xi(t,e,n,r){var i=Di(r);return new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Oi(n)+" argument to be a "+e+", but it was: "+i)}function Ci(t,e,n){if(n<=0)throw new ti(Zr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Oi(e)+" argument to be a positive number, but it was: "+n+".")}function Oi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Pi(t,e){return t+" "+e+(1===t?"":"s")}var Li,Mi,Ui=(Object.defineProperty(oo.prototype,"latitude",{get:function(){return this.O},enumerable:!0,configurable:!0}),Object.defineProperty(oo.prototype,"longitude",{get:function(){return this.F},enumerable:!0,configurable:!0}),oo.prototype.isEqual=function(t){return this.O===t.O&&this.F===t.F},oo.prototype.U=function(t){return Hr(this.O,t.O)||Hr(this.F,t.F)},oo),qi=(io.now=function(){return io.fromMillis(Date.now())},io.fromDate=function(t){return io.fromMillis(t.getTime())},io.fromMillis=function(t){var e=Math.floor(t/1e3);return new io(e,1e6*(t-1e3*e))},io.prototype.toDate=function(){return new Date(this.toMillis())},io.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},io.prototype.U=function(t){return this.seconds===t.seconds?Hr(this.nanoseconds,t.nanoseconds):Hr(this.seconds,t.seconds)},io.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},io.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},io),Vi=(ro.j=function(t){var e=Math.floor(t/1e6);return new ro(new qi(e,t%1e6*1e3))},ro.L=function(t){return new ro(t)},ro.B=function(){return ro.MIN},ro.prototype.h=function(t){return this.timestamp.U(t.timestamp)},ro.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ro.prototype.M=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ro.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ro.prototype.q=function(){return this.timestamp},ro.MIN=new ro(new qi(0,0)),ro),Gi=(Object.defineProperty(no.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),no.prototype.isEqual=function(t){return 0===no.G(this,t)},no.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof no?t.forEach(function(t){e.push(t)}):e.push(t),this.W(e)},no.prototype.limit=function(){return this.offset+this.length},no.prototype.K=function(t){return t=void 0===t?1:t,jr(this.length>=t,"Can't call popFirst() with less segments"),this.W(this.segments,this.offset+t,this.length-t)},no.prototype.H=function(){return jr(!this.J(),"Can't call popLast() on empty path"),this.W(this.segments,this.offset,this.length-1)},no.prototype.Y=function(){return jr(!this.J(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},no.prototype.X=function(){return this.get(this.length-1)},no.prototype.get=function(t){return jr(t<this.length,"Index out of range"),this.segments[this.offset+t]},no.prototype.J=function(){return 0===this.length},no.prototype.$=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},no.prototype.Z=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},no.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},no.prototype.tt=function(){return this.segments.slice(this.offset,this.limit())},no.G=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},no),ji=(t(eo,Mi=Gi),eo.prototype.W=function(t,e,n){return new eo(t,e,n)},eo.prototype.nt=function(){return this.tt().join("/")},eo.prototype.toString=function(){return this.nt()},eo.it=function(t){if(0<=t.indexOf("//"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new eo(t.split("/").filter(function(t){return 0<t.length}))},eo.et=new eo([]),eo),Fi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Bi=(t(to,Li=Gi),to.prototype.W=function(t,e,n){return new to(t,e,n)},to.rt=function(t){return Fi.test(t)},to.prototype.nt=function(){return this.tt().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),to.rt(t)||(t="`"+t+"`"),t}).join(".")},to.prototype.toString=function(){return this.nt()},to.prototype.ut=function(){return 1===this.length&&"__name__"===this.get(0)},to.st=function(){return new to(["__name__"])},to.ot=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new ti(Zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new ti(Zr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new to(e)},to.et=new to([]),to),Hi=(Zi.prototype.ct=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Zi.prototype.isEqual=function(t){return null!==t&&0===ji.G(this.path,t.path)},Zi.prototype.toString=function(){return this.path.toString()},Zi.G=function(t,e){return ji.G(t.path,e.path)},Zi.ht=function(t){return t.length%2==0},Zi.at=function(t){return new Zi(new ji(t.slice()))},Zi.ft=function(t){return new Zi(ji.it(t))},Zi.EMPTY=new Zi(new ji([])),Zi),zi=($i.prototype.lt=function(t,e){return new $i(this.G,this.root.lt(t,e,this.G).copy(null,null,Wi.dt,null,null))},$i.prototype.remove=function(t){return new $i(this.G,this.root.remove(t,this.G).copy(null,null,Wi.dt,null,null))},$i.prototype.get=function(t){for(var e=this.root;!e.J();){var n=this.G(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},$i.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.J();){var r=this.G(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},$i.prototype.J=function(){return this.root.J()},Object.defineProperty($i.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),$i.prototype.vt=function(){return this.root.vt()},$i.prototype.wt=function(){return this.root.wt()},$i.prototype.pt=function(t){return this.root.pt(t)},$i.prototype.forEach=function(n){this.pt(function(t,e){return n(t,e),!1})},$i.prototype.toString=function(){var n=[];return this.pt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},$i.prototype.gt=function(t){return this.root.gt(t)},$i.prototype.bt=function(){return new Ji(this.root,null,this.G,!1)},$i.prototype.yt=function(t){return new Ji(this.root,t,this.G,!1)},$i.prototype._t=function(){return new Ji(this.root,null,this.G,!0)},$i.prototype.It=function(t){return new Ji(this.root,t,this.G,!0)},$i),Ji=(Ki.prototype.Rt=function(){jr(0<this.Et.length,"getNext() called on iterator when hasNext() is false.");var t=this.Et.pop(),e={key:t.key,value:t.value};if(this.Tt)for(t=t.left;!t.J();)this.Et.push(t),t=t.right;else for(t=t.right;!t.J();)this.Et.push(t),t=t.left;return e},Ki.prototype.At=function(){return 0<this.Et.length},Ki.prototype.Dt=function(){if(0===this.Et.length)return null;var t=this.Et[this.Et.length-1];return{key:t.key,value:t.value}},Ki),Wi=(Qi.prototype.copy=function(t,e,n,r,i){return new Qi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Qi.prototype.J=function(){return!1},Qi.prototype.pt=function(t){return this.left.pt(t)||t(this.key,this.value)||this.right.pt(t)},Qi.prototype.gt=function(t){return this.right.gt(t)||t(this.key,this.value)||this.left.gt(t)},Qi.prototype.min=function(){return this.left.J()?this:this.left.min()},Qi.prototype.vt=function(){return this.min().key},Qi.prototype.wt=function(){return this.right.J()?this.key:this.right.wt()},Qi.prototype.lt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.lt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.lt(t,e,n))).Pt()},Qi.prototype.St=function(){if(this.left.J())return Qi.EMPTY;var t=this;return t.left.Ct()||t.left.left.Ct()||(t=t.kt()),(t=t.copy(null,null,null,t.left.St(),null)).Pt()},Qi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.J()||r.left.Ct()||r.left.left.Ct()||(r=r.kt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Ct()&&(r=r.Vt()),r.right.J()||r.right.Ct()||r.right.left.Ct()||(r=r.Nt()),0===e(t,r.key)){if(r.right.J())return Qi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.St())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Pt()},Qi.prototype.Ct=function(){return this.color},Qi.prototype.Pt=function(){var t=this;return t.right.Ct()&&!t.left.Ct()&&(t=t.Ot()),t.left.Ct()&&t.left.left.Ct()&&(t=t.Vt()),t.left.Ct()&&t.right.Ct()&&(t=t.Ft()),t},Qi.prototype.kt=function(){var t=this.Ft();return t.right.left.Ct()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).Ot()).Ft()),t},Qi.prototype.Nt=function(){var t=this.Ft();return t.left.left.Ct()&&(t=(t=t.Vt()).Ft()),t},Qi.prototype.Ot=function(){var t=this.copy(null,null,Qi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Qi.prototype.Vt=function(){var t=this.copy(null,null,Qi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Qi.prototype.Ft=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Qi.prototype.Ut=function(){var t=this.xt();return Math.pow(2,t)<=this.size+1},Qi.prototype.xt=function(){if(this.Ct()&&this.left.Ct())throw Gr("Red node has red child("+this.key+","+this.value+")");if(this.right.Ct())throw Gr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.xt();if(t!==this.right.xt())throw Gr("Black depths differ");return t+(this.Ct()?0:1)},Qi.EMPTY=null,Qi.RED=!0,Qi.dt=!1,Qi),Yi=(Object.defineProperty(Xi.prototype,"key",{get:function(){throw Gr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"value",{get:function(){throw Gr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"color",{get:function(){throw Gr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"left",{get:function(){throw Gr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Xi.prototype,"right",{get:function(){throw Gr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Xi.prototype.copy=function(t,e,n,r,i){return this},Xi.prototype.lt=function(t,e,n){return new Wi(t,e)},Xi.prototype.remove=function(t,e){return this},Xi.prototype.J=function(){return!0},Xi.prototype.pt=function(t){return!1},Xi.prototype.gt=function(t){return!1},Xi.prototype.vt=function(){return null},Xi.prototype.wt=function(){return null},Xi.prototype.Ct=function(){return!1},Xi.prototype.Ut=function(){return!0},Xi.prototype.xt=function(){return 0},Xi);function Xi(){this.size=0}function Qi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Qi.RED,this.left=null!=r?r:Qi.EMPTY,this.right=null!=i?i:Qi.EMPTY,this.size=this.left.size+1+this.right.size}function Ki(t,e,n,r){this.Tt=r,this.Et=[];for(var i=1;!t.J();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Tt?t.left:t.right;else{if(0===i){this.Et.push(t);break}this.Et.push(t),t=this.Tt?t.right:t.left}}function $i(t,e){this.G=t,this.root=e||Wi.EMPTY}function Zi(t){this.path=t,jr(Zi.ht(t),"Invalid DocumentKey with an odd number of segments: "+t.tt().join("/"))}function to(){return null!==Li&&Li.apply(this,arguments)||this}function eo(){return null!==Mi&&Mi.apply(this,arguments)||this}function no(t,e,n){void 0===e?e=0:e>t.length&&Gr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Gr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}function ro(t){this.timestamp=t}function io(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function oo(t,e){if(gi("GeoPoint",arguments,2),Ei("GeoPoint","number",1,t),Ei("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new ti(Zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new ti(Zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.O=t,this.F=e}Wi.EMPTY=new Yi;var so=(go.jt=function(t){var e=new go(t.G);return t.forEach(function(t){e=e.add(t)}),e},go.prototype.has=function(t){return null!==this.data.get(t)},go.prototype.first=function(){return this.data.vt()},go.prototype.last=function(){return this.data.wt()},Object.defineProperty(go.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),go.prototype.indexOf=function(t){return this.data.indexOf(t)},go.prototype.forEach=function(n){this.data.pt(function(t,e){return n(t),!1})},go.prototype.Lt=function(t,e){for(var n=this.data.yt(t[0]);n.At();){var r=n.Rt();if(0<=this.G(r.key,t[1]))return;e(r.key)}},go.prototype.Bt=function(t,e){var n;for(n=void 0!==e?this.data.yt(e):this.data.bt();n.At();)if(!t(n.Rt().key))return},go.prototype.Mt=function(t){var e=this.data.yt(t);return e.At()?e.Rt().key:null},go.prototype.bt=function(){return new ao(this.data.bt())},go.prototype.yt=function(t){return new ao(this.data.yt(t))},go.prototype.add=function(t){return this.copy(this.data.remove(t).lt(t,!0))},go.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},go.prototype.J=function(){return this.data.J()},go.prototype.qt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},go.prototype.isEqual=function(t){if(!(t instanceof go))return!1;if(this.size!==t.size)return!1;for(var e=this.data.bt(),n=t.data.bt();e.At();){var r=e.Rt().key,i=n.Rt().key;if(0!==this.G(r,i))return!1}return!0},go.prototype.tt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},go.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},go.prototype.copy=function(t){var e=new go(this.G);return e.data=t,e},go),ao=(mo.prototype.Rt=function(){return this.Qt.Rt().key},mo.prototype.At=function(){return this.Qt.At()},mo),uo=(vo.prototype.Gt=function(t,e){return new ks(e,t)},vo.prototype.Wt=function(t,e){return e},vo.prototype.zt=function(t){return null},vo.prototype.isEqual=function(t){return t instanceof vo},vo.instance=new vo,vo),ho=(yo.prototype.Gt=function(t,e){return this.apply(t)},yo.prototype.Wt=function(t,e){return this.apply(t)},yo.prototype.apply=function(t){for(var n=wo(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Os(n)},yo.prototype.zt=function(t){return null},yo.prototype.isEqual=function(t){return t instanceof yo&&zr(t.elements,this.elements)},yo),co=(po.prototype.Gt=function(t,e){return this.apply(t)},po.prototype.Wt=function(t,e){return this.apply(t)},po.prototype.apply=function(t){for(var n=wo(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Os(n)},po.prototype.zt=function(t){return null},po.prototype.isEqual=function(t){return t instanceof po&&zr(t.elements,this.elements)},po),fo=(lo.prototype.Gt=function(t,e){var n=this.zt(t);if(n instanceof Ns&&this.Kt instanceof Ns){var r=n.Ht+this.Kt.Ht;return new Ns(r)}return r=n.Ht+this.Kt.Ht,new Ts(r)},lo.prototype.Wt=function(t,e){return jr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},lo.prototype.zt=function(t){return t instanceof rs?t:new Ns(0)},lo.prototype.isEqual=function(t){return t instanceof lo&&this.Kt.isEqual(t.Kt)},lo);function lo(t){this.Kt=t}function po(t){this.elements=t}function yo(t){this.elements=t}function vo(){}function mo(t){this.Qt=t}function go(t){this.G=t,this.data=new zi(this.G)}function wo(t){return t instanceof Os?t.Ht.slice():[]}function bo(t,e){this.version=t,this.transformResults=e}var Eo,Io,No=(So.Jt=function(t){return new So(t)},So.Yt=function(t){var e=new so(Bi.G);return t.forEach(function(t){return e=e.add(t)}),new So(e)},So.prototype.Xt=function(e){var n=!1;return this.fields.forEach(function(t){t.$(e)&&(n=!0)}),n},So.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},So),To=(Ao.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Ao);function Ao(t,e){this.field=t,this.transform=e}function So(t){this.fields=t}(Io=Eo=Eo||{})[Io.Set=0]="Set",Io[Io.$t=1]="__PRIVATE_Patch",Io[Io.Transform=2]="Transform",Io[Io.Zt=3]="__PRIVATE_Delete",Io[Io.Verify=4]="Verify";var ko,Do,Ro,_o,xo,Co,Oo,Po,Lo,Mo=(Xo.exists=function(t){return new Xo(void 0,t)},Xo.updateTime=function(t){return new Xo(t)},Object.defineProperty(Xo.prototype,"tn",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Xo.prototype.nn=function(t){return void 0!==this.updateTime?t instanceof Ls&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ls:(jr(this.tn,"Precondition should be empty"),!0)},Xo.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},Xo.NONE=new Xo,Xo),Uo=(Yo.prototype.in=function(t){null!=t&&jr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Yo.en=function(t){return t instanceof Ls?t.version:Vi.MIN},Yo),qo=(t(Wo,Lo=Uo),Wo.prototype.Wt=function(t,e){this.in(t),jr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ls(this.key,n,{hasCommittedMutations:!0},this.value)},Wo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=Uo.en(t);return new Ls(this.key,r,{un:!0},this.value)},Wo.prototype.sn=function(t){return null},Wo.prototype.isEqual=function(t){return t instanceof Wo&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.rn.isEqual(t.rn)},Wo),Vo=(t(Jo,Po=Uo),Jo.prototype.Wt=function(t,e){if(this.in(t),jr(null==e.transformResults,"Transform results received by PatchMutation."),!this.rn.nn(t))return new Us(this.key,e.version);var n=this.hn(t);return new Ls(this.key,e.version,{hasCommittedMutations:!0},n)},Jo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=Uo.en(t),i=this.hn(t);return new Ls(this.key,r,{un:!0},i)},Jo.prototype.sn=function(t){return null},Jo.prototype.isEqual=function(t){return t instanceof Jo&&this.key.isEqual(t.key)&&this.on.isEqual(t.on)&&this.rn.isEqual(t.rn)},Jo.prototype.hn=function(t){var e;return e=t instanceof Ls?t.data():xs.EMPTY,this.cn(e)},Jo.prototype.cn=function(t){var n=this,r=t.an();return this.on.fields.forEach(function(t){if(!t.J()){var e=n.data.field(t);null!==e?r.set(t,e):r.delete(t)}}),r.fn()},Jo),Go=(t(zo,Oo=Uo),zo.prototype.Wt=function(t,e){if(this.in(t),jr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.rn.nn(t))return new Us(this.key,e.version);var n=this.ln(t),r=this.dn(t,e.transformResults),i=e.version,o=this.vn(n.data(),r);return new Ls(this.key,i,{hasCommittedMutations:!0},o)},zo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=this.ln(t),i=this.wn(n,t,e),o=this.vn(r.data(),i);return new Ls(this.key,r.version,{un:!0},o)},zo.prototype.sn=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ls?t.field(i.field):void 0,s=i.transform.zt(o||null);null!=s&&(e=null==e?xs.mn().set(i.field,s):e.set(i.field,s))}return e?e.fn():null},zo.prototype.isEqual=function(t){return t instanceof zo&&this.key.isEqual(t.key)&&zr(this.fieldTransforms,t.fieldTransforms)&&this.rn.isEqual(t.rn)},zo.prototype.ln=function(t){return jr(t instanceof Ls,"Unknown MaybeDocument type "+t),jr(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},zo.prototype.dn=function(t,e){var n=[];jr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Ls&&(s=t.field(i.field)),n.push(o.Wt(s,e[r]))}return n},zo.prototype.wn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],a=s.transform,u=null;e instanceof Ls&&(u=e.field(s.field)),null===u&&n instanceof Ls&&(u=n.field(s.field)),r.push(a.Gt(u,t))}return r},zo.prototype.vn=function(t,e){jr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=t.an(),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.fn()},zo),jo=(t(Ho,Co=Uo),Ho.prototype.Wt=function(t,e){return this.in(t),jr(null==e.transformResults,"Transform results received by DeleteMutation."),new Ms(this.key,e.version,{hasCommittedMutations:!0})},Ho.prototype.Gt=function(t,e,n){return this.in(t),this.rn.nn(t)?(t&&jr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Ms(this.key,Vi.B())):t},Ho.prototype.sn=function(t){return null},Ho.prototype.isEqual=function(t){return t instanceof Ho&&this.key.isEqual(t.key)&&this.rn.isEqual(t.rn)},Ho),Fo=(t(Bo,xo=Uo),Bo.prototype.Wt=function(t,e){Gr("VerifyMutation should only be used in Transactions.")},Bo.prototype.Gt=function(t,e,n){Gr("VerifyMutation should only be used in Transactions.")},Bo.prototype.sn=function(t){Gr("VerifyMutation should only be used in Transactions.")},Bo.prototype.isEqual=function(t){return t instanceof Bo&&this.key.isEqual(t.key)&&this.rn.isEqual(t.rn)},Bo);function Bo(t,e){var n=xo.call(this)||this;return n.key=t,n.rn=e,n.type=Eo.Verify,n}function Ho(t,e){var n=Co.call(this)||this;return n.key=t,n.rn=e,n.type=Eo.Zt,n}function zo(t,e){var n=Oo.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Eo.Transform,n.rn=Mo.exists(!0),n}function Jo(t,e,n,r){var i=Po.call(this)||this;return i.key=t,i.data=e,i.on=n,i.rn=r,i.type=Eo.$t,i}function Wo(t,e,n){var r=Lo.call(this)||this;return r.key=t,r.value=e,r.rn=n,r.type=Eo.Set,r}function Yo(){}function Xo(t,e){this.updateTime=t,this.exists=e,jr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}(Do=ko=ko||{})[Do.pn=0]="__PRIVATE_NullValue",Do[Do.gn=1]="__PRIVATE_BooleanValue",Do[Do.bn=2]="__PRIVATE_NumberValue",Do[Do.yn=3]="__PRIVATE_TimestampValue",Do[Do._n=4]="__PRIVATE_StringValue",Do[Do.In=5]="__PRIVATE_BlobValue",Do[Do.Tn=6]="__PRIVATE_RefValue",Do[Do.En=7]="__PRIVATE_GeoPointValue",Do[Do.ArrayValue=8]="ArrayValue",Do[Do.Rn=9]="__PRIVATE_ObjectValue",(_o=Ro=Ro||{})[_o.An=0]="__PRIVATE_Default",_o[_o.Dn=1]="__PRIVATE_Estimate",_o[_o.Pn=2]="__PRIVATE_Previous";var Qo,Ko,$o,Zo=(us.Cn=function(t,e){switch(t.serverTimestamps){case"estimate":return new us(Ro.Dn,e);case"previous":return new us(Ro.Pn,e);case"none":case void 0:return new us(Ro.An,e);default:return Gr("fromSnapshotOptions() called with invalid options.")}},us),ts=(as.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},as.prototype.kn=function(t){return jr(this.Vn!==t.Vn,"Default compareTo should not be used for values of same type."),Hr(this.Vn,t.Vn)},as),es=(t(ss,$o=ts),ss.prototype.value=function(t){return null},ss.prototype.isEqual=function(t){return t instanceof ss},ss.prototype.h=function(t){return t instanceof ss?0:this.kn(t)},ss.prototype.Nn=function(){return 4},ss.On=new ss,ss),ns=(t(os,Ko=ts),os.prototype.value=function(t){return this.Ht},os.prototype.isEqual=function(t){return t instanceof os&&this.Ht===t.Ht},os.prototype.h=function(t){return t instanceof os?Hr(this.Ht,t.Ht):this.kn(t)},os.prototype.Nn=function(){return 4},os.of=function(t){return t?os.Fn:os.Un},os.Fn=new os(!0),os.Un=new os(!1),os),rs=(t(is,Qo=ts),is.prototype.value=function(t){return this.Ht},is.prototype.h=function(t){return t instanceof is?(e=this.Ht)<(n=t.Ht)?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1:this.kn(t);var e,n},is.prototype.Nn=function(){return 8},is);function is(t){var e=Qo.call(this)||this;return e.Ht=t,e.Vn=ko.bn,e}function os(t){var e=Ko.call(this)||this;return e.Ht=t,e.Vn=ko.gn,e}function ss(){var t=$o.call(this)||this;return t.Vn=ko.pn,t.Ht=null,t}function as(){}function us(t,e){this.Sn=t,this.timestampsInSnapshots=e}function hs(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var cs,fs,ls,ps,ds,ys,vs,ms,gs,ws,bs,Es,Is,Ns=(t(na,Is=rs),na.prototype.isEqual=function(t){return t instanceof na&&hs(this.Ht,t.Ht)},na),Ts=(t(ea,Es=rs),ea.prototype.isEqual=function(t){return t instanceof ea&&hs(this.Ht,t.Ht)},ea.xn=new ea(NaN),ea.POSITIVE_INFINITY=new ea(1/0),ea.NEGATIVE_INFINITY=new ea(-1/0),ea),As=(t(ta,bs=ts),ta.prototype.value=function(t){return this.Ht},ta.prototype.isEqual=function(t){return t instanceof ta&&this.Ht===t.Ht},ta.prototype.h=function(t){return t instanceof ta?Hr(this.Ht,t.Ht):this.kn(t)},ta.prototype.Nn=function(){return 2*this.Ht.length},ta),Ss=(t(Zs,ws=ts),Zs.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Ht:this.Ht.toDate()},Zs.prototype.isEqual=function(t){return t instanceof Zs&&this.Ht.isEqual(t.Ht)},Zs.prototype.h=function(t){return t instanceof Zs?this.Ht.U(t.Ht):t instanceof ks?-1:this.kn(t)},Zs.prototype.Nn=function(){return 16},Zs),ks=(t($s,gs=ts),$s.prototype.value=function(t){return t&&t.Sn===Ro.Dn?new Ss(this.jn).value(t):t&&t.Sn===Ro.Pn&&this.previousValue?this.previousValue.value(t):null},$s.prototype.isEqual=function(t){return t instanceof $s&&this.jn.isEqual(t.jn)},$s.prototype.h=function(t){return t instanceof $s?this.jn.U(t.jn):t instanceof Ss?1:this.kn(t)},$s.prototype.toString=function(){return"<ServerTimestamp localTime="+this.jn.toString()+">"},$s.prototype.Nn=function(){return 16+(this.previousValue?this.previousValue.Nn():0)},$s),Ds=(t(Ks,ms=ts),Ks.prototype.value=function(t){return this.Ht},Ks.prototype.isEqual=function(t){return t instanceof Ks&&this.Ht.isEqual(t.Ht)},Ks.prototype.h=function(t){return t instanceof Ks?this.Ht.U(t.Ht):this.kn(t)},Ks.prototype.Nn=function(){return this.Ht.Ln()},Ks),Rs=(t(Qs,vs=ts),Qs.prototype.value=function(t){return this.key},Qs.prototype.isEqual=function(t){return t instanceof Qs&&this.key.isEqual(t.key)&&this.s.isEqual(t.s)},Qs.prototype.h=function(t){if(t instanceof Qs){var e=this.s.h(t.s);return 0!==e?e:Hi.G(this.key,t.key)}return this.kn(t)},Qs.prototype.Nn=function(){return this.s.projectId.length+this.s.database.length+this.key.toString().length},Qs),_s=(t(Xs,ys=ts),Xs.prototype.value=function(t){return this.Ht},Xs.prototype.isEqual=function(t){return t instanceof Xs&&this.Ht.isEqual(t.Ht)},Xs.prototype.h=function(t){return t instanceof Xs?this.Ht.U(t.Ht):this.kn(t)},Xs.prototype.Nn=function(){return 16},Xs),xs=(t(Ys,ds=ts),Ys.mn=function(){return new Cs(Ys.EMPTY.Ht)},Ys.prototype.value=function(n){var r={};return this.Ht.pt(function(t,e){r[t]=e.value(n)}),r},Ys.prototype.forEach=function(t){this.Ht.pt(t)},Ys.prototype.isEqual=function(t){if(t instanceof Ys){for(var e=this.Ht.bt(),n=t.Ht.bt();e.At()&&n.At();){var r=e.Rt(),i=n.Rt();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.At()&&!n.At()}return!1},Ys.prototype.h=function(t){if(t instanceof Ys){for(var e=this.Ht.bt(),n=t.Ht.bt();e.At()&&n.At();){var r=e.Rt(),i=n.Rt(),o=Hr(r.key,i.key)||r.value.h(i.value);if(o)return o}return Hr(e.At(),n.At())}return this.kn(t)},Ys.prototype.contains=function(t){return null!==this.field(t)},Ys.prototype.field=function(t){jr(!t.J(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Ys?e.Ht.get(t):null}),e},Ys.prototype.on=function(){var i=new so(Bi.G);return this.Ht.forEach(function(t,e){var n=new Bi([t]);if(e instanceof Ys){var r=e.on().fields;r.J()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),No.Jt(i)},Ys.prototype.Nn=function(){var n=0;return this.Ht.pt(function(t,e){n+=t.length+e.Nn()}),n},Ys.prototype.toString=function(){return this.Ht.toString()},Ys.prototype.an=function(){return new Cs(this.Ht)},Ys.EMPTY=new Ys(new zi(Hr)),Ys),Cs=(Ws.prototype.set=function(t,e){jr(!t.J(),"Cannot set field for empty path on ObjectValue");var n=t.Y();if(1===t.length)this.Ht=this.Ht.lt(n,e);else{var r=this.Ht.get(n),i=(r instanceof xs?r:xs.EMPTY).an().set(t.K(),e).fn();this.Ht=this.Ht.lt(n,i)}return this},Ws.prototype.delete=function(t){jr(!t.J(),"Cannot delete field for empty path on ObjectValue");var e=t.Y();if(1===t.length)this.Ht=this.Ht.remove(e);else{var n=this.Ht.get(e);if(n instanceof xs){var r=n.an().delete(t.K()).fn();this.Ht=this.Ht.lt(t.Y(),r)}}return this},Ws.prototype.fn=function(){return new xs(this.Ht)},Ws),Os=(t(Js,ps=ts),Js.prototype.value=function(e){return this.Ht.map(function(t){return t.value(e)})},Js.prototype.contains=function(t){for(var e=0,n=this.Ht;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Js.prototype.forEach=function(t){this.Ht.forEach(t)},Js.prototype.isEqual=function(t){if(t instanceof Js){if(this.Ht.length!==t.Ht.length)return!1;for(var e=0;e<this.Ht.length;e++)if(!this.Ht[e].isEqual(t.Ht[e]))return!1;return!0}return!1},Js.prototype.h=function(t){if(t instanceof Js){for(var e=Math.min(this.Ht.length,t.Ht.length),n=0;n<e;n++){var r=this.Ht[n].h(t.Ht[n]);if(r)return r}return Hr(this.Ht.length,t.Ht.length)}return this.kn(t)},Js.prototype.Nn=function(){return this.Ht.reduce(function(t,e){return t+e.Nn()},0)},Js.prototype.toString=function(){return"["+this.Ht.map(function(t){return t.toString()}).join(",")+"]"},Js),Ps=(zs.Bn=function(t,e){return Hi.G(t.key,e.key)},zs),Ls=(t(Hs,ls=Ps),Hs.prototype.field=function(t){if(this.Mn)return this.Mn.field(t);this.qn||(this.qn=new Map);var e=t.nt(),n=this.qn.get(e);if(void 0===n){var r=this.Qn(t);n=void 0===r?null:this.converter(r),this.qn.set(e,n)}return n},Hs.prototype.data=function(){var n=this;if(!this.Mn){var r=xs.mn();yi(this.proto.fields||{},function(t,e){r.set(new Bi([t]),n.converter(e))}),this.Mn=r.fn(),this.qn=void 0}return this.Mn},Hs.prototype.value=function(){return this.data().value()},Hs.prototype.isEqual=function(t){return t instanceof Hs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.un===t.un&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Hs.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.un+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Hs.prototype,"hasPendingWrites",{get:function(){return this.un||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Hs.prototype.Qn=function(t){jr(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.Y()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Hs.Gn=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.h(i):Gr("Trying to compare documents on fields that don't exist")},Hs),Ms=(t(Bs,fs=Ps),Bs.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Bs.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Bs.prototype.isEqual=function(t){return t instanceof Bs&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Bs),Us=(t(Fs,cs=Ps),Fs.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Fs.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Fs.prototype.isEqual=function(t){return t instanceof Fs&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Fs),qs=Number,Vs=qs.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Gs=qs.MAX_SAFE_INTEGER||Math.pow(2,53)-1,js=qs.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Fs(){return null!==cs&&cs.apply(this,arguments)||this}function Bs(t,e,n){var r=fs.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Hs(t,e,n,r,i,o){var s=ls.call(this,t,e)||this;return s.Mn=r,s.proto=i,s.converter=o,jr(void 0!==s.Mn||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.un=!!n.un,s.hasCommittedMutations=!!n.hasCommittedMutations,s}function zs(t,e){this.key=t,this.version=e}function Js(t){var e=ps.call(this)||this;return e.Ht=t,e.Vn=ko.ArrayValue,e}function Ws(t){this.Ht=t}function Ys(t){var e=ds.call(this)||this;return e.Ht=t,e.Vn=ko.Rn,e}function Xs(t){var e=ys.call(this)||this;return e.Ht=t,e.Vn=ko.En,e}function Qs(t,e){var n=vs.call(this)||this;return n.s=t,n.key=e,n.Vn=ko.Tn,n}function Ks(t){var e=ms.call(this)||this;return e.Ht=t,e.Vn=ko.In,e}function $s(t,e){var n=gs.call(this)||this;return n.jn=t,n.previousValue=e,n.Vn=ko.yn,n}function Zs(t){var e=ws.call(this)||this;return e.Ht=t,e.Vn=ko.yn,e}function ta(t){var e=bs.call(this)||this;return e.Ht=t,e.Vn=ko._n,e}function ea(){return null!==Es&&Es.apply(this,arguments)||this}function na(){return null!==Is&&Is.apply(this,arguments)||this}function ra(t){return null==t}function ia(t){return js(t)&&t<=Gs&&Vs<=t}var oa,sa,aa=(ua.prototype.canonicalId=function(){if(null===this.Wn){var t=this.path.nt();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";ra(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Wn=t}return this.Wn},ua.prototype.toString=function(){var t=this.path.nt();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ra(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},ua.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},ua.prototype.zn=function(){return Hi.ht(this.path)&&null===this.collectionGroup&&0===this.filters.length},ua);function ua(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Wn=null}(sa=oa=oa||{}).Kn="F",sa.Hn="L";var ha,ca,fa,la,pa,da,ya,va,ma=(Ga.ti=function(t){return new Ga(t)},Object.defineProperty(Ga.prototype,"orderBy",{get:function(){if(null===this.Xn){var t=this.ni(),e=this.ii();if(null!==t&&null===e)t.ut()?this.Xn=[Da]:this.Xn=[new ka(t),Da];else{jr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.Xn=[]),r=0,i=this.Jn;r<i.length;r++){var o=i[r];this.Xn.push(o),o.field.ut()&&(n=!0)}if(!n){var s=0<this.Jn.length?this.Jn[this.Jn.length-1].dir:Aa.ASCENDING;this.Xn.push(s===Aa.ASCENDING?Da:Ra)}}}return this.Xn},enumerable:!0,configurable:!0}),Ga.prototype.ei=function(t){jr(null==this.ni()||!(t instanceof wa)||!t.ri()||t.field.isEqual(this.ni()),"Query must only have one inequality field."),jr(!this.zn(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new Ga(this.path,this.collectionGroup,this.Jn.slice(),e,this.limit,this.Yn,this.startAt,this.endAt)},Ga.prototype.ui=function(t){jr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.Jn.concat([t]);return new Ga(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Yn,this.startAt,this.endAt)},Ga.prototype.si=function(t){return new Ga(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),t,oa.Kn,this.startAt,this.endAt)},Ga.prototype.oi=function(t){return new Ga(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),t,oa.Hn,this.startAt,this.endAt)},Ga.prototype.hi=function(t){return new Ga(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),this.limit,this.Yn,t,this.endAt)},Ga.prototype.ci=function(t){return new Ga(this.path,this.collectionGroup,this.Jn.slice(),this.filters.slice(),this.limit,this.Yn,this.startAt,t)},Ga.prototype.ai=function(t){return new Ga(t,null,this.Jn.slice(),this.filters.slice(),this.limit,this.Yn,this.startAt,this.endAt)},Ga.prototype.fi=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Jn.length||1===this.Jn.length&&this.Jn[0].field.ut())},Ga.prototype.canonicalId=function(){return this.li().canonicalId()+"|lt:"+this.Yn},Ga.prototype.toString=function(){return"Query(target="+this.li().toString()+"; limitType="+this.Yn+")"},Ga.prototype.isEqual=function(t){return this.li().isEqual(t.li())&&this.Yn===t.Yn},Ga.prototype.di=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.ut()}return jr(n,"orderBy used that doesn't compare on key field"),0},Ga.prototype.matches=function(t){return this.vi(t)&&this.wi(t)&&this.mi(t)&&this.pi(t)},Ga.prototype.gi=function(){return!ra(this.limit)&&this.Yn===oa.Kn},Ga.prototype.bi=function(){return!ra(this.limit)&&this.Yn===oa.Hn},Ga.prototype.ii=function(){return 0<this.Jn.length?this.Jn[0].field:null},Ga.prototype.ni=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof wa&&n.ri())return n.field}return null},Ga.prototype.yi=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof wa&&0<=t.indexOf(r.op))return r.op}return null},Ga.prototype.zn=function(){return this.li().zn()},Ga.prototype._i=function(){return null!==this.collectionGroup},Ga.prototype.li=function(){if(!this.$n)if(this.Yn===oa.Kn)this.$n=new aa(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===Aa.DESCENDING?Aa.ASCENDING:Aa.DESCENDING;t.push(new ka(r.field,i))}var o=this.endAt?new Sa(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Sa(this.startAt.position,!this.startAt.before):null;this.$n=new aa(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.$n},Ga.prototype.vi=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.ct(this.collectionGroup)&&this.path.$(e):Hi.ht(this.path)?this.path.isEqual(e):this.path.Z(e)},Ga.prototype.wi=function(t){for(var e=0,n=this.Jn;e<n.length;e++){var r=n[e];if(!r.field.ut()&&null===t.field(r.field))return!1}return!0},Ga.prototype.mi=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Ga.prototype.pi=function(t){return!(this.startAt&&!this.startAt.Ii(this.orderBy,t)||this.endAt&&this.endAt.Ii(this.orderBy,t))},Ga.prototype.Zn=function(t){jr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},Ga),ga=(Va.it=function(t){switch(t){case"<":return Va.LESS_THAN;case"<=":return Va.LESS_THAN_OR_EQUAL;case"==":return Va.EQUAL;case">=":return Va.GREATER_THAN_OR_EQUAL;case">":return Va.GREATER_THAN;case"array-contains":return Va.ARRAY_CONTAINS;case"in":return Va.IN;case"array-contains-any":return Va.ARRAY_CONTAINS_ANY;default:return Gr("Unknown FieldFilter operator: "+t)}},Va.prototype.toString=function(){return this.name},Va.prototype.isEqual=function(t){return this.name===t.name},Va.LESS_THAN=new Va("<"),Va.LESS_THAN_OR_EQUAL=new Va("<="),Va.EQUAL=new Va("=="),Va.GREATER_THAN=new Va(">"),Va.GREATER_THAN_OR_EQUAL=new Va(">="),Va.ARRAY_CONTAINS=new Va("array-contains"),Va.IN=new Va("in"),Va.ARRAY_CONTAINS_ANY=new Va("array-contains-any"),Va),wa=(t(qa,va=function(){}),qa.create=function(t,e,n){if(t.ut())return e===ga.IN?(jr(n instanceof Os,"Comparing on key with IN, but filter value not an ArrayValue"),jr(n.Ht.every(function(t){return t instanceof Rs}),"Comparing on key with IN, but an array value was not a RefValue"),new Ea(t,n)):(jr(n instanceof Rs,"Comparing on key, but filter value not a RefValue"),jr(e!==ga.ARRAY_CONTAINS&&e!==ga.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new ba(t,e,n));if(n.isEqual(es.On)){if(e!==ga.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new qa(t,e,n)}if(n.isEqual(Ts.xn)){if(e!==ga.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new qa(t,e,n)}return e===ga.ARRAY_CONTAINS?new Ia(t,n):e===ga.IN?(jr(n instanceof Os,"IN filter has invalid value: "+n.toString()),new Na(t,n)):e===ga.ARRAY_CONTAINS_ANY?(jr(n instanceof Os,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Ta(t,n)):new qa(t,e,n)},qa.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.Vn===e.Vn&&this.Ti(e.h(this.value))},qa.prototype.Ti=function(t){switch(this.op){case ga.LESS_THAN:return t<0;case ga.LESS_THAN_OR_EQUAL:return t<=0;case ga.EQUAL:return 0===t;case ga.GREATER_THAN:return 0<t;case ga.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Gr("Unknown FieldFilter operator: "+this.op)}},qa.prototype.ri=function(){return 0<=[ga.LESS_THAN,ga.LESS_THAN_OR_EQUAL,ga.GREATER_THAN,ga.GREATER_THAN_OR_EQUAL].indexOf(this.op)},qa.prototype.canonicalId=function(){return this.field.nt()+this.op.toString()+this.value.toString()},qa.prototype.isEqual=function(t){return t instanceof qa&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},qa.prototype.toString=function(){return this.field.nt()+" "+this.op+" "+this.value.value()},qa),ba=(t(Ua,ya=wa),Ua.prototype.matches=function(t){var e=this.value,n=Hi.G(t.key,e.key);return this.Ti(n)},Ua),Ea=(t(Ma,da=wa),Ma.prototype.matches=function(e){return this.value.Ht.some(function(t){return e.key.isEqual(t.key)})},Ma),Ia=(t(La,pa=wa),La.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Os&&e.contains(this.value)},La),Na=(t(Pa,la=wa),Pa.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},Pa),Ta=(t(Oa,fa=wa),Oa.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Os&&n.Ht.some(function(t){return e.value.contains(t)})},Oa),Aa=(Ca.prototype.toString=function(){return this.name},Ca.ASCENDING=new Ca("asc"),Ca.DESCENDING=new Ca("desc"),Ca),Sa=(xa.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},xa.prototype.Ii=function(t,e){jr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.ut())jr(o instanceof Rs,"Bound has a non-key value where the key path is being used."),n=Hi.G(o.key,e.key);else{var s=e.field(i.field);jr(null!==s,"Field should exist since document matched the orderBy already."),n=o.h(s)}if(i.dir===Aa.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},xa.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},xa),ka=(_a.prototype.compare=function(t,e){var n=this.Ei?Ls.Bn(t,e):Ls.Gn(this.field,t,e);switch(this.dir){case Aa.ASCENDING:return n;case Aa.DESCENDING:return-1*n;default:return Gr("Unknown direction: "+this.dir)}},_a.prototype.canonicalId=function(){return this.field.nt()+this.dir.toString()},_a.prototype.toString=function(){return this.field.nt()+" ("+this.dir+")"},_a.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},_a),Da=new ka(Bi.st(),Aa.ASCENDING),Ra=new ka(Bi.st(),Aa.DESCENDING);function _a(t,e){this.field=t,void 0===e&&(e=Aa.ASCENDING),this.dir=e,this.Ei=t.ut()}function xa(t,e){this.position=t,this.before=e}function Ca(t){this.name=t}function Oa(t,e){var n=fa.call(this,t,ga.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}function Pa(t,e){var n=la.call(this,t,ga.IN,e)||this;return n.value=e,n}function La(t,e){return pa.call(this,t,ga.ARRAY_CONTAINS,e)||this}function Ma(t,e){var n=da.call(this,t,ga.IN,e)||this;return n.value=e,n}function Ua(){return null!==ya&&ya.apply(this,arguments)||this}function qa(t,e,n){var r=va.call(this)||this;return r.field=t,r.op=e,r.value=n,r}function Va(t){this.name=t}function Ga(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=oa.Kn),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.Jn=n,this.filters=r,this.limit=i,this.Yn=o,this.startAt=s,this.endAt=a,this.Xn=null,this.$n=null,this.startAt&&this.Zn(this.startAt),this.endAt&&this.Zn(this.endAt)}(ca=ha=ha||{})[ca.Ri=0]="__PRIVATE_RemoteStore",ca[ca.Ai=1]="__PRIVATE_SharedClientState";var ja,Fa,Ba=(Ha.fromBase64String=function(t){return new Ha(zu.t().atob(t))},Ha.fromUint8Array=function(t){return new Ha(za(t))},Ha.prototype.toBase64=function(){return zu.t().btoa(this.Di)},Ha.prototype.toUint8Array=function(){return Ja(this.Di)},Ha.prototype.Nn=function(){return 2*this.Di.length},Ha.prototype.isEqual=function(t){return this.Di===t.Di},Ha.Pi=new Ha(""),Ha);function Ha(t){this.Di=t}function za(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}function Ja(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(Fa=ja=ja||{})[Fa.Si=0]="__PRIVATE_Listen",Fa[Fa.Ci=1]="__PRIVATE_ExistenceFilterMismatch",Fa[Fa.ki=2]="__PRIVATE_LimboResolution";var Wa,Ya,Xa=($a.prototype.Oi=function(t){return new $a(this.target,this.targetId,this.Vi,t,this.Ni,this.lastLimboFreeSnapshotVersion,this.resumeToken)},$a.prototype.Fi=function(t,e){return new $a(this.target,this.targetId,this.Vi,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},$a.prototype.Ui=function(t){return new $a(this.target,this.targetId,this.Vi,this.sequenceNumber,this.Ni,t,this.resumeToken)},$a.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.Vi===t.Vi&&this.sequenceNumber===t.sequenceNumber&&this.Ni.isEqual(t.Ni)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},$a),Qa=(Ka.prototype.isEqual=function(t){return t&&t.count===this.count},Ka);function Ka(t){this.count=t}function $a(t,e,n,r,i,o,s){void 0===i&&(i=Vi.MIN),void 0===o&&(o=Vi.MIN),void 0===s&&(s=Ba.Pi),this.target=t,this.targetId=e,this.Vi=n,this.sequenceNumber=r,this.Ni=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Za(t){switch(t){case Zr.OK:return Gr("Treated status OK as error");case Zr.CANCELLED:case Zr.UNKNOWN:case Zr.DEADLINE_EXCEEDED:case Zr.RESOURCE_EXHAUSTED:case Zr.INTERNAL:case Zr.UNAVAILABLE:case Zr.UNAUTHENTICATED:return!1;case Zr.INVALID_ARGUMENT:case Zr.NOT_FOUND:case Zr.ALREADY_EXISTS:case Zr.PERMISSION_DENIED:case Zr.FAILED_PRECONDITION:case Zr.ABORTED:case Zr.OUT_OF_RANGE:case Zr.UNIMPLEMENTED:case Zr.DATA_LOSS:return!0;default:return Gr("Unknown status code: "+t)}}function tu(t){if(void 0===t)return qr("GRPC error has no .code"),Zr.UNKNOWN;switch(t){case Wa.OK:return Zr.OK;case Wa.CANCELLED:return Zr.CANCELLED;case Wa.UNKNOWN:return Zr.UNKNOWN;case Wa.DEADLINE_EXCEEDED:return Zr.DEADLINE_EXCEEDED;case Wa.RESOURCE_EXHAUSTED:return Zr.RESOURCE_EXHAUSTED;case Wa.INTERNAL:return Zr.INTERNAL;case Wa.UNAVAILABLE:return Zr.UNAVAILABLE;case Wa.UNAUTHENTICATED:return Zr.UNAUTHENTICATED;case Wa.INVALID_ARGUMENT:return Zr.INVALID_ARGUMENT;case Wa.NOT_FOUND:return Zr.NOT_FOUND;case Wa.ALREADY_EXISTS:return Zr.ALREADY_EXISTS;case Wa.PERMISSION_DENIED:return Zr.PERMISSION_DENIED;case Wa.FAILED_PRECONDITION:return Zr.FAILED_PRECONDITION;case Wa.ABORTED:return Zr.ABORTED;case Wa.OUT_OF_RANGE:return Zr.OUT_OF_RANGE;case Wa.UNIMPLEMENTED:return Zr.UNIMPLEMENTED;case Wa.DATA_LOSS:return Zr.DATA_LOSS;default:return Gr("Unknown status code: "+t)}}(Ya=Wa=Wa||{})[Ya.OK=0]="OK",Ya[Ya.CANCELLED=1]="CANCELLED",Ya[Ya.UNKNOWN=2]="UNKNOWN",Ya[Ya.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ya[Ya.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ya[Ya.NOT_FOUND=5]="NOT_FOUND",Ya[Ya.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ya[Ya.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ya[Ya.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ya[Ya.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ya[Ya.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ya[Ya.ABORTED=10]="ABORTED",Ya[Ya.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ya[Ya.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ya[Ya.INTERNAL=13]="INTERNAL",Ya[Ya.UNAVAILABLE=14]="UNAVAILABLE",Ya[Ya.DATA_LOSS=15]="DATA_LOSS";var eu=new zi(Hi.G);function nu(){return eu}function ru(){return nu()}var iu=new zi(Hi.G);function ou(){return iu}var su=new zi(Hi.G);function au(){return su}var uu=new so(Hi.G);function hu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=uu,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var cu=new so(Hr);function fu(){return cu}var lu,pu,du,yu,vu=(mu.Li=function(t){return new mu(t.G)},mu.prototype.has=function(t){return null!=this.xi.get(t)},mu.prototype.get=function(t){return this.xi.get(t)},mu.prototype.first=function(){return this.ji.vt()},mu.prototype.last=function(){return this.ji.wt()},mu.prototype.J=function(){return this.ji.J()},mu.prototype.indexOf=function(t){var e=this.xi.get(t);return e?this.ji.indexOf(e):-1},Object.defineProperty(mu.prototype,"size",{get:function(){return this.ji.size},enumerable:!0,configurable:!0}),mu.prototype.forEach=function(n){this.ji.pt(function(t,e){return n(t),!1})},mu.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.xi.lt(t.key,t),e.ji.lt(t,null))},mu.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.xi.remove(t),this.ji.remove(e)):this},mu.prototype.isEqual=function(t){if(!(t instanceof mu))return!1;if(this.size!==t.size)return!1;for(var e=this.ji.bt(),n=t.ji.bt();e.At();){var r=e.Rt().key,i=n.Rt().key;if(!r.isEqual(i))return!1}return!0},mu.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},mu.prototype.copy=function(t,e){var n=new mu;return n.G=this.G,n.xi=t,n.ji=e,n},mu);function mu(n){this.G=n?function(t,e){return n(t,e)||Hi.G(t.key,e.key)}:function(t,e){return Hi.G(t.key,e.key)},this.xi=ou(),this.ji=new zi(this.G)}(pu=lu=lu||{})[pu.Bi=0]="__PRIVATE_Added",pu[pu.Mi=1]="__PRIVATE_Removed",pu[pu.qi=2]="__PRIVATE_Modified",pu[pu.Qi=3]="__PRIVATE_Metadata",(yu=du=du||{})[yu.Gi=0]="__PRIVATE_Local",yu[yu.Wi=1]="__PRIVATE_Synced";function gu(t,e,n,r){this.ce=t,this.removedTargetIds=e,this.key=n,this.ae=r}function wu(t,e){this.targetId=t,this.fe=e}var bu,Eu,Iu=(Ru.prototype.track=function(t){var e=t.doc.key,n=this.zi.get(e);n?t.type!==lu.Bi&&n.type===lu.Qi?this.zi=this.zi.lt(e,t):t.type===lu.Qi&&n.type!==lu.Mi?this.zi=this.zi.lt(e,{type:n.type,doc:t.doc}):t.type===lu.qi&&n.type===lu.qi?this.zi=this.zi.lt(e,{type:lu.qi,doc:t.doc}):t.type===lu.qi&&n.type===lu.Bi?this.zi=this.zi.lt(e,{type:lu.Bi,doc:t.doc}):t.type===lu.Mi&&n.type===lu.Bi?this.zi=this.zi.remove(e):t.type===lu.Mi&&n.type===lu.qi?this.zi=this.zi.lt(e,{type:lu.Mi,doc:n.doc}):t.type===lu.Bi&&n.type===lu.Mi?this.zi=this.zi.lt(e,{type:lu.qi,doc:t.doc}):Gr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.zi=this.zi.lt(e,t)},Ru.prototype.Ki=function(){var n=[];return this.zi.pt(function(t,e){n.push(e)}),n},Ru),Nu=(Du.$i=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:lu.Bi,doc:t})}),new Du(t,e,vu.Li(e),i,n,r,!0,!1)},Object.defineProperty(Du.prototype,"hasPendingWrites",{get:function(){return!this.Ji.J()},enumerable:!0,configurable:!0}),Du.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Yi===t.Yi&&this.Ji.isEqual(t.Ji)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.Hi.isEqual(t.Hi)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Du),Tu=(ku.ee=function(t,e){var n,r=((n={})[t]=Au.re(t,e),n);return new ku(Vi.MIN,r,fu(),nu(),hu())},ku),Au=(Su.re=function(t,e){return new Su(Ba.Pi,e,hu(),hu(),hu())},Su);function Su(t,e,n,r,i){this.resumeToken=t,this.ue=e,this.se=n,this.oe=r,this.he=i}function ku(t,e,n,r,i){this.Ni=t,this.Zi=e,this.te=n,this.ne=r,this.ie=i}function Du(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.Hi=n,this.docChanges=r,this.Ji=i,this.fromCache=o,this.Yi=s,this.Xi=a}function Ru(){this.zi=new zi(Hi.G)}(Eu=bu=bu||{})[Eu.le=0]="__PRIVATE_NoChange",Eu[Eu.Bi=1]="__PRIVATE_Added",Eu[Eu.Mi=2]="__PRIVATE_Removed",Eu[Eu.de=3]="__PRIVATE_Current",Eu[Eu.ve=4]="__PRIVATE_Reset";function _u(t,e,n,r){void 0===n&&(n=Ba.Pi),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var xu=(Object.defineProperty(Pu.prototype,"ue",{get:function(){return this.ge},enumerable:!0,configurable:!0}),Object.defineProperty(Pu.prototype,"resumeToken",{get:function(){return this.pe},enumerable:!0,configurable:!0}),Object.defineProperty(Pu.prototype,"ye",{get:function(){return 0!==this.we},enumerable:!0,configurable:!0}),Object.defineProperty(Pu.prototype,"_e",{get:function(){return this.be},enumerable:!0,configurable:!0}),Pu.prototype.Ie=function(t){0<t.Nn()&&(this.be=!0,this.pe=t)},Pu.prototype.Te=function(){var n=hu(),r=hu(),i=hu();return this.me.forEach(function(t,e){switch(e){case lu.Bi:n=n.add(t);break;case lu.qi:r=r.add(t);break;case lu.Mi:i=i.add(t);break;default:Gr("Encountered invalid change type: "+e)}}),new Au(this.pe,this.ge,n,r,i)},Pu.prototype.Ee=function(){this.be=!1,this.me=Mu()},Pu.prototype.Re=function(t,e){this.be=!0,this.me=this.me.lt(t,e)},Pu.prototype.Ae=function(t){this.be=!0,this.me=this.me.remove(t)},Pu.prototype.De=function(){this.we+=1},Pu.prototype.Pe=function(){this.we-=1},Pu.prototype.Se=function(){this.be=!0,this.ge=!0},Pu),Cu=(Ou.prototype.Fe=function(t){for(var e=0,n=t.ce;e<n.length;e++){var r=n[e];t.ae instanceof Ls?this.Ue(r,t.ae):t.ae instanceof Ms&&this.xe(r,t.key,t.ae)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.xe(r,t.key,t.ae)},Ou.prototype.je=function(n){var r=this;this.Le(n,function(t){var e=r.Be(t);switch(n.state){case bu.le:r.Me(t)&&e.Ie(n.resumeToken);break;case bu.Bi:e.Pe(),e.ye||e.Ee(),e.Ie(n.resumeToken);break;case bu.Mi:e.Pe(),e.ye||r.removeTarget(t),jr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case bu.de:r.Me(t)&&(e.Se(),e.Ie(n.resumeToken));break;case bu.ve:r.Me(t)&&(r.qe(t),e.Ie(n.resumeToken));break;default:Gr("Unknown target watch change state: "+n.state)}})},Ou.prototype.Le=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):di(this.ke,e)},Ou.prototype.Qe=function(t){var e=t.targetId,n=t.fe.count,r=this.Ge(e);if(r){var i=r.target;if(i.zn())if(0===n){var o=new Hi(i.path);this.xe(e,o,new Ms(o,Vi.B()))}else jr(1===n,"Single document existence filter with count: "+n);else this.We(e)!==n&&(this.qe(e),this.Oe=this.Oe.add(e))}},Ou.prototype.ze=function(i){var o=this,s={};di(this.ke,function(t,e){var n=o.Ge(t);if(n){if(e.ue&&n.target.zn()){var r=new Hi(n.target.path);null!==o.Ve.get(r)||o.Ke(t,r)||o.xe(t,r,new Ms(r,i))}e._e&&(s[t]=e.Te(),e.Ee())}});var r=hu();this.Ne.forEach(function(t,e){var n=!0;e.Bt(function(t){var e=o.Ge(t);return!e||e.Vi===ja.ki||(n=!1)}),n&&(r=r.add(t))});var t=new Tu(i,s,this.Oe,this.Ve,r);return this.Ve=nu(),this.Ne=Lu(),this.Oe=new so(Hr),t},Ou.prototype.Ue=function(t,e){if(this.Me(t)){var n=this.Ke(t,e.key)?lu.qi:lu.Bi;this.Be(t).Re(e.key,n),this.Ve=this.Ve.lt(e.key,e),this.Ne=this.Ne.lt(e.key,this.He(e.key).add(t))}},Ou.prototype.xe=function(t,e,n){if(this.Me(t)){var r=this.Be(t);this.Ke(t,e)?r.Re(e,lu.Mi):r.Ae(e),this.Ne=this.Ne.lt(e,this.He(e).delete(t)),n&&(this.Ve=this.Ve.lt(e,n))}},Ou.prototype.removeTarget=function(t){delete this.ke[t]},Ou.prototype.We=function(t){var e=this.Be(t).Te();return this.Ce.Je(t).size+e.se.size-e.he.size},Ou.prototype.De=function(t){this.Be(t).De()},Ou.prototype.Be=function(t){return this.ke[t]||(this.ke[t]=new xu),this.ke[t]},Ou.prototype.He=function(t){var e=this.Ne.get(t);return e||(e=new so(Hr),this.Ne=this.Ne.lt(t,e)),e},Ou.prototype.Me=function(t){var e=null!==this.Ge(t);return e||Ur("WatchChangeAggregator","Detected inactive target",t),e},Ou.prototype.Ge=function(t){var e=this.ke[t];return e&&e.ye?null:this.Ce.Ye(t)},Ou.prototype.qe=function(e){var n=this;jr(!this.ke[e].ye,"Should only reset active targets"),this.ke[e]=new xu,this.Ce.Je(e).forEach(function(t){n.xe(e,t,null)})},Ou.prototype.Ke=function(t,e){return this.Ce.Je(t).has(e)},Ou);function Ou(t){this.Ce=t,this.ke={},this.Ve=nu(),this.Ne=Lu(),this.Oe=new so(Hr)}function Pu(){this.we=0,this.me=Mu(),this.pe=Ba.Pi,this.ge=!1,this.be=!0}function Lu(){return new zi(Hi.G)}function Mu(){return new zi(Hi.G)}var Uu,qu,Vu=((Uu={})[Aa.ASCENDING.name]="ASCENDING",Uu[Aa.DESCENDING.name]="DESCENDING",Uu),Gu=((qu={})[ga.LESS_THAN.name]="LESS_THAN",qu[ga.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",qu[ga.GREATER_THAN.name]="GREATER_THAN",qu[ga.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",qu[ga.EQUAL.name]="EQUAL",qu[ga.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",qu[ga.IN.name]="IN",qu[ga.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",qu),ju=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fu(t,e){jr(!ra(t),e+" is missing")}function Bu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Gr("can't parse "+t)}var Hu=(Wu.prototype.Xe=function(t){var e=void 0===t.code?Zr.UNKNOWN:tu(t.code);return new ti(e,t.message||"")},Wu.prototype.$e=function(t){return this.options.Ze||ra(t)?t:{value:t}},Wu.prototype.tr=function(t){var e;return ra(e="object"==typeof t?t.value:t)?null:e},Wu.prototype.q=function(t){return this.options.Ze?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Wu.prototype.L=function(t){if("string"==typeof t)return this.nr(t);jr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Bu(t.seconds||"0"),n=t.nanos||0;return new qi(e,n)},Wu.prototype.nr=function(t){var e=0,n=ju.exec(t);if(jr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new qi(o,e)},Wu.prototype.ir=function(t){return this.options.Ze?t.toBase64():t.toUint8Array()},Wu.prototype.er=function(t){return this.options.Ze?(jr(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),Ba.fromBase64String(t||"")):(jr(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),Ba.fromUint8Array(t||new Uint8Array))},Wu.prototype.rr=function(t){return"string"==typeof t?(jr(this.options.Ze,"Expected bytes to be passed in as Uint8Array, but got a string instead."),th.fromBase64String(t)):(jr(!this.options.Ze,"Expected bytes to be passed in as Uint8Array, but got a string instead."),th.fromUint8Array(t))},Wu.prototype.toVersion=function(t){return this.q(t.q())},Wu.prototype.fromVersion=function(t){return jr(!!t,"Trying to deserialize version that isn't set"),Vi.L(this.L(t))},Wu.prototype.ur=function(t,e){return this.sr(t).child("documents").child(e).nt()},Wu.prototype.or=function(t){var e=ji.it(t);return jr(this.hr(e),"Tried to deserialize invalid key "+e.toString()),e},Wu.prototype.cr=function(t){return this.ur(this.s,t.path)},Wu.prototype.ar=function(t){var e=this.or(t);return jr(e.get(1)===this.s.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.s.projectId),jr(!e.get(3)&&!this.s.database||e.get(3)===this.s.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.s.database),new Hi(this.lr(e))},Wu.prototype.dr=function(t){return this.ur(this.s,t)},Wu.prototype.vr=function(t){var e=this.or(t);return 4===e.length?ji.et:this.lr(e)},Object.defineProperty(Wu.prototype,"wr",{get:function(){return new ji(["projects",this.s.projectId,"databases",this.s.database]).nt()},enumerable:!0,configurable:!0}),Wu.prototype.sr=function(t){return new ji(["projects",t.projectId,"databases",t.database])},Wu.prototype.lr=function(t){return jr(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.K(5)},Wu.prototype.hr=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},Wu.prototype.mr=function(t){if(t instanceof es)return{nullValue:"NULL_VALUE"};if(t instanceof ns)return{booleanValue:t.value()};if(t instanceof Ns)return{integerValue:""+t.value()};if(t instanceof Ts){var e=t.value();if(this.options.Ze){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof As?{stringValue:t.value()}:t instanceof xs?{mapValue:this.pr(t)}:t instanceof Os?{arrayValue:this.gr(t)}:t instanceof Ss?{timestampValue:this.q(t.Ht)}:t instanceof _s?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ds?{bytesValue:this.ir(t.value())}:t instanceof Rs?{referenceValue:this.ur(t.s,t.key.path)}:Gr("Unknown FieldValue "+JSON.stringify(t))},Wu.prototype.br=function(t){var e=this;if("nullValue"in t)return es.On;if("booleanValue"in t)return ns.of(t.booleanValue);if("integerValue"in t)return new Ns(Bu(t.integerValue));if("doubleValue"in t){if(this.options.Ze){if("NaN"===t.doubleValue)return Ts.xn;if("Infinity"===t.doubleValue)return Ts.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Ts.NEGATIVE_INFINITY}return new Ts(t.doubleValue)}if("stringValue"in t)return new As(t.stringValue);if("mapValue"in t)return this.yr(t.mapValue.fields||{});if("arrayValue"in t){Fu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Os(n.map(function(t){return e.br(t)}))}if("timestampValue"in t)return Fu(t.timestampValue,"timestampValue"),new Ss(this.L(t.timestampValue));if("geoPointValue"in t){Fu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new _s(new Ui(r,i))}if("bytesValue"in t){Fu(t.bytesValue,"bytesValue");var o=this.rr(t.bytesValue);return new Ds(o)}if("referenceValue"in t){Fu(t.referenceValue,"referenceValue");var s=this.or(t.referenceValue),a=new Kr(s.get(1),s.get(3)),u=new Hi(this.lr(s));return new Rs(a,u)}return Gr("Unknown Value proto "+JSON.stringify(t))},Wu.prototype._r=function(t,e){return{name:this.cr(t),fields:this.Ir(e)}},Wu.prototype.Tr=function(t){return jr(!t.un,"Can't serialize documents with mutations."),{name:this.cr(t.key),fields:this.Ir(t.data()),updateTime:this.q(t.version.q())}},Wu.prototype.Er=function(t,e){var n=this,r=this.ar(t.name),i=this.fromVersion(t.updateTime);return new Ls(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.br(t)})},Wu.prototype.Ir=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.mr(e)}),r},Wu.prototype.yr=function(t){var n=this,e=t,r=xs.mn();return yi(e,function(t,e){r.set(new Bi([t]),n.br(e))}),r.fn()},Wu.prototype.pr=function(t){return{fields:this.Ir(t)}},Wu.prototype.gr=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.mr(t))}),{values:n}},Wu.prototype.Rr=function(t){var e=this;jr(!!t.found,"Tried to deserialize a found document from a missing document."),Fu(t.found.name,"doc.found.name"),Fu(t.found.updateTime,"doc.found.updateTime");var n=this.ar(t.found.name),r=this.fromVersion(t.found.updateTime);return new Ls(n,r,{},void 0,t.found,function(t){return e.br(t)})},Wu.prototype.Ar=function(t){jr(!!t.missing,"Tried to deserialize a missing document from a found document."),jr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.ar(t.missing),n=this.fromVersion(t.readTime);return new Ms(e,n)},Wu.prototype.Dr=function(t){return"found"in t?this.Rr(t):"missing"in t?this.Ar(t):Gr("invalid batch get response: "+JSON.stringify(t))},Wu.prototype.Pr=function(t){switch(t){case bu.Bi:return"ADD";case bu.de:return"CURRENT";case bu.le:return"NO_CHANGE";case bu.Mi:return"REMOVE";case bu.ve:return"RESET";default:return Gr("Unknown WatchTargetChangeState: "+t)}},Wu.prototype.Sr=function(t){if(t instanceof wu)return{filter:{count:t.fe.count,targetId:t.targetId}};if(t instanceof gu){if(t.ae instanceof Ls){var e=t.ae;return{documentChange:{document:{name:this.cr(e.key),fields:this.Ir(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.ce,removedTargetIds:t.removedTargetIds}}}if(t.ae instanceof Ms)return e=t.ae,{documentDelete:{document:this.cr(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.ae)return{documentRemove:{document:this.cr(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof _u){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Wa.OK;switch(t){case Zr.OK:return Wa.OK;case Zr.CANCELLED:return Wa.CANCELLED;case Zr.UNKNOWN:return Wa.UNKNOWN;case Zr.DEADLINE_EXCEEDED:return Wa.DEADLINE_EXCEEDED;case Zr.RESOURCE_EXHAUSTED:return Wa.RESOURCE_EXHAUSTED;case Zr.INTERNAL:return Wa.INTERNAL;case Zr.UNAVAILABLE:return Wa.UNAVAILABLE;case Zr.UNAUTHENTICATED:return Wa.UNAUTHENTICATED;case Zr.INVALID_ARGUMENT:return Wa.INVALID_ARGUMENT;case Zr.NOT_FOUND:return Wa.NOT_FOUND;case Zr.ALREADY_EXISTS:return Wa.ALREADY_EXISTS;case Zr.PERMISSION_DENIED:return Wa.PERMISSION_DENIED;case Zr.FAILED_PRECONDITION:return Wa.FAILED_PRECONDITION;case Zr.ABORTED:return Wa.ABORTED;case Zr.OUT_OF_RANGE:return Wa.OUT_OF_RANGE;case Zr.UNIMPLEMENTED:return Wa.UNIMPLEMENTED;case Zr.DATA_LOSS:return Wa.DATA_LOSS;default:return Gr("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.Pr(t.state),targetIds:t.targetIds,resumeToken:this.ir(t.resumeToken),cause:n}}}return Gr("Unrecognized watch change: "+JSON.stringify(t))},Wu.prototype.Cr=function(t){var e,n=this;if("targetChange"in t){Fu(t.targetChange,"targetChange");var r=this.kr(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=this.er(t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&this.Xe(s);e=new _u(r,i,o,a||null)}else if("documentChange"in t){Fu(t.documentChange,"documentChange");var u=t.documentChange;Fu(u.document,"documentChange.name"),Fu(u.document.name,"documentChange.document.name"),Fu(u.document.updateTime,"documentChange.document.updateTime");var h=this.ar(u.document.name),c=this.fromVersion(u.document.updateTime),f=new Ls(h,c,{},void 0,u.document,function(t){return n.br(t)}),l=u.targetIds||[],p=u.removedTargetIds||[];e=new gu(l,p,f.key,f)}else if("documentDelete"in t){Fu(t.documentDelete,"documentDelete");var d=t.documentDelete;Fu(d.document,"documentDelete.document"),h=this.ar(d.document),c=d.readTime?this.fromVersion(d.readTime):Vi.B(),f=new Ms(h,c),p=d.removedTargetIds||[],e=new gu([],p,f.key,f)}else if("documentRemove"in t){Fu(t.documentRemove,"documentRemove");var y=t.documentRemove;Fu(y.document,"documentRemove"),h=this.ar(y.document),p=y.removedTargetIds||[],e=new gu([],p,h,null)}else{if(!("filter"in t))return Gr("Unknown change type "+JSON.stringify(t));Fu(t.filter,"filter");var v=t.filter;Fu(v.targetId,"filter.targetId");var m=v.count||0,g=new Qa(m),w=v.targetId;e=new wu(w,g)}return e},Wu.prototype.kr=function(t){return"NO_CHANGE"===t?bu.le:"ADD"===t?bu.Bi:"REMOVE"===t?bu.Mi:"CURRENT"===t?bu.de:"RESET"===t?bu.ve:Gr("Got unexpected TargetChange.state: "+t)},Wu.prototype.Vr=function(t){if(!("targetChange"in t))return Vi.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Vi.MIN:e.readTime?this.fromVersion(e.readTime):Vi.MIN},Wu.prototype.Nr=function(t){var e,n=this;if(t instanceof qo)e={update:this._r(t.key,t.value)};else if(t instanceof jo)e={delete:this.cr(t.key)};else if(t instanceof Vo)e={update:this._r(t.key,t.data),updateMask:this.Or(t.on)};else if(t instanceof Go)e={transform:{document:this.cr(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Fr(t)})}};else{if(!(t instanceof Fo))return Gr("Unknown mutation type "+t.type);e={verify:this.cr(t.key)}}return t.rn.tn||(e.currentDocument=this.Ur(t.rn)),e},Wu.prototype.xr=function(t){var e=this,n=t.currentDocument?this.jr(t.currentDocument):Mo.NONE;if(t.update){Fu(t.update.name,"name");var r=this.ar(t.update.name),i=this.yr(t.update.fields||{});if(t.updateMask){var o=this.Lr(t.updateMask);return new Vo(r,i,o,n)}return new qo(r,i,n)}if(t.delete)return r=this.ar(t.delete),new jo(r,n);if(t.transform){r=this.ar(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.Br(t)});return jr(!0===n.exists,'Transforms only support precondition "exists == true"'),new Go(r,s)}return t.verify?(r=this.ar(t.verify),new Fo(r,n)):Gr("unknown mutation proto: "+JSON.stringify(t))},Wu.prototype.Ur=function(t){return jr(!t.tn,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Gr("Unknown precondition")},Wu.prototype.jr=function(t){return void 0!==t.updateTime?Mo.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Mo.exists(t.exists):Mo.NONE},Wu.prototype.Mr=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Vi.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.br(t)})),new bo(r,i)},Wu.prototype.qr=function(t,e){var n=this;return t&&0<t.length?(jr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.Mr(t,e)})):[]},Wu.prototype.Fr=function(t){var e=this,n=t.transform;if(n instanceof uo)return{fieldPath:t.field.nt(),setToServerValue:"REQUEST_TIME"};if(n instanceof ho)return{fieldPath:t.field.nt(),appendMissingElements:{values:n.elements.map(function(t){return e.mr(t)})}};if(n instanceof co)return{fieldPath:t.field.nt(),removeAllFromArray:{values:n.elements.map(function(t){return e.mr(t)})}};if(n instanceof fo)return{fieldPath:t.field.nt(),increment:this.mr(n.Kt)};throw Gr("Unknown transform: "+t.transform)},Wu.prototype.Br=function(t){var e=this,n=null;if("setToServerValue"in t)jr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=uo.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new ho(r.map(function(t){return e.br(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new co(r.map(function(t){return e.br(t)}));else if("increment"in t){var i=this.br(t.increment);jr(i instanceof rs,"NUMERIC_ADD transform requires a NumberValue"),n=new fo(i)}else Gr("Unknown transform proto: "+JSON.stringify(t));var o=Bi.ot(t.fieldPath);return new To(o,n)},Wu.prototype.Qr=function(t){return{documents:[this.dr(t.path)]}},Wu.prototype.Gr=function(t){var e=t.documents.length;jr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return ma.ti(this.vr(n)).li()},Wu.prototype.Wr=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(jr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.dr(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(jr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.dr(n.H()),e.structuredQuery.from=[{collectionId:n.X()}]);var r=this.zr(t.filters);r&&(e.structuredQuery.where=r);var i=this.Kr(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.$e(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Hr(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Hr(t.endAt)),e},Wu.prototype.Jr=function(t){var e=this.vr(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){jr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.Yr(n.where));var a=[];n.orderBy&&(a=this.Xr(n.orderBy));var u=null;n.limit&&(u=this.tr(n.limit));var h=null;n.startAt&&(h=this.$r(n.startAt));var c=null;return n.endAt&&(c=this.$r(n.endAt)),new ma(e,i,a,s,u,oa.Kn,h,c).li()},Wu.prototype.Zr=function(t){var e=this.tu(t.Vi);return null==e?null:{"goog-listen-tags":e}},Wu.prototype.tu=function(t){switch(t){case ja.Si:return null;case ja.Ci:return"existence-filter-mismatch";case ja.ki:return"limbo-document";default:return Gr("Unrecognized query purpose: "+t)}},Wu.prototype.li=function(t){var e,n=t.target;return(e=n.zn()?{documents:this.Qr(n)}:{query:this.Wr(n)}).targetId=t.targetId,0<t.resumeToken.Nn()&&(e.resumeToken=this.ir(t.resumeToken)),e},Wu.prototype.zr=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof wa?e.nu(t):Gr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Wu.prototype.Yr=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.iu(t)]:void 0!==t.fieldFilter?[this.eu(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.Yr(t)}).reduce(function(t,e){return t.concat(e)}):Gr("Unknown filter: "+JSON.stringify(t)):[]},Wu.prototype.Kr=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.ru(t)})},Wu.prototype.Xr=function(t){var e=this;return t.map(function(t){return e.uu(t)})},Wu.prototype.Hr=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.mr(t)})}},Wu.prototype.$r=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.br(t)});return new Sa(r,n)},Wu.prototype.su=function(t){return Vu[t.name]},Wu.prototype.ou=function(t){switch(t){case"ASCENDING":return Aa.ASCENDING;case"DESCENDING":return Aa.DESCENDING;default:return}},Wu.prototype.hu=function(t){return Gu[t.name]},Wu.prototype.cu=function(t){switch(t){case"EQUAL":return ga.EQUAL;case"GREATER_THAN":return ga.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return ga.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return ga.LESS_THAN;case"LESS_THAN_OR_EQUAL":return ga.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return ga.ARRAY_CONTAINS;case"IN":return ga.IN;case"ARRAY_CONTAINS_ANY":return ga.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Gr("Unspecified operator");default:return Gr("Unknown operator")}},Wu.prototype.au=function(t){return{fieldPath:t.nt()}},Wu.prototype.fu=function(t){return Bi.ot(t.fieldPath)},Wu.prototype.ru=function(t){return{field:this.au(t.field),direction:this.su(t.dir)}},Wu.prototype.uu=function(t){return new ka(this.fu(t.field),this.ou(t.direction))},Wu.prototype.eu=function(t){return wa.create(this.fu(t.fieldFilter.field),this.cu(t.fieldFilter.op),this.br(t.fieldFilter.value))},Wu.prototype.nu=function(t){if(t.op===ga.EQUAL){if(t.value.isEqual(Ts.xn))return{unaryFilter:{field:this.au(t.field),op:"IS_NAN"}};if(t.value.isEqual(es.On))return{unaryFilter:{field:this.au(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.au(t.field),op:this.hu(t.op),value:this.mr(t.value)}}},Wu.prototype.iu=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fu(t.unaryFilter.field);return wa.create(e,ga.EQUAL,Ts.xn);case"IS_NULL":var n=this.fu(t.unaryFilter.field);return wa.create(n,ga.EQUAL,es.On);case"OPERATOR_UNSPECIFIED":return Gr("Unspecified filter");default:return Gr("Unknown filter")}},Wu.prototype.Or=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.nt())}),{fieldPaths:e}},Wu.prototype.Lr=function(t){var e=(t.fieldPaths||[]).map(function(t){return Bi.ot(t)});return No.Yt(e)},Wu),zu=(Ju.lu=function(t){Ju.platform&&Gr("Platform already defined"),Ju.platform=t},Ju.t=function(){return Ju.platform||Gr("Platform not set"),Ju.platform},Ju);function Ju(){}function Wu(t,e){this.s=t,this.options=e}function Yu(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new ti(Zr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}function Xu(){if("undefined"==typeof Uint8Array)throw new ti(Zr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Qu(){if(!zu.t().du)throw new ti(Zr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Ku(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var $u,Zu,th=(ih.fromBase64String=function(t){gi("Blob.fromBase64String",arguments,1),Ei("Blob.fromBase64String","string",1,t),Qu();try{return new ih(zu.t().atob(t))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},ih.fromUint8Array=function(t){if(gi("Blob.fromUint8Array",arguments,1),Xu(),!(t instanceof Uint8Array))throw xi("Blob.fromUint8Array","Uint8Array",1,t);return new ih(za(t))},ih.prototype.toBase64=function(){return gi("Blob.toBase64",arguments,0),Qu(),zu.t().btoa(this.Di)},ih.prototype.toUint8Array=function(){return gi("Blob.toUint8Array",arguments,0),Xu(),Ja(this.Di)},ih.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},ih.prototype.isEqual=function(t){return this.Di===t.Di},ih.prototype.Ln=function(){return 2*this.Di.length},ih.prototype.U=function(t){return Hr(this.Di,t.Di)},ih),eh=Yu(th,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),nh=(rh.prototype.wu=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},rh.prototype.next=function(){var t=++this.previousValue;return this.mu&&this.mu(t),t},rh.gu=-1,rh);function rh(t,e){var n=this;this.previousValue=t,e&&(e.vu=function(t){return n.wu(t)},this.mu=function(t){return e.pu(t)})}function ih(t){Qu(),this.Di=t}(Zu=$u=$u||{}).bu="all",Zu.yu="listen_stream_idle",Zu._u="listen_stream_connection_backoff",Zu.Iu="write_stream_idle",Zu.Tu="write_stream_connection_backoff",Zu.Eu="online_state_timeout",Zu.Ru="client_metadata_refresh",Zu.Au="lru_garbage_collection",Zu.Du="retry_transaction";var oh=(lh.Nu=function(t,e,n,r,i){var o=new lh(t,e,Date.now()+n,r,i);return o.start(n),o},lh.prototype.start=function(t){var e=this;this.Ou=setTimeout(function(){return e.Fu()},t)},lh.prototype.Uu=function(){return this.Fu()},lh.prototype.cancel=function(t){null!==this.Ou&&(this.clearTimeout(),this.Vu.reject(new ti(Zr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},lh.prototype.Fu=function(){var e=this;this.Pu.xu(function(){return null!==e.Ou?(e.clearTimeout(),e.op().then(function(t){return e.Vu.resolve(t)})):Promise.resolve()})},lh.prototype.clearTimeout=function(){null!==this.Ou&&(this.ku(this),clearTimeout(this.Ou),this.Ou=null)},lh),sh=(Object.defineProperty(fh.prototype,"Gu",{get:function(){return this.Lu},enumerable:!0,configurable:!0}),fh.prototype.xu=function(t){this.enqueue(t)},fh.prototype.Wu=function(t){this.zu(),this.Ku(t)},fh.prototype.Hu=function(t){return this.zu(),this.Ku(t)},fh.prototype.Ju=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.zu(),this.Lu?[3,2]:(this.Lu=!0,[4,this.Hu(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},fh.prototype.enqueue=function(t){return this.zu(),this.Lu?new Promise(function(t){}):this.Ku(t)},fh.prototype.Ku=function(t){var n=this,e=this.ju.then(function(){return n.qu=!0,t().catch(function(t){n.Mu=t,n.qu=!1;var e=t.stack||t.message||"";throw qr("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.qu=!1,t})});return this.ju=e},fh.prototype.Yu=function(t,e,n){var r=this;this.zu(),jr(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.Qu.indexOf(t)&&(e=0);var i=oh.Nu(this,t,e,n,function(t){return r.Xu(t)});return this.Bu.push(i),i},fh.prototype.zu=function(){this.Mu&&Gr("AsyncQueue is already failed: "+(this.Mu.stack||this.Mu.message))},fh.prototype.$u=function(){jr(this.qu,"verifyOpInProgress() called when no op in progress on this queue.")},fh.prototype.Zu=function(){return this.Hu(function(){return Promise.resolve()})},fh.prototype.ts=function(t){for(var e=0,n=this.Bu;e<n.length;e++)if(n[e].Su===t)return!0;return!1},fh.prototype.ns=function(r){var i=this;return this.Zu().then(function(){jr(r===$u.bu||i.ts(r),"Attempted to drain to missing operation "+r),i.Bu.sort(function(t,e){return t.Cu-e.Cu});for(var t=0,e=i.Bu;t<e.length;t++){var n=e[t];if(n.Uu(),r!==$u.bu&&n.Su===r)break}return i.Zu()})},fh.prototype.es=function(t){this.Qu.push(t)},fh.prototype.Xu=function(t){var e=this.Bu.indexOf(t);jr(0<=e,"Delayed operation not found."),this.Bu.splice(e,1)},fh),ah="",uh="",hh="",ch="";function fh(){this.ju=Promise.resolve(),this.Lu=!1,this.Bu=[],this.Mu=null,this.qu=!1,this.Qu=[]}function lh(t,e,n,r,i){this.Pu=t,this.Su=e,this.Cu=n,this.op=r,this.ku=i,this.Vu=new Ku,this.then=this.Vu.promise.then.bind(this.Vu.promise),this.catch=this.Vu.promise.catch.bind(this.Vu.promise),this.Vu.promise.catch(function(t){})}function ph(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=yh(e)),e=dh(t.get(n),e);return yh(e)}function dh(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=ah+hh;break;case ah:n+=ah+ch;break;default:n+=o}}return n}function yh(t){return t+ah+uh}function vh(t){var e=t.length;if(jr(2<=e,"Invalid path "+t),2===e)return jr(t.charAt(0)===ah&&t.charAt(1)===uh,"Non-empty path "+t+" had length 2"),ji.et;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(ah,o);switch((s<0||n<s)&&Gr('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case uh:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case hh:i+=t.substring(o,s),i+="\0";break;case ch:i+=t.substring(o,s+1);break;default:Gr('Invalid encoded resource path: "'+t+'"')}o=s+2}return new ji(r)}var mh=(jh.prototype.Wt=function(t,e,n){e&&jr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.rs;jr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Wt(e,s)}}return e},jh.prototype.Gt=function(t,e){e&&jr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.Gt(e,e,this.jn));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.Gt(e,i,this.jn))}return e},jh.prototype.us=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Gt(t.key,n.get(t.key));e&&(i=i.lt(t.key,e))}),i},jh.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},hu())},jh.prototype.isEqual=function(t){return this.batchId===t.batchId&&zr(this.mutations,t.mutations)&&zr(this.baseMutations,t.baseMutations)},jh),gh=(Gh.from=function(t,e,n,r){jr(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=au(),o=t.mutations,s=0;s<o.length;s++)i=i.lt(o[s].key,n[s].version);return new Gh(t,e,n,r,i)},Gh),wh=(Vh.prototype.J=function(){return this.hs.J()},Vh.prototype.fs=function(t,e){var n=new bh(t,e);this.hs=this.hs.add(n),this.cs=this.cs.add(n)},Vh.prototype.ls=function(t,e){var n=this;t.forEach(function(t){return n.fs(t,e)})},Vh.prototype.ds=function(t,e){this.vs(new bh(t,e))},Vh.prototype.ws=function(t,e){var n=this;t.forEach(function(t){return n.ds(t,e)})},Vh.prototype.ms=function(t){var e=this,n=Hi.EMPTY,r=new bh(n,t),i=new bh(n,t+1),o=[];return this.cs.Lt([r,i],function(t){e.vs(t),o.push(t.key)}),o},Vh.prototype.ps=function(){var e=this;this.hs.forEach(function(t){return e.vs(t)})},Vh.prototype.vs=function(t){this.hs=this.hs.delete(t),this.cs=this.cs.delete(t)},Vh.prototype.gs=function(t){var e=Hi.EMPTY,n=new bh(e,t),r=new bh(e,t+1),i=hu();return this.cs.Lt([n,r],function(t){i=i.add(t.key)}),i},Vh.prototype.bs=function(t){var e=new bh(t,0),n=this.hs.Mt(e);return null!==n&&t.isEqual(n.key)},Vh),bh=(qh.Bn=function(t,e){return Hi.G(t.key,e.key)||Hr(t.ys,e.ys)},qh.as=function(t,e){return Hr(t.ys,e.ys)||Hi.G(t.key,e.key)},qh),Eh=(Uh.prototype.get=function(t){var e=this._s(t),n=this.Is[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},Uh.prototype.has=function(t){return void 0!==this.get(t)},Uh.prototype.set=function(t,e){var n=this._s(t),r=this.Is[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Is[n]=[[t,e]]},Uh.prototype.delete=function(t){var e=this._s(t),n=this.Is[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Is[e]:n.splice(r,1),!0;return!1},Uh.prototype.forEach=function(a){yi(this.Is,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];a(o,s)}})},Uh.prototype.J=function(){return vi(this.Is)},Uh),Ih=(Mh.prototype.catch=function(t){return this.next(void 0,t)},Mh.prototype.next=function(r,i){var o=this;return this.As&&Gr("Called next() or catch() twice for PersistencePromise"),this.As=!0,this.Rs?this.error?this.Ds(i,this.error):this.Ps(r,this.result):new Mh(function(e,n){o.Ts=function(t){o.Ps(r,t).next(e,n)},o.Es=function(t){o.Ds(i,t).next(e,n)}})},Mh.prototype.Ss=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Mh.prototype.Cs=function(t){try{var e=t();return e instanceof Mh?e:Mh.resolve(e)}catch(t){return Mh.reject(t)}},Mh.prototype.Ps=function(t,e){return t?this.Cs(function(){return t(e)}):Mh.resolve(e)},Mh.prototype.Ds=function(t,e){return t?this.Cs(function(){return t(e)}):Mh.reject(e)},Mh.resolve=function(n){return new Mh(function(t,e){t(n)})},Mh.reject=function(n){return new Mh(function(t,e){e(n)})},Mh.ks=function(t){return new Mh(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Mh.Vs=function(t){for(var n=Mh.resolve(!1),e=function(e){n=n.next(function(t){return t?Mh.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Mh.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.ks(i)},Mh),Nh=(Object.defineProperty(Lh.prototype,"readTime",{get:function(){return jr(void 0!==this.Fs,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.Fs},set:function(t){jr(void 0===this.Fs||this.Fs.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.Fs=t},enumerable:!0,configurable:!0}),Lh.prototype.Us=function(t,e){this.xs(),this.readTime=e,this.Ns.set(t.key,t)},Lh.prototype.js=function(t,e){this.xs(),e&&(this.readTime=e),this.Ns.set(t,null)},Lh.prototype.Ls=function(t,e){this.xs();var n=this.Ns.get(e);return void 0!==n?Ih.resolve(n):this.Bs(t,e)},Lh.prototype.getEntries=function(t,e){return this.Ms(t,e)},Lh.prototype.apply=function(t){return this.xs(),this.Os=!0,this.qs(t)},Lh.prototype.xs=function(){jr(!this.Os,"Changes have already been applied.")},Lh),Th="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ah=(Ph.prototype.Gs=function(t){this.Qs.push(t)},Ph.prototype.Ws=function(){this.Qs.forEach(function(t){return t()})},Ph),Sh=(Oh.Ks=function(o,t,s){return jr(Oh.Hs(),"IndexedDB not supported in current environment."),Ur("SimpleDb","Opening database:",o),new Ih(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Oh(e))},i.onblocked=function(){r(new ti(Zr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new ti(Zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ur("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Mc).next(function(){Ur("SimpleDb","Database upgrade to version "+Mc+" complete")})}}).Ss()},Oh.delete=function(t){return Ur("SimpleDb","Removing database:",t),Fh(window.indexedDB.deleteDatabase(t)).Ss()},Oh.Hs=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Oh.Js())return!0;if(void 0===window.navigator)return!1;var t=l(),e=Oh.zs(t),n=0<e&&e<10,r=Oh.Ys(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Oh.Js=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Xs)},Oh.$s=function(t,e){return t.store(e)},Oh.zs=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Oh.Ys=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Oh.prototype.Zs=function(e){this.db.onversionchange=function(t){return e(t)}},Oh.prototype.runTransaction=function(r,h,c){return p(this,void 0,void 0,function(){var o,s,a,e,u,n;return y(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),s=r.endsWith("idempotent"),a=0,e=function(){var e,n,r,i;return y(this,function(t){switch(t.label){case 0:++a,e=Dh.open(u.db,o?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=c(e).catch(function(t){return e.abort(t),Ih.reject(t)}).Ss()).catch(function(){}),[4,e.to];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=s&&"FirebaseError"!==r.name&&a<3,Ur("SimpleDb","Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},Oh.prototype.close=function(){this.db.close()},Oh),kh=(Object.defineProperty(Ch.prototype,"Rs",{get:function(){return this.io},enumerable:!0,configurable:!0}),Object.defineProperty(Ch.prototype,"ro",{get:function(){return this.eo},enumerable:!0,configurable:!0}),Object.defineProperty(Ch.prototype,"cursor",{set:function(t){this.no=t},enumerable:!0,configurable:!0}),Ch.prototype.done=function(){this.io=!0},Ch.prototype.uo=function(t){this.eo=t},Ch.prototype.delete=function(){return Fh(this.no.delete())},Ch),Dh=(xh.open=function(t,e,n){return new xh(t.transaction(n,e))},Object.defineProperty(xh.prototype,"to",{get:function(){return this.so.promise},enumerable:!0,configurable:!0}),xh.prototype.abort=function(t){t&&this.so.reject(t),this.aborted||(Ur("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},xh.prototype.store=function(t){var e=this.transaction.objectStore(t);return jr(!!e,"Object store not part of transaction: "+t),new Rh(e)},xh),Rh=(_h.prototype.put=function(t,e){return Fh(void 0!==e?(Ur("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ur("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},_h.prototype.add=function(t){return Ur("SimpleDb","ADD",this.store.name,t,t),Fh(this.store.add(t))},_h.prototype.get=function(e){var n=this;return Fh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ur("SimpleDb","GET",n.store.name,e,t),t})},_h.prototype.delete=function(t){return Ur("SimpleDb","DELETE",this.store.name,t),Fh(this.store.delete(t))},_h.prototype.count=function(){return Ur("SimpleDb","COUNT",this.store.name),Fh(this.store.count())},_h.prototype.oo=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ho(n,function(t,e){r.push(e)}).next(function(){return r})},_h.prototype.co=function(t,e){Ur("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ao=!1;var r=this.cursor(n);return this.ho(r,function(t,e,n){return n.delete()})},_h.prototype.fo=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ho(r,e)},_h.prototype.lo=function(i){var t=this.cursor({});return new Ih(function(n,r){t.onerror=function(t){var e=Hh(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},_h.prototype.ho=function(t,s){var a=[];return new Ih(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new kh(e),r=s(e.primaryKey,e.value,n);if(r instanceof Ih){var i=r.catch(function(t){return n.done(),Ih.reject(t)});a.push(i)}n.Rs?o():null===n.ro?e.continue():e.continue(n.ro)}else o()}}).next(function(){return Ih.ks(a)})},_h.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(jr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},_h.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ao?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},_h);function _h(t){this.store=t}function xh(t){var n=this;this.transaction=t,this.aborted=!1,this.so=new Ku,this.transaction.oncomplete=function(){n.so.resolve()},this.transaction.onabort=function(){t.error?n.so.reject(t.error):n.so.resolve()},this.transaction.onerror=function(t){var e=Hh(t.target.error);n.so.reject(e)}}function Ch(t){this.no=t,this.io=!1,this.eo=null}function Oh(t){this.db=t,12.2===Oh.zs(l())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Ph(){this.Qs=[]}function Lh(){this.Ns=new Eh(function(t){return t.toString()}),this.Os=!1}function Mh(t){var e=this;this.Ts=null,this.Es=null,this.result=void 0,this.error=void 0,this.Rs=!1,this.As=!1,t(function(t){e.Rs=!0,e.result=t,e.Ts&&e.Ts(t)},function(t){e.Rs=!0,e.error=t,e.Es&&e.Es(t)})}function Uh(t){this._s=t,this.Is={}}function qh(t,e){this.key=t,this.ys=e}function Vh(){this.hs=new so(bh.Bn),this.cs=new so(bh.as)}function Gh(t,e,n,r,i){this.batch=t,this.ss=e,this.rs=n,this.streamToken=r,this.os=i}function jh(t,e,n,r){this.batchId=t,this.jn=e,this.baseMutations=n,jr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}function Fh(t){return new Ih(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Hh(t.target.error);r(e)}})}var Bh=!1;function Hh(t){var e=Sh.zs(l());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new ti("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Bh||(Bh=!0,setTimeout(function(){throw r},0)),r}}return t}var zh=(Jh.mo=function(t,e,n,r){return jr(""!==t.uid,"UserID must not be an empty string."),new Jh(t.l()?t.uid:"",e,n,r)},Jh.prototype.po=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xh(t).fo({index:zc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Jh.prototype.bo=function(e,t,n){return this.yo(e).next(function(t){return t.lastStreamToken=n.toBase64(),Kh(e).put(t)})},Jh.prototype._o=function(t){return this.yo(t).next(function(t){return Ba.fromBase64String(t.lastStreamToken)})},Jh.prototype.Io=function(e,n){return this.yo(e).next(function(t){return t.lastStreamToken=n.toBase64(),Kh(e).put(t)})},Jh.prototype.To=function(h,c,f,l){var p=this,d=Qh(h),y=Xh(h);return y.add({}).next(function(t){jr("number"==typeof t,"Auto-generated key is not a number");for(var e=new mh(t,c,f,l),n=p.serializer.Eo(p.userId,e),r=[],i=new so(function(t,e){return Hr(t.nt(),e.nt())}),o=0,s=l;o<s.length;o++){var a=s[o],u=Yc.key(p.userId,a.key.path,t);i=i.add(a.key.path.H()),r.push(y.put(n)),r.push(d.put(u,Yc.PLACEHOLDER))}return i.forEach(function(t){r.push(p.do.Ro(h,t))}),h.Gs(function(){p.wo[t]=e.keys()}),Ih.ks(r).next(function(){return e})})},Jh.prototype.Ao=function(t,e){var n=this;return Xh(t).get(e).next(function(t){return t?(jr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.Do(t)):null})},Jh.prototype.Po=function(t,n){var r=this;return this.wo[n]?Ih.resolve(this.wo[n]):this.Ao(t,n).next(function(t){if(t){var e=t.keys();return r.wo[n]=e}return null})},Jh.prototype.So=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Xh(t).fo({index:zc.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(jr(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.Do(e)),n.done()}).next(function(){return o})},Jh.prototype.Co=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Xh(t).fo({index:zc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Jh.prototype.ko=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xh(t).oo(zc.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.Do(t)})})},Jh.prototype.Vo=function(a,u){var h=this,t=Yc.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),c=[];return Qh(a).fo({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],s=vh(i);if(r===h.userId&&u.path.isEqual(s))return Xh(a).get(o).next(function(t){if(!t)throw Gr("Dangling document-mutation reference found: "+e+" which points to "+o);jr(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),c.push(h.serializer.Do(t))});n.done()}).next(function(){return c})},Jh.prototype.No=function(r,t){var u=this,h=new so(Hr),i=[];return t.forEach(function(a){var t=Yc.prefixForPath(u.userId,a.path),e=IDBKeyRange.lowerBound(t),n=Qh(r).fo({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=vh(i);r===u.userId&&a.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),Ih.ks(i).next(function(){return u.Oo(r,h)})},Jh.prototype.Fo=function(t,e){var a=this;jr(!e.zn(),"Document queries shouldn't go down this path"),jr(!e._i(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,h=u.length+1,n=Yc.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),c=new so(Hr);return Qh(t).fo({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=vh(i);r===a.userId&&u.$(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return a.Oo(t,c)})},Jh.prototype.Oo=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Xh(t).get(e).next(function(t){if(null===t)throw Gr("Dangling document-mutation reference found, which points to "+e);jr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.Do(t))}))}),Ih.ks(i).next(function(){return r})},Jh.prototype.Uo=function(e,n){var r=this;return Yh(e.xo,this.userId,n).next(function(t){return e.Gs(function(){r.jo(n.batchId)}),Ih.forEach(t,function(t){return r.vo.Lo(e,t)})})},Jh.prototype.jo=function(t){delete this.wo[t]},Jh.prototype.Bo=function(n){var o=this;return this.po(n).next(function(t){if(!t)return Ih.resolve();var e=IDBKeyRange.lowerBound(Yc.prefixForUser(o.userId)),i=[];return Qh(n).fo({range:e},function(t,e,n){if(t[0]===o.userId){var r=vh(t[1]);i.push(r)}else n.done()}).next(function(){jr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.nt()}))})})},Jh.prototype.bs=function(t,e){return Wh(t,this.userId,e)},Jh.prototype.yo=function(t){var e=this;return Kh(t).get(this.userId).next(function(t){return t||new Hc(e.userId,-1,"")})},Jh);function Jh(t,e,n,r){this.userId=t,this.serializer=e,this.do=n,this.vo=r,this.wo={}}function Wh(t,o,e){var n=Yc.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),a=!1;return Qh(t).fo({range:r,ao:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function Yh(t,e,n){var r=t.store(zc.store),i=t.store(Yc.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.fo({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){jr(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Yc.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return Ih.ks(o).next(function(){return h})}function Xh(t){return Nf.$s(t,zc.store)}function Qh(t){return Nf.$s(t,Yc.store)}function Kh(t){return Nf.$s(t,Hc.store)}var $h,Zh;(Zh=$h=$h||{})[Zh.Mo=0]="__PRIVATE_QueryCache",Zh[Zh.qo=1]="__PRIVATE_SyncEngine";var tc=(uc.prototype.next=function(){var t=this.Wo;return this.Wo+=2,t},uc.prototype.after=function(t){return this.Go(t+2),this.next()},uc.prototype.Go=function(t){jr((1&t)===this.Qo,"Cannot supply target ID from different generator ID"),this.Wo=t},uc.zo=function(){return new uc($h.Mo,2)},uc.Ko=function(){return new uc($h.qo)},uc),ec=(ac.prototype.Yo=function(e,n){var r=this;return this.Jo.Vo(e,n).next(function(t){return r.Xo(e,n,t)})},ac.prototype.Xo=function(t,r,i){return this.Ho.Ls(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Gt(r,t);return t})},ac.prototype.$o=function(t,e,i){var o=ru();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Gt(t,e);o=o.lt(t,e)}),o},ac.prototype.Zo=function(e,t){var n=this;return this.Ho.getEntries(e,t).next(function(t){return n.th(e,t)})},ac.prototype.th=function(r,i){var o=this;return this.Jo.No(r,i).next(function(t){var e=o.$o(r,i,t),n=nu();return e.forEach(function(t,e){e=e||new Ms(t,Vi.B()),n=n.lt(t,e)}),n})},ac.prototype.nh=function(t,e,n){return e.zn()?this.ih(t,e.path):e._i()?this.eh(t,e,n):this.rh(t,e,n)},ac.prototype.ih=function(t,e){return this.Yo(t,new Hi(e)).next(function(t){var e=ou();return t instanceof Ls&&(e=e.lt(t.key,t)),e})},ac.prototype.eh=function(n,r,i){var o=this;jr(r.path.J(),"Currently we only support collection group queries at the root.");var s=r.collectionGroup,a=ou();return this.do.uh(n,s).next(function(t){return Ih.forEach(t,function(t){var e=r.ai(t.child(s));return o.rh(n,e,i).next(function(t){t.forEach(function(t,e){a=a.lt(t,e)})})}).next(function(){return a})})},ac.prototype.rh=function(e,n,t){var c,f,r=this;return this.Ho.nh(e,n,t).next(function(t){return c=t,r.Jo.Fo(e,n)}).next(function(t){return f=t,r.sh(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a),h=s.Gt(u,u,r.jn);c=h instanceof Ls?c.lt(a,h):c.remove(a)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},ac.prototype.sh=function(t,e,n){for(var r=hu(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Vo&&null===n.get(u.key)&&(r=r.add(u.key))}var h=n;return this.Ho.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ls&&(h=h.lt(t,e))}),h})},ac),nc=(sc.ah=function(t,e){for(var n=hu(),r=hu(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case lu.Bi:n=n.add(s.doc.key);break;case lu.Mi:r=r.add(s.doc.key)}}return new sc(t,e.fromCache,n,r)},sc),rc="LocalStore",ic=(oc.prototype.start=function(){return this.Ah()},oc.prototype.Dh=function(i){return p(this,void 0,void 0,function(){var e,v,n,r=this;return y(this,function(t){switch(t.label){case 0:return e=this.Jo,v=this.Th,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var y;return r.Jo.ko(d).next(function(t){return y=t,e=r.persistence.gh(i),v=new ec(r.bh,e,r.persistence.Eh()),e.ko(d)}).next(function(t){for(var e=[],n=[],r=hu(),i=0,o=y;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++){var h=u[a];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){s=f[c],n.push(s.batchId);for(var l=0,p=s.mutations;l<p.length;l++)h=p[l],r=r.add(h.key)}return v.Zo(d,r).next(function(t){return{Ph:t,Sh:e,Ch:n}})})})];case 1:return n=t.sent(),this.Jo=e,this.Th=v,this.fh.Rh(this.Th),[2,n]}})})},oc.prototype.kh=function(a){var u,h=this,c=qi.now(),t=a.reduce(function(t,e){return t.add(e.key)},hu());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(s){return h.Th.Zo(s,t).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=i.sn(u.get(i.key));null!=o&&e.push(new Vo(i.key,o,o.on(),Mo.exists(!0)))}return h.Jo.To(s,c,e,a)})}).then(function(t){var e=t.us(u);return{batchId:t.batchId,Ns:e}})},oc.prototype.Vh=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.Jo.Po(e,t).next(function(t){return t?n.Th.Zo(e,t):Ih.resolve(null)})})},oc.prototype.bo=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.bh.Nh({Oh:!0});return i.Jo.bo(t,r.batch,r.streamToken).next(function(){return i.Fh(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Jo.Bo(t)}).next(function(){return i.Th.Zo(t,e)})})},oc.prototype.Uh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.Jo.Ao(e,t).next(function(t){return jr(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.Jo.Uo(e,t)}).next(function(){return r.Jo.Bo(e)}).next(function(){return r.Th.Zo(e,n)})})},oc.prototype.Co=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.Jo.Co(t)})},oc.prototype._o=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.Jo._o(t)})},oc.prototype.Io=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.Jo.Io(t,e)})},oc.prototype.xh=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e._h.xh(t)})},oc.prototype.jh=function(u){var h=this,c=u.Ni,f=this.dh;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=h.bh.Nh({Oh:!0});f=h.dh;var s=[];di(u.Zi,function(t,e){var n=f.get(t);if(n){s.push(h._h.Lh(o,e.he,t).next(function(){return h._h.Bh(o,e.se,t)}));var r=e.resumeToken;if(0<r.Nn()){var i=n.Fi(r,c).Oi(o.Mh);f=f.lt(t,i),oc.qh(n,i,e)&&s.push(h._h.Qh(o,i))}}});var a=nu(),n=hu();if(u.ne.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){u.ne.forEach(function(t,e){var n=r.get(t);e instanceof Ms&&e.version.isEqual(Vi.MIN)?(i.js(t,c),a=a.lt(t,e)):null==n||0<e.version.h(n.version)||0===e.version.h(n.version)&&n.hasPendingWrites?(jr(!Vi.MIN.isEqual(c),"Cannot add a document when the remote version is zero"),i.Us(e,c),a=a.lt(t,e)):Ur(rc,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.ie.has(t)&&s.push(h.persistence.vo.Gh(o,t))})})),!c.isEqual(Vi.MIN)){var t=h._h.xh(o).next(function(t){return jr(0<=c.h(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),h._h.Wh(o,o.Mh,c)});s.push(t)}return Ih.ks(s).next(function(){return i.apply(o)}).next(function(){return h.Th.th(o,a)})}).then(function(t){return h.dh=f,t})},oc.qh=function(t,e,n){return jr(0<e.resumeToken.Nn(),"Attempted to persist target data with no resume token"),0===t.resumeToken.Nn()||e.Ni.M()-t.Ni.M()>=this.zh||0<n.se.size+n.oe.size+n.he.size},oc.prototype.Kh=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.lh.ls(i.oh,o),this.lh.ws(i.hh,o),!i.fromCache){var s=this.dh.get(o);jr(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.Ni,u=s.Ui(a);this.dh=this.dh.lt(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Ih.forEach(t,function(t){return Ih.forEach(t.hh,function(t){return n.persistence.vo.ds(e,t)})})})},oc.prototype.Hh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.Jo.So(t,e)})},oc.prototype.Jh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.Th.Yo(t,e)})},oc.prototype.Yh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i._h.Xh(e,r).next(function(t){return t?(n=t,Ih.resolve(n)):i._h.$h(e).next(function(t){return n=new Xa(r,t,ja.Si,e.Mh),i._h.Zh(e,n).next(function(){return n})})})}).then(function(t){return null===i.dh.get(t.targetId)&&(i.dh=i.dh.lt(t.targetId,t),i.vh.set(r,t.targetId)),t})},oc.prototype.Xh=function(t,e){var n=this.vh.get(e);return void 0!==n?Ih.resolve(this.dh.get(n)):this._h.Xh(t,e)},oc.prototype.tc=function(n,r){var i=this,o=this.dh.get(n);jr(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.lh.ms(n);return r?Ih.resolve():Ih.forEach(t,function(t){return i.persistence.vo.ds(e,t)}).next(function(){i.persistence.vo.removeTarget(e,o)})}).then(function(){i.dh=i.dh.remove(n),i.vh.delete(o.target)})},oc.prototype.nc=function(t,n){var r=this,i=Vi.MIN,o=hu();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.Xh(e,t.li()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r._h.ic(e,t.targetId).next(function(t){o=t})}).next(function(){return r.fh.nh(e,t,n?i:Vi.MIN,n?o:hu())}).next(function(t){return{documents:t,ec:o}})})},oc.prototype.rc=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n._h.ic(t,e)})},oc.prototype.uc=function(){return this.persistence.uc()},oc.prototype.sc=function(t){this.Jo.jo(t)},oc.prototype.oc=function(t){this.persistence.oc(t)},oc.prototype.Fh=function(t,i,o){var e=this,s=i.batch,n=s.keys(),a=Ih.resolve();return n.forEach(function(r){a=a.next(function(){return o.Ls(t,r)}).next(function(t){var e=t,n=i.os.get(r);jr(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.h(n)<0)&&((e=s.Wt(r,e,i))?o.Us(e,i.ss):jr(!t,"Mutation batch "+s+" applied to document "+t+" resulted in null"))})}),a.next(function(){return e.Jo.Uo(t,s)})},oc.prototype.hc=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.cc(t,n.dh)})},oc.prototype.ac=function(e){var n=this,t=this.dh.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n._h.Ye(t,e).next(function(t){return t?t.target:null})})},oc.prototype.fc=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.bh.fc(t,r.wh)}).then(function(t){var e=t.lc,n=t.readTime;return r.wh=n,e})},oc.prototype.Ah=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return n.bh.dc(t)})];case 1:return e.wh=t.sent(),[2]}})})},oc.zh=3e8,oc);function oc(t,e,n){this.persistence=t,this.fh=e,this.lh=new wh,this.dh=new zi(Hr),this.vh=new Eh(function(t){return t.canonicalId()}),this.wh=Vi.MIN,jr(t.mh,"LocalStore was passed an unstarted persistence implementation"),this.persistence.vo.ph(this.lh),this.Jo=t.gh(n),this.bh=t.yh(),this._h=t.Ih(),this.Th=new ec(this.bh,this.Jo,this.persistence.Eh()),this.fh.Rh(this.Th)}function sc(t,e,n,r){this.targetId=t,this.fromCache=e,this.oh=n,this.hh=r}function ac(t,e,n){this.Ho=t,this.Jo=e,this.do=n}function uc(t,e){jr((1&(this.Qo=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.Go(void 0!==e?e:this.Qo)}function hc(e){return p(this,void 0,void 0,function(){return y(this,function(t){if(e.code!==Zr.FAILED_PRECONDITION||e.message!==Th)throw e;return Ur(rc,"Unexpectedly lost primary lease"),[2]})})}function cc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Hr(n,i);return 0===s?Hr(r,o):s}var fc=(Ec.prototype.mc=function(){return++this.wc},Ec.prototype.pc=function(t){var e=[t,this.mc()];if(this.buffer.size<this.vc)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();cc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Ec.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Ec),lc={gc:!1,bc:0,yc:0,_c:0},pc=(bc.Rc=function(t){return new bc(t,bc.Ac,bc.Dc)},bc.Pc=-1,bc.Sc=1048576,bc.kc=new bc(bc.Cc=41943040,bc.Ac=10,bc.Dc=1e3),bc.DISABLED=new bc(bc.Pc,0,0),bc),dc=(wc.prototype.start=function(){jr(null===this.Fc,"Cannot start an already started LruScheduler"),this.Vc.params.Ic!==pc.Pc&&this.Uc()},wc.prototype.stop=function(){this.Fc&&(this.Fc.cancel(),this.Fc=null)},Object.defineProperty(wc.prototype,"mh",{get:function(){return null!==this.Fc},enumerable:!0,configurable:!0}),wc.prototype.Uc=function(){var t=this;jr(null===this.Fc,"Cannot schedule GC while a task is pending");var e=this.Oc?3e5:6e4;Ur("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Fc=this.Pu.Yu($u.Au,e,function(){return t.Fc=null,t.Oc=!0,t.Nc.hc(t.Vc).then(function(){return t.Uc()}).catch(hc)})},wc),yc=(gc.prototype.jc=function(t,e){return this.xc.Lc(t).next(function(t){return Math.floor(e/100*t)})},gc.prototype.Bc=function(t,e){var n=this;if(0===e)return Ih.resolve(nh.gu);var r=new fc(e);return this.xc.Le(t,function(t){return r.pc(t.sequenceNumber)}).next(function(){return n.xc.Mc(t,function(t){return r.pc(t)})}).next(function(){return r.maxValue})},gc.prototype.qc=function(t,e,n){return this.xc.qc(t,e,n)},gc.prototype.Qc=function(t,e){return this.xc.Qc(t,e)},gc.prototype.cc=function(e,n){var r=this;return this.params.Ic===pc.Pc?(Ur("LruGarbageCollector","Garbage collection skipped; disabled"),Ih.resolve(lc)):this.Gc(e).next(function(t){return t<r.params.Ic?(Ur("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Ic),lc):r.Wc(e,n)})},gc.prototype.Gc=function(t){return this.xc.Gc(t)},gc.prototype.Wc=function(e,n){var r,i,o,s,a,u,h,c=this,f=Date.now();return this.jc(e,this.params.Tc).next(function(t){return i=t>c.params.Ec?(Ur("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Ec+" from "+t),c.params.Ec):t,s=Date.now(),c.Bc(e,i)}).next(function(t){return r=t,a=Date.now(),c.qc(e,r,n)}).next(function(t){return o=t,u=Date.now(),c.Qc(e,r)}).next(function(t){return h=Date.now(),Lr()<=Ar.DEBUG&&Ur("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(h-u)+"ms\nTotal Duration: "+(h-f)+"ms"),Ih.resolve({gc:!0,bc:i,yc:o,_c:t})})},gc),vc=(mc.prototype.$h=function(e){var n=this;return this.Kc(e).next(function(t){return t.highestTargetId=n.zc.after(t.highestTargetId),n.Hc(e,t).next(function(){return t.highestTargetId})})},mc.prototype.xh=function(t){return this.Kc(t).next(function(t){return Vi.L(new qi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},mc.prototype.Jc=function(t){return Tc(t.xo)},mc.prototype.Wh=function(e,n,r){var i=this;return this.Kc(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.q()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Hc(e,t)})},mc.prototype.Zh=function(e,n){var r=this;return this.Yc(e,n).next(function(){return r.Kc(e).next(function(t){return t.targetCount+=1,r.Xc(n,t),r.Hc(e,t)})})},mc.prototype.Qh=function(t,e){return this.Yc(t,e)},mc.prototype.$c=function(e,t){var n=this;return this.Zc(e,t.targetId).next(function(){return Ic(e).delete(t.targetId)}).next(function(){return n.Kc(e)}).next(function(t){return jr(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.Hc(e,t)})},mc.prototype.qc=function(r,i,o){var s=this,a=0,u=[];return Ic(r).fo(function(t,e){var n=s.serializer.ta(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(a++,u.push(s.$c(r,n)))}).next(function(){return Ih.ks(u)}).next(function(){return a})},mc.prototype.Le=function(t,r){var i=this;return Ic(t).fo(function(t,e){var n=i.serializer.ta(e);r(n)})},mc.prototype.Kc=function(t){return Nc(t.xo)},mc.prototype.Hc=function(t,e){return(n=t,Nf.$s(n,of.store)).put(of.key,e);var n},mc.prototype.Yc=function(t,e){return Ic(t).put(this.serializer.na(e))},mc.prototype.Xc=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},mc.prototype.ia=function(t){return this.Kc(t).next(function(t){return t.targetCount})},mc.prototype.Xh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Ic(t).fo({range:n,index:nf.queryTargetsIndexName},function(t,e,n){var r=o.serializer.ta(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},mc.prototype.Bh=function(n,t,r){var i=this,o=[],s=Ac(n);return t.forEach(function(t){var e=ph(t.path);o.push(s.put(new rf(r,e))),o.push(i.vo.fs(n,t))}),Ih.ks(o)},mc.prototype.Lh=function(n,t,r){var i=this,o=Ac(n);return Ih.forEach(t,function(t){var e=ph(t.path);return Ih.ks([o.delete([r,e]),i.vo.ds(n,t)])})},mc.prototype.Zc=function(t,e){var n=Ac(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},mc.prototype.ic=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ac(t),o=hu();return r.fo({range:n,ao:!0},function(t,e,n){var r=vh(t[1]),i=new Hi(r);o=o.add(i)}).next(function(){return o})},mc.prototype.bs=function(t,e){var n=ph(e.path),r=IDBKeyRange.bound([n],[Jr(n)],!1,!0),i=0;return Ac(t).fo({index:rf.documentTargetsIndex,ao:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},mc.prototype.Ye=function(t,e){var n=this;return Ic(t).get(e).next(function(t){return t?n.serializer.ta(t):null})},mc);function mc(t,e){this.vo=t,this.serializer=e,this.zc=tc.zo()}function gc(t,e){this.xc=t,this.params=e}function wc(t,e,n){this.Vc=t,this.Pu=e,this.Nc=n,this.Oc=!1,this.Fc=null}function bc(t,e,n){this.Ic=t,this.Tc=e,this.Ec=n}function Ec(t){this.vc=t,this.buffer=new so(cc),this.wc=0}function Ic(t){return Nf.$s(t,nf.store)}function Nc(t){return Sh.$s(t,of.store).get(of.key).next(function(t){return jr(null!==t,"Missing metadata row."),t})}function Tc(t){return Nc(t).next(function(t){return t.highestListenSequenceNumber})}function Ac(t){return Nf.$s(t,rf.store)}var Sc,kc=(Dc.prototype.Us=function(t,e,n){return xc(t).put(Cc(e),n)},Dc.prototype.js=function(t,e){var n=xc(t),r=Cc(e);return n.delete(r)},Dc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.ea(e,t)})},Dc.prototype.Ls=function(t,e){var n=this;return xc(t).get(Cc(e)).next(function(t){return n.ra(t)})},Dc.prototype.ua=function(t,e){var n=this;return xc(t).get(Cc(e)).next(function(t){var e=n.ra(t);return e?{sa:e,size:Oc(t)}:null})},Dc.prototype.getEntries=function(t,e){var r=this,i=ru();return this.oa(t,e,function(t,e){var n=r.ra(e);i=i.lt(t,n)}).next(function(){return i})},Dc.prototype.ha=function(t,e){var r=this,i=ru(),o=new zi(Hi.G);return this.oa(t,e,function(t,e){var n=r.ra(e);o=n?(i=i.lt(t,n),o.lt(t,Oc(e))):(i=i.lt(t,null),o.lt(t,0))}).next(function(){return{ca:i,aa:o}})},Dc.prototype.oa=function(t,e,i){if(e.J())return Ih.resolve();var n=IDBKeyRange.bound(e.first().path.tt(),e.last().path.tt()),o=e.bt(),s=o.Rt();return xc(t).fo({range:n},function(t,e,n){for(var r=Hi.at(t);s&&Hi.G(s,r)<0;)i(s,null),s=o.Rt();s&&s.isEqual(r)&&(i(s,e),s=o.At()?o.Rt():null),s?n.uo(s.path.tt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.At()?o.Rt():null})},Dc.prototype.nh=function(t,i,e){var o=this;jr(!i._i(),"CollectionGroup queries should be handled in LocalDocumentsView");var s=ou(),a=i.path.length+1,n={};if(e.isEqual(Vi.MIN)){var r=i.path.tt();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.tt(),h=this.serializer.fa(e);n.range=IDBKeyRange.lowerBound([u,h],!0),n.index=$c.collectionReadTimeIndex}return xc(t).fo(n,function(t,e,n){if(t.length===a){var r=o.serializer.la(e);i.path.$(r.key.path)?r instanceof Ls&&i.matches(r)&&(s=s.lt(r.key,r)):n.done()}}).next(function(){return s})},Dc.prototype.fc=function(t,e){var r=this,i=nu(),o=this.serializer.fa(e),n=xc(t),s=IDBKeyRange.lowerBound(o,!0);return n.fo({index:$c.readTimeIndex,range:s},function(t,e){var n=r.serializer.la(e);i=i.lt(n.key,n),o=e.readTime}).next(function(){return{lc:i,readTime:r.serializer.da(o)}})},Dc.prototype.dc=function(t){var r=this,e=xc(t),i=Vi.MIN;return e.fo({index:$c.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.da(e.readTime)),n.done()}).next(function(){return i})},Dc.prototype.Nh=function(t){return new Dc.va(this,!!t&&t.Oh)},Dc.prototype.wa=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Dc.prototype.getMetadata=function(t){return _c(t).get(Zc.key).next(function(t){return jr(!!t,"Missing document cache metadata"),t})},Dc.prototype.ea=function(t,e){return _c(t).put(Zc.key,e)},Dc.prototype.ra=function(t){if(t){var e=this.serializer.la(t);return e instanceof Ms&&e.version.isEqual(Vi.B())?null:e}return null},Dc.va=(t(Rc,Sc=Nh),Rc.prototype.qs=function(s){var a=this,u=[],h=0,c=new so(function(t,e){return Hr(t.nt(),e.nt())});return this.Ns.forEach(function(t,e){var n=a.pa.get(t);if(jr(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){jr(!a.readTime.isEqual(Vi.MIN),"Cannot add a document with a read time of zero");var r=a.ma.serializer.ga(e,a.readTime);c=c.add(t.path.H());var i=Oc(r);h+=i-n,u.push(a.ma.Us(s,t,r))}else if(h-=n,a.Oh){var o=a.ma.serializer.ga(new Ms(t,Vi.B()),a.readTime);u.push(a.ma.Us(s,t,o))}else u.push(a.ma.js(s,t))}),c.forEach(function(t){u.push(a.ma.do.Ro(s,t))}),u.push(this.ma.updateMetadata(s,h)),Ih.ks(u)},Rc.prototype.Bs=function(t,e){var n=this;return this.ma.ua(t,e).next(function(t){return null===t?(n.pa.set(e,0),null):(n.pa.set(e,t.size),t.sa)})},Rc.prototype.Ms=function(t,e){var n=this;return this.ma.ha(t,e).next(function(t){var e=t.ca;return t.aa.forEach(function(t,e){n.pa.set(t,e)}),e})},Rc),Dc);function Dc(t,e){this.serializer=t,this.do=e}function Rc(t,e){var n=Sc.call(this)||this;return n.ma=t,n.Oh=e,n.pa=new Eh(function(t){return t.toString()}),n}function _c(t){return Nf.$s(t,Zc.store)}function xc(t){return Nf.$s(t,$c.store)}function Cc(t){return t.path.tt()}function Oc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Gr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Pc=(Gc.prototype.Ro=function(t,e){return this.ba.add(e),Ih.resolve()},Gc.prototype.uh=function(t,e){return Ih.resolve(this.ba.getEntries(e))},Gc),Lc=(Vc.prototype.add=function(t){jr(t.length%2==1,"Expected a collection path.");var e=t.X(),n=t.H(),r=this.index[e]||new so(ji.G),i=!r.has(n);return this.index[e]=r.add(n),i},Vc.prototype.has=function(t){var e=t.X(),n=t.H(),r=this.index[e];return r&&r.has(n)},Vc.prototype.getEntries=function(t){return(this.index[t]||new so(ji.G)).tt()},Vc),Mc=9,Uc=(qc.prototype.createOrUpgrade=function(n,r,t,e){var i=this;jr(t<e&&0<=t&&e<=Mc,"Unexpected schema upgrade from v"+t+" to v{toVersion}.");var o,s=new Dh(r);t<1&&1<=e&&(n.createObjectStore(Fc.store),(o=n).createObjectStore(Hc.store,{keyPath:Hc.keyPath}),o.createObjectStore(zc.store,{keyPath:zc.keyPath,autoIncrement:!0}).createIndex(zc.userMutationsIndex,zc.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Yc.store),ff(n),n.createObjectStore($c.store));var a,u=Ih.resolve();return t<3&&3<=e&&(0!==t&&((a=n).deleteObjectStore(rf.store),a.deleteObjectStore(nf.store),a.deleteObjectStore(of.store),ff(n)),u=u.next(function(){return t=s.store(of.store),e=new of(0,0,Vi.MIN.q(),0),t.put(of.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(u=u.next(function(){return r=n,(i=s).store(zc.store).oo().next(function(t){r.deleteObjectStore(zc.store),r.createObjectStore(zc.store,{keyPath:zc.keyPath,autoIncrement:!0}).createIndex(zc.userMutationsIndex,zc.userMutationsKeyPath,{unique:!0});var e=i.store(zc.store),n=t.map(function(t){return e.put(t)});return Ih.ks(n)});var r,i})),u=u.next(function(){n.createObjectStore(lf.store,{keyPath:lf.keyPath})})),t<5&&5<=e&&(u=u.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(u=u.next(function(){return n.createObjectStore(Zc.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(u=u.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(u=u.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(u=u.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore($c.store)).createIndex($c.readTimeIndex,$c.readTimeIndexPath,{unique:!1}),t.createIndex($c.collectionReadTimeIndex,$c.collectionReadTimeIndexPath,{unique:!1})})),u},qc.prototype.addDocumentGlobal=function(e){var n=0;return e.store($c.store).fo(function(t,e){n+=Oc(e)}).next(function(){var t=new Zc(n);return e.store(Zc.store).put(Zc.key,t)})},qc.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Hc.store),e=r.store(zc.store);return t.oo().next(function(t){return Ih.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.oo(zc.userMutationsIndex,t).next(function(t){return Ih.forEach(t,function(t){jr(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.Do(t);return Yh(r,n.userId,e).next(function(){})})})})})},qc.prototype.ensureSequenceNumbers=function(t){var s=t.store(rf.store),e=t.store($c.store);return Tc(t).next(function(i){var o=[];return e.fo(function(t,e){var n=new ji(t),r=[0,ph(n)];o.push(s.get(r).next(function(t){return t?Ih.resolve():(e=n,s.put(new rf(0,ph(e),i)));var e}))}).next(function(){return Ih.ks(o)})})},qc.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.X(),n=t.H();return r.put({collectionId:e,parent:ph(n)})}}t.createObjectStore(sf.store,{keyPath:sf.keyPath});var r=e.store(sf.store),o=new Lc;return e.store($c.store).fo({ao:!0},function(t,e){var n=new ji(t);return i(n.H())}).next(function(){return e.store(Yc.store).fo({ao:!0},function(t,e){t[0];var n=t[1],r=(t[2],vh(n));return i(r.H())})})},qc);function qc(t){this.serializer=t}function Vc(){this.index={}}function Gc(){this.ba=new Lc}function jc(t,e){this.seconds=t,this.nanoseconds=e}var Fc=(Bc.store="owner",Bc.key="owner",Bc);function Bc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Hc=(Wc.store="mutationQueues",Wc.keyPath="userId",Wc),zc=(Jc.store="mutations",Jc.keyPath="batchId",Jc.userMutationsIndex="userMutationsIndex",Jc.userMutationsKeyPath=["userId","batchId"],Jc);function Jc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}function Wc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Yc=(Xc.prefixForUser=function(t){return[t]},Xc.prefixForPath=function(t,e){return[t,ph(e)]},Xc.key=function(t,e,n){return[t,ph(e),n]},Xc.store="documentMutations",Xc.PLACEHOLDER=new Xc,Xc);function Xc(){}function Qc(t,e){this.path=t,this.readTime=e}function Kc(t,e){this.path=t,this.version=e}var $c=(ef.store="remoteDocuments",ef.readTimeIndex="readTimeIndex",ef.readTimeIndexPath="readTime",ef.collectionReadTimeIndex="collectionReadTimeIndex",ef.collectionReadTimeIndexPath=["parentPath","readTime"],ef),Zc=(tf.store="remoteDocumentGlobal",tf.key="remoteDocumentGlobalKey",tf);function tf(t){this.byteSize=t}function ef(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var nf=(cf.store="targets",cf.keyPath="targetId",cf.queryTargetsIndexName="queryTargetsIndex",cf.queryTargetsKeyPath=["canonicalId","targetId"],cf),rf=(hf.store="targetDocuments",hf.keyPath=["targetId","path"],hf.documentTargetsIndex="documentTargetsIndex",hf.documentTargetsKeyPath=["path","targetId"],hf),of=(uf.key="targetGlobalKey",uf.store="targetGlobal",uf),sf=(af.store="collectionParents",af.keyPath=["collectionId","parent"],af);function af(t,e){this.collectionId=t,this.parent=e}function uf(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function hf(t,e,n){this.targetId=t,this.path=e,jr(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}function cf(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}function ff(t){t.createObjectStore(rf.store,{keyPath:rf.keyPath}).createIndex(rf.documentTargetsIndex,rf.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(nf.store,{keyPath:nf.keyPath}).createIndex(nf.queryTargetsIndexName,nf.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(of.store)}var lf=(pf.store="clientMetadata",pf.keyPath="clientId",pf);function pf(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var df=s(s(s([Hc.store,zc.store,Yc.store,$c.store,nf.store,Fc.store,of.store,rf.store],[lf.store]),[Zc.store]),[sf.store]),yf=(vf.prototype.Ro=function(t,e){var n=this;if(jr(e.length%2==1,"Expected a collection path."),this.ya.has(e))return Ih.resolve();var r=e.X(),i=e.H();t.Gs(function(){n.ya.add(e)});var o={collectionId:r,parent:ph(i)};return mf(t).put(o)},vf.prototype.uh=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Jr(i),""],!1,!0);return mf(t).oo(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(vh(r.parent))}return o})},vf);function vf(){this.ya=new Lc}function mf(t){return Nf.$s(t,sf.store)}var gf=(wf.prototype.la=function(t){if(t.document)return this._a.Er(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Hi.at(t.noDocument.path),n=this.Ia(t.noDocument.readTime);return new Ms(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Hi.at(t.unknownDocument.path),n=this.Ia(t.unknownDocument.version),new Us(e,n)):Gr("Unexpected DbRemoteDocument")},wf.prototype.ga=function(t,e){var n=this.fa(e),r=t.key.path.H().tt();if(t instanceof Ls){var i=t.proto?t.proto:this._a.Tr(t),o=t.hasCommittedMutations;return new $c(null,null,i,o,n,r)}if(t instanceof Ms){var s=t.key.path.tt(),a=this.Ta(t.version);return o=t.hasCommittedMutations,new $c(null,new Qc(s,a),null,o,n,r)}if(t instanceof Us){s=t.key.path.tt();var u=this.Ta(t.version);return new $c(new Kc(s,u),null,null,!0,n,r)}return Gr("Unexpected MaybeDocument")},wf.prototype.fa=function(t){var e=t.q();return[e.seconds,e.nanoseconds]},wf.prototype.da=function(t){var e=new qi(t[0],t[1]);return Vi.L(e)},wf.prototype.Ta=function(t){var e=t.q();return new jc(e.seconds,e.nanoseconds)},wf.prototype.Ia=function(t){var e=new qi(t.seconds,t.nanoseconds);return Vi.L(e)},wf.prototype.Eo=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n._a.Nr(t)}),i=e.mutations.map(function(t){return n._a.Nr(t)});return new zc(t,e.batchId,e.jn.toMillis(),r,i)},wf.prototype.Do=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e._a.xr(t)}),r=t.mutations.map(function(t){return e._a.xr(t)}),i=qi.fromMillis(t.localWriteTimeMs);return new mh(t.batchId,i,n,r)},wf.prototype.Ea=function(t){var e=[];return t.forEach(function(t){e.push(ph(t.path))}),e},wf.prototype.Ra=function(t){for(var e=hu(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Hi(vh(i)))}return e},wf.prototype.ta=function(t){var e,n=this.Ia(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Ia(t.lastLimboFreeSnapshotVersion):Vi.MIN;return e=void 0!==t.query.documents?this._a.Gr(t.query):this._a.Jr(t.query),new Xa(e,t.targetId,ja.Si,t.lastListenSequenceNumber,n,r,Ba.fromBase64String(t.resumeToken))},wf.prototype.na=function(t){jr(ja.Si===t.Vi,"Only queries with purpose "+ja.Si+" may be stored, got "+t.Vi);var e,n=this.Ta(t.Ni),r=this.Ta(t.lastLimboFreeSnapshotVersion);e=t.target.zn()?this._a.Qr(t.target):this._a.Wr(t.target);var i=t.resumeToken.toBase64();return new nf(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},wf);function wf(t){this._a=t}var bf,Ef="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",If=(t(Af,bf=Ah),Af),Nf=(Tf.$s=function(t,e){if(t instanceof If)return Sh.$s(t.xo,e);throw Gr("IndexedDbPersistence must use instances of IndexedDbTransaction")},Tf.xa=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(!Tf.Hs())throw new ti(Zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Tf(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.ja,n.Aa,n.serializer,n.Da)).start()];case 1:return t.sent(),[2,e]}})})},Tf.prototype.start=function(){var e=this;return jr(!this.mh,"IndexedDbPersistence double-started!"),jr(null!==this.window,"Expected 'window' to be defined"),Sh.Ks(this.Oa,Mc,new Uc(this.serializer)).then(function(t){return e.La=t,e.Ba()}).then(function(){return e.Ma(),e.qa(),e.Qa(),e.La.runTransaction("readonly-idempotent",[of.store],function(t){return Tc(t)})}).then(function(t){e.Ga=new nh(t,e.Da)}).then(function(){e.Pa=!0}).catch(function(t){return e.La&&e.La.close(),Promise.reject(t)})},Tf.prototype.Wa=function(n){var t=this;return this.Na=function(e){return p(t,void 0,void 0,function(){return y(this,function(t){return this.mh?[2,n(e)]:[2]})})},n(this.isPrimary)},Tf.prototype.za=function(n){var t=this;this.La.Zs(function(e){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Tf.prototype.oc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Aa.xu(function(){return p(e,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.mh?[4,this.Ba()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Tf.prototype.Ba=function(){var n=this;return this.La.runTransaction("readwrite-idempotent",df,function(e){return kf(e).put(new lf(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Ka(e).next(function(t){t||(n.isPrimary=!1,n.Aa.xu(function(){return n.Na(!1)}))})}).next(function(){return n.Ha(e)}).next(function(t){return n.isPrimary&&!t?n.Ja(e).next(function(){return!1}):!!t&&n.Ya(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Ur("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Aa.xu(function(){return n.Na(t)}),n.isPrimary=t})},Tf.prototype.Ka=function(t){var e=this;return Sf(t).get(Fc.key).next(function(t){return Ih.resolve(e.Xa(t))})},Tf.prototype.$a=function(t){return kf(t).delete(this.clientId)},Tf.prototype.Za=function(){return p(this,void 0,void 0,function(){var i=this;return y(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.tf(this.Va,18e5)?[3,2]:(this.Va=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=Tf.$s(t,lf.store);return r.oo().next(function(t){var e=i.nf(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ih.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.if(t.clientId))}),t.label=2;case 2:return[2]}})})},Tf.prototype.Qa=function(){var t=this;this.ka=this.Aa.Yu($u.Ru,4e3,function(){return t.Ba().then(function(){return t.Za()}).then(function(){return t.Qa()})})},Tf.prototype.Xa=function(t){return!!t&&t.ownerId===this.clientId},Tf.prototype.Ha=function(e){var i=this;return Sf(e).get(Fc.key).next(function(t){if(null!==t&&i.tf(t.leaseTimestampMs,5e3)&&!i.ef(t.ownerId)){if(i.Xa(t)&&i.networkEnabled)return!0;if(!i.Xa(t)){if(!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,Ef);return!1}}return!(!i.networkEnabled||!i.inForeground)||kf(e).oo().next(function(t){return void 0===i.nf(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ur("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Tf.prototype.shutdown=function(){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){switch(t.label){case 0:return this.Pa=!1,this.rf(),this.ka&&(this.ka.cancel(),this.ka=null),this.uf(),this.sf(),[4,this.La.runTransaction("readwrite-idempotent",[Fc.store,lf.store],function(t){return e.Ja(t).next(function(){return e.$a(t)})})];case 1:return t.sent(),this.La.close(),this.hf(),[2]}})})},Tf.prototype.nf=function(t,e){var n=this;return t.filter(function(t){return n.tf(t.updateTimeMs,e)&&!n.ef(t.clientId)})},Tf.prototype.uc=function(){var e=this;return this.La.runTransaction("readonly-idempotent",[lf.store],function(t){return kf(t).oo().next(function(t){return e.nf(t,18e5).map(function(t){return t.clientId})})})},Tf.clearPersistence=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return Tf.Hs()?(e=n+Tf.Fa,[4,Sh.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Tf.prototype,"mh",{get:function(){return this.Pa},enumerable:!0,configurable:!0}),Tf.prototype.gh=function(t){return jr(this.mh,"Cannot initialize MutationQueue before persistence is started."),zh.mo(t,this.serializer,this.do,this.vo)},Tf.prototype.Ih=function(){return jr(this.mh,"Cannot initialize TargetCache before persistence is started."),this._h},Tf.prototype.yh=function(){return jr(this.mh,"Cannot initialize RemoteDocumentCache before persistence is started."),this.Ho},Tf.prototype.Eh=function(){return jr(this.mh,"Cannot initialize IndexManager before persistence is started."),this.do},Tf.prototype.runTransaction=function(n,t,r){var i=this;Ur("IndexedDbPersistence","Starting transaction:",n);var o,e=t.endsWith("idempotent"),s=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.La.runTransaction(s,df,function(e){return o=new If(e,i.Ga.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.Ka(e).next(function(t){return!!t||i.Ha(e)}).next(function(t){if(!t)throw qr("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Aa.xu(function(){return i.Na(!1)}),new ti(Zr.FAILED_PRECONDITION,Th);return r(o)}).next(function(t){return i.Ya(e).next(function(){return t})}):i.cf(e).next(function(){return r(o)})}).then(function(t){return o.Ws(),t})},Tf.prototype.cf=function(t){var e=this;return Sf(t).get(Fc.key).next(function(t){if(null!==t&&e.tf(t.leaseTimestampMs,5e3)&&!e.ef(t.ownerId)&&!e.Xa(t)&&!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,Ef)})},Tf.prototype.Ya=function(t){var e=new Fc(this.clientId,this.allowTabSynchronization,Date.now());return Sf(t).put(Fc.key,e)},Tf.Hs=function(){return Sh.Hs()},Tf.af=function(t){var e=t.s.projectId;return t.s.o||(e+="."+t.s.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Tf.prototype.Ja=function(t){var e=this,n=Sf(t);return n.get(Fc.key).next(function(t){return e.Xa(t)?(Ur("IndexedDbPersistence","Releasing primary lease."),n.delete(Fc.key)):Ih.resolve()})},Tf.prototype.tf=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(qr("Detected an update time that is in the future: "+t+" > "+n),1))},Tf.prototype.Ma=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ca=function(){t.Aa.xu(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ba()})},this.document.addEventListener("visibilitychange",this.Ca),this.inForeground="visible"===this.document.visibilityState)},Tf.prototype.uf=function(){this.Ca&&(jr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.Ca),this.Ca=null)},Tf.prototype.qa=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Sa=function(){t.rf(),t.Aa.xu(function(){return t.shutdown()})},this.window.addEventListener("unload",this.Sa))},Tf.prototype.sf=function(){this.Sa&&(jr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.Sa),this.Sa=null)},Tf.prototype.ef=function(t){try{var e=null!==this.Ua.getItem(this.if(t));return Ur("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return qr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Tf.prototype.rf=function(){try{this.Ua.setItem(this.if(this.clientId),String(Date.now()))}catch(t){qr("Failed to set zombie client id.",t)}},Tf.prototype.hf=function(){try{this.Ua.removeItem(this.if(this.clientId))}catch(t){}},Tf.prototype.if=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Tf.Fa="main",Tf);function Tf(t,e,n,r,i,o,s,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Aa=o,this.Da=a,this.Pa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Sa=null,this.inForeground=!1,this.Ca=null,this.ka=null,this.Va=Number.NEGATIVE_INFINITY,this.Na=function(t){return Promise.resolve()},this.vo=new Df(this,i),this.Oa=e+Tf.Fa,this.serializer=new gf(s),this.document=r.document,this._h=new vc(this.vo,this.serializer),this.do=new yf,this.Ho=new kc(this.serializer,this.do),!r.window||!r.window.localStorage)throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Ua=this.window.localStorage}function Af(t,e){var n=bf.call(this)||this;return n.xo=t,n.Mh=e,n}function Sf(t){return t.store(Fc.store)}function kf(t){return t.store(lf.store)}var Df=(Rf.prototype.Lc=function(t){var n=this.lf(t);return this.db.Ih().ia(t).next(function(e){return n.next(function(t){return e+t})})},Rf.prototype.lf=function(t){var e=0;return this.Mc(t,function(t){e++}).next(function(){return e})},Rf.prototype.Le=function(t,e){return this.db.Ih().Le(t,e)},Rf.prototype.Mc=function(t,n){return this.df(t,function(t,e){return n(e)})},Rf.prototype.ph=function(t){this.ff=t},Rf.prototype.fs=function(t,e){return _f(t,e)},Rf.prototype.ds=function(t,e){return _f(t,e)},Rf.prototype.qc=function(t,e,n){return this.db.Ih().qc(t,e,n)},Rf.prototype.Lo=function(t,e){return _f(t,e)},Rf.prototype.vf=function(t,e){return this.ff.bs(e)?Ih.resolve(!0):(r=e,i=!1,Kh(n=t).lo(function(t){return Wh(n,t,r).next(function(t){return t&&(i=!0),Ih.resolve(!t)})}).next(function(){return i}));var n,r,i},Rf.prototype.Qc=function(r,i){var o=this,s=this.db.yh().Nh(),a=[],u=0;return this.df(r,function(e,t){if(t<=i){var n=o.vf(r,e).next(function(t){if(!t)return u++,s.Ls(r,e).next(function(){return s.js(e),Ac(r).delete([0,ph(e.path)])})});a.push(n)}}).next(function(){return Ih.ks(a)}).next(function(){return s.apply(r)}).next(function(){return u})},Rf.prototype.removeTarget=function(t,e){var n=e.Oi(t.Mh);return this.db.Ih().Qh(t,n)},Rf.prototype.Gh=function(t,e){return _f(t,e)},Rf.prototype.df=function(t,o){var s,e=Ac(t),a=nh.gu;return e.fo({index:rf.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(a!==nh.gu&&o(new Hi(vh(s)),a),a=i,s=r):a=nh.gu}).next(function(){a!==nh.gu&&o(new Hi(vh(s)),a)})},Rf.prototype.Gc=function(t){return this.db.yh().wa(t)},Rf);function Rf(t,e){this.db=t,this.ff=null,this.Vc=new yc(this,e)}function _f(t,e){return Ac(t).put((n=e,r=t.Mh,new rf(0,ph(n.path),r)));var n,r}var xf=(Pf.prototype.Rh=function(t){this.wf=t},Pf.prototype.nh=function(e,r,i,o){var s=this;return jr(void 0!==this.wf,"setLocalDocumentsView() not called"),r.fi()?this.mf(e,r):i.isEqual(Vi.MIN)?this.mf(e,r):this.wf.Zo(e,o).next(function(t){var n=s.pf(r,t);return(r.gi()||r.bi())&&s.gf(r.Yn,n,o,i)?s.mf(e,r):(Lr()<=Ar.DEBUG&&Ur("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.wf.nh(e,r,i).next(function(e){return n.forEach(function(t){e=e.lt(t.key,t)}),e}))})},Pf.prototype.pf=function(n,t){var r=new so(function(t,e){return n.di(t,e)});return t.forEach(function(t,e){e instanceof Ls&&n.matches(e)&&(r=r.add(e))}),r},Pf.prototype.gf=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===oa.Kn?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.h(r))},Pf.prototype.mf=function(t,e){return Lr()<=Ar.DEBUG&&Ur("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.wf.nh(t,e,Vi.MIN)},Pf),Cf=(Of.prototype.po=function(t){return Ih.resolve(0===this.Jo.length)},Of.prototype.bo=function(t,e,n){var r=e.batchId,i=this._f(r,"acknowledged");jr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.Jo[i];return jr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Ih.resolve()},Of.prototype._o=function(t){return Ih.resolve(this.lastStreamToken)},Of.prototype.Io=function(t,e){return this.lastStreamToken=e,Ih.resolve()},Of.prototype.To=function(t,e,n,r){jr(0!==r.length,"Mutation batches should not be empty");var i=this.bf;this.bf++,0<this.Jo.length&&jr(this.Jo[this.Jo.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new mh(i,e,n,r);this.Jo.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.yf=this.yf.add(new bh(u.key,i)),this.do.Ro(t,u.key.path.H())}return Ih.resolve(o)},Of.prototype.Ao=function(t,e){return Ih.resolve(this.If(e))},Of.prototype.Po=function(t,e){var n=this.If(e);return jr(null!=n,"Failed to find local mutation batch."),Ih.resolve(n.keys())},Of.prototype.So=function(t,e){var n=e+1,r=this.Tf(n),i=r<0?0:r;return Ih.resolve(this.Jo.length>i?this.Jo[i]:null)},Of.prototype.Co=function(){return Ih.resolve(0===this.Jo.length?-1:this.bf-1)},Of.prototype.ko=function(t){return Ih.resolve(this.Jo.slice())},Of.prototype.Vo=function(t,n){var r=this,e=new bh(n,0),i=new bh(n,Number.POSITIVE_INFINITY),o=[];return this.yf.Lt([e,i],function(t){jr(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.If(t.ys);jr(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Ih.resolve(o)},Of.prototype.No=function(t,e){var r=this,i=new so(Hr);return e.forEach(function(e){var t=new bh(e,0),n=new bh(e,Number.POSITIVE_INFINITY);r.yf.Lt([t,n],function(t){jr(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.ys)})}),Ih.resolve(this.Ef(i))},Of.prototype.Fo=function(t,e){jr(!e._i(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Hi.ht(i)||(i=i.child(""));var o=new bh(new Hi(i),0),s=new so(Hr);return this.yf.Bt(function(t){var e=t.key.path;return!!n.$(e)&&(e.length===r&&(s=s.add(t.ys)),!0)},o),Ih.resolve(this.Ef(s))},Of.prototype.Ef=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.If(t);null!==e&&r.push(e)}),r},Of.prototype.Uo=function(n,r){var i=this;jr(0===this._f(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.Jo.shift();var o=this.yf;return Ih.forEach(r.mutations,function(t){var e=new bh(t.key,r.batchId);return o=o.delete(e),i.vo.Lo(n,t.key)}).next(function(){i.yf=o})},Of.prototype.jo=function(t){},Of.prototype.bs=function(t,e){var n=new bh(e,0),r=this.yf.Mt(n);return Ih.resolve(e.isEqual(r&&r.key))},Of.prototype.Bo=function(t){return 0===this.Jo.length&&jr(this.yf.J(),"Document leak -- detected dangling mutation references when queue is empty."),Ih.resolve()},Of.prototype._f=function(t,e){var n=this.Tf(t);return jr(0<=n&&n<this.Jo.length,"Batches must exist to be "+e),n},Of.prototype.Tf=function(t){return 0===this.Jo.length?0:t-this.Jo[0].batchId},Of.prototype.If=function(t){var e=this.Tf(t);if(e<0||e>=this.Jo.length)return null;var n=this.Jo[e];return jr(n.batchId===t,"If found batch must match"),n},Of);function Of(t,e){this.do=t,this.vo=e,this.Jo=[],this.bf=1,this.lastStreamToken=Ba.Pi,this.yf=new so(bh.Bn)}function Pf(){}var Lf,Mf,Uf,qf,Vf=($f.prototype.Us=function(t,e,n){jr(!n.isEqual(Vi.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Rf(e);return this.docs=this.docs.lt(r,{sa:e,size:s,readTime:n}),this.size+=s-o,this.do.Ro(t,r.path.H())},$f.prototype.js=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},$f.prototype.Ls=function(t,e){var n=this.docs.get(e);return Ih.resolve(n?n.sa:null)},$f.prototype.getEntries=function(t,e){var n=this,r=ru();return e.forEach(function(t){var e=n.docs.get(t);r=r.lt(t,e?e.sa:null)}),Ih.resolve(r)},$f.prototype.nh=function(t,e,n){jr(!e._i(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=ou(),i=new Hi(e.path.child("")),o=this.docs.yt(i);o.At();){var s=o.Rt(),a=s.key,u=s.value,h=u.sa,c=u.readTime;if(!e.path.$(a.path))break;c.h(n)<=0||h instanceof Ls&&e.matches(h)&&(r=r.lt(h.key,h))}return Ih.resolve(r)},$f.prototype.Af=function(t,e){return Ih.forEach(this.docs,function(t){return e(t)})},$f.prototype.fc=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},$f.prototype.dc=function(t){return Ih.resolve(Vi.MIN)},$f.prototype.Nh=function(t){return new $f.va(this)},$f.prototype.wa=function(t){return Ih.resolve(this.size)},$f.va=(t(Zf,qf=Nh),Zf.prototype.qs=function(n){var r=this,i=[];return this.Ns.forEach(function(t,e){e?i.push(r.ma.Us(n,e,r.readTime)):r.ma.js(t)}),Ih.ks(i)},Zf.prototype.Bs=function(t,e){return this.ma.Ls(t,e)},Zf.prototype.Ms=function(t,e){return this.ma.getEntries(t,e)},Zf),$f),Gf=(Kf.prototype.Le=function(t,n){return this.Df.forEach(function(t,e){return n(e)}),Ih.resolve()},Kf.prototype.xh=function(t){return Ih.resolve(this.lastRemoteSnapshotVersion)},Kf.prototype.Jc=function(t){return Ih.resolve(this.Pf)},Kf.prototype.$h=function(t){var e=this.zc.after(this.highestTargetId);return this.highestTargetId=e,Ih.resolve(e)},Kf.prototype.Wh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Pf&&(this.Pf=e),Ih.resolve()},Kf.prototype.Yc=function(t){this.Df.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.Pf&&(this.Pf=t.sequenceNumber)},Kf.prototype.Zh=function(t,e){return jr(!this.Df.has(e.target),"Adding a target that already exists"),this.Yc(e),this.targetCount+=1,Ih.resolve()},Kf.prototype.Qh=function(t,e){return jr(this.Df.has(e.target),"Updating a non-existent target"),this.Yc(e),Ih.resolve()},Kf.prototype.$c=function(t,e){return jr(0<this.targetCount,"Removing a target from an empty cache"),jr(this.Df.has(e.target),"Removing a non-existent target from the cache"),this.Df.delete(e.target),this.Sf.ms(e.targetId),this.targetCount-=1,Ih.resolve()},Kf.prototype.qc=function(n,r,i){var o=this,s=0,a=[];return this.Df.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Df.delete(t),a.push(o.Zc(n,e.targetId)),s++)}),Ih.ks(a).next(function(){return s})},Kf.prototype.ia=function(t){return Ih.resolve(this.targetCount)},Kf.prototype.Xh=function(t,e){var n=this.Df.get(e)||null;return Ih.resolve(n)},Kf.prototype.Ye=function(t,e){return Gr("Not yet implemented.")},Kf.prototype.Bh=function(e,t,n){this.Sf.ls(t,n);var r=this.persistence.vo,i=[];return r&&t.forEach(function(t){i.push(r.fs(e,t))}),Ih.ks(i)},Kf.prototype.Lh=function(e,t,n){this.Sf.ws(t,n);var r=this.persistence.vo,i=[];return r&&t.forEach(function(t){i.push(r.ds(e,t))}),Ih.ks(i)},Kf.prototype.Zc=function(t,e){return this.Sf.ms(e),Ih.resolve()},Kf.prototype.ic=function(t,e){var n=this.Sf.gs(e);return Ih.resolve(n)},Kf.prototype.bs=function(t,e){return Ih.resolve(this.Sf.bs(e))},Kf),jf=(Qf.Vf=function(t,e){return new Qf(t,function(t){return new Hf(t,e)})},Qf.Nf=function(t){return new Qf(t,function(t){return new Bf(t)})},Qf.prototype.shutdown=function(){return this.Pa=!1,Promise.resolve()},Object.defineProperty(Qf.prototype,"mh",{get:function(){return this.Pa},enumerable:!0,configurable:!0}),Qf.prototype.uc=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return[2,[this.clientId]]})})},Qf.prototype.Wa=function(t){return t(!0)},Qf.prototype.za=function(){},Qf.prototype.oc=function(t){},Qf.prototype.Eh=function(){return this.do},Qf.prototype.gh=function(t){var e=this.Cf[t.v()];return e||(e=new Cf(this.do,this.vo),this.Cf[t.v()]=e),e},Qf.prototype.Ih=function(){return this._h},Qf.prototype.yh=function(){return this.Ho},Qf.prototype.runTransaction=function(t,e,n){var r=this;Ur("MemoryPersistence","Starting transaction:",t);var i=new Ff(this.Ga.next());return this.vo.Of(),n(i).next(function(t){return r.vo.Ff(i).next(function(){return t})}).Ss().then(function(t){return i.Ws(),t})},Qf.prototype.Uf=function(e,n){return Ih.Vs((t=this.Cf,r=[],yi(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.bs(e,n)}}));var t,r},Qf),Ff=(t(Xf,Uf=Ah),Xf),Bf=(Object.defineProperty(Yf.prototype,"jf",{get:function(){if(this.xf)return this.xf;throw Gr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Yf.prototype.ph=function(t){this.ff=t},Yf.prototype.fs=function(t,e){return this.jf.delete(e),Ih.resolve()},Yf.prototype.ds=function(t,e){return this.jf.add(e),Ih.resolve()},Yf.prototype.Lo=function(t,e){return this.jf.add(e),Ih.resolve()},Yf.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Ih();return r.ic(t,e.targetId).next(function(t){t.forEach(function(t){return n.jf.add(t)})}).next(function(){return r.$c(t,e)})},Yf.prototype.Of=function(){this.xf=new Set},Yf.prototype.Ff=function(t){var n=this,r=this.persistence.yh().Nh();return Ih.forEach(this.jf,function(e){return n.Lf(t,e).next(function(t){t||r.js(e)})}).next(function(){return n.xf=null,r.apply(t)})},Yf.prototype.Gh=function(t,e){var n=this;return this.Lf(t,e).next(function(t){t?n.jf.delete(e):n.jf.add(e)})},Yf.prototype.kf=function(t){return 0},Yf.prototype.Lf=function(t,e){var n=this;return Ih.Vs([function(){return n.persistence.Ih().bs(t,e)},function(){return n.persistence.Uf(t,e)},function(){return Ih.resolve(n.ff.bs(e))}])},Yf),Hf=(Wf.prototype.Of=function(){},Wf.prototype.Ff=function(t){return Ih.resolve()},Wf.prototype.Le=function(t,e){return this.persistence.Ih().Le(t,e)},Wf.prototype.Lc=function(t){var n=this.Mf(t);return this.persistence.Ih().ia(t).next(function(e){return n.next(function(t){return e+t})})},Wf.prototype.Mf=function(t){var e=0;return this.Mc(t,function(t){e++}).next(function(){return e})},Wf.prototype.Mc=function(n,r){var i=this;return Ih.forEach(this.Bf,function(t,e){return i.vf(n,t,e).next(function(t){return t?Ih.resolve():r(e)})})},Wf.prototype.ph=function(t){this.ff=t},Wf.prototype.qc=function(t,e,n){return this.persistence.Ih().qc(t,e,n)},Wf.prototype.Qc=function(t,n){var r=this,i=0,e=this.persistence.yh(),o=e.Nh();return e.Af(t,function(e){return r.vf(t,e,n).next(function(t){t||(i++,o.js(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},Wf.prototype.Lo=function(t,e){return this.Bf.set(e,t.Mh),Ih.resolve()},Wf.prototype.removeTarget=function(t,e){var n=e.Oi(t.Mh);return this.persistence.Ih().Qh(t,n)},Wf.prototype.fs=function(t,e){return this.Bf.set(e,t.Mh),Ih.resolve()},Wf.prototype.ds=function(t,e){return this.Bf.set(e,t.Mh),Ih.resolve()},Wf.prototype.Gh=function(t,e){return this.Bf.set(e,t.Mh),Ih.resolve()},Wf.prototype.kf=function(t){var e=t.key.toString().length;return t instanceof Ls&&(e+=t.data().Nn()),e},Wf.prototype.vf=function(t,e,n){var r=this;return Ih.Vs([function(){return r.persistence.Uf(t,e)},function(){return Ih.resolve(r.ff.bs(e))},function(){return r.persistence.Ih().bs(t,e)},function(){var t=r.Bf.get(e);return Ih.resolve(void 0!==t&&n<t)}])},Wf.prototype.Gc=function(t){return this.persistence.yh().wa(t)},Wf),zf=(Jf.prototype.reset=function(){this.Wf=0},Jf.prototype.Hf=function(){this.Wf=this.Gf},Jf.prototype.Jf=function(t){var e=this;this.cancel();var n=Math.floor(this.Wf+this.Yf()),r=Math.max(0,Date.now()-this.Kf),i=Math.max(0,n-r);0<this.Wf&&Ur("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Wf+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zf=this.Aa.Yu(this.Su,i,function(){return e.Kf=Date.now(),t()}),this.Wf*=this.Qf,this.Wf<this.qf&&(this.Wf=this.qf),this.Wf>this.Gf&&(this.Wf=this.Gf)},Jf.prototype.cancel=function(){null!==this.zf&&(this.zf.cancel(),this.zf=null)},Jf.prototype.Yf=function(){return(Math.random()-.5)*this.Wf},Jf);function Jf(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Aa=t,this.Su=e,this.qf=n,this.Qf=r,this.Gf=i,this.Wf=0,this.zf=null,this.Kf=Date.now(),this.reset()}function Wf(t,e){this.persistence=t,this.ff=null,this.Bf=new Eh(function(t){return ph(t.path)}),this.Vc=new yc(this,e)}function Yf(t){this.persistence=t,this.ff=null,this.xf=null}function Xf(t){var e=Uf.call(this)||this;return e.Mh=t,e}function Qf(t,e){var n=this;this.clientId=t,this.Cf={},this.Ga=new nh(0),this.Pa=!1,this.Pa=!0,this.vo=e(this),this._h=new Gf(this),this.do=new Pc,this.Ho=new Vf(this.do,function(t){return n.vo.kf(t)})}function Kf(t){this.persistence=t,this.Df=new Eh(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Vi.MIN,this.highestTargetId=0,this.Pf=0,this.Sf=new wh,this.targetCount=0,this.zc=tc.zo()}function $f(t,e){this.do=t,this.Rf=e,this.docs=new zi(Hi.G),this.size=0}function Zf(t){var e=qf.call(this)||this;return e.ma=t,e}(Mf=Lf=Lf||{})[Mf.Xf=0]="__PRIVATE_Initial",Mf[Mf.$f=1]="__PRIVATE_Starting",Mf[Mf.Zf=2]="__PRIVATE_Open",Mf[Mf.Error=3]="Error",Mf[Mf.tl=4]="__PRIVATE_Backoff";var tl,el,nl=(ll.prototype.sl=function(){return this.state===Lf.$f||this.state===Lf.Zf||this.state===Lf.tl},ll.prototype.ol=function(){return this.state===Lf.Zf},ll.prototype.start=function(){this.state!==Lf.Error?(jr(this.state===Lf.Xf,"Already started"),this.auth()):this.hl()},ll.prototype.stop=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.sl()?[4,this.close(Lf.Xf)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},ll.prototype.cl=function(){jr(!this.sl(),"Can only inhibit backoff in a stopped state"),this.state=Lf.Xf,this.ul.reset()},ll.prototype.al=function(){var t=this;this.ol()&&null===this.rl&&(this.rl=this.Aa.Yu(this.nl,6e4,function(){return t.fl()}))},ll.prototype.ll=function(t){this.dl(),this.stream.send(t)},ll.prototype.fl=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.ol()?[2,this.close(Lf.Xf)]:[2]})})},ll.prototype.dl=function(){this.rl&&(this.rl.cancel(),this.rl=null)},ll.prototype.close=function(e,n){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return jr(this.sl(),"Only started streams should be closed."),jr(e===Lf.Error||ra(n),"Can't provide an error when not in an error state."),this.dl(),this.ul.cancel(),this.el++,e!==Lf.Error?this.ul.reset():n&&n.code===Zr.RESOURCE_EXHAUSTED?(qr(n.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.ul.Hf()):n&&n.code===Zr.UNAUTHENTICATED&&this.il.I(),null!==this.stream&&(this.vl(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.wl(n)];case 1:return t.sent(),[2]}})})},ll.prototype.vl=function(){},ll.prototype.auth=function(){var n=this;jr(this.state===Lf.Xf,"Must be in initial state to auth"),this.state=Lf.$f;var t=this.ml(this.el),e=this.el;this.il.getToken().then(function(t){n.el===e&&n.pl(t)},function(e){t(function(){var t=new ti(Zr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.gl(t)})})},ll.prototype.pl=function(t){var e=this;jr(this.state===Lf.$f,"Trying to start stream in a non-starting state");var n=this.ml(this.el);this.stream=this.bl(t),this.stream.yl(function(){n(function(){return jr(e.state===Lf.$f,"Expected stream to be in state Starting, but was "+e.state),e.state=Lf.Zf,e.listener.yl()})}),this.stream.wl(function(t){n(function(){return e.gl(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},ll.prototype.hl=function(){var t=this;jr(this.state===Lf.Error,"Should only perform backoff when in Error state"),this.state=Lf.tl,this.ul.Jf(function(){return p(t,void 0,void 0,function(){return y(this,function(t){return jr(this.state===Lf.tl,"Backoff elapsed but state is now: "+this.state),this.state=Lf.Xf,this.start(),jr(this.sl(),"PersistentStream should have started"),[2]})})})},ll.prototype.gl=function(t){return jr(this.sl(),"Can't handle server close on non-started stream"),Ur("PersistentStream","close with error: "+t),this.stream=null,this.close(Lf.Error,t)},ll.prototype.ml=function(e){var n=this;return function(t){n.Aa.xu(function(){return n.el===e?t():(Ur("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},ll),rl=(t(fl,el=nl),fl.prototype.bl=function(t){return this.connection._l("Listen",t)},fl.prototype.onMessage=function(t){this.ul.reset();var e=this.serializer.Cr(t),n=this.serializer.Vr(t);return this.listener.Il(e,n)},fl.prototype.watch=function(t){var e={};e.database=this.serializer.wr,e.addTarget=this.serializer.li(t);var n=this.serializer.Zr(t);n&&(e.labels=n),this.ll(e)},fl.prototype.Tl=function(t){var e={};e.database=this.serializer.wr,e.removeTarget=t,this.ll(e)},fl),il=(t(cl,tl=nl),Object.defineProperty(cl.prototype,"Rl",{get:function(){return this.El},enumerable:!0,configurable:!0}),cl.prototype.start=function(){this.El=!1,tl.prototype.start.call(this)},cl.prototype.vl=function(){this.El&&this.Al([])},cl.prototype.bl=function(t){return this.connection._l("Write",t)},cl.prototype.onMessage=function(t){if(jr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.er(t.streamToken),this.El){this.ul.reset();var e=this.serializer.qr(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Dl(n,e)}return jr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.El=!0,this.listener.Pl()},cl.prototype.Sl=function(){jr(this.ol(),"Writing handshake requires an opened stream"),jr(!this.El,"Handshake already completed");var t={};t.database=this.serializer.wr,this.ll(t)},cl.prototype.Al=function(t){var e=this;jr(this.ol(),"Writing mutations requires an opened stream"),jr(this.El,"Handshake must be complete before writing mutations"),jr(0<this.lastStreamToken.Nn(),"Trying to write mutation without a token");var n={streamToken:this.serializer.ir(this.lastStreamToken),writes:t.map(function(t){return e.serializer.Nr(t)})};this.ll(n)},cl),ol=(hl.prototype.Cl=function(t){return new il(this.Aa,this.connection,this.credentials,this.serializer,t)},hl.prototype.kl=function(t){return new rl(this.Aa,this.connection,this.credentials,this.serializer,t)},hl.prototype.commit=function(t){var e=this,n={database:this.serializer.wr,writes:t.map(function(t){return e.serializer.Nr(t)})};return this.Vl("Commit",n).then(function(t){return e.serializer.qr(t.writeResults,t.commitTime)})},hl.prototype.lookup=function(e){var i=this,t={database:this.serializer.wr,documents:e.map(function(t){return i.serializer.cr(t)})};return this.Nl("BatchGetDocuments",t).then(function(t){var n=nu();t.forEach(function(t){var e=i.serializer.Dr(t);n=n.lt(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);jr(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},hl.prototype.Vl=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Vl(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},hl.prototype.Nl=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Nl(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},hl),sl=(ul.documentId=function(){return ul.Fl},ul.prototype.isEqual=function(t){if(!(t instanceof ul))throw xi("isEqual","FieldPath",1,t);return this.Ol.isEqual(t.Ol)},ul.Fl=new ul(Bi.st().nt()),ul),al=new RegExp("[~\\*/\\[\\]]");function ul(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new ti(Zr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Pi(1,"element")+".")}();for(var n=0;n<t.length;++n)if(Ei("FieldPath","string",n,t[n]),0===t[n].length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Ol=new Bi(t)}function hl(t,e,n,r){this.Aa=t,this.connection=e,this.credentials=n,this.serializer=r}function cl(t,e,n,r,i){var o=tl.call(this,t,$u.Tu,$u.Iu,e,n,i)||this;return o.serializer=r,o.El=!1,o.lastStreamToken=Ba.Pi,o}function fl(t,e,n,r,i){var o=el.call(this,t,$u._u,$u.yu,e,n,i)||this;return o.serializer=r,o}function ll(t,e,n,r,i,o){this.Aa=t,this.nl=n,this.connection=r,this.il=i,this.listener=o,this.state=Lf.Xf,this.el=0,this.rl=null,this.stream=null,this.ul=new zf(t,e)}var pl,dl,yl,vl,ml,gl,wl,bl=(Ul.delete=function(){return mi("FieldValue.delete",arguments),El.instance},Ul.serverTimestamp=function(){return mi("FieldValue.serverTimestamp",arguments),Il.instance},Ul.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayUnion",arguments,1),new Nl(t)},Ul.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayRemove",arguments,1),new Tl(t)},Ul.increment=function(t){return Ei("FieldValue.increment","number",1,t),gi("FieldValue.increment",arguments,1),new Al(t)},Ul.prototype.isEqual=function(t){return this===t},Ul),El=(t(Ml,wl=bl),Ml.instance=new Ml,Ml),Il=(t(Ll,gl=bl),Ll.instance=new Ll,Ll),Nl=(t(Pl,ml=bl),Pl),Tl=(t(Ol,vl=bl),Ol),Al=(t(Cl,yl=bl),Cl),Sl=Yu(bl,"Use FieldValue.<field>() instead."),kl=/^__.*__$/,Dl=(xl.prototype.Ll=function(t,e){var n=[];return null!==this.on?n.push(new Vo(t,this.data,this.on,e)):n.push(new qo(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Go(t,this.fieldTransforms)),n},xl),Rl=(_l.prototype.Ll=function(t,e){var n=[new Vo(t,this.data,this.on,e)];return 0<this.fieldTransforms.length&&n.push(new Go(t,this.fieldTransforms)),n},_l);function _l(t,e,n){this.data=t,this.on=e,this.fieldTransforms=n}function xl(t,e,n){this.data=t,this.on=e,this.fieldTransforms=n}function Cl(t){var e=yl.call(this,"FieldValue.increment")||this;return e.jl=t,e}function Ol(t){var e=vl.call(this,"FieldValue.arrayRemove")||this;return e.xl=t,e}function Pl(t){var e=ml.call(this,"FieldValue.arrayUnion")||this;return e.xl=t,e}function Ll(){return gl.call(this,"FieldValue.serverTimestamp")||this}function Ml(){return wl.call(this,"FieldValue.delete")||this}function Ul(t){this.Ul=t}function ql(t){switch(t){case pl.Set:case pl.Bl:case pl.Ml:return!0;case pl.ql:case pl.Ql:return!1;default:throw Gr("Unexpected case for UserDataSource: "+t)}}(dl=pl=pl||{})[dl.Set=0]="Set",dl[dl.Ml=1]="__PRIVATE_Update",dl[dl.Bl=2]="__PRIVATE_MergeSet",dl[dl.ql=3]="__PRIVATE_Argument",dl[dl.Ql=4]="__PRIVATE_ArrayArgument";var Vl=(Bl.prototype.Kl=function(t){var e=null==this.path?null:this.path.child(t),n=new Bl(this.Gl,this.methodName,e,!1,this.fieldTransforms,this.on);return n.Hl(t),n},Bl.prototype.Jl=function(t){var e=null==this.path?null:this.path.child(t),n=new Bl(this.Gl,this.methodName,e,!1,this.fieldTransforms,this.on);return n.zl(),n},Bl.prototype.Yl=function(t){return new Bl(this.Gl,this.methodName,null,!0,this.fieldTransforms,this.on)},Bl.prototype.Xl=function(t){var e=null===this.path||this.path.J()?"":" (found in field "+this.path.toString()+")";return new ti(Zr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},Bl.prototype.contains=function(e){return void 0!==this.on.find(function(t){return e.$(t)})||void 0!==this.fieldTransforms.find(function(t){return e.$(t.field)})},Bl.prototype.zl=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.Hl(this.path.get(t))},Bl.prototype.Hl=function(t){if(0===t.length)throw this.Xl("Document fields must not be empty");if(ql(this.Gl)&&kl.test(t))throw this.Xl('Document fields cannot begin and end with "__"')},Bl),Gl=function(t,e){this.s=t,this.key=e},jl=(Fl.prototype.Zl=function(t,e){var n=new Vl(pl.Set,t,Bi.et);zl("Data must be an object, but it was:",n,e);var r=this.td(e,n);return new Dl(r,null,n.fieldTransforms)},Fl.prototype.nd=function(t,e,n){var r=new Vl(pl.Bl,t,Bi.et);zl("Data must be an object, but it was:",r,e);var i,o,s=this.td(e,r);if(n){for(var a=new so(Bi.G),u=0,h=n;u<h.length;u++){var c=h[u],f=void 0;if(c instanceof sl)f=c.Ol;else{if("string"!=typeof c)throw Gr("Expected stringOrFieldPath to be a string or a FieldPath");f=Wl(t,c)}if(!r.contains(f))throw new ti(Zr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");a=a.add(f)}i=No.Jt(a),o=r.fieldTransforms.filter(function(t){return i.Xt(t.field)})}else i=No.Yt(r.on),o=r.fieldTransforms;return new Dl(s,i,o)},Fl.prototype.ed=function(o,t){var s=this,a=new Vl(pl.Ml,o,Bi.et);zl("Data must be an object, but it was:",a,t);var u=new so(Bi.G),h=xs.mn();yi(t,function(t,e){var n=Wl(o,t),r=a.Jl(n);if((e=s.rd(e,r))instanceof El)u=u.add(n);else{var i=s.td(e,r);null!=i&&(u=u.add(n),h.set(n,i))}});var e=No.Jt(u);return new Rl(h.fn(),e,a.fieldTransforms)},Fl.prototype.ud=function(t,e,n,r){var i=new Vl(pl.Ml,t,Bi.et),o=[Jl(t,e)],s=[n];if(r.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(Jl(t,r[a])),s.push(r[a+1]);var u=new so(Bi.G),h=xs.mn();for(a=0;a<o.length;++a){var c=o[a],f=i.Jl(c),l=this.rd(s[a],f);if(l instanceof El)u=u.add(c);else{var p=this.td(l,f);null!=p&&(u=u.add(c),h.set(c,p))}}var d=No.Jt(u);return new Rl(h.fn(),d,i.fieldTransforms)},Fl.prototype.sd=function(t,e,n){void 0===n&&(n=!1);var r=new Vl(n?pl.Ql:pl.ql,t,Bi.et),i=this.td(e,r);return jr(null!=i,"Parsed data should not be null."),jr(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},Fl.prototype.rd=function(t,e){try{return this.$l(t)}catch(t){var n=Yl(t);throw e.Xl(n)}},Fl.prototype.td=function(t,e){if(Hl(t=this.rd(t,e)))return zl("Unsupported field value:",e,t),this.od(t,e);if(t instanceof bl)return this.hd(t,e),null;if(e.path&&e.on.push(e.path),t instanceof Array){if(e.Wl&&e.Gl!==pl.Ql)throw e.Xl("Nested arrays are not supported");return this.ad(t,e)}return this.fd(t,e)},Fl.prototype.od=function(t,r){var i=this,o=new zi(Hr);return vi(t)?r.path&&0<r.path.length&&r.on.push(r.path):yi(t,function(t,e){var n=i.td(e,r.Kl(t));null!=n&&(o=o.lt(t,n))}),new xs(o)},Fl.prototype.ad=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.td(s,e.Yl(r));null==a&&(a=es.On),n.push(a),r++}return new Os(n)},Fl.prototype.hd=function(t,e){if(!ql(e.Gl))throw e.Xl(t.Ul+"() can only be used with update() and set()");if(null===e.path)throw e.Xl(t.Ul+"() is not currently supported inside arrays");if(t instanceof El){if(e.Gl!==pl.Bl)throw e.Gl===pl.Ml?(jr(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.Xl("FieldValue.delete() can only appear at the top level of your update data")):e.Xl("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.on.push(e.path)}else if(t instanceof Il)e.fieldTransforms.push(new To(e.path,uo.instance));else if(t instanceof Nl){var n=this.ld(t.Ul,t.xl),r=new ho(n);e.fieldTransforms.push(new To(e.path,r))}else if(t instanceof Tl){n=this.ld(t.Ul,t.xl);var i=new co(n);e.fieldTransforms.push(new To(e.path,i))}else if(t instanceof Al){var o=this.sd("FieldValue.increment",t.jl),s=new fo(o);e.fieldTransforms.push(new To(e.path,s))}else Gr("Unknown FieldValue type: "+t)},Fl.prototype.fd=function(t,e){if(null===t)return es.On;if("number"==typeof t)return ia(t)?new Ns(t):new Ts(t);if("boolean"==typeof t)return ns.of(t);if("string"==typeof t)return new As(t);if(t instanceof Date)return new Ss(qi.fromDate(t));if(t instanceof qi)return new Ss(new qi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Ui)return new _s(t);if(t instanceof th)return new Ds(t);if(t instanceof Gl)return new Rs(t.s,t.key);throw e.Xl("Unsupported field value: "+Di(t))},Fl.prototype.ld=function(r,t){var i=this;return t.map(function(t,e){var n=new Vl(pl.ql,r,Bi.et);return i.td(t,n.Yl(e))})},Fl);function Fl(t){this.$l=t}function Bl(t,e,n,r,i,o){this.Gl=t,this.methodName=e,this.path=n,this.Wl=r,void 0===i&&this.zl(),this.Wl=void 0!==r&&r,this.fieldTransforms=i||[],this.on=o||[]}function Hl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof qi||t instanceof Ui||t instanceof th||t instanceof Gl||t instanceof bl)}function zl(t,e,n){if(!Hl(n)||!ki(n)){var r=Di(n);throw"an object"===r?e.Xl(t+" a custom object"):e.Xl(t+" "+r)}}function Jl(t,e){if(e instanceof sl)return e.Ol;if("string"==typeof e)return Wl(t,e);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Wl(e,t){try{return function(e){if(0<=e.search(al))throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(sl.bind.apply(sl,s([void 0],e.split("."))))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t).Ol}catch(t){var n=Yl(t);throw new ti(Zr.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Yl(t){return t instanceof Error?t.message:t.toString()}var Xl=(np.prototype.lookup=function(r){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.gd(),0<this.mutations.length)throw new ti(Zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.dd.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Ms||t instanceof Ls?n.bd(t):Gr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},np.prototype.set=function(t,e){this.write(e.Ll(t,this.rn(t))),this.pd.add(t)},np.prototype.update=function(t,e){try{this.write(e.Ll(t,this.yd(t)))}catch(t){this.md=t}this.pd.add(t)},np.prototype.delete=function(t){this.write([new jo(t,this.rn(t))]),this.pd.add(t)},np.prototype.commit=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.gd(),this.md)throw this.md;return e=this.vd,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new Fo(t,n.rn(t)))}),[4,this.dd.commit(this.mutations)];case 1:return t.sent(),this.wd=!0,[2]}})})},np.prototype.bd=function(t){var e;if(t instanceof Ls)e=t.version;else{if(!(t instanceof Ms))throw Gr("Document in a transaction was a "+t.constructor.name);e=Vi.B()}var n=this.vd.get(t.key);if(null!==n){if(!e.isEqual(n))throw new ti(Zr.ABORTED,"Document version changed between two reads.")}else this.vd=this.vd.lt(t.key,e)},np.prototype.rn=function(t){var e=this.vd.get(t);return!this.pd.has(t)&&e?Mo.updateTime(e):Mo.NONE},np.prototype.yd=function(t){var e=this.vd.get(t);if(this.pd.has(t)||!e)return Mo.exists(!0);if(e.isEqual(Vi.B()))throw new ti(Zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Mo.updateTime(e)},np.prototype.write=function(t){this.gd(),this.mutations=this.mutations.concat(t)},np.prototype.gd=function(){jr(!this.wd,"A transaction object cannot be used after its update callback has been invoked.")},np),Ql=(ep.prototype.Rd=function(){var t=this;0===this.Id&&(this.Ad("Unknown"),jr(null===this.Td,"onlineStateTimer shouldn't be started yet"),this.Td=this.Pu.Yu($u.Eu,1e4,function(){return t.Td=null,jr("Unknown"===t.state,"Timer should be canceled if we transitioned to a different state."),t.Dd("Backend didn't respond within 10 seconds."),t.Ad("Offline"),Promise.resolve()}))},ep.prototype.Pd=function(t){"Online"===this.state?(this.Ad("Unknown"),jr(0===this.Id,"watchStreamFailures must be 0"),jr(null===this.Td,"onlineStateTimer must be null")):(this.Id++,1<=this.Id&&(this.Sd(),this.Dd("Connection failed 1 times. Most recent error: "+t.toString()),this.Ad("Offline")))},ep.prototype.set=function(t){this.Sd(),this.Id=0,"Online"===t&&(this.Ed=!1),this.Ad(t)},ep.prototype.Ad=function(t){t!==this.state&&(this.state=t,this._d(t))},ep.prototype.Dd=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ed?(qr(e),this.Ed=!1):Ur("OnlineStateTracker",e)},ep.prototype.Sd=function(){null!==this.Td&&(this.Td.cancel(),this.Td=null)},ep),Kl="RemoteStore",$l=(tp.prototype.start=function(){return this.enableNetwork()},tp.prototype.enableNetwork=function(){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.Fd()?(e=this.qd,[4,this.Nc._o()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.zd()?this.Kd():this.xd.set("Unknown"),[4,this.Hd()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},tp.prototype.disableNetwork=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Jd()];case 1:return t.sent(),this.xd.set("Offline"),[2]}})})},tp.prototype.Jd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.qd.stop()];case 1:return t.sent(),[4,this.jd.stop()];case 2:return t.sent(),0<this.Cd.length&&(Ur(Kl,"Stopping write stream with "+this.Cd.length+" pending writes"),this.Cd=[]),this.Yd(),[2]}})})},tp.prototype.shutdown=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return Ur(Kl,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.Jd()];case 1:return t.sent(),this.Nd.shutdown(),this.xd.set("Unknown"),[2]}})})},tp.prototype.listen=function(t){li(this.kd,t.targetId)||(this.kd[t.targetId]=t,this.zd()?this.Kd():this.jd.ol()&&this.Xd(t))},tp.prototype.$d=function(t){jr(li(this.kd,t),"unlisten called on target no currently watched: "+t),delete this.kd[t],this.jd.ol()&&this.Zd(t),vi(this.kd)&&(this.jd.ol()?this.jd.al():this.Fd()&&this.xd.set("Unknown"))},tp.prototype.Ye=function(t){return this.kd[t]||null},tp.prototype.Je=function(t){return this.tv.Je(t)},tp.prototype.Xd=function(t){this.Vd.De(t.targetId),this.jd.watch(t)},tp.prototype.Zd=function(t){this.Vd.De(t),this.jd.Tl(t)},tp.prototype.Kd=function(){jr(this.zd(),"startWatchStream() called when shouldStartWatchStream() is false."),this.Vd=new Cu(this),this.jd.start(),this.xd.Rd()},tp.prototype.zd=function(){return this.Fd()&&!this.jd.sl()&&!vi(this.kd)},tp.prototype.Fd=function(){return this.isPrimary&&this.networkEnabled},tp.prototype.Yd=function(){this.Vd=null},tp.prototype.Ld=function(){return p(this,void 0,void 0,function(){var n=this;return y(this,function(t){return di(this.kd,function(t,e){n.Xd(e)}),[2]})})},tp.prototype.Bd=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return void 0===e&&jr(!this.zd(),"Watch stream was stopped gracefully while still needed."),this.Yd(),this.zd()?(this.xd.Pd(e),this.Kd()):this.xd.set("Unknown"),[2]})})},tp.prototype.Md=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.xd.set("Online"),n instanceof _u&&n.state===bu.Mi&&n.cause?[2,this.nv(n)]:(n instanceof gu?this.Vd.Fe(n):n instanceof wu?this.Vd.Qe(n):(jr(n instanceof _u,"Expected watchChange to be an instance of WatchTargetChange"),this.Vd.je(n)),r.isEqual(Vi.MIN)?[3,3]:[4,this.Nc.xh()]);case 1:return e=t.sent(),0<=r.h(e)?[4,this.iv(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},tp.prototype.iv=function(r){var i=this;jr(!r.isEqual(Vi.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.Vd.ze(r);return di(t.Zi,function(t,e){if(0<e.resumeToken.Nn()){var n=i.kd[t];n&&(i.kd[t]=n.Fi(e.resumeToken,r))}}),t.te.forEach(function(t){var e=i.kd[t];if(e){i.kd[t]=e.Fi(Ba.Pi,e.Ni),i.Zd(t);var n=new Xa(e.target,t,ja.Ci,e.sequenceNumber);i.Xd(n)}}),this.tv.jh(t)},tp.prototype.nv=function(t){var n=this;jr(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return p(n,void 0,void 0,function(){return y(this,function(t){return li(this.kd,e)?(delete this.kd[e],this.Vd.removeTarget(e),[2,this.tv.ev(e,r)]):[2]})})})}),i},tp.prototype.Hd=function(){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.rv()?(e=0<this.Cd.length?this.Cd[this.Cd.length-1].batchId:-1,[4,this.Nc.Hh(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.Cd.length&&this.qd.al(),[3,4]);case 2:return this.uv(n),[4,this.Hd()];case 3:t.sent(),t.label=4;case 4:return this.sv()&&this.ov(),[2]}})})},tp.prototype.rv=function(){return this.Fd()&&this.Cd.length<10},tp.prototype.hv=function(){return this.Cd.length},tp.prototype.uv=function(t){jr(this.rv(),"addToWritePipeline called when pipeline is full"),this.Cd.push(t),this.qd.ol()&&this.qd.Rl&&this.qd.Al(t.mutations)},tp.prototype.sv=function(){return this.Fd()&&!this.qd.sl()&&0<this.Cd.length},tp.prototype.ov=function(){jr(this.sv(),"startWriteStream() called when shouldStartWriteStream() is false."),this.qd.start()},tp.prototype.Qd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.qd.Sl(),[2]})})},tp.prototype.Wd=function(){var r=this;return this.Nc.Io(this.qd.lastStreamToken).then(function(){for(var t=0,e=r.Cd;t<e.length;t++){var n=e[t];r.qd.Al(n.mutations)}}).catch(hc)},tp.prototype.Dl=function(t,e){var n=this;jr(0<this.Cd.length,"Got result for empty write pipeline");var r=this.Cd.shift(),i=gh.from(r,t,e,this.qd.lastStreamToken);return this.tv.cv(i).then(function(){return n.Hd()})},tp.prototype.Gd=function(n){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){return void 0===n&&jr(!this.sv(),"Write stream was stopped gracefully while still needed."),n&&0<this.Cd.length?[2,(this.qd.Rl?this.av(n):this.fv(n)).then(function(){e.sv()&&e.ov()})]:[2]})})},tp.prototype.fv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return Za(e.code)?(Ur(Kl,"RemoteStore error before completed handshake; resetting stream token: ",this.qd.lastStreamToken),this.qd.lastStreamToken=Ba.Pi,[2,this.Nc.Io(Ba.Pi).catch(hc)]):[2]})})},tp.prototype.av=function(i){return p(this,void 0,void 0,function(){var n,r=this;return y(this,function(t){return Za(e=i.code)&&e!==Zr.ABORTED?(n=this.Cd.shift(),this.qd.cl(),[2,this.tv.lv(n.batchId,i).then(function(){return r.Hd()})]):[2];var e})})},tp.prototype.dv=function(){return new Xl(this.dd)},tp.prototype.Ud=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Jd()];case 1:return t.sent(),this.xd.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},tp.prototype.vv=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Fd()?(Ur(Kl,"RemoteStore restarting streams for new credential"),[4,this.Ud()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},tp.prototype.wv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.Jd()];case 3:t.sent(),this.xd.set("Unknown"),t.label=4;case 4:return[2]}})})},tp),Zl="firestore_clients";function tp(t,e,n,r,i){var o=this;this.Nc=t,this.dd=e,this.Cd=[],this.kd={},this.Vd=null,this.networkEnabled=!1,this.isPrimary=!1,this.Nd=i,this.Nd.Od(function(t){n.xu(function(){return p(o,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Fd()?(Ur(Kl,"Restarting streams for network reachability change."),[4,this.Ud()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.xd=new Ql(n,r),this.jd=this.dd.kl({yl:this.Ld.bind(this),wl:this.Bd.bind(this),Il:this.Md.bind(this)}),this.qd=this.dd.Cl({yl:this.Qd.bind(this),wl:this.Gd.bind(this),Pl:this.Wd.bind(this),Dl:this.Dl.bind(this)})}function ep(t,e){this.Pu=t,this._d=e,this.state="Unknown",this.Id=0,this.Td=null,this.Ed=!0}function np(t){this.dd=t,this.vd=au(),this.mutations=[],this.wd=!1,this.md=null,this.pd=new Set}function rp(t,e){return jr(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Zl+"_"+t+"_"+e}var ip="firestore_mutations";function op(t,e,n){var r=ip+"_"+t+"_"+n;return e.l()&&(r+="_"+e.uid),r}var sp="firestore_targets";function ap(t,e){return sp+"_"+t+"_"+e}var up="SharedClientState",hp=(bp.mv=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new ti(r.error.code,r.error.message)),i?new bp(t,e,r.state,o):(qr(up,"Failed to parse mutation state for ID '"+e+"': "+n),null)},bp.prototype.pv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},bp),cp=(wp.mv=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ti(n.error.code,n.error.message)),r?new wp(t,n.state,i):(qr(up,"Failed to parse target state for ID '"+t+"': "+e),null)},wp.prototype.pv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},wp),fp=(gp.mv=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=fu(),o=0;r&&o<n.activeTargetIds.length;++o)r=ia(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new gp(t,i):(qr(up,"Failed to parse client data for instance '"+t+"': "+e),null)},gp),lp=(mp.mv=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new mp(e.clientId,e.onlineState):(qr(up,"Failed to parse online state: "+t),null)},mp),pp=(vp.prototype.gv=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},vp.prototype.bv=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},vp.prototype.pv=function(){var t={activeTargetIds:this.activeTargetIds.tt(),updateTimeMs:Date.now()};return JSON.stringify(t)},vp),dp=(yp.Hs=function(t){return!(!t.window||null==t.window.localStorage)},yp.prototype.start=function(){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l=this;return y(this,function(t){switch(t.label){case 0:return jr(!this.mh,"WebStorageSharedClientState already started"),jr(null!==this.tv,"syncEngine property must be set before calling start()"),jr(null!==this._d,"onlineStateHandler property must be set before calling start()"),[4,this.tv.uc()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.yv&&(o=this.getItem(rp(this.persistenceKey,i)))&&(s=fp.mv(i,o))&&(this._v[s.clientId]=s);for(this.kv(),(a=this.storage.getItem(this.Cv))&&(u=this.Vv(a))&&this.Nv(u),h=0,c=this.Ev;h<c.length;h++)f=c[h],this.Tv(f);return this.Ev=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.mh=!0,[2]}})})},yp.prototype.pu=function(t){this.setItem(this.Av,JSON.stringify(t))},yp.prototype.Ov=function(){var n=fu();return yi(this._v,function(t,e){n=n.qt(e.activeTargetIds)}),n},yp.prototype.Fv=function(t){for(var e in this._v)if(this._v.hasOwnProperty(e)&&this._v[e].activeTargetIds.has(t))return!0;return!1},yp.prototype.Uv=function(t){this.xv(t,"pending")},yp.prototype.jv=function(t,e,n){this.xv(t,e,n),this.Lv(t)},yp.prototype.Bv=function(t){var e="not-current";if(this.Fv(t)){var n=this.storage.getItem(ap(this.persistenceKey,t));if(n){var r=cp.mv(t,n);r&&(e=r.state)}}return this.Mv.gv(t),this.kv(),e},yp.prototype.qv=function(t){this.Mv.bv(t),this.kv()},yp.prototype.Qv=function(t){return this.Mv.activeTargetIds.has(t)},yp.prototype.Gv=function(t){this.removeItem(ap(this.persistenceKey,t))},yp.prototype.Wv=function(t,e,n){this.zv(t,e,n)},yp.prototype.Dh=function(t,e,n){var r=this;e.forEach(function(t){r.Lv(t)}),this.currentUser=t,n.forEach(function(t){r.Uv(t)})},yp.prototype.Kv=function(t){this.Hv(t)},yp.prototype.shutdown=function(){this.mh&&(this.platform.window.removeEventListener("storage",this.Iv),this.removeItem(this.Rv),this.mh=!1)},yp.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ur(up,"READ",t,e),e},yp.prototype.setItem=function(t,e){Ur(up,"SET",t,e),this.storage.setItem(t,e)},yp.prototype.removeItem=function(t){Ur(up,"REMOVE",t),this.storage.removeItem(t)},yp.prototype.Tv=function(a){var t=this;if(a.storageArea===this.storage){if(Ur(up,"EVENT",a.key,a.newValue),a.key===this.Rv)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Aa.xu(function(){return p(t,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){if(!this.mh)return this.Ev.push(a),[2];if(null===a.key)return[2];if(this.Dv.test(a.key)){if(null==a.newValue)return n=this.Jv(a.key),[2,this.Yv(n,null)];if(e=this.Xv(a.key,a.newValue))return[2,this.Yv(e.clientId,e)]}else if(this.Pv.test(a.key)){if(null!==a.newValue&&(r=this.$v(a.key,a.newValue)))return[2,this.Zv(r)]}else if(this.Sv.test(a.key)){if(null!==a.newValue&&(i=this.tw(a.key,a.newValue)))return[2,this.nw(i)]}else if(a.key===this.Cv){if(null!==a.newValue&&(o=this.Vv(a.newValue)))return[2,this.Nv(o)]}else a.key===this.Av&&(jr(!!this.vu,"Missing sequenceNumberHandler"),(s=function(t){var e=nh.gu;if(null!=t)try{var n=JSON.parse(t);jr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){qr(up,"Failed to read sequence number from WebStorage",t)}return e}(a.newValue))!==nh.gu&&this.vu(s));return[2]})})})}},Object.defineProperty(yp.prototype,"Mv",{get:function(){return this._v[this.yv]},enumerable:!0,configurable:!0}),yp.prototype.kv=function(){this.setItem(this.Rv,this.Mv.pv())},yp.prototype.xv=function(t,e,n){var r=new hp(this.currentUser,t,e,n),i=op(this.persistenceKey,this.currentUser,t);this.setItem(i,r.pv())},yp.prototype.Lv=function(t){var e=op(this.persistenceKey,this.currentUser,t);this.removeItem(e)},yp.prototype.Hv=function(t){var e={clientId:this.yv,onlineState:t};this.storage.setItem(this.Cv,JSON.stringify(e))},yp.prototype.zv=function(t,e,n){var r=ap(this.persistenceKey,t),i=new cp(t,e,n);this.setItem(r,i.pv())},yp.prototype.Jv=function(t){var e=this.Dv.exec(t);return e?e[1]:null},yp.prototype.Xv=function(t,e){var n=this.Jv(t);return jr(null!==n,"Cannot parse client state key '"+t+"'"),fp.mv(n,e)},yp.prototype.$v=function(t,e){var n=this.Pv.exec(t);jr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return hp.mv(new $r(i),r,e)},yp.prototype.tw=function(t,e){var n=this.Sv.exec(t);jr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return cp.mv(r,e)},yp.prototype.Vv=function(t){return lp.mv(t)},yp.prototype.Zv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return e.user.uid!==this.currentUser.uid?(Ur(up,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.tv.iw(e.batchId,e.state,e.error)]})})},yp.prototype.nw=function(t){return this.tv.ew(t.targetId,t.state,t.error)},yp.prototype.Yv=function(t,e){var n=this,r=this.Ov();e?this._v[t]=e:delete this._v[t];var i=this.Ov(),o=[],s=[];return i.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return i.has(e)||s.push(e),[2]})})}),this.tv.rw(o,s)},yp.prototype.Nv=function(t){this._v[t.clientId]&&this._d(t.onlineState)},yp);function yp(t,e,n,r,i){if(this.Aa=t,this.platform=e,this.persistenceKey=n,this.yv=r,this.tv=null,this._d=null,this.vu=null,this._v={},this.Iv=this.Tv.bind(this),this.mh=!1,this.Ev=[],!yp.Hs(this.platform))throw new ti(Zr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Rv=rp(this.persistenceKey,this.yv),this.Av="firestore_sequence_number_"+this.persistenceKey,this._v[this.yv]=new pp,this.Dv=new RegExp("^"+Zl+"_"+o+"_([^_]*)$"),this.Pv=new RegExp("^"+ip+"_"+o+"_(\\d+)(?:_(.*))?$"),this.Sv=new RegExp("^"+sp+"_"+o+"_(\\d+)$"),this.Cv="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Iv)}function vp(){this.activeTargetIds=fu()}function mp(t,e){this.clientId=t,this.onlineState=e}function gp(t,e){this.clientId=t,this.activeTargetIds=e}function wp(t,e,n){this.targetId=t,this.state=e,jr(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function bp(t,e,n,r){this.user=t,this.batchId=e,this.state=n,jr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}function Ep(t){this.key=t}function Ip(t){this.key=t}var Np=(Sp.prototype.Uv=function(t){},Sp.prototype.jv=function(t,e,n){},Sp.prototype.Bv=function(t){return this.uw.gv(t),this.sw[t]||"not-current"},Sp.prototype.Wv=function(t,e,n){this.sw[t]=e},Sp.prototype.qv=function(t){this.uw.bv(t)},Sp.prototype.Qv=function(t){return this.uw.activeTargetIds.has(t)},Sp.prototype.Gv=function(t){delete this.sw[t]},Sp.prototype.Ov=function(){return this.uw.activeTargetIds},Sp.prototype.Fv=function(t){return this.uw.activeTargetIds.has(t)},Sp.prototype.start=function(){return this.uw=new pp,Promise.resolve()},Sp.prototype.Dh=function(t,e,n){},Sp.prototype.Kv=function(t){},Sp.prototype.shutdown=function(){},Sp.prototype.pu=function(t){},Sp),Tp=(Object.defineProperty(Ap.prototype,"fw",{get:function(){return this.ow},enumerable:!0,configurable:!0}),Ap.prototype.lw=function(t,e){var a=this,u=e?e.dw:new Iu,h=e?e.aw:this.aw,c=e?e.Ji:this.Ji,f=h,l=!1,p=this.query.gi()&&h.size===this.query.limit?h.last():null,d=this.query.bi()&&h.size===this.query.limit?h.first():null;if(t.pt(function(t,e){var n=h.get(t),r=e instanceof Ls?e:null;r&&(jr(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=a.query.matches(r)?r:null);var i=!!n&&a.Ji.has(n.key),o=!!r&&(r.un||a.Ji.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:lu.Qi,doc:r}),s=!0):a.vw(n,r)||(u.track({type:lu.qi,doc:r}),s=!0,(p&&0<a.query.di(r,p)||d&&a.query.di(r,d)<0)&&(l=!0)):!n&&r?(u.track({type:lu.Bi,doc:r}),s=!0):n&&!r&&(u.track({type:lu.Mi,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.gi()||this.query.bi())for(;f.size>this.query.limit;){var n=this.query.gi()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),u.track({type:lu.Mi,doc:n})}return jr(!l||!e,"View was refilled using docs that themselves needed refilling."),{aw:f,dw:u,gf:l,Ji:c}},Ap.prototype.vw=function(t,e){return t.un&&e.hasCommittedMutations&&!e.un},Ap.prototype.qs=function(t,e,n){var o=this;jr(!t.gf,"Cannot apply changes that need a refill");var r=this.aw;this.aw=t.aw,this.Ji=t.Ji;var i=t.dw.Ki();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.di(t.doc,e.doc);function n(t){switch(t){case lu.Bi:return 1;case lu.qi:case lu.Qi:return 2;case lu.Mi:return 0;default:return Gr("Unknown ChangeType: "+t)}}var r,i}),this.ww(n);var s=e?this.mw():[],a=0===this.cw.size&&this.ue?du.Wi:du.Gi,u=a!==this.hw;return this.hw=a,0!==i.length||u?{snapshot:new Nu(this.query,t.aw,r,i,t.Ji,a===du.Gi,u,!1),pw:s}:{pw:s}},Ap.prototype.gw=function(t){return this.ue&&"Offline"===t?(this.ue=!1,this.qs({aw:this.aw,dw:new Iu,Ji:this.Ji,gf:!1},!1)):{pw:[]}},Ap.prototype.bw=function(t){return!this.ow.has(t)&&!!this.aw.has(t)&&!this.aw.get(t).un},Ap.prototype.ww=function(t){var e=this;t&&(t.se.forEach(function(t){return e.ow=e.ow.add(t)}),t.oe.forEach(function(t){return jr(e.ow.has(t),"Modified document "+t+" not found in view.")}),t.he.forEach(function(t){return e.ow=e.ow.delete(t)}),this.ue=t.ue)},Ap.prototype.mw=function(){var e=this;if(!this.ue)return[];var n=this.cw;this.cw=hu(),this.aw.forEach(function(t){e.bw(t.key)&&(e.cw=e.cw.add(t.key))});var r=[];return n.forEach(function(t){e.cw.has(t)||r.push(new Ip(t))}),this.cw.forEach(function(t){n.has(t)||r.push(new Ep(t))}),r},Ap.prototype.yw=function(t){this.ow=t.ec,this.cw=hu();var e=this.lw(t.documents);return this.qs(e,!0)},Ap.prototype._w=function(){return Nu.$i(this.query,this.aw,this.Ji,this.hw===du.Gi)},Ap);function Ap(t,e){this.query=t,this.ow=e,this.hw=null,this.ue=!1,this.cw=hu(),this.Ji=hu(),this.aw=new vu(t.di.bind(t))}function Sp(){this.uw=new pp,this.sw={},this.tv=null,this._d=null,this.vu=null}function kp(t,e,n){this.query=t,this.targetId=e,this.view=n}function Dp(t){this.key=t,this.Pw=!1}function Rp(){this.um=null,this.targetId=0,this.listeners=[]}function _p(){}var xp=(Hp.prototype.run=function(){this.Ew()},Hp.prototype.Ew=function(){var t=this;this.ul.Jf(function(){return p(t,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){return e=this.Iw.dv(),(n=this.Rw(e))&&n.then(function(t){r.Pu.xu(function(){return e.commit().then(function(){r.Vu.resolve(t)}).catch(function(t){r.Aw(t)})})}).catch(function(t){r.Aw(t)}),[2]})})})},Hp.prototype.Rw=function(t){try{var e=this.updateFunction(t);return!ra(e)&&e.catch&&e.then?e:(this.Vu.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Vu.reject(t),null}},Hp.prototype.Aw=function(t){var e=this;0<this.Tw&&this.Dw(t)?(this.Tw-=1,this.Pu.xu(function(){return e.Ew(),Promise.resolve()})):this.Vu.reject(t)},Hp.prototype.Dw=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Za(e)},Hp),Cp=(Object.defineProperty(Bp.prototype,"Lw",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),Bp.prototype.subscribe=function(t){jr(null!==t,"SyncEngine listener cannot be null"),jr(null===this.Cw,"SyncEngine already has a subscriber."),this.Cw=t},Bp.prototype.listen=function(s){return p(this,void 0,void 0,function(){var e,n,r,i,o;return y(this,function(t){switch(t.label){case 0:return this.Bw("listen()"),(r=this.kw.get(s))?(e=r.targetId,this.Sw.Bv(e),n=r.view._w(),[3,4]):[3,1];case 1:return[4,this.Nc.Yh(s.li())];case 2:return i=t.sent(),o=this.Sw.Bv(i.targetId),e=i.targetId,[4,this.Mw(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.Iw.listen(i),t.label=4;case 4:return this.Cw.Il([n]),[2,e]}})})},Bp.prototype.Mw=function(a,u,h){return p(this,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){switch(t.label){case 0:return[4,this.Nc.nc(a,!0)];case 1:return e=t.sent(),n=new Tp(a,e.ec),r=n.lw(e.documents),i=Au.re(u,h&&"Offline"!==this.onlineState),jr(0===(o=n.qs(r,!0===this.isPrimary,i)).pw.length,"View returned limbo docs before target ack from the server."),jr(!!o.snapshot,"applyChanges for new view should always return a snapshot"),s=new kp(a,u,n),this.kw.set(a,s),this.Vw[u]||(this.Vw[u]=[]),this.Vw[u].push(a),[2,o.snapshot]}})})},Bp.prototype.qw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return[4,this.Nc.nc(r.query,!0)];case 1:return e=t.sent(),n=r.view.yw(e),this.isPrimary&&this.Qw(r.targetId,n.pw),[2,n]}})})},Bp.prototype.$d=function(i){return p(this,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){switch(t.label){case 0:return this.Bw("unlisten()"),jr(!!(e=this.kw.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.Vw[e.targetId]).length?(this.Vw[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.kw.delete(i),[2]):this.isPrimary?(this.Sw.qv(e.targetId),this.Sw.Fv(e.targetId)?[3,2]:[4,this.Nc.tc(e.targetId,!1).then(function(){r.Sw.Gv(e.targetId),r.Iw.$d(e.targetId),r.Gw(e.targetId)}).catch(hc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Gw(e.targetId),[4,this.Nc.tc(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Bp.prototype.write=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Bw("write()"),[4,this.Nc.kh(n)];case 1:return e=t.sent(),this.Sw.Uv(e.batchId),this.Ww(e.batchId,r),[4,this.zw(e.Ns)];case 2:return t.sent(),[4,this.Iw.Hd()];case 3:return t.sent(),[2]}})})},Bp.prototype.runTransaction=function(t,e,n){new xp(t,this.Iw,e,n).run()},Bp.prototype.jh=function(n){return p(this,void 0,void 0,function(){var e,r=this;return y(this,function(t){switch(t.label){case 0:this.Bw("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Nc.jh(n)];case 2:return e=t.sent(),yi(n.Zi,function(t,e){var n=r.Ow[Number(t)];n&&(jr(e.se.size+e.oe.size+e.he.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.se.size?n.Pw=!0:0<e.oe.size?jr(n.Pw,"Received change for limbo target document without add."):0<e.he.size&&(jr(n.Pw,"Received remove for limbo target document without add."),n.Pw=!1))}),[4,this.zw(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,hc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Bp.prototype.gw=function(r,t){if(this.isPrimary&&t===ha.Ri||!this.isPrimary&&t===ha.Ai){this.Bw("applyOnlineStateChange()");var i=[];this.kw.forEach(function(t,e){var n=e.view.gw(r);jr(0===n.pw.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.Cw.Kw(r),this.Cw.Il(i),this.onlineState=r,this.isPrimary&&this.Sw.Kv(r)}},Bp.prototype.ev=function(a,u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return y(this,function(t){switch(t.label){case 0:return this.Bw("rejectListens()"),this.Sw.Wv(a,"rejected",u),e=this.Ow[a],(n=e&&e.key)?(this.Nw=this.Nw.remove(n),delete this.Ow[a],r=(r=new zi(Hi.G)).lt(n,new Ms(n,Vi.B())),i=hu().add(n),o=new Tu(Vi.MIN,{},new so(Hr),r,i),[2,this.jh(o)]):[3,1];case 1:return[4,this.Nc.tc(a,!1).then(function(){return s.Gw(a,u)}).catch(hc)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Bp.prototype.iw=function(n,r,i){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Bw("applyBatchState()"),[4,this.Nc.Vh(n)];case 1:return null===(e=t.sent())?(Ur("SyncEngine","Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.Iw.Hd()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.Hw(n,i||null),this.Nc.sc(n)):Gr("Unknown batchState: "+r),t.label=4;case 4:return[4,this.zw(e)];case 5:return t.sent(),[2]}})})},Bp.prototype.cv=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:this.Bw("applySuccessfulWrite()"),e=r.batch.batchId,this.Hw(e,null),this.Jw(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Nc.bo(r)];case 2:return n=t.sent(),this.Sw.jv(e,"acknowledged"),[4,this.zw(n)];case 3:return t.sent(),[3,6];case 4:return[4,hc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Bp.prototype.lv=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:this.Bw("rejectFailedWrite()"),this.Hw(n,r),this.Jw(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Nc.Uh(n)];case 2:return e=t.sent(),this.Sw.jv(n,"rejected",r),[4,this.zw(e)];case 3:return t.sent(),[3,6];case 4:return[4,hc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Bp.prototype.Yw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.Iw.Fd()||Ur("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.Nc.Co()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.xw.get(e)||[]).push(r),this.xw.set(e,n)),[2]}})})},Bp.prototype.Jw=function(t){(this.xw.get(t)||[]).forEach(function(t){t.resolve()}),this.xw.delete(t)},Bp.prototype.Xw=function(e){this.xw.forEach(function(t){t.forEach(function(t){t.reject(new ti(Zr.CANCELLED,e))})}),this.xw.clear()},Bp.prototype.Ww=function(t,e){var n=this.Uw[this.currentUser.v()];n=(n=n||new zi(Hr)).lt(t,e),this.Uw[this.currentUser.v()]=n},Bp.prototype.Hw=function(t,e){var n=this.Uw[this.currentUser.v()];if(n){var r=n.get(t);r&&(jr(t===n.vt(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.Uw[this.currentUser.v()]=n}},Bp.prototype.Gw=function(t,e){var n=this;void 0===e&&(e=null),this.Sw.qv(t),jr(this.Vw[t]&&0!==this.Vw[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.Vw[t];r<i.length;r++){var o=i[r];this.kw.delete(o),e&&this.Cw.$w(o,e)}if(delete this.Vw[t],this.isPrimary){var s=this.Fw.gs(t);this.Fw.ms(t),s.forEach(function(t){n.Fw.bs(t)||n.Zw(t)})}},Bp.prototype.Zw=function(t){var e=this.Nw.get(t);null!==e&&(this.Iw.$d(e),this.Nw=this.Nw.remove(t),delete this.Ow[e])},Bp.prototype.Qw=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Ep?(this.Fw.fs(i.key,t),this.tm(i)):i instanceof Ip?(Ur("SyncEngine","Document no longer in limbo: "+i.key),this.Fw.ds(i.key,t),this.Fw.bs(i.key)||this.Zw(i.key)):Gr("Unknown limbo change: "+JSON.stringify(i))}},Bp.prototype.tm=function(t){var e=t.key;if(!this.Nw.get(e)){Ur("SyncEngine","New document in limbo: "+e);var n=this.jw.next(),r=ma.ti(e.path);this.Ow[n]=new Dp(e),this.Iw.listen(new Xa(r.li(),n,ja.ki,nh.gu)),this.Nw=this.Nw.lt(e,n)}},Bp.prototype.nm=function(){return this.Nw},Bp.prototype.zw=function(r,u){return p(this,void 0,void 0,function(){var o,s,e,a=this;return y(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.kw.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.lw(r);return n.gf?a.Nc.nc(i.query,!1).then(function(t){var e=t.documents;return i.view.lw(e,n)}):n}).then(function(t){var e=u&&u.Zi[i.targetId],n=i.view.qs(t,!0===a.isPrimary,e);if(a.Qw(i.targetId,n.pw),n.snapshot){a.isPrimary&&a.Sw.Wv(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=nc.ah(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Cw.Il(o),[4,this.Nc.Kh(s)];case 2:return t.sent(),[2]}})})},Bp.prototype.Bw=function(t){jr(null!==this.Cw,"Trying to call "+t+" before calling subscribe().")},Bp.prototype.vv=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.Xw("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.Nc.Dh(r)]):[3,3];case 1:return n=t.sent(),this.Sw.Dh(r,n.Sh,n.Ch),[4,this.zw(n.Ph)];case 2:t.sent(),t.label=3;case 3:return[4,this.Iw.vv()];case 4:return t.sent(),[2]}})})},Bp.prototype.wv=function(u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return!0!==u||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Iw.wv(!0)]);case 1:return t.sent(),o=this.Sw.Ov(),[4,this.im(o.tt())];case 2:for(e=t.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.Iw.listen(i);return[3,7];case 3:return!1!==u||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),di(this.Vw,function(t,e){a.Sw.Qv(t)?o.push(t):s=s.then(function(){return a.Gw(t),a.Nc.tc(t,!0)}),a.Iw.$d(t)}),[4,s]);case 4:return t.sent(),[4,this.im(o)];case 5:return t.sent(),this.em(),[4,this.Iw.wv(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Bp.prototype.em=function(){var e=this;di(this.Ow,function(t){e.Iw.$d(t)}),this.Fw.ps(),this.Ow=[],this.Nw=new zi(Hi.G)},Bp.prototype.im=function(d){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l,p;return y(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(a=this.Vw[o])&&0!==a.length?[4,this.Nc.tc(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.Nc.Yh(a[0].li())];case 3:s=t.sent(),u=0,h=a,t.label=4;case 4:return u<h.length?(c=h[u],jr(!!(f=this.kw.get(c)),"No query view found for "+c),[4,this.qw(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return jr(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.Nc.ac(o)];case 9:return jr(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.Nc.Yh(p)];case 10:return s=t.sent(),[4,this.Mw(this.rm(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return this.Cw.Il(n),[2,e]}})})},Bp.prototype.rm=function(t){return new ma(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,oa.Kn,t.startAt,t.endAt)},Bp.prototype.uc=function(){return this.Nc.uc()},Bp.prototype.ew=function(r,i,o){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Ur("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.Vw[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.Nc.fc()];case 2:return e=t.sent(),n=Tu.ee(r,"current"===i),[4,this.zw(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.Nc.tc(r,!0)];case 5:return t.sent(),this.Gw(r,o),[3,7];case 6:Gr("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},Bp.prototype.rw=function(f,l){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c=this;return y(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=f,t.label=1;case 1:return e<n.length?(h=n[e],jr(!this.Vw[h],"Trying to add an already active target"),[4,this.Nc.ac(h)]):[3,6];case 2:return jr(!!(r=t.sent()),"Query data for active target "+h+" not found"),[4,this.Nc.Yh(r)];case 3:return i=t.sent(),[4,this.Mw(this.rm(r),i.targetId,!1)];case 4:t.sent(),this.Iw.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return y(this,function(t){switch(t.label){case 0:return s.Vw[e]?[4,s.Nc.tc(e,!1).then(function(){c.Iw.$d(e),c.Gw(e)}).catch(hc)]:[2,"continue"];case 1:return t.sent(),[2]}})},s=this,a=0,u=l,t.label=7;case 7:return a<u.length?(h=u[a],[5,o(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Bp.prototype.enableNetwork=function(){return this.Nc.oc(!0),this.Iw.enableNetwork()},Bp.prototype.disableNetwork=function(){return this.Nc.oc(!1),this.Iw.disableNetwork()},Bp.prototype.Je=function(t){var e=this.Ow[t];if(e&&e.Pw)return hu().add(e.key);var n=hu(),r=this.Vw[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.kw.get(s);jr(!!a,"No query view found for "+s),n=n.qt(a.view.fw)}return n},Bp),Op=(Fp.prototype.listen=function(t){var e=t.query,n=!1,r=this.sm.get(e);return r||(n=!0,r=new Rp,this.sm.set(e,r)),r.listeners.push(t),jr(!t.gw(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.um&&t.hm(r.um)&&this.cm(),n?this.tv.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},Fp.prototype.$d=function(o){return p(this,void 0,void 0,function(){var e,n,r,i;return y(this,function(t){return e=o.query,n=!1,(r=this.sm.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.sm.delete(e),[2,this.tv.$d(e)]):[2]})})},Fp.prototype.Il=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.sm.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].hm(i)&&(e=!0);s.um=i}}e&&this.cm()},Fp.prototype.$w=function(t,e){var n=this.sm.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.sm.delete(t)},Fp.prototype.Kw=function(i){this.onlineState=i;var o=!1;this.sm.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].gw(i)&&(o=!0)}),o&&this.cm()},Fp.prototype.am=function(t){this.om.add(t),t.next()},Fp.prototype.fm=function(t){this.om.delete(t)},Fp.prototype.cm=function(){this.om.forEach(function(t){t.next()})},Fp),Pp=(jp.prototype.hm=function(t){if(jr(0<t.docChanges.length||t.Yi,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==lu.Qi&&e.push(i)}t=new Nu(t.query,t.docs,t.Hi,e,t.Ji,t.fromCache,t.Yi,!0)}var o=!1;return this.dm?this.wm(t)&&(this.lm.next(t),o=!0):this.mm(t,this.onlineState)&&(this.pm(t),o=!0),this.vm=t,o},jp.prototype.onError=function(t){this.lm.error(t)},jp.prototype.gw=function(t){this.onlineState=t;var e=!1;return this.vm&&!this.dm&&this.mm(this.vm,t)&&(this.pm(this.vm),e=!0),e},jp.prototype.mm=function(t,e){if(jr(!this.dm,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n="Offline"!==e;return this.options.gm&&n?(jr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.J()||"Offline"===e},jp.prototype.wm=function(t){if(0<t.docChanges.length)return!0;var e=this.vm&&this.vm.hasPendingWrites!==t.hasPendingWrites;return!(!t.Yi&&!e)&&!0===this.options.includeMetadataChanges},jp.prototype.pm=function(t){jr(!this.dm,"Trying to raise initial events for second time"),t=Nu.$i(t.query,t.docs,t.Ji,t.fromCache),this.dm=!0,this.lm.next(t)},jp),Lp=(Gp.prototype.ja=function(){return pc.Rc(this.cacheSizeBytes)},Gp),Mp=(Vp.prototype.start=function(t){var n=this;this.ym();var r=new Ku,i=new Ku,o=!1;return this.credentials.T(function(e){o?n.Pu.xu(function(){return n.vv(e)}):(o=!0,n._m(t,i,e).then(function(t){return n.Im(e,t)}).then(r.resolve,r.reject))}),this.Pu.xu(function(){return r.promise}),i.promise},Vp.prototype.enableNetwork=function(){var t=this;return this.ym(),this.Pu.enqueue(function(){return t.tv.enableNetwork()})},Vp.prototype._m=function(t,e,n){var r=this;return t instanceof Lp?this.Tm(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.Em(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.Rm()}):(e.resolve(),this.Rm())},Vp.prototype.Em=function(t){return t instanceof ti?t.code===Zr.FAILED_PRECONDITION||t.code===Zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Vp.prototype.ym=function(){if(this.Pu.Gu)throw new ti(Zr.FAILED_PRECONDITION,"The client has already been terminated.")},Vp.prototype.Tm=function(r,i){var t=this,o=Nf.af(this.bm),s=new Hu(this.bm.s,{Ze:!0});return Promise.resolve().then(function(){return p(t,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!dp.Hs(this.platform))throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.ja(),this.Sw=i.synchronizeTabs?new dp(this.Pu,this.platform,o,this.clientId,r):new Np,[4,Nf.xa({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,Aa:this.Pu,serializer:s,ja:e,Da:this.Sw})];case 1:return n=t.sent(),[2,(this.persistence=n).vo.Vc]}})})})},Vp.prototype.Rm=function(){return this.persistence=jf.Nf(this.clientId),this.Sw=new Np,Promise.resolve(null)},Vp.prototype.Im=function(h,c){var t=this;return Ur("FirestoreClient","Initializing. user=",h.uid),this.platform.Am(this.bm).then(function(u){return p(t,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return e=new xf,this.Nc=new ic(this.persistence,e,h),[4,this.Nc.start()];case 1:return t.sent(),c&&(this.Dm=new dc(c,this.Pu,this.Nc)),n=this.platform.Pm(),r=this.platform.Sm(this.bm.s),i=new ol(this.Pu,u,this.credentials,r),o=function(t){return a.tv.gw(t,ha.Ri)},s=function(t){return a.tv.gw(t,ha.Ai)},this.Iw=new $l(this.Nc,i,this.Pu,o,n),this.tv=new Cp(this.Nc,this.Iw,this.Sw,h),this.Sw._d=s,this.Iw.tv=this.tv,this.Sw.tv=this.tv,this.Cm=new Op(this.tv),[4,this.Sw.start()];case 2:return t.sent(),[4,this.Iw.start()];case 3:return t.sent(),[4,this.persistence.Wa(function(e){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.tv.wv(e)];case 1:return t.sent(),this.Dm&&(e&&!this.Dm.mh?this.Dm.start():e||this.Dm.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.za(function(){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},Vp.prototype.vv=function(t){return this.Pu.$u(),Ur("FirestoreClient","Credential Changed. Current user: "+t.uid),this.tv.vv(t)},Vp.prototype.disableNetwork=function(){var t=this;return this.ym(),this.Pu.enqueue(function(){return t.tv.disableNetwork()})},Vp.prototype.terminate=function(){var t=this;return this.Pu.Ju(function(){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Dm&&this.Dm.stop(),[4,this.Iw.shutdown()];case 1:return t.sent(),[4,this.Sw.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.R(),[2]}})})})},Vp.prototype.waitForPendingWrites=function(){var t=this;this.ym();var e=new Ku;return this.Pu.xu(function(){return t.tv.Yw(e)}),e.promise},Vp.prototype.listen=function(t,e,n){var r=this;this.ym();var i=new Pp(t,e,n);return this.Pu.xu(function(){return r.Cm.listen(i)}),i},Vp.prototype.$d=function(t){var e=this;this.km||this.Pu.xu(function(){return e.Cm.$d(t)})},Vp.prototype.Vm=function(t){var e=this;return this.ym(),this.Pu.enqueue(function(){return e.Nc.Jh(t)}).then(function(t){if(t instanceof Ls)return t;if(t instanceof Ms)return null;throw new ti(Zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Vp.prototype.Nm=function(i){var t=this;return this.ym(),this.Pu.enqueue(function(){return p(t,void 0,void 0,function(){var e,n,r;return y(this,function(t){switch(t.label){case 0:return[4,this.Nc.nc(i,!0)];case 1:return e=t.sent(),n=new Tp(i,e.ec),r=n.lw(e.documents),[2,n.qs(r,!1).snapshot]}})})})},Vp.prototype.write=function(t){var e=this;this.ym();var n=new Ku;return this.Pu.xu(function(){return e.tv.write(t,n)}),n.promise},Vp.prototype.s=function(){return this.bm.s},Vp.prototype.am=function(t){var e=this;this.ym(),this.Pu.xu(function(){return e.Cm.am(t),Promise.resolve()})},Vp.prototype.fm=function(t){this.km||this.Cm.fm(t)},Object.defineProperty(Vp.prototype,"km",{get:function(){return this.Pu.Gu},enumerable:!0,configurable:!0}),Vp.prototype.transaction=function(t){var e=this;this.ym();var n=new Ku;return this.Pu.xu(function(){return e.tv.runTransaction(e.Pu,t,n),Promise.resolve()}),n.promise},Vp),Up=(qp.prototype.next=function(t){this.Om(this.observer.next,t)},qp.prototype.error=function(t){this.Om(this.observer.error,t)},qp.prototype.Fm=function(){this.muted=!0},qp.prototype.Om=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},qp);function qp(t){this.observer=t,this.muted=!1}function Vp(t,e,n,r){this.platform=t,this.bm=e,this.credentials=n,this.Pu=r,this.clientId=Fr.u()}function Gp(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}function jp(t,e,n){this.query=t,this.lm=e,this.dm=!1,this.vm=null,this.onlineState="Unknown",this.options=n||{}}function Fp(t){this.tv=t,this.sm=new Eh(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.om=new Set,this.tv.subscribe(this)}function Bp(t,e,n,r){this.Nc=t,this.Iw=e,this.Sw=n,this.currentUser=r,this.Cw=null,this.kw=new Eh(function(t){return t.canonicalId()}),this.Vw={},this.Nw=new zi(Hi.G),this.Ow={},this.Fw=new wh,this.Uw={},this.xw=new Map,this.jw=tc.Ko(),this.isPrimary=void 0,this.onlineState="Unknown"}function Hp(t,e,n,r){this.Pu=t,this.Iw=e,this.updateFunction=n,this.Vu=r,this.Tw=5,this.ul=new zf(this.Pu,$u.Du)}function zp(i){return function(){if("object"!=typeof i||null===i)return!1;for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}()}var Jp,Wp=pc.Pc,Yp=(pd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},pd),Xp=(ld.prototype.settings=function(t){if(gi("Firestore.settings",arguments,1),Ei("Firestore.settings","object",1,t),li(t,"persistence"))throw new ti(Zr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Yp(t);if(this.Lm&&!this.Gm.isEqual(e))throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Gm=e).credentials&&(this.Qm=function(t){if(!t)return new ei;switch(t.type){case"gapi":var e=t.N;return jr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new ii(e,t.k||"0");case"provider":return t.N;default:throw new ti(Zr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},ld.prototype.enableNetwork=function(){return this.jm(),this.Lm.enableNetwork()},ld.prototype.disableNetwork=function(){return this.jm(),this.Lm.disableNetwork()},ld.prototype.enablePersistence=function(t){if(this.Lm)throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&qr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=pi(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.Km(new Lp(this.Gm.cacheSizeBytes,e))},ld.prototype.clearPersistence=function(){var t=this,n=Nf.af(this.Hm()),r=new Ku;return this.xm.Wu(function(){return p(t,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this.Lm&&!this.Lm.km)throw new ti(Zr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Nf.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},ld.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(ld.prototype,"Jm",{get:function(){return this.jm(),this.Lm.km},enumerable:!0,configurable:!0}),ld.prototype.waitForPendingWrites=function(){return this.jm(),this.Lm.waitForPendingWrites()},ld.prototype.onSnapshotsInSync=function(t){if(this.jm(),zp(t))return this.Ym(t);Ei("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Ym(e)},ld.prototype.Ym=function(t){var e=this,n=new Up({next:function(){t.next&&t.next()},error:function(t){throw Gr("Uncaught Error in onSnapshotsInSync")}});return this.Lm.am(n),function(){n.Fm(),e.Lm.fm(n)}},ld.prototype.jm=function(){return this.Lm||this.Km(new _p),this.Lm},ld.prototype.Hm=function(){return new Wr(this.Bm,this.qm,this.Gm.host,this.Gm.ssl,this.Gm.forceLongPolling)},ld.prototype.Km=function(t){jr(!!this.Gm.host,"FirestoreSettings.host is not set"),jr(!this.Lm,"configureClient() called multiple times");var e=this.Hm();return this.Lm=new Mp(zu.t(),e,this.Qm,this.xm),this.Lm.start(t)},ld.prototype.zm=function(r){return new jl(function(t){if(t instanceof $p){var e=r,n=t.firestore.Bm;if(!n.isEqual(e))throw new ti(Zr.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new Gl(r,t.Xm)}return t})},ld.Mm=function(t){var e=t.options;if(!li(e,"projectId"))throw new ti(Zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new ti(Zr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Kr(n)},Object.defineProperty(ld.prototype,"app",{get:function(){if(!this.Um)throw new ti(Zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Um},enumerable:!0,configurable:!0}),ld.prototype.collection=function(t){return gi("Firestore.collection",arguments,1),Ei("Firestore.collection","non-empty string",1,t),this.jm(),new yd(ji.it(t),this)},ld.prototype.doc=function(t){return gi("Firestore.doc",arguments,1),Ei("Firestore.doc","non-empty string",1,t),this.jm(),$p.$m(ji.it(t),this)},ld.prototype.collectionGroup=function(t){if(gi("Firestore.collectionGroup",arguments,1),Ei("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.jm(),new nd(new ma(ji.et,t),this)},ld.prototype.runTransaction=function(e){var n=this;return gi("Firestore.runTransaction",arguments,1),Ei("Firestore.runTransaction","function",1,e),this.jm().transaction(function(t){return e(new Qp(n,t))})},ld.prototype.batch=function(){return this.jm(),new Kp(this)},Object.defineProperty(ld,"logLevel",{get:function(){switch(Lr()){case Ar.DEBUG:return"debug";case Ar.ERROR:return"error";case Ar.SILENT:return"silent";default:return Gr("Unknown log level: "+Lr())}},enumerable:!0,configurable:!0}),ld.setLogLevel=function(t){switch(gi("Firestore.setLogLevel",arguments,1),Ei("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Mr(Ar.DEBUG);break;case"error":Mr(Ar.ERROR);break;case"silent":Mr(Ar.SILENT);break;default:throw new ti(Zr.INVALID_ARGUMENT,"Invalid log level: "+t)}},ld.prototype.Zm=function(){return this.Gm.timestampsInSnapshots},ld),Qp=(fd.prototype.get=function(t){var n=this;gi("Transaction.get",arguments,1);var r=bd("Transaction.get",t,this.tp);return this.np.lookup([r.Xm]).then(function(t){if(!t||1!==t.length)return Gr("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Ms)return new td(n.tp,r.Xm,null,!1,!1,r.ip);if(e instanceof Ls)return new td(n.tp,r.Xm,e,!1,!1,r.ip);throw Gr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},fd.prototype.set=function(t,e,n){bi("Transaction.set",arguments,2,3);var r=bd("Transaction.set",t,this.tp);n=md("Transaction.set",n);var i=Ed(r.ip,e,"Transaction.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.tp.Wm.nd(s,o,n.mergeFields):this.tp.Wm.Zl(s,o);return this.np.set(r.Xm,a),this},fd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof sl?(wi("Transaction.update",arguments,3),r=bd("Transaction.update",t,this.tp),this.tp.Wm.ud("Transaction.update",e,n,o)):(gi("Transaction.update",arguments,2),r=bd("Transaction.update",t,this.tp),this.tp.Wm.ed("Transaction.update",e)),this.np.update(r.Xm,i),this},fd.prototype.delete=function(t){gi("Transaction.delete",arguments,1);var e=bd("Transaction.delete",t,this.tp);return this.np.delete(e.Xm),this},fd),Kp=(cd.prototype.set=function(t,e,n){bi("WriteBatch.set",arguments,2,3),this.up();var r=bd("WriteBatch.set",t,this.tp);n=md("WriteBatch.set",n);var i=Ed(r.ip,e,"WriteBatch.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.tp.Wm.nd(s,o,n.mergeFields):this.tp.Wm.Zl(s,o);return this.ep=this.ep.concat(a.Ll(r.Xm,Mo.NONE)),this},cd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.up(),i="string"==typeof e||e instanceof sl?(wi("WriteBatch.update",arguments,3),r=bd("WriteBatch.update",t,this.tp),this.tp.Wm.ud("WriteBatch.update",e,n,o)):(gi("WriteBatch.update",arguments,2),r=bd("WriteBatch.update",t,this.tp),this.tp.Wm.ed("WriteBatch.update",e)),this.ep=this.ep.concat(i.Ll(r.Xm,Mo.exists(!0))),this},cd.prototype.delete=function(t){gi("WriteBatch.delete",arguments,1),this.up();var e=bd("WriteBatch.delete",t,this.tp);return this.ep=this.ep.concat(new jo(e.Xm,Mo.NONE)),this},cd.prototype.commit=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.up(),this.rp=!0,0<this.ep.length?[2,this.tp.jm().write(this.ep)]:[2]})})},cd.prototype.up=function(){if(this.rp)throw new ti(Zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},cd),$p=(hd.$m=function(t,e,n){if(t.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.nt()+" has "+t.length);return new hd(new Hi(t),e,n)},Object.defineProperty(hd.prototype,"id",{get:function(){return this.Xm.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"parent",{get:function(){return new yd(this.Xm.path.H(),this.firestore,this.ip)},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"path",{get:function(){return this.Xm.path.nt()},enumerable:!0,configurable:!0}),hd.prototype.collection=function(t){if(gi("DocumentReference.collection",arguments,1),Ei("DocumentReference.collection","non-empty string",1,t),!t)throw new ti(Zr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=ji.it(t);return new yd(this.Xm.path.child(e),this.firestore)},hd.prototype.isEqual=function(t){if(!(t instanceof hd))throw xi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.Xm.isEqual(t.Xm)&&this.ip===t.ip},hd.prototype.set=function(t,e){bi("DocumentReference.set",arguments,1,2),e=md("DocumentReference.set",e);var n=Ed(this.ip,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.Wm.nd(i,r,e.mergeFields):this.firestore.Wm.Zl(i,r);return this.Lm.write(o.Ll(this.Xm,Mo.NONE))},hd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof sl?(wi("DocumentReference.update",arguments,2),this.firestore.Wm.ud("DocumentReference.update",t,e,r)):(gi("DocumentReference.update",arguments,1),this.firestore.Wm.ed("DocumentReference.update",t)),this.Lm.write(n.Ll(this.Xm,Mo.exists(!0)))},hd.prototype.delete=function(){return gi("DocumentReference.delete",arguments,0),this.Lm.write([new jo(this.Xm,Mo.NONE)])},hd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||zp(t[i])||(_i("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ti("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=zp(t[i])?t[i]:(Ei("DocumentReference.onSnapshot","function",i,t[i]),Ii("DocumentReference.onSnapshot","function",i+1,t[i+1]),Ii("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.sp(o,n)},hd.prototype.sp=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Up({next:function(t){if(n.next){jr(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r.Xm);n.next(new td(r.firestore,r.Xm,e,t.fromCache,t.hasPendingWrites,r.ip))}},error:e}),o=this.Lm.listen(ma.ti(this.Xm.path),i,t);return function(){i.Fm(),r.Lm.$d(o)}},hd.prototype.get=function(n){var r=this;return bi("DocumentReference.get",arguments,0,1),wd("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.jm().Vm(r.Xm).then(function(t){e(new td(r.firestore,r.Xm,t,!0,t instanceof Ls&&t.un,r.ip))},t):r.hp(e,t,n)})},hd.prototype.hp=function(e,n,r){var i=this.sp({includeMetadataChanges:!0,gm:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new ti(Zr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},hd.prototype.withConverter=function(t){return new hd(this.Xm,this.firestore,t)},hd),Zp=(ud.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},ud),td=(ad.prototype.data=function(t){if(bi("DocumentSnapshot.data",arguments,0,1),t=gd("DocumentSnapshot.data",t),this.cp){if(this.ip){var e=new ed(this.tp,this.Xm,this.cp,this.ap,this.fp);return this.ip.fromFirestore(e,t)}return this.lp(this.cp.data(),Zo.Cn(t,this.tp.Zm()))}},ad.prototype.get=function(t,e){if(bi("DocumentSnapshot.get",arguments,1,2),e=gd("DocumentSnapshot.get",e),this.cp){var n=this.cp.data().field(Jl("DocumentSnapshot.get",t));if(null!==n)return this.dp(n,Zo.Cn(e,this.tp.Zm()))}},Object.defineProperty(ad.prototype,"id",{get:function(){return this.Xm.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"ref",{get:function(){return new $p(this.Xm,this.tp,this.ip)},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"exists",{get:function(){return null!==this.cp},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"metadata",{get:function(){return new Zp(this.fp,this.ap)},enumerable:!0,configurable:!0}),ad.prototype.isEqual=function(t){if(!(t instanceof ad))throw xi("isEqual","DocumentSnapshot",1,t);return this.tp===t.tp&&this.ap===t.ap&&this.Xm.isEqual(t.Xm)&&(null===this.cp?null===t.cp:this.cp.isEqual(t.cp))&&this.ip===t.ip},ad.prototype.lp=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.dp(e,n)}),i},ad.prototype.dp=function(t,e){if(t instanceof xs)return this.lp(t,e);if(t instanceof Os)return this.vp(t,e);if(t instanceof Rs){var n=t.value(e),r=this.tp.jm().s();return t.s.isEqual(r)||qr("Document "+this.Xm.path+" contains a document reference within a different database ("+t.s.projectId+"/"+t.s.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new $p(n,this.tp,this.ip)}return t.value(e)},ad.prototype.vp=function(t,e){var n=this;return t.Ht.map(function(t){return n.dp(t,e)})},ad),ed=(t(sd,Jp=td),sd.prototype.data=function(t){var e=Jp.prototype.data.call(this,t);return jr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},sd),nd=(od.prototype.where=function(t,e,n){var r;gi("Query.where",arguments,3),Ri("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+Di(r)+" provided to function "+t+"() for its "+Oi(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=Jl("Query.where",t),o=ga.it(e);if(i.ut()){if(o===ga.ARRAY_CONTAINS||o===ga.ARRAY_CONTAINS_ANY)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===ga.IN){this.mp(n,o);for(var s=[],a=0,u=n;a<u.length;a++){var h=u[a];s.push(this.pp(h))}r=new Os(s)}else r=this.pp(n)}else o!==ga.IN&&o!==ga.ARRAY_CONTAINS_ANY||this.mp(n,o),r=this.firestore.Wm.sd("Query.where",n,o===ga.IN);var c=wa.create(i,o,r);return this.gp(c),new od(this.wp.ei(c),this.firestore,this.ip)},od.prototype.orderBy=function(t,e){var n;if(bi("Query.orderBy",arguments,1,2),Ii("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Aa.ASCENDING;else{if("desc"!==e)throw new ti(Zr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Aa.DESCENDING}if(null!==this.wp.startAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.wp.endAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Jl("Query.orderBy",t),i=new ka(r,n);return this.bp(i),new od(this.wp.ui(i),this.firestore,this.ip)},od.prototype.limit=function(t){return gi("Query.limit",arguments,1),Ei("Query.limit","number",1,t),Ci("Query.limit",1,t),new od(this.wp.si(t),this.firestore,this.ip)},od.prototype.limitToLast=function(t){return gi("Query.limitToLast",arguments,1),Ei("Query.limitToLast","number",1,t),Ci("Query.limitToLast",1,t),new od(this.wp.oi(t),this.firestore,this.ip)},od.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAt",arguments,1);var r=this.yp("Query.startAt",t,e,!0);return new od(this.wp.hi(r),this.firestore,this.ip)},od.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAfter",arguments,1);var r=this.yp("Query.startAfter",t,e,!1);return new od(this.wp.hi(r),this.firestore,this.ip)},od.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endBefore",arguments,1);var r=this.yp("Query.endBefore",t,e,!0);return new od(this.wp.ci(r),this.firestore,this.ip)},od.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endAt",arguments,1);var r=this.yp("Query.endAt",t,e,!1);return new od(this.wp.ci(r),this.firestore,this.ip)},od.prototype.isEqual=function(t){if(!(t instanceof od))throw xi("isEqual","Query",1,t);return this.firestore===t.firestore&&this.wp.isEqual(t.wp)},od.prototype.withConverter=function(t){return new od(this.wp,this.firestore,t)},od.prototype.yp=function(t,e,n,r){if(Ri(t,1,e),e instanceof td){if(0<n.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new ti(Zr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this._p(t,i.cp,r)}var o=[e].concat(n);return this.Ip(t,o,r)},od.prototype._p=function(t,e,n){for(var r=[],i=0,o=this.wp.orderBy;i<o.length;i++){var s=o[i];if(s.field.ut())r.push(new Rs(this.firestore.Bm,e.key));else{var a=e.field(s.field);if(a instanceof ks)throw new ti(Zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var u=s.field.nt();throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new Sa(r,n)},od.prototype.Ip=function(t,e,n){var r=this.wp.Jn;if(e.length>r.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.ut()){if("string"!=typeof s)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.wp._i()&&-1!==s.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this.wp.path.child(ji.it(s));if(!Hi.ht(a))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new Hi(a);i.push(new Rs(this.firestore.Bm,u))}else{var h=this.firestore.Wm.sd(t,s);i.push(h)}}return new Sa(i,n)},od.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||zp(t[i])||(_i("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ti("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=zp(t[i])?t[i]:(Ei("Query.onSnapshot","function",i,t[i]),Ii("Query.onSnapshot","function",i+1,t[i+1]),Ii("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Tp(this.wp),this.sp(r,n)},od.prototype.sp=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Up({next:function(t){e.next&&e.next(new rd(n.firestore,n.wp,t,n.ip))},error:r}),o=this.firestore.jm(),s=o.listen(this.wp,i,t);return function(){i.Fm(),o.$d(s)}},od.prototype.Tp=function(t){if(t.bi()&&0===t.Jn.length)throw new ti(Zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},od.prototype.get=function(n){var r=this;return bi("Query.get",arguments,0,1),wd("Query.get",n),this.Tp(this.wp),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.jm().Nm(r.wp).then(function(t){e(new rd(r.firestore,r.wp,t,r.ip))},t):r.hp(e,t,n)})},od.prototype.hp=function(e,n,r){var i=this.sp({includeMetadataChanges:!0,gm:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},od.prototype.pp=function(t){if("string"==typeof t){if(""===t)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.wp._i()&&-1!==t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.wp.path.child(ji.it(t));if(!Hi.ht(e))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Rs(this.firestore.Bm,new Hi(e))}if(t instanceof $p){var n=t;return new Rs(this.firestore.Bm,n.Xm)}throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Di(t)+".")},od.prototype.mp=function(t,e){if(!Array.isArray(t)||0===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},od.prototype.gp=function(t){if(t instanceof wa){var e=[ga.ARRAY_CONTAINS,ga.ARRAY_CONTAINS_ANY],n=[ga.IN,ga.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ri()){var o=this.wp.ni();if(null!==o&&!o.isEqual(t.field))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.wp.ii();null!==s&&this.Ep(t.field,s)}else if(i||r){var a=null;if(i&&(a=this.wp.yi(n)),null===a&&r&&(a=this.wp.yi(e)),null!=a)throw a===t.op?new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+a.toString()+"' filters.")}}},od.prototype.bp=function(t){if(null===this.wp.ii()){var e=this.wp.ni();null!==e&&this.Ep(e,t.field)}},od.prototype.Ep=function(t,e){if(!e.isEqual(t))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},od),rd=(Object.defineProperty(id.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"empty",{get:function(){return this.Ap.docs.J()},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"size",{get:function(){return this.Ap.docs.size},enumerable:!0,configurable:!0}),id.prototype.forEach=function(e,n){var r=this;bi("QuerySnapshot.forEach",arguments,1,2),Ei("QuerySnapshot.forEach","function",1,e),this.Ap.docs.forEach(function(t){e.call(n,r.Sp(t))})},Object.defineProperty(id.prototype,"query",{get:function(){return new nd(this.Rp,this.tp,this.ip)},enumerable:!0,configurable:!0}),id.prototype.docChanges=function(t){t&&(_i("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ti("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Ap.Xi)throw new ti(Zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Dp&&this.Pp===e||(this.Dp=function(i,e,o,s){if(o.Hi.J()){var n,r=0;return o.docChanges.map(function(t){var e=new ed(i,t.doc.key,t.doc,o.fromCache,o.Ji.has(t.doc.key),s);return jr(t.type===lu.Bi,"Invalid event type for first snapshot"),jr(!n||o.query.di(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.Hi;return o.docChanges.filter(function(t){return e||t.type!==lu.Qi}).map(function(t){var e=new ed(i,t.doc.key,t.doc,o.fromCache,o.Ji.has(t.doc.key),s),n=-1,r=-1;return t.type!==lu.Bi&&(jr(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==lu.Mi&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case lu.Bi:return"added";case lu.qi:case lu.Qi:return"modified";case lu.Mi:return"removed";default:return Gr("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.tp,e,this.Ap,this.ip),this.Pp=e),this.Dp},id.prototype.isEqual=function(t){if(!(t instanceof id))throw xi("isEqual","QuerySnapshot",1,t);return this.tp===t.tp&&this.Rp.isEqual(t.Rp)&&this.Ap.isEqual(t.Ap)&&this.ip===t.ip},id.prototype.Sp=function(t){return new ed(this.tp,t.key,t,this.metadata.fromCache,this.Ap.Ji.has(t.key),this.ip)},id);function id(t,e,n,r){this.tp=t,this.Rp=e,this.Ap=n,this.ip=r,this.Dp=null,this.Pp=null,this.metadata=new Zp(n.hasPendingWrites,n.fromCache)}function od(t,e,n){this.wp=t,this.firestore=e,this.ip=n}function sd(){return null!==Jp&&Jp.apply(this,arguments)||this}function ad(t,e,n,r,i,o){this.tp=t,this.Xm=e,this.cp=n,this.ap=r,this.fp=i,this.ip=o}function ud(t,e){this.hasPendingWrites=t,this.fromCache=e}function hd(t,e,n){this.Xm=t,this.firestore=e,this.ip=n,this.Lm=this.firestore.jm()}function cd(t){this.tp=t,this.ep=[],this.rp=!1}function fd(t,e){this.tp=t,this.np=e}function ld(t,e){var n=this;if(this.Um=null,this.xm=new sh,this.INTERNAL={delete:function(){return p(n,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.jm(),[4,this.Lm.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this.Um=r,this.Bm=ld.Mm(r),this.qm=r.name,this.Qm=new ni(e)}else{var i=t;if(!i.projectId)throw new ti(Zr.INVALID_ARGUMENT,"Must provide projectId");this.Bm=new Kr(i.projectId,i.database),this.qm="[DEFAULT]",this.Qm=new ei}this.Gm=new Yp({}),this.Wm=this.zm(this.Bm)}function pd(t){if(void 0===t.host){if(void 0!==t.ssl)throw new ti(Zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ni("settings","non-empty string","host",t.host),this.host=t.host,Ti("settings","boolean","ssl",t.ssl),this.ssl=pi(t.ssl,!0);if(_i("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ti("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ti("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?qr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&qr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=pi(t.timestampsInSnapshots,!0),Ti("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=pc.Cc;else{if(t.cacheSizeBytes!==Wp&&t.cacheSizeBytes<pc.Sc)throw new ti(Zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+pc.Sc);this.cacheSizeBytes=t.cacheSizeBytes}Ti("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}s(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(rd.prototype.docChanges,t,{get:function(){return function(){throw new ti(Zr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var dd,yd=(t(vd,dd=nd),Object.defineProperty(vd.prototype,"id",{get:function(){return this.wp.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(vd.prototype,"parent",{get:function(){var t=this.wp.path.H();return t.J()?null:new $p(new Hi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(vd.prototype,"path",{get:function(){return this.wp.path.nt()},enumerable:!0,configurable:!0}),vd.prototype.doc=function(t){if(bi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Fr.u()),Ei("CollectionReference.doc","non-empty string",1,t),""===t)throw new ti(Zr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=ji.it(t);return $p.$m(this.wp.path.child(e),this.firestore,this.ip)},vd.prototype.add=function(t){gi("CollectionReference.add",arguments,1),Ei("CollectionReference.add","object",1,this.ip?this.ip.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},vd.prototype.withConverter=function(t){return new vd(this.Cp,this.firestore,t)},vd);function vd(t,e,n){var r=dd.call(this,ma.ti(t),e,n)||this;if((r.Cp=t).length%2!=1)throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.nt()+" has "+t.length);return r}function md(t,e){if(void 0===e)return{merge:!1};if(_i(t,e,["merge","mergeFields"]),Ti(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Di(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Di(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof sl}),void 0!==e.mergeFields&&void 0!==e.merge)throw new ti(Zr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gd(t,e){return void 0===e?{}:(_i(t,e,["serverTimestamps"]),Ai(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function wd(t,e){Ii(t,"object",1,e),e&&(_i(t,e,["source"]),Ai(t,0,"source",e.source,["default","server","cache"]))}function bd(t,e,n){if(e instanceof $p){if(e.firestore!==n)throw new ti(Zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw xi(t,"DocumentReference",1,e)}function Ed(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Id=Yu(Xp,"Use firebase.firestore() instead."),Nd=Yu(Qp,"Use firebase.firestore().runTransaction() instead."),Td=Yu(Kp,"Use firebase.firestore().batch() instead."),Ad=Yu($p,"Use firebase.firestore().doc() instead."),Sd=Yu(td),kd=Yu(ed),Dd=Yu(nd),Rd=Yu(rd),_d=Yu(yd,"Use firebase.firestore().collection() instead."),xd={Firestore:Id,GeoPoint:Ui,Timestamp:qi,Blob:eh,Transaction:Nd,WriteBatch:Td,DocumentReference:Ad,DocumentSnapshot:Sd,Query:Dd,QueryDocumentSnapshot:kd,QuerySnapshot:Rd,CollectionReference:_d,FieldPath:sl,FieldValue:Sl,setLogLevel:Xp.setLogLevel,CACHE_SIZE_UNLIMITED:Wp};var Cd=(Bd.prototype.Od=function(t){},Bd.prototype.shutdown=function(){},Bd),Od=(Fd.prototype.Od=function(t){this.Fp.push(t)},Fd.prototype.shutdown=function(){window.removeEventListener("online",this.kp),window.removeEventListener("offline",this.Np)},Fd.prototype.Up=function(){window.addEventListener("online",this.kp),window.addEventListener("offline",this.Np)},Fd.prototype.Vp=function(){Ur("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Fp;t<e.length;t++)(0,e[t])(0)},Fd.prototype.Op=function(){Ur("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Fp;t<e.length;t++)(0,e[t])(1)},Fd.Hs=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Fd),Pd=(jd.prototype.yl=function(t){jr(!this.Lp,"Called onOpen on stream twice!"),this.Lp=t},jd.prototype.wl=function(t){jr(!this.Bp,"Called onClose on stream twice!"),this.Bp=t},jd.prototype.onMessage=function(t){jr(!this.Mp,"Called onMessage on stream twice!"),this.Mp=t},jd.prototype.close=function(){this.jp()},jd.prototype.send=function(t){this.xp(t)},jd.prototype.qp=function(){jr(void 0!==this.Lp,"Cannot call onOpen because no callback was set"),this.Lp()},jd.prototype.Qp=function(t){jr(void 0!==this.Bp,"Cannot call onClose because no callback was set"),this.Bp(t)},jd.prototype.Gp=function(t){jr(void 0!==this.Mp,"Cannot call onMessage because no callback was set"),this.Mp(t)},jd),Ld={BatchGetDocuments:"batchGet",Commit:"commit"},Md="gl-js/ fire/"+Or,Ud=(Gd.prototype.zp=function(t,e){if(e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n]);t["X-Goog-Api-Client"]=Md},Gd.prototype.Vl=function(u,r,i){var h=this,c=this.Kp(u);return new Promise(function(o,s){var a=new Cr;a.listenOnce(_r.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Rr.NO_ERROR:var t=a.getResponseJson();Ur("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Rr.TIMEOUT:Ur("Connection",'RPC "'+u+'" timed out'),s(new ti(Zr.DEADLINE_EXCEEDED,"Request time out"));break;case Rr.HTTP_ERROR:var e=a.getStatus();if(Ur("Connection",'RPC "'+u+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Zr).indexOf(i)?i:Zr.UNKNOWN);s(new ti(r,n.message))}else s(new ti(Zr.UNKNOWN,"Server responded with status "+a.getStatus()))}else Ur("Connection",'RPC "'+u+'" failed'),s(new ti(Zr.UNAVAILABLE,"Connection failed."));break;default:Gr('RPC "'+u+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Ur("Connection",'RPC "'+u+'" completed.')}var i});var t=f({},r);delete t.database;var e=JSON.stringify(t);Ur("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.zp(n,i),a.send(c,"POST",e,n,15)})},Gd.prototype.Nl=function(t,e,n){return this.Vl(t,e,n)},Gd.prototype._l=function(t,e){var n=[this.Wp,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Dr(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.zp(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||function(){var t=l();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=l().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ur("Connection","Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),a=!1,h=!1,c=new Pd({xp:function(t){h?Ur("Connection","Not sending because WebChannel is closed:",t):(a||(Ur("Connection","Opening WebChannel transport."),u.open(),a=!0),Ur("Connection","WebChannel sending:",t),u.send(t))},jp:function(){return u.close()}});return s(xr.EventType.OPEN,function(){h||Ur("Connection","WebChannel transport opened.")}),s(xr.EventType.CLOSE,function(){h||(h=!0,Ur("Connection","WebChannel transport closed"),c.Qp())}),s(xr.EventType.ERROR,function(t){h||(h=!0,Ur("Connection","WebChannel transport errored:",t),c.Qp(new ti(Zr.UNAVAILABLE,"The operation could not be completed")))}),s(xr.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];jr(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Ur("Connection","WebChannel received error:",i);var o=i.status,s=function(){var t=Wa[o];if(void 0!==t)return tu(t)}(),a=i.message;void 0===s&&(s=Zr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,c.Qp(new ti(s,a)),u.close()}else Ur("Connection","WebChannel received:",n),c.Gp(n)}}),setTimeout(function(){c.qp()},0),c},Gd.prototype.Kp=function(t){var e=Ld[t];return jr(void 0!==e,"Unknown REST mapping for: "+t),this.Wp+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},Gd),qd=(Object.defineProperty(Vd.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Vd.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Vd.prototype.Am=function(t){return Promise.resolve(new Ud(t))},Vd.prototype.Pm=function(){return Od.Hs()?new Od:new Cd},Vd.prototype.Sm=function(t){return new Hu(t,{Ze:!0})},Vd.prototype.i=function(t){return JSON.stringify(t)},Vd.prototype.atob=function(t){return atob(t)},Vd.prototype.btoa=function(t){return btoa(t)},Vd);function Vd(){this.du="undefined"!=typeof atob}function Gd(t){this.s=t.s;var e=t.ssl?"https":"http";this.Wp=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function jd(t){this.xp=t.xp,this.jp=t.jp}function Fd(){var t=this;this.kp=function(){return t.Vp()},this.Np=function(){return t.Op()},this.Fp=[],this.Up()}function Bd(){}zu.lu(new qd);var Hd,zd;(zd=Jd).INTERNAL.registerComponent(new b("firestore",function(t){var e=t.getProvider("app").getImmediate();return new Xp(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps((jr((Hd=xd)&&"object"==typeof Hd,"shallowCopy() expects object parameter."),f({},Hd)))),zd.registerVersion("@firebase/firestore","1.11.2")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map